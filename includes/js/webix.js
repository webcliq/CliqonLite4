/* webix.js v1.10.0 */
if(!window.webix)webix={};webix.assert=function(e,t){if(!e){webix.assert_error(t)}};webix.assert_config=function(e){var t=e.cells||e.rows||e.elements||e.cols;if(t)for(var n=0;n<t.length;n++)if(t[n]===null||typeof t[n]==="undefined")webix.assert_error("You have trailing comma or Null element in collection's configuration")};webix.assert_error=function(e){webix.log("error",e);if(webix.message&&typeof e=="string")webix.message({type:"debug",text:e,expire:-1});if(webix.debug!==false)debugger};webix.assert_core_ready=function(){if(window.webix_on_core_ready)window.webix_on_core_ready()};webix.assert_level=0;webix.assert_level_in=function(){webix.assert_level++;if(webix.assert_level==100)webix.assert_error("Attempt to copy object with self reference")};webix.assert_level_out=function(){webix.assert_level--};webix.version="1.10.0";webix.codebase="./";webix.name="core";webix.clone=function(e){var t=webix.clone._function;t.prototype=e;return new t};webix.clone._function=function(){};webix.extend=function(e,t,n){webix.assert(e,"Invalid mixing target");webix.assert(t,"Invalid mixing source");if(e._webix_proto_wait){webix.PowerArray.insertAt.call(e._webix_proto_wait,t,1);return e}for(var r in t)if(!e[r]||n)e[r]=t[r];if(t.defaults)webix.extend(e.defaults,t.defaults);if(t.$init)t.$init.call(e);return e};webix.copy=function(e){webix.assert(e,"Invalid mixing target");webix.assert_level_in();var t;if(arguments.length>1){t=arguments[0];e=arguments[1]}else t=webix.isArray(e)?[]:{};for(var n in e){if(e[n]&&typeof e[n]=="object"&&!webix.isDate(e[n])){t[n]=webix.isArray(e[n])?[]:{};webix.copy(t[n],e[n])}else{t[n]=e[n]}}webix.assert_level_out();return t};webix.single=function(e){var t=null;var n=function(n){if(!t)t=new e({});if(t._reinit)t._reinit.apply(t,arguments);return t};return n};webix.protoUI=function(){if(webix.debug_proto)webix.log("UI registered: "+arguments[0].name);var e=arguments;var t=e[0].name;var n=function(e){if(!n)return webix.ui[t].prototype;var r=n._webix_proto_wait;if(r){var i=[r[0]];for(var s=1;s<r.length;s++){i[s]=r[s];if(i[s]._webix_proto_wait)i[s]=i[s].call(webix,i[s].name);if(i[s].prototype&&i[s].prototype.name)webix.ui[i[s].prototype.name]=i[s]}webix.ui[t]=webix.proto.apply(webix,i);if(n._webix_type_wait)for(var s=0;s<n._webix_type_wait.length;s++)webix.type(webix.ui[t],n._webix_type_wait[s]);n=r=null}if(this!=webix)return new webix.ui[t](e);else return webix.ui[t]};n._webix_proto_wait=Array.prototype.slice.call(arguments,0);return webix.ui[t]=n};webix.proto=function(){if(webix.debug_proto)webix.log("Proto chain:"+arguments[0].name+"["+arguments.length+"]");var e=arguments;var t=e[0];var n=!!t.$init;var r=[];webix.assert(t,"Invalid mixing target");for(var i=e.length-1;i>0;i--){webix.assert(e[i],"Invalid mixing source");if(typeof e[i]=="function")e[i]=e[i].prototype;if(e[i].$init)r.push(e[i].$init);if(e[i].defaults){var s=e[i].defaults;if(!t.defaults)t.defaults={};for(var o in s)if(webix.isUndefined(t.defaults[o]))t.defaults[o]=s[o]}if(e[i].type&&t.type){for(var o in e[i].type)if(!t.type[o])t.type[o]=e[i].type[o]}for(var u in e[i]){if(!t[u]&&t[u]!==false)t[u]=e[i][u]}}if(n)r.push(t.$init);t.$init=function(){for(var e=0;e<r.length;e++)r[e].apply(this,arguments)};if(t.$skin)t.$skin();var a=function(e){this.$ready=[];webix.assert(this.$init,"object without init method");this.$init(e);if(this._parseSettings)this._parseSettings(e,this.defaults);for(var t=0;t<this.$ready.length;t++)this.$ready[t].call(this)};a.prototype=t;t=e=null;return a};webix.bind=function(e,t){return function(){return e.apply(t,arguments)}};webix.require=function(e,t,n){if(webix.require.disabled){if(t)t.call(n||this);return}if(typeof e!="string"){var r=e.length||0;var i=t;if(!r){for(var s in e)r++;t=function(){r--;if(r===0)i.apply(this,arguments)};for(var s in e)webix.require(s,t,n)}else{t=function(){if(r){r--;webix.require(e[e.length-r-1],t,n)}else return i.apply(this,arguments)};t()}return}if(webix._modules[e]!==true){if(e.substr(-4)==".css"){var o=webix.html.create("LINK",{type:"text/css",rel:"stylesheet",href:webix.codebase+e});document.head.appendChild(o);if(t)t.call(n||window);return}var u=arguments[4];if(!t){webix.exec(webix.ajax().sync().get(webix.codebase+e).responseText);webix._modules[e]=true}else{if(!webix._modules[e]){webix._modules[e]=[[t,n]];webix.ajax(webix.codebase+e,function(t){webix.exec(t);var n=webix._modules[e];webix._modules[e]=true;for(var r=0;r<n.length;r++)n[r][0].call(n[r][1]||window,!r)})}else webix._modules[e].push([t,n])}}else if(t)t()};webix._modules={};webix.exec=function(e){if(window.execScript)window.execScript(e);else window.eval(e)};webix.wrap=function(e,t){if(!e)return t;return function(){var n=e.apply(this,arguments);t.apply(this,arguments);return n}};webix.isUndefined=function(e){return typeof e=="undefined"};webix.delay=function(e,t,n,r){return window.setTimeout(function(){if(!(t&&t.$destructed)){var r=e.apply(t,n||[]);e=t=n=null;return r}},r||1)};webix.once=function(e){var t=true;return function(){if(t){t=false;e.apply(this,arguments)}}};webix.uid=function(){if(!this._seed)this._seed=(new Date).valueOf();this._seed++;return this._seed};webix.toNode=function(e){if(typeof e=="string")return document.getElementById(e);return e};webix.toArray=function(e){return webix.extend(e||[],webix.PowerArray,true)};webix.toFunctor=function(str,scope){if(typeof str=="string"){var method=str.replace("()","");if(scope&&scope[method])return scope[method];return window[method]||eval(str)}return str};webix.isArray=function(e){return Array.isArray?Array.isArray(e):Object.prototype.toString.call(e)==="[object Array]"};webix.isDate=function(e){return e instanceof Date};webix._events={};webix.event=function(e,t,n,r){e=webix.toNode(e);webix.assert(e,"Invalid node as target for webix.event");var i=webix.uid();if(r)n=webix.bind(n,r);webix._events[i]=[e,t,n];if(e.addEventListener)e.addEventListener(t,n,false);else if(e.attachEvent)e.attachEvent("on"+t,webix._events[i][2]=function(){return n.apply(e,arguments)});return i};webix.eventRemove=function(e){if(!e)return;webix.assert(this._events[e],"Removing non-existing event");var t=webix._events[e];if(t[0].removeEventListener)t[0].removeEventListener(t[1],t[2],false);else if(t[0].detachEvent)t[0].detachEvent("on"+t[1],t[2]);delete this._events[e]};webix.log=function(e,t,n){if(arguments.length==1){t=e;e="log"}if(window.console&&window.console.log){e=e.toLowerCase();if(window.console[e])window.console[e](t||"unknown error");else window.console.log(e+": "+t);if(n)window.console.log(n)}};webix.log_full_time=function(e){webix._start_time_log=new Date;webix.log("Timing start ["+e+"]");window.setTimeout(function(){var t=new Date;webix.log("Timing end ["+e+"]:"+(t.valueOf()-webix._start_time_log.valueOf())/1e3+"s")},1)};webix.log_time=function(e){var t="_start_time_log"+e;if(!webix[t]){webix[t]=new Date;webix.log("Info","Timing start ["+e+"]")}else{var n=new Date;webix.log("Info","Timing end ["+e+"]:"+(n.valueOf()-webix[t].valueOf())/1e3+"s");webix[t]=null}};webix.debug_code=function(e){e.call(webix)};webix.EventSystem={$init:function(){if(!this._evs_events){this._evs_events={};this._evs_handlers={};this._evs_map={}}},blockEvent:function(){this._evs_events._block=true},unblockEvent:function(){this._evs_events._block=false},mapEvent:function(e){webix.extend(this._evs_map,e,true)},on_setter:function(e){if(e){for(var t in e){var n=webix.toFunctor(e[t],this.$scope);var r=t.indexOf("->");if(r!==-1){this[t.substr(0,r)].attachEvent(t.substr(r+2),webix.bind(n,this))}else this.attachEvent(t,n)}}},callEvent:function(e,t){if(this._evs_events._block)return true;e=e.toLowerCase();var n=this._evs_events[e.toLowerCase()];var r=true;if(webix.log)if((webix.debug||this.debug)&&!webix.debug_blacklist[e])webix.log("info","["+this.name+"@"+(this._settings||{}).id+"] event:"+e,t);if(n)for(var i=0;i<n.length;i++){if(n[i].apply(this,t||[])===false)r=false}if(this._evs_map[e]){var s=this._evs_map[e];s.$eventSource=this;if(!s.callEvent(e,t))r=false;s.$eventSource=null}return r},attachEvent:function(e,t,n){webix.assert(t,"Invalid event handler for "+e);e=e.toLowerCase();n=n||webix.uid();t=webix.toFunctor(t,this.$scope);var r=this._evs_events[e]||webix.toArray();if(arguments[3])r.unshift(t);else r.push(t);this._evs_events[e]=r;this._evs_handlers[n]={f:t,t:e};return n},detachEvent:function(e){if(!this._evs_handlers[e]){return}var t=this._evs_handlers[e].t;var n=this._evs_handlers[e].f;var r=this._evs_events[t];r.remove(n);delete this._evs_handlers[e]},hasEvent:function(e){e=e.toLowerCase();return this._evs_events[e]?true:false}};webix.extend(webix,webix.EventSystem);webix.PowerArray={removeAt:function(e,t){if(e>=0)this.splice(e,t||1)},remove:function(e){this.removeAt(this.find(e))},insertAt:function(e,t){if(!t&&t!==0)this.push(e);else{var n=this.splice(t,this.length-t);this[t]=e;this.push.apply(this,n)}},find:function(e){for(var t=0;t<this.length;t++)if(e==this[t])return t;return-1},each:function(e,t){for(var n=0;n<this.length;n++)e.call(t||this,this[n])},map:function(e,t){for(var n=0;n<this.length;n++)this[n]=e.call(t||this,this[n]);return this},filter:function(e,t){for(var n=0;n<this.length;n++)if(!e.call(t||this,this[n])){this.splice(n,1);n--}return this}};webix.env={};(function(){if(navigator.userAgent.indexOf("Mobile")!=-1||navigator.userAgent.indexOf("Windows Phone")!=-1)webix.env.mobile=true;if(webix.env.mobile||navigator.userAgent.indexOf("iPad")!=-1||navigator.userAgent.indexOf("Android")!=-1)webix.env.touch=true;if(navigator.userAgent.indexOf("Opera")!=-1)webix.env.isOpera=true;else{webix.env.isIE=!!document.all;if(webix.env.isIE){var e=parseFloat(navigator.appVersion.split("MSIE")[1]);if(e==8)webix.env.isIE8=true}webix.env.isFF=navigator.userAgent.indexOf("Firefox")!=-1;webix.env.isWebKit=navigator.userAgent.indexOf("KHTML")!=-1;webix.env.isSafari=webix.env.isWebKit&&navigator.userAgent.indexOf("Mac")!=-1}if(navigator.userAgent.toLowerCase().indexOf("android")!=-1)webix.env.isAndroid=true;webix.env.transform=false;webix.env.transition=false;var t=-1;var n=["","webkit","Moz","O","ms"];var r=["","-webkit-","-Moz-","-o-","-ms-"];var i=document.createElement("DIV");for(var s=0;s<n.length;s++){var o=n[s]?n[s]+"Transform":"transform";if(typeof i.style[o]!="undefined"){t=s;break}}if(t>-1){webix.env.cssPrefix=r[t];var u=webix.env.jsPrefix=n[t];webix.env.transform=u?u+"Transform":"transform";webix.env.transition=u?u+"Transition":"transition";webix.env.transitionDuration=u?u+"TransitionDuration":"transitionDuration";i.style[webix.env.transform]="translate3d(0,0,0)";webix.env.translate=i.style[webix.env.transform]?"translate3d":"translate";webix.env.transitionEnd=webix.env.cssPrefix=="-Moz-"?"transitionend":u?u+"TransitionEnd":"transitionend"}})();webix.env.svg=function(){return document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")}();webix.html={_native_on_selectstart:0,denySelect:function(){if(!webix._native_on_selectstart)webix._native_on_selectstart=document.onselectstart;document.onselectstart=webix.html.stopEvent},allowSelect:function(){if(webix._native_on_selectstart!==0){document.onselectstart=webix._native_on_selectstart||null}webix._native_on_selectstart=0},index:function(e){var t=0;while(e=e.previousSibling)t++;return t},_style_cache:{},createCss:function(e){var t="";for(var n in e)t+=n+":"+e[n]+";";var r=this._style_cache[t];if(!r){r="s"+webix.uid();this.addStyle("."+r+"{"+t+"}");this._style_cache[t]=r}return r},addStyle:function(e){var t=document.createElement("style");t.setAttribute("type","text/css");t.setAttribute("media","screen");if(t.styleSheet)t.styleSheet.cssText=e;else t.appendChild(document.createTextNode(e));document.getElementsByTagName("head")[0].appendChild(t)},create:function(e,t,n){t=t||{};var r=document.createElement(e);for(var i in t)r.setAttribute(i,t[i]);if(t.style)r.style.cssText=t.style;if(t["class"])r.className=t["class"];if(n)r.innerHTML=n;return r},getValue:function(e){e=webix.toNode(e);if(!e)return"";return webix.isUndefined(e.value)?e.innerHTML:e.value},remove:function(e){if(e instanceof Array)for(var t=0;t<e.length;t++)this.remove(e[t]);else if(e&&e.parentNode)e.parentNode.removeChild(e)},insertBefore:function(e,t,n){if(!e)return;if(t&&t.parentNode)t.parentNode.insertBefore(e,t);else n.appendChild(e)},locate:function(e,t){var n;if(e.tagName)n=e;else{e=e||event;n=e.target||e.srcElement}while(n){if(n.getAttribute){var r=n.getAttribute(t);if(r)return r}n=n.parentNode}return null},offset:function(e){if(e.getBoundingClientRect){var t=e.getBoundingClientRect();var n=document.body;var r=document.documentElement;var i=window.pageYOffset||r.scrollTop||n.scrollTop;var s=window.pageXOffset||r.scrollLeft||n.scrollLeft;var o=r.clientTop||n.clientTop||0;var u=r.clientLeft||n.clientLeft||0;var a=t.top+i-o;var f=t.left+s-u;return{y:Math.round(a),x:Math.round(f),width:e.offsetHeight,height:e.offsetWidth}}else{var a=0,f=0;while(e){a=a+parseInt(e.offsetTop,10);f=f+parseInt(e.offsetLeft,10);e=e.offsetParent}return{y:a,x:f,width:e.offsetHeight,height:e.offsetWidth}}},posRelative:function(e){e=e||event;if(!webix.isUndefined(e.offsetX))return{x:e.offsetX,y:e.offsetY};else return{x:e.layerX,y:e.layerY}},pos:function(e){e=e||event;if(e.touches&&e.touches[0])e=e.touches[0];if(e.pageX||e.pageY)return{x:e.pageX,y:e.pageY};var t=webix.env.isIE&&document.compatMode!="BackCompat"?document.documentElement:document.body;return{x:e.clientX+t.scrollLeft-t.clientLeft,y:e.clientY+t.scrollTop-t.clientTop}},preventEvent:function(e){if(e&&e.preventDefault)e.preventDefault();return webix.html.stopEvent(e)},stopEvent:function(e){(e||event).cancelBubble=true;return false},addCss:function(e,t){e.className+=" "+t},removeCss:function(e,t){e.className=e.className.replace(RegExp(" "+t,"g"),"")}};webix.ready=function(e){if(this._ready)e.call();else this._ready_code.push(e)};webix.debug_ready=webix.ready;webix._ready_code=[];(function(){var e=document.getElementsByTagName("SCRIPT");webix.assert(e.length,"Can't locate codebase");if(e.length){e=(e[e.length-1].getAttribute("src")||"").split("/");e.splice(e.length-1,1);webix.codebase=e.slice(0,e.length).join("/")+"/"}var t=function(){webix.callEvent("onReady",[])};webix.attachEvent("onReady",function(){webix.delay(function(){webix._ready=true;for(var e=0;e<webix._ready_code.length;e++)webix._ready_code[e].call();webix._ready_code=[]})});if(document.readyState=="complete")t();else webix.event(window,"load",t)})();webix.locale=webix.locale||{};webix.assert_core_ready();webix.ready(function(){webix.event(document.body,"click",function(e){webix.callEvent("onClick",[e||event])})});webix.editStop=function(){webix.callEvent("onEditEnd",[])};webix.debug_blacklist={onmousemoving:1};(function(e){function n(e,t){var n=this;n.promise=n;n.state="pending";n.val=null;n.fn=e||null;n.er=t||null;n.next=[]}var t=typeof setImmediate!=="undefined"?setImmediate:function(e){setTimeout(e,0)};n.prototype.resolve=function(e){var n=this;if(n.state==="pending"){n.val=e;n.state="resolving";t(function(){n.fire()})}};n.prototype.reject=function(e){var n=this;if(n.state==="pending"){n.val=e;n.state="rejecting";t(function(){n.fire()})}};n.prototype.then=function(e,t){var r=this;var i=new n(e,t);r.next.push(i);if(r.state==="resolved"){i.resolve(r.val)}if(r.state==="rejected"){i.reject(r.val)}return i};n.prototype.fail=function(e){return this.then(null,e)};n.prototype.finish=function(e){var t=this;t.state=e;if(t.state==="resolved"){t.next.map(function(e){e.resolve(t.val)})}if(t.state==="rejected"){t.next.map(function(e){e.reject(t.val)})}};n.prototype.thennable=function(e,t,n,r,i){var s=this;i=i||s.val;if(typeof i==="object"&&typeof e==="function"){try{var o=0;e.call(i,function(e){if(o++!==0)return;t(e)},function(e){if(o++!==0)return;n(e)})}catch(u){n(u)}}else{r(i)}};n.prototype.fire=function(){var e=this;var t;try{t=e.val&&e.val.then}catch(n){e.val=n;e.state="rejecting";return e.fire()}e.thennable(t,function(t){e.val=t;e.state="resolving";e.fire()},function(t){e.val=t;e.state="rejecting";e.fire()},function(n){e.val=n;if(e.state==="resolving"&&typeof e.fn==="function"){try{e.val=e.fn.call(undefined,e.val)}catch(r){e.val=r;return e.finish("rejected")}}if(e.state==="rejecting"&&typeof e.er==="function"){try{e.val=e.er.call(undefined,e.val);e.state="resolving"}catch(r){e.val=r;return e.finish("rejected")}}if(e.val===e){e.val=TypeError();return e.finish("rejected")}e.thennable(t,function(t){e.val=t;e.finish("resolved")},function(t){e.val=t;e.finish("rejected")},function(t){e.val=t;e.state==="resolving"?e.finish("resolved"):e.finish("rejected")})})};n.prototype.done=function(){if(this.state="rejected"&&!this.next){throw this.val}return null};n.prototype.nodeify=function(e){if(typeof e==="function")return this.then(function(t){try{e(null,t)}catch(n){setImmediate(function(){throw n})}return t},function(t){try{e(t)}catch(n){setImmediate(function(){throw n})}return t});return this};n.prototype.spread=function(e,t){return this.all().then(function(t){return typeof e==="function"&&e.apply(null,t)},t)};n.prototype.all=function(){var e=this;return this.then(function(t){function o(){if(++i===s)r.resolve(t)}var r=new n;if(!(t instanceof Array)){r.reject(TypeError);return r}var i=0;var s=t.length;for(var u=0,a=t.length;u<a;u++){var f=t[u];var l;try{l=f&&f.then}catch(c){r.reject(c);break}(function(n){e.thennable(l,function(e){t[n]=e;o()},function(e){t[n]=e;o()},function(){o()},f)})(u)}return r})};var r={defer:function(){return new n(null,null)},fcall:function(){var e=new n;var t=Array.apply([],arguments);var r=t.shift();try{var i=r.apply(null,t);e.resolve(i)}catch(s){e.reject(s)}return e},nfcall:function(){var e=new n;var t=Array.apply([],arguments);var r=t.shift();try{t.push(function(t,n){if(t){return e.reject(t)}return e.resolve(n)});r.apply(null,t)}catch(i){e.reject(i)}return e}};if(typeof module!=="undefined"){module.exports=r}else{e.promise=r}})(webix);(function(){function t(e,t,i){var s={name:t,data:i};var o=webix.promise.defer();o._syncid=setTimeout(function(){n(e,s,o)},1);o.sync=function(){clearTimeout(this._syncid);return r(e,s)};return o}function n(e,t,n){webix.ajax().post(e,t).then(function(e){var t=o(e.text());if(!t)n.reject();else n.resolve(t.data)},function(e){n.reject(e)});webix.callEvent("onRemoteCall",[n,t])}function r(e,t,n){webix.callEvent("onRemoteCall",[null,t]);return o(webix.ajax().sync().post(e,t).responseText).data}function s(e,t){if(typeof t=="string"){if(i.test(t))return new Date(t)}return t}function o(t){try{if(e.parseDates)return JSON.parse(t,s);else return JSON.parse(t)}catch(n){webix.assert(false,n.toString());return null}}var e={timeout:30,parseDates:true};var i=/\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z/;var u=webix.remote=function(e,t,n,r){if(!t){var i=document.getElementsByTagName("script");t=i[i.length-1].src}n=n||u;r=r||"";for(var s in e){if(typeof e[s]=="object"){var o=n[s]={};u(e[s],t,o,s+".")}else n[s]=a(t,r+s)}};var a=function(e,n){return function(){return t(e,n,JSON.stringify([].splice.call(arguments,0)))}};u.config=e})();webix.skin={};webix.skin.air={topLayout:"wide",barHeight:34,tabbarHeight:36,rowHeight:34,toolbarHeight:22,listItemHeight:28,inputHeight:34,inputPadding:2,menuHeight:34,menuMargin:0,labelTopHeight:16,layoutMargin:{space:10,wide:4,clean:0,head:4,line:-1,toolbar:4,form:8},layoutPadding:{space:10,wide:0,clean:0,head:0,line:0,toolbar:4,form:8},tabMargin:-1,calendarHeight:70,padding:0};webix.skin["aircompact"]={topLayout:"wide",barHeight:24,tabbarHeight:26,rowHeight:26,toolbarHeight:22,listItemHeight:28,inputHeight:29,inputPadding:2,menuHeight:25,menuMargin:0,labelTopHeight:16,layoutMargin:{space:10,wide:4,clean:0,head:4,line:-1,toolbar:4,form:8},layoutPadding:{space:10,wide:0,clean:0,head:0,line:0,toolbar:4,form:8},tabMargin:-1,calendarHeight:70,padding:0};webix.skin.web={name:"web",topLayout:"space",barHeight:28,tabbarHeight:30,rowHeight:30,toolbarHeight:22,listItemHeight:28,inputHeight:28,inputPadding:2,menuMargin:0,menuHeight:27,labelTopHeight:16,layoutMargin:{space:10,wide:4,clean:0,head:4,line:-1,toolbar:4,form:8,accordion:9},layoutPadding:{space:10,wide:0,clean:0,head:0,line:0,toolbar:4,form:8,accordion:0},tabMargin:3,tabTopOffset:3,calendarHeight:70,padding:0};webix.skin.clouds={topLayout:"wide",barHeight:36,tabbarHeight:46,rowHeight:34,toolbarHeight:22,listItemHeight:32,inputHeight:30,inputPadding:2,menuHeight:34,labelTopHeight:16,layoutMargin:{space:10,wide:4,clean:0,head:4,line:-1,toolbar:4,form:8},layoutPadding:{space:10,wide:0,clean:0,head:0,line:0,toolbar:4,form:8},tabMargin:2,tabOffset:0,tabBottomOffset:10,calendarHeight:70,padding:0};webix.skin.terrace={topLayout:"space",barHeight:37,tabbarHeight:39,rowHeight:38,toolbarHeight:22,listItemHeight:28,inputHeight:30,inputPadding:2,menuMargin:0,menuHeight:32,labelTopHeight:16,layoutMargin:{space:20,wide:20,clean:0,head:4,line:-1,toolbar:4,form:8},layoutPadding:{space:20,wide:0,clean:0,head:0,line:0,toolbar:4,form:8},tabMargin:2,tabOffset:0,calendar:{height:70},padding:17};webix.skin.metro={topLayout:"space",barHeight:36,tabbarHeight:46,rowHeight:34,toolbarHeight:36,listItemHeight:32,inputHeight:30,buttonHeight:45,inputPadding:2,menuHeight:36,labelTopHeight:16,layoutMargin:{space:10,wide:4,clean:0,head:4,line:-1,toolbar:4,form:8,accordion:9},layoutPadding:{space:10,wide:0,clean:0,head:0,line:0,toolbar:0,form:8,accordion:0},tabMargin:2,tabOffset:0,tabBottomOffset:10,calendarHeight:70,padding:0};webix.skin.light={topLayout:"space",barHeight:36,tabbarHeight:46,rowHeight:32,toolbarHeight:36,listItemHeight:32,inputHeight:34,buttonHeight:45,inputPadding:3,menuHeight:36,labelTopHeight:16,layoutMargin:{space:15,wide:15,clean:0,head:4,line:-1,toolbar:4,form:8,accordion:10},layoutPadding:{space:15,wide:0,clean:0,head:0,line:0,toolbar:0,form:8,accordion:0},tabMargin:2,tabOffset:0,tabBottomOffset:10,calendarHeight:70,padding:0};webix.skin.glamour={topLayout:"space",barHeight:39,tabbarHeight:39,rowHeight:32,toolbarHeight:39,listItemHeight:32,inputHeight:34,buttonHeight:34,inputPadding:3,menuHeight:36,labelTopHeight:16,layoutMargin:{space:15,wide:15,clean:0,head:4,line:-1,toolbar:4,form:8,accordion:10},layoutPadding:{space:15,wide:0,clean:0,head:0,line:0,toolbar:3,form:8,accordion:0},tabMargin:1,tabOffset:0,tabBottomOffset:1,calendarHeight:70,padding:0};webix.skin.touch={topLayout:"space",barHeight:42,tabbarHeight:50,rowHeight:42,toolbarHeight:42,listItemHeight:42,inputHeight:42,inputPadding:4,menuHeight:42,labelTopHeight:24,unitHeaderHeight:34,layoutMargin:{space:10,wide:4,clean:0,head:4,line:-1,toolbar:0,form:0,accordion:9},layoutPadding:{space:10,wide:0,clean:0,head:0,line:0,toolbar:4,form:8,accordion:0},tabMargin:2,tabOffset:0,tabBottomOffset:10,calendar:{headerHeight:70,timepickerHeight:35,height:310,width:300},padding:0,customCheckbox:true,customRadio:true};webix.skin.flat={topLayout:"space",barHeight:45,tabbarHeight:45,rowHeight:34,toolbarHeight:45,listItemHeight:34,inputHeight:38,buttonHeight:38,inputPadding:3,menuHeight:34,labelTopHeight:16,propertyItemHeight:28,layoutMargin:{space:10,wide:10,clean:0,head:4,line:-1,toolbar:4,form:8,accordion:10},layoutPadding:{space:10,wide:0,clean:0,head:0,line:0,toolbar:5,form:17,accordion:0},tabMargin:4,tabOffset:0,tabBottomOffset:6,tabTopOffset:1,customCheckbox:true,customRadio:true,calendarHeight:70,padding:0,accordionType:"accordion"};webix.skin.compact={topLayout:"space",barHeight:34,tabbarHeight:34,rowHeight:24,toolbarHeight:34,listItemHeight:28,inputHeight:30,buttonHeight:30,inputPadding:3,menuHeight:28,labelTopHeight:16,layoutMargin:{space:5,wide:5,clean:0,head:4,line:-1,toolbar:4,form:4,accordion:5},layoutPadding:{space:5,wide:0,clean:0,head:0,line:0,toolbar:3,form:12,accordion:0},tabMargin:3,tabOffset:0,tabBottomOffset:3,tabTopOffset:1,customCheckbox:true,customRadio:true,calendarHeight:70,padding:0,accordionType:"accordion"};webix.skin.set=function(e){webix.assert(webix.skin[e],"Incorrect skin name: "+e);webix.skin.$active=webix.skin[e];webix.skin.$name=e;if(webix.ui){for(var t in webix.ui){var n=webix.ui[t];if(n&&n.prototype&&n.prototype.$skin)n.prototype.$skin(n.prototype)}}};webix.skin.set(window.webix_skin||"flat");webix.Destruction={$init:function(){webix.destructors.push(this)},destructor:function(){if(this._last_editor)this.editCancel();if(this.callEvent)this.callEvent("onDestruct",[]);this.destructor=function(){};if(this.getChildViews){var e=this.getChildViews();if(e)for(var t=0;t<e.length;t++)e[t].destructor();if(this._destroy_with_me)for(var t=0;t<this._destroy_with_me.length;t++)this._destroy_with_me[t].destructor()}delete webix.ui.views[this._settings.id];this._htmlmap=null;this._htmlrows=null;if(this._html)document.body.appendChild(this._html);this._html=null;if(this._contentobj){this._contentobj.innerHTML="";this._contentobj._htmlmap=null}if(this._viewobj&&this._viewobj.parentNode){this._viewobj.parentNode.removeChild(this._viewobj)}if(this.data&&this.data.destructor)this.data.destructor();if(this.unbind)this.unbind();this.data=null;this._viewobj=this.$view=this._contentobj=this._dataobj=null;this._evs_events=this._evs_handlers={};if(webix.UIManager._view==this)webix.UIManager._view=null;this.$scope=null;this.$destructed=true}};webix.destructors=[];webix.event(window,"unload",function(){webix.callEvent("unload",[]);webix._final_destruction=true;for(var e=0;e<webix.destructors.length;e++)webix.destructors[e].destructor();webix.destructors=[];webix.ui._popups=webix.toArray();for(var t in webix._events){var n=webix._events[t];if(n[0].removeEventListener)n[0].removeEventListener(n[1],n[2],false);else if(n[0].detachEvent)n[0].detachEvent("on"+n[1],n[2]);delete webix._events[t]}});(function(){var e={};var t=new RegExp("(\\r\\n|\\n)","g");var n=new RegExp('(\\")',"g");var r={"&":"&","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"};var i=/[&<>"'`]/g;var s=function(e){return r[e]||"&"};webix.template=function(r){if(typeof r=="function")return r;if(e[r])return e[r];r=(r||"").toString();if(r.indexOf("->")!=-1){r=r.split("->");switch(r[0]){case"html":r=webix.html.getValue(r[1]);break;case"http":r=(new webix.ajax).sync().get(r[1],{uid:webix.uid()}).responseText;break;default:break}}r=(r||"").toString();r=r.replace(t,"\\n");r=r.replace(n,'\\"');r=r.replace(/\{obj\.([^}?]+)\?([^:]*):([^}]*)\}/g,'"+(obj.$1?"$2":"$3")+"');r=r.replace(/\{common\.([^}\(]*)\}/g,"\"+(common.$1||'')+\"");r=r.replace(/\{common\.([^\}\(]*)\(\)\}/g,'"+(common.$1?common.$1.apply(this, arguments):"")+"');r=r.replace(/\{obj\.([^}]*)\}/g,'"+(obj.$1)+"');r=r.replace("{obj}",'"+obj+"');r=r.replace(/#([^#'";, ]+)#/gi,function(e,t){if(t.charAt(0)=="!")return'"+webix.template.escape(obj.'+t.substr(1)+')+"';else return'"+(obj.'+t+')+"'});try{e[r]=Function("obj","common",'return "'+r+'";')}catch(i){webix.assert_error("Invalid template:"+r)}return e[r]};webix.template.escape=function(e){return(e.toString()||"").replace(i,s)};webix.template.empty=function(){return""};webix.template.bind=function(e){return webix.bind(webix.template(e),this)};webix.type=function(e,t){if(e._webix_proto_wait){if(!e._webix_type_wait)e._webix_type_wait=[];e._webix_type_wait.push(t);return}if(typeof e=="function")e=e.prototype;if(!e.types){e.types={"default":e.type};e.type.name="default"}var n=t.name;var r=e.type;if(n)r=e.types[n]=webix.clone(t.baseType?e.types[t.baseType]:e.type);for(var i in t){if(i.indexOf("template")===0)r[i]=webix.template(t[i]);else r[i]=t[i]}return n}})();webix.Settings={$init:function(){this._settings=this.config={}},define:function(e,t){if(typeof e=="object")return this._parseSeetingColl(e);return this._define(e,t)},_define:function(e,t){var n=this[e+"_setter"];return this._settings[e]=n?n.call(this,t,e):t},_parseSeetingColl:function(e){if(e){for(var t in e)this._define(t,e[t])}},_parseSettings:function(e,t){var n={};if(t)n=webix.extend(n,t);if(typeof e=="object"&&!e.tagName)webix.extend(n,e,true);this._parseSeetingColl(n)},_mergeSettings:function(e,t){for(var n in t)switch(typeof e[n]){case"object":e[n]=this._mergeSettings(e[n]||{},t[n]);break;case"undefined":e[n]=t[n];break;default:break}return e}};webix.proxy=function(e,t){webix.assert(webix.proxy[e],"Invalid proxy name: "+e);var n=webix.copy(webix.proxy[e]);n.source=t;if(n.init)n.init();return n};webix.proxy.post={$proxy:true,load:function(e,t){webix.ajax().bind(e).post(this.source,this.params||{},t)}};webix.proxy.sync={$proxy:true,load:function(e,t){webix.ajax().sync().bind(e).get(this.source,null,t)}};webix.proxy.connector={$proxy:true,connectorName:"!nativeeditor_status",load:function(e,t){webix.ajax(this.source,t,e)},saveAll:function(e,t,n,r){var i=this.source;var s={};var o=[];for(var u=0;u<t.length;u++){var a=t[u];o.push(a.id);for(var f in a.data)if(f.indexOf("$")!==0)s[a.id+"_"+f]=a.data[f];s[a.id+"_"+this.connectorName]=a.operation}s.ids=o.join(",");s.webix_security=webix.securityKey;i+=i.indexOf("?")==-1?"?":"&";i+="editing=true";webix.ajax().post(i,s,r)},result:function(e,t,n,r,i,s){i=i.xml();if(!i)return n._processError(null,r,i,s);var o=i.data.action;if(!o.length)o=[o];var u=[];for(var a=0;a<o.length;a++){var f=o[a];u.push(f);f.status=f.type;f.id=f.sid;f.newid=f.tid;n.processResult(f,f,{text:r,data:i,loader:s})}return u}};webix.proxy.debug={$proxy:true,save:function(e,t,n,r){webix.delay(function(){window.console.log("[DP] "+t.id+" -> "+t.operation,t.data);var e={id:t.data.id,newid:t.data.id,status:t.data.operation};n.processResult(e,e)})}};webix.proxy.rest={$proxy:true,load:function(e,t){webix.ajax(this.source,t,e)},save:function(e,t,n,r){var i=this.source;i+=i.charAt(i.length-1)=="/"?"":"/";var s=t.operation;var o=t.data;if(s=="insert")delete o.id;if(s=="update"){webix.ajax().put(i+o.id,o,r)}else if(s=="delete"){webix.ajax().del(i+o.id,o,r)}else{webix.ajax().post(i,o,r)}}};webix.proxy.faye={$proxy:true,init:function(){this.clientId=this.clientId||webix.uid()},load:function(e){var t=this.clientId;this.client.subscribe(this.source,function(n){if(n.clientId==t)return;webix.dp(e).ignore(function(){if(n.operation=="delete")e.remove(n.data.id);else if(n.operation=="insert")e.add(n.data);else if(n.operation=="update"){var t=e.getItem(n.data.id);if(t){webix.extend(t,n.data,true);e.refresh(t.id)}}})})},save:function(e,t,n,r){t.clientId=this.clientId;this.client.publish(this.source,t)}};webix.proxy.indexdb={$proxy:true,create:function(e,t,n,r){this.source=e+"/";this._get_db(r,n,function(e){var n=e.target.result;for(var r in t){var i=t[r];var s=n.createObjectStore(r,{keyPath:"id",autoIncrement:true});for(var o=0;o<i.length;o++)s.put(i[o])}})},_get_db:function(e,t,n){if(this.source.indexOf("/")!=-1){var r=this.source.split("/");this.source=r[1];t=t||r[2];var i=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB;var s;if(t)s=i.open(r[0],t);else s=i.open(r[0]);if(n)s.onupgradeneeded=n;s.onerror=function(){};s.onblocked=function(){};s.onsuccess=webix.bind(function(t){this.db=t.target.result;if(e)e.call(this)},this)}else if(this.db)e.call(this);else webix.delay(this._get_db,this,[e],50)},load:function(e,t){this._get_db(function(){var n=this.db.transaction(this.source).objectStore(this.source);var r=[];n.openCursor().onsuccess=function(n){var i=n.target.result;if(i){r.push(i.value);i["continue"]()}else{e.parse(r);webix.ajax.$callback(e,t,"[]",r)}}})},save:function(e,t,n,r){this._get_db(function(){var e=t.operation;var r=t.data;var i=t.id;var s=this.db.transaction([this.source],"readwrite").objectStore(this.source);var o;if(e=="delete")o=s["delete"](i);else if(e=="update")o=s.put(r);else if(e=="insert"){delete r.id;o=s.add(r)}o.onsuccess=function(r){var i={status:e,id:t.id};if(e=="insert")i.newid=r.target.result;n.processResult(i,i)}})}};webix.ajax=function(e,t,n){if(arguments.length!==0){var r=new webix.ajax;if(n)r.master=n;return r.get(e,null,t)}if(!this.getXHR)return new webix.ajax;return this};webix.ajax.count=0;webix.ajax.prototype={master:null,getXHR:function(){if(webix.env.isIE){return new ActiveXObject("Microsoft.xmlHTTP")}else return new XMLHttpRequest},_send:function(e,t,n){var r=webix.promise.defer();var i=this.getXHR();if(!webix.isArray(n))n=[n];n.push({success:function(e,t){r.resolve(t)},error:function(e,t){r.reject(i)}});if(typeof t=="object"){var s=[];for(var o in t){var u=t[o];if(u===null||u===webix.undefined)u="";s.push(o+"="+encodeURIComponent(u))}t=s.join("&")}if(t&&this.request==="GET"){e=e+(e.indexOf("?")!=-1?"&":"?")+t;t=null}if(!webix.callEvent("onBeforeAjax",[this.request,e,t,i]))return;i.open(this.request,e,!this._sync);if(webix.securityKey)i.setRequestHeader("Webix-Token",webix.securityKey);if(this._header){for(var a in this._header)i.setRequestHeader(a,this._header[a])}else if(this.request!=="GET")i.setRequestHeader("Content-type","application/x-www-form-urlencoded");var f=this;i.onreadystatechange=function(){if(!i.readyState||i.readyState==4){if(webix.debug_time)webix.log_full_time("data_loading");var e=i.getResponseHeader("Webix-Token");if(e)webix.securityKey=e;webix.ajax.count++;if(n&&f){var t=f.master||f;var r=i.status>=400;var s=i.responseText||"";var o=f._data(i);webix.ajax.$callback(t,n,s,o,i,r)}if(f)f.master=null;n=f=null}};if(!this._sync)setTimeout(function(){i.send(t||null)},1);else i.send(t||null);if(this.master&&this.master._ajax_queue)this.master._ajax_queue.push(i);return this._sync?i:r},_data:function(x){return{xml:function(){try{return webix.DataDriver.xml.tagToObject(webix.DataDriver.xml.toObject(x.responseText,this))}catch(e){webix.log(x.responseText);webix.log(e.toString());webix.assert_error("Invalid xml data for parsing")}},rawxml:function(){return x.responseXML},text:function(){return x.responseText},json:function(){try{eval("webix.temp = "+x.responseText);var t=webix.temp;webix.temp=null;return t}catch(e){webix.log(x.responseText);webix.log(e.toString());webix.assert_error("Invalid json data for parsing")}}}},get:function(e,t,n){if(arguments.length==2&&(t.success||t.error)){n=t;t=null}this.request="GET";return this._send(e,t,n)},post:function(e,t,n){this.request="POST";return this._send(e,t,n)},put:function(e,t,n){this.request="PUT";return this._send(e,t,n)},del:function(e,t,n){this.request="DELETE";return this._send(e,t,n)},sync:function(){this._sync=true;return this},header:function(e){this._header=e;return this},bind:function(e){this.master=e;return this}};webix.ajax.$callback=function(e,t,n,r,i,s){if(e.$destructed)return;if(s)webix.callEvent("onAjaxError",[i]);if(!webix.isArray(t))t=[t];if(!s)for(var o=0;o<t.length;o++){if(t[o]){var u=t[o].before;if(u)u.call(e,n,r,i)}}for(var o=0;o<t.length;o++)if(t[o]){var a=t[o].success||t[o];if(s)a=t[o].error;if(a&&a.call)a.call(e,n,r,i)}};webix.send=function(e,t,n,r){var i=webix.html.create("FORM",{target:r||"_self",action:e,method:n||"POST"},"");for(var s in t){var o=webix.html.create("INPUT",{type:"hidden",name:s,value:t[s]},"");i.appendChild(o)}i.style.display="none";document.body.appendChild(i);i.submit();document.body.removeChild(i)};webix.AtomDataLoader={$init:function(e){this.data={};if(e){this._settings.datatype=e.datatype||"json";this.$ready.push(this._load_when_ready)}},_load_when_ready:function(){this._ready_for_data=true;if(this._settings.url)this.url_setter(this._settings.url);if(this._settings.data)this.data_setter(this._settings.data)},url_setter:function(e){if(typeof e=="string"&&e.indexOf("->")!=-1){var t=e.split("->");e=webix.proxy(t[0],t[1])}if(!this._ready_for_data)return e;this.load(e,this._settings.datatype);return e},data_setter:function(e){if(!this._ready_for_data)return e;this.parse(e,this._settings.datatype);return true},load:function(e,t){var n=arguments[2]||null;this.callEvent("onBeforeLoad",[]);if(typeof t=="string"){this.data.driver=webix.DataDriver[t];t=arguments[2]}else if(!this.data.driver)this.data.driver=webix.DataDriver.json;var r=[{success:this._onLoad,error:this._onLoadError}];if(t){if(webix.isArray(t))r.push.apply(r,t);else r.push(t)}if(typeof e=="string"&&e.indexOf("->")!=-1){var i=e.split("->");e=webix.proxy(i[0],i[1])}if(e.$proxy&&e.load)return e.load(this,r,n);if(typeof e==="function"){return e(n).then(webix.bind(function(e){webix.ajax.$callback(this,r,"",e,-1)},this),webix.bind(function(e){webix.ajax.$callback(this,r,"",null,e,true)},this))}return webix.ajax(e,r,this)},parse:function(e,t){if(e&&e.then&&typeof e.then=="function")return e.then(webix.bind(function(e){this.parse(e,t)},this));this.callEvent("onBeforeLoad",[]);this.data.driver=webix.DataDriver[t||"json"];this._onLoad(e,null)},_onLoad:function(e,t,n){var r=this.data.driver;var i;if(n===-1)i=t;else i=r.toObject(e,t);if(i)this.data=i;else this._onLoadError(e,t,n);this.callEvent("onAfterLoad",[])},_onLoadError:function(e,t,n){this.callEvent("onAfterLoad",[]);this.callEvent("onLoadError",arguments);webix.callEvent("onLoadError",[e,t,n,this])},_check_data_feed:function(e){if(!this._settings.dataFeed||this._ignore_feed||!e)return true;var t=this._settings.dataFeed;if(typeof t=="function")return t.call(this,e.id||e,e);t=t+(t.indexOf("?")==-1?"?":"&")+"action=get&id="+encodeURIComponent(e.id||e);this.callEvent("onBeforeLoad",[]);webix.ajax(t,function(e,t,n){this._ignore_feed=true;var r=webix.DataDriver.json;var i=r.toObject(e,t);if(i)this.setValues(r.getDetails(r.getRecords(i)[0]));else this._onLoadError(e,t,n);this._ignore_feed=false;this.callEvent("onAfterLoad",[])},this);return false}};webix.DataDriver={};webix.DataDriver.json={toObject:function(data){if(!data)return null;if(typeof data=="string"){try{eval("webix.temp="+data);data=webix.temp}catch(e){webix.assert_error(e);return null}}if(data.data){var t=data.data.config={};data.data.collections=data.collections;for(var key in data)if(key!="data")t[key]=data[key];data=data.data}return data},getRecords:function(e){if(e&&!webix.isArray(e))return[e];return e},getDetails:function(e){if(typeof e=="string")return{id:webix.uid(),value:e};return e},getOptions:function(e){return e.collections},getInfo:function(e){var t=e.config;if(!t)return{};return{_size:t.total_count||0,_from:t.pos||0,_parent:t.parent||0,_config:t.config,_key:t.webix_security}},child:"data"};webix.DataDriver.html={toObject:function(e){if(typeof e=="string"){var t=null;if(e.indexOf("<")==-1)t=webix.toNode(e);if(!t){t=document.createElement("DIV");t.innerHTML=e}return t.firstChild}return e},getRecords:function(e){return e.getElementsByTagName(this.tag)},getDetails:function(e){return webix.DataDriver.xml.tagToObject(e)},getOptions:function(){return false},getInfo:function(e){return{_size:0,_from:0}},tag:"LI"};webix.DataDriver.jsarray={toObject:function(data){if(typeof data=="string"){eval("webix.temp="+data);return webix.temp}return data},getRecords:function(e){return e},getDetails:function(e){var t={};for(var n=0;n<e.length;n++)t["data"+n]=e[n];if(this.idColumn!==null)t.id=e[this.idColumn];return t},getOptions:function(){return false},getInfo:function(e){return{_size:0,_from:0}},idColumn:null};webix.DataDriver.csv={toObject:function(e){return e},getRecords:function(e){return e.split(this.row)},getDetails:function(e){e=this.stringToArray(e);var t={};for(var n=0;n<e.length;n++)t["data"+n]=e[n];if(this.idColumn!==null)t.id=e[this.idColumn];return t},getOptions:function(){return false},getInfo:function(e){return{_size:0,_from:0}},stringToArray:function(e){e=e.split(this.cell);for(var t=0;t<e.length;t++)e[t]=e[t].replace(/^[ \t\n\r]*(\"|)/g,"").replace(/(\"|)[ \t\n\r]*$/g,"");return e},idColumn:null,row:"\n",cell:","};webix.DataDriver.xml={_isValidXML:function(e){if(!e||!e.documentElement)return null;if(e.getElementsByTagName("parsererror").length)return null;return e},toObject:function(e,t){var n=t?t.rawxml?t.rawxml():t:null;if(this._isValidXML(n))return n;if(typeof e=="string")n=this.fromString(e.replace(/^[\s]+/,""));else n=e;if(this._isValidXML(n))return n;return null},getRecords:function(e){return this.xpath(e,this.records)},records:"/*/item",child:"item",config:"/*/config",getDetails:function(e){return this.tagToObject(e,{})},getOptions:function(){return false},getInfo:function(e){var t=this.xpath(e,this.config);if(t.length)t=this.assignTypes(this.tagToObject(t[0],{}));else t=null;return{_size:e.documentElement.getAttribute("total_count")||0,_from:e.documentElement.getAttribute("pos")||0,_parent:e.documentElement.getAttribute("parent")||0,_config:t,_key:e.documentElement.getAttribute("webix_security")||null}},xpath:function(e,t){if(window.XPathResult){var n=e;if(e.nodeName.indexOf("document")==-1)e=e.ownerDocument;var r=[];var i=e.evaluate(t,n,null,XPathResult.ANY_TYPE,null);var s=i.iterateNext();while(s){r.push(s);s=i.iterateNext()}return r}else{var o=true;try{if(typeof e.selectNodes=="undefined")o=false}catch(u){}if(o)return e.selectNodes(t);else{var a=t.split("/").pop();return e.getElementsByTagName(a)}}},assignTypes:function(e){for(var t in e){var n=e[t];if(typeof n=="object")this.assignTypes(n);else if(typeof n=="string"){if(n==="")continue;if(n=="true")e[t]=true;else if(n=="false")e[t]=false;else if(n==n*1)e[t]=e[t]*1}}return e},tagToObject:function(e,t){var n=e.nodeType==1&&e.getAttribute("stack");var r=0;if(!n){t=t||{};var i=e.attributes;if(i&&i.length)for(var s=0;s<i.length;s++){t[i[s].name]=i[s].value;var r=1}var o=e.childNodes;for(var s=0;s<o.length;s++)if(o[s].nodeType==1){var u=o[s].tagName;if(t[u]){if(typeof t[u].push!="function")t[u]=[t[u]];t[u].push(this.tagToObject(o[s],{}))}else t[u]=this.tagToObject(o[s],{});r=2}if(!r)return this.nodeValue(e);if(r<2)t.value=t.value||this.nodeValue(e)}else{t=[];var o=e.childNodes;for(var s=0;s<o.length;s++)if(o[s].nodeType==1)t.push(this.tagToObject(o[s],{}))}return t},nodeValue:function(e){if(e.firstChild){return e.firstChild.wholeText||e.firstChild.data}return""},fromString:function(e){try{if(window.DOMParser)return(new DOMParser).parseFromString(e,"text/xml");if(window.ActiveXObject){var t=new ActiveXObject("Microsoft.xmlDOM");t.loadXML(e);return t}}catch(n){webix.assert_error(n);return null}webix.assert_error("Load from xml string is not supported")}};webix.debug_code(function(){webix.debug_load_event=webix.attachEvent("onLoadError",function(e,t,n,r){e=e||"[EMPTY DATA]";var i="Data loading error, check console for details";if(e.indexOf("<?php")===0)i="PHP support missed";else if(e.indexOf("WEBIX_ERROR:")===0)i=e.replace("WEBIX_ERROR:","");if(webix.message)webix.message({type:"debug",text:i,expire:-1});if(window.console){var s=window.console;s.log("Data loading error");s.log("Object:",r);s.log("Response:",e);s.log("XHTTP:",n)}});webix.ready(function(){var e=document.location.href;if(e.indexOf("file:")===0){if(webix.message)webix.message({type:"error",text:"Please open sample by http,<br>not as file://",expire:-1});else window.alert("Please open sample by http, not as file://")}})});webix.BaseBind={bind:function(e,t,n){if(!this.attachEvent)webix.extend(this,webix.EventSystem);if(typeof e=="string")e=webix.$$(e);if(e._initBindSource)e._initBindSource();if(this._initBindSource)this._initBindSource();if(!e.getBindData)webix.extend(e,webix.BindSource);this._bind_ready();e.addBind(this._settings.id,t,n);this._bind_source=e._settings.id;if(webix.debug_bind)webix.log("[bind] "+this.name+"@"+this._settings.id+" <= "+e.name+"@"+e._settings.id);var r=this._settings.id;this._bind_refresh_handler=this.attachEvent(this.touchable?"onAfterRender":"onBindRequest",function(){return e.getBindData(r)});if(this.refresh&&this.isVisible(this._settings.id))this.refresh()},unbind:function(){if(this._bind_source){var e=webix.$$(this._bind_source);if(e)e.removeBind(this._settings.id);this.detachEvent(this._bind_refresh_handler);this._bind_source=null}},_bind_ready:function(){if(this.filter){var e=this._settings.id;this.data._on_sync=webix.bind(function(){webix.$$(this._bind_source)._bind_updated[e]=false},this)}var t=this.render;this.render=function(){if(this._in_bind_processing)return;this._in_bind_processing=true;var e=this.callEvent("onBindRequest");this._in_bind_processing=false;return t.apply(this,e===false?arguments:[])};if(this.getValue||this.getValues)this.save=function(){if(this.validate&&!this.validate())return false;webix.$$(this._bind_source).setBindData(this.getValue?this.getValue:this.getValues(),this._settings.id);if(this.setDirty)this.setDirty(false)};if(!this._settings.dataFeed&&this.loadNext)this.data.attachEvent("onStoreLoad",webix.bind(function(){if(this._bind_source)webix.$$(this._bind_source)._bind_updated[this._settings.id]=false},this));this._bind_ready=function(){}}};webix.BindSource={$init:function(){this._bind_hash={};this._bind_updated={};this._ignore_binds={};this._bind_specific_rules(this)},saveBatch:function(e){this._do_not_update_binds=true;e.call(this);this._do_not_update_binds=false;this._update_binds()},setBindData:function(e,t){if(t)this._ignore_binds[t]=true;if(webix.debug_bind)webix.log("[bind:save] "+this.name+"@"+this._settings.id+" <= "+"@"+t);if(this.setValue)this.setValue(e);else if(this.setValues)this.setValues(e);else{var n=this.getCursor();if(n)this.updateItem(n,e);else this.add(e)}this.callEvent("onBindUpdate",[e,t]);if(this.save)this.save();if(t)this._ignore_binds[t]=false},getBindData:function(e,t){if(this._bind_updated[e])return false;var n=webix.$$(e);if(n.isVisible(n._settings.id)){this._bind_updated[e]=true;if(webix.debug_bind)webix.log("[bind:request] "+this.name+"@"+this._settings.id+" => "+n.name+"@"+n._settings.id);this._bind_update(n,this._bind_hash[e][0],this._bind_hash[e][1]);if(t&&n.filter)n.refresh()}},addBind:function(e,t,n){this._bind_hash[e]=[t,n]},removeBind:function(e){delete this._bind_hash[e];delete this._bind_updated[e];delete this._ignore_binds[e]},_bind_specific_rules:function(e){if(e.filter)webix.extend(this,webix.CollectionBind);else if(e.setValue)webix.extend(this,webix.ValueBind);else webix.extend(this,webix.RecordBind)},_update_binds:function(){if(!this._do_not_update_binds)for(var e in this._bind_hash){if(this._ignore_binds[e])continue;this._bind_updated[e]=false;this.getBindData(e,true)}},_bind_update_common:function(e,t,n){if(e.setValue)e.setValue(n&&t?n[t]:n);else if(!e.filter){if(!n&&e.clear)e.clear();else{if(e._check_data_feed(n))e.setValues(webix.clone(n))}}else{e.data.silent(function(){this.filter(t,n)})}e.callEvent("onBindApply",[n,t,this])}};webix.DataValue=webix.proto({name:"DataValue",isVisible:function(){return true},$init:function(e){if(!e||webix.isUndefined(e.value))this.data=e||"";var t=e&&e.id?e.id:webix.uid();this._settings={id:t};webix.ui.views[t]=this},setValue:function(e){this.data=e;this.callEvent("onChange",[e])},getValue:function(){return this.data},refresh:function(){this.callEvent("onBindRequest")}},webix.EventSystem,webix.BaseBind);webix.DataRecord=webix.proto({name:"DataRecord",isVisible:function(){return true},$init:function(e){this.data=e||{};var t=e&&e.id?e.id:webix.uid();this._settings={id:t};webix.ui.views[t]=this},getValues:function(){return this.data},setValues:function(e){this.data=e;this.callEvent("onChange",[e])},refresh:function(){this.callEvent("onBindRequest")}},webix.EventSystem,webix.BaseBind,webix.AtomDataLoader,webix.Settings);webix.ValueBind={$init:function(){this.attachEvent("onChange",this._update_binds)},_bind_update:function(e,t,n){var r=this.getValue()||"";if(n)r=n(r);if(e.setValue)e.setValue(r);else if(!e.filter){var i={};i[t]=r;if(e._check_data_feed(r))e.setValues(i)}else{e.data.silent(function(){this.filter(t,r)})}e.callEvent("onBindApply",[r,t,this])}};webix.RecordBind={$init:function(){this.attachEvent("onChange",this._update_binds)},_bind_update:function(e,t,n){var r=this.getValues()||null;if(n)r=n(r);this._bind_update_common(e,t,r)}};webix.CollectionBind={$init:function(){this._cursor=null;this.attachEvent("onSelectChange",function(e){var t=this.getSelectedId();this.setCursor(t?t.id||t:null)});this.attachEvent("onAfterCursorChange",this._update_binds);this.attachEvent("onAfterDelete",function(e){if(e==this.getCursor())this.setCursor(null)});this.data.attachEvent("onStoreUpdated",webix.bind(function(e,t,n){if(e&&e==this.getCursor()&&n!="paint"&&n!="delete")this._update_binds()},this));this.data.attachEvent("onClearAll",webix.bind(function(){this._cursor=null},this));this.data.attachEvent("onIdChange",webix.bind(function(e,t){if(this._cursor==e)this._cursor=t},this))},setCursor:function(e){if(e==this._cursor||e!==null&&!this.getItem(e))return;this.callEvent("onBeforeCursorChange",[this._cursor]);this._cursor=e;this.callEvent("onAfterCursorChange",[e])},getCursor:function(){return this._cursor},_bind_update:function(e,t,n){var r=this.getItem(this.getCursor())||this._settings.defaultData||null;if(n)r=n(r);this._bind_update_common(e,t,r)}};webix.AtomRender={_toHTML:function(e){if(e.$empty)return"";return this._settings.template(e,this)},render:function(){if(this.isVisible(this._settings.id)){if(webix.debug_render)webix.log("Render: "+this.name+"@"+this._settings.id);if(!this.callEvent||this.callEvent("onBeforeRender",[this.data])){if(this.data&&!this._settings.content)this._dataobj.innerHTML=this._toHTML(this.data);if(this.callEvent)this.callEvent("onAfterRender",[])}return true}return false},sync:function(e){this._backbone_sync=false;if(e.name!="DataStore"){if(e.data&&e.name=="DataStore"){e=e.data}else{this._backbone_sync=true}}if(this._backbone_sync)e.bind("change",webix.bind(function(e){if(e.id==this.data.id){this.data=e.attributes;this.refresh()}},this));else e.attachEvent("onStoreUpdated",webix.bind(function(t){if(!t||t==this.data.id){this.data=e.pull[t];this.refresh()}},this))},template_setter:webix.template};webix.SingleRender=webix.proto({template_setter:function(e){this.type.template=webix.template(e)},_toHTML:function(e){var t=this.type;return(t.templateStart?t.templateStart(e,t):"")+t.template(e,t)+(t.templateEnd?t.templateEnd(e,t):"")},customize:function(e){webix.type(this,e)}},webix.AtomRender);webix.UIManager={_view:null,_hotkeys:{},_focus_time:0,_controls:{enter:13,tab:9,esc:27,escape:27,up:38,down:40,left:37,right:39,pgdown:34,pagedown:34,pgup:33,pageup:33,end:35,home:36,"delete":46,backspace:8,space:32,meta:91,win:91,mac:91},_enable:function(){webix.event(document.body,"click",webix.bind(this._focus_click,this));webix.event(document,"keydown",webix.bind(this._keypress,this));if(document.body.addEventListener)document.body.addEventListener("focus",webix.bind(this._focus_tab,this),true);webix.destructors.push(this)},destructor:function(){webix.UIManager._view=null},getFocus:function(){return this._view},_focus_action:function(e){this._focus_was_there=this._focus_was_there||e._settings.id},setFocus:function(e,t){e=webix.$$(e);if(e&&!e.$view)e=null;this._focus_time=new Date;if(this._view===e)return true;if(this._view&&this._view.callEvent)this._view.callEvent("onBlur",[this._view]);if(e&&e.callEvent)e.callEvent("onFocus",[e,this._view]);webix.callEvent("onFocusChange",[e,this._view]);if(this._view&&this._view.blur&&!t)this._view.blur();this._view=e;if(e&&e.focus&&!t)e.focus();return true},hasFocus:function(e){return e===this._view?true:false},_focus:function(e,t){var n=webix.html.locate(e,"view_id")||this._focus_was_there;n=webix.$$(n);this._focus_was_there=null;if(n==this._view)return;if(!t)this._focus_was_there=null;if(n){n=webix.$$(n);if(this.canFocus(n))this.setFocus(n)}else if(!t)this.setFocus(null);return true},_focus_click:function(e){if(new Date-this._focus_time<100)return false;return this._focus(e)},_focus_tab:function(e){return this._focus(e,true)},canFocus:function(e){return e.isVisible()&&e.isEnabled()},_moveChildFocus:function(e){var t=this.getFocus();if(e&&!this._is_child_of(e,t))return false;if(!this._focus_logic("getPrev",e))this.setFocus(this.getPrev(e));else this._view=null},_is_child_of:function(e,t){if(!e)return false;if(!t)return false;while(t){if(t===e)return true;t=t.getParentView()}return false},_keypress_timed:function(){if(this&&this.callEvent)this.callEvent("onTimedKeyPress",[])},_keypress:function(e){var t=e.which;var n=e.ctrlKey;var r=e.shiftKey;var i=e.altKey;var s=e.metaKey;var o=this._keycode(t,n,r,i,s);var u=this.getFocus();if(u&&u.callEvent){if(u.callEvent("onKeyPress",[t,e])===false)webix.html.preventEvent(e);if(u.hasEvent("onTimedKeyPress")){clearTimeout(u._key_press_timeout);u._key_press_timeout=webix.delay(this._keypress_timed,u,[],u._settings.keyPressTimeout||250)}}if(this.tabControl){if(t===9&&!n&&!i&&!s){this._focus_logic(!r?"getNext":"getPrev");webix.html.preventEvent(e)}}o=this._keycode(String.fromCharCode(t),n,r,i,s);var a=!n&&!i&&!s&&t!=9&&t!=27&&t!=13;if(this._check_keycode(o,a,e)===false){webix.html.preventEvent(e);return false}},_focus_logic:function(e){if(!this.getFocus())return null;e=e||"getNext";var t=this.getFocus();var n=t;var r=webix.uid();while(true){t=this[e](t);if(t&&t._settings.tabFocus&&this.canFocus(t))return this.setFocus(t);if(t===n||t.$fmarker==r)return null;t.$fmarker=r}},getTop:function(e){var t,n=webix.$$(e);while(n&&(t=n.getParentView()))n=t;return n},getNext:function(e,t){var n=e.getChildViews();if(n.length&&!t)return n[0];var r=e.getParentView();if(!r)return e;var i=r.getChildViews();if(i.length){var s=webix.PowerArray.find.call(i,e)+1;while(s<i.length){if(this.canFocus(i[s]))return i[s];s++}}return this.getNext(r,true)},getPrev:function(e,t){var n=e.getChildViews();if(n.length&&t)return this.getPrev(n[n.length-1],true);if(t)return e;var r=e.getParentView();if(!r)return this.getPrev(e,true);var i=r.getChildViews();if(i){var s=webix.PowerArray.find.call(i,e)-1;while(s>=0){if(this.canFocus(i[s]))return this.getPrev(i[s],true);s--}}return r},addHotKey:function(e,t,n){webix.assert(t,"Hot key handler is not defined");e=this._parse_keys(e);webix.assert(e.letter,"Unknown key code");if(!n)n=null;e.handler=t;e.view=n;var r=this._keycode(e.letter,e.ctrl,e.shift,e.alt,e.meta);if(!this._hotkeys[r])this._hotkeys[r]=[];this._hotkeys[r].push(e);return r},removeHotKey:function(e,t,n){if(!t&&!n)delete this._hotkeys[e];else{var r=this._hotkeys[e];if(r){for(var i=r.length-1;i>=0;i--){if(n&&r[i].view!==n)continue;if(t&&r[i].handler!==t)continue;r.splice(i,1)}if(!r.length)delete this._hotkeys[e]}}},_keycode:function(e,t,n,r,i){return e+"_"+[,t?"1":"0",n?"1":"0",r?"1":"0",i?"1":"0"].join("")},_check_keycode:function(e,t,n){var r=this.getFocus();if(this._hotkeys[e])return this._process_calls(this._hotkeys[e],r,n);else if(t&&this._hotkeys["ANY_0000"])return this._process_calls(this._hotkeys["ANY_0000"],r,n);return true},_process_calls:function(e,t,n){for(var r=0;r<e.length;r++){var i=e[r];var s=false;if(i.view!==null&&t!==i.view&&(typeof i.view!=="string"||!t||t.name!==i.view))continue;var o=i.handler(t,n);if(!!o===o)return o}return true},_parse_keys:function(e){var t=this._controls;var n=e.toLowerCase().split(/[\+\-_]/);var r,i,s,o;r=i=s=o=0;var u="";for(var a=0;a<n.length;a++){if(n[a]==="ctrl")r=1;else if(n[a]==="shift")i=1;else if(n[a]==="alt")s=1;else if(n[a]==="command")o=1;else{if(t[n[a]]){u=String.fromCharCode(t[n[a]])}else{u=n[a]}}}return{letter:u.toUpperCase(),ctrl:r,shift:i,alt:s,meta:o,debug:e}},getState:function(e,t){t=t||false;e=webix.$$(e);var n={id:e.config.id,width:e.config.width,height:e.config.height,gravity:e.config.gravity};if(!webix.isUndefined(e.config.collapsed))n.collapsed=e.config.collapsed;if(e.name==="tabs"||e.name==="tabbar")n.activeCell=e.getValue();if(t){n=[n];if(e._cells){for(var r=0;r<e._cells.length;r++)n=n.concat(this.getState(e._cells[r],t))}}return n},setState:function(e){if(!webix.isArray(e))e=[e];for(var t=0;t<e.length;t++){var n=e[t];var r=webix.$$(n.id);if(!r)continue;if(!webix.isUndefined(n.collapsed))r.define("collapsed",n.collapsed);if(!webix.isUndefined(n.activeCell))r.setValue(n.activeCell);r.define("width",n.width);r.define("height",n.height);r.define("gravity",n.gravity)}var i=webix.$$(e[0].id);if(i)i.resize()}};webix.ready(function(){webix.UIManager._enable();webix.UIManager.addHotKey("enter",function(e){if(e&&e.editStop&&e._in_edit_mode){e.editStop();return true}});webix.UIManager.addHotKey("esc",function(e){if(e){if(e.editCancel&&e._in_edit_mode){e.editCancel();return true}var t=e.getTopParentView();if(t&&t.setPosition)t._hide()}});webix.UIManager.addHotKey("shift+tab",function(e,t){if(e&&e._custom_tab_handler&&!e._custom_tab_handler(false,t))return false;if(e&&e._in_edit_mode){if(e.editNext)return e.editNext(false);else if(e.editStop){e.editStop();return true}}});webix.UIManager.addHotKey("tab",function(e,t){if(e&&e._custom_tab_handler&&!e._custom_tab_handler(true,t))return false;if(e&&e._in_edit_mode){if(e.editNext)return e.editNext(true);else if(e.editStop){e.editStop();return true}}})});webix.IdSpace={$init:function(){this._elements={};this._translate_ids={};this.getTopParentView=webix.bind(function(){return this},this);this._run_inner_init_logic();this.$ready.push(this._run_after_inner_init_logic)},$$:function(e){return this._elements[e]},innerId:function(e){return this._translate_ids[e]},_run_inner_init_logic:function(e){this._prev_global_col=webix._global_collection;webix._global_collection=this},_run_after_inner_init_logic:function(e){for(var t in this._elements){var n=this._elements[t];if(this.callEvent&&n.mapEvent&&!n._evs_map.onitemclick)n.mapEvent({onitemclick:this});n.getTopParentView=this.getTopParentView}webix._global_collection=this._prev_global_col;this._prev_global_col=0},ui:function(){this._run_inner_init_logic();var e=webix.ui.apply(webix,arguments);this._run_after_inner_init_logic();return e}};(function(){var e=[];var t=webix.ui;if(!webix.ui){t=webix.ui=function(n,r,i){webix._ui_creation=true;var s=n;s=webix.toNode(n.container||r||document.body);var o;var u=s==document.body;if(n._settings||s&&webix.isArray(n)){o=n}else{if(s&&u)n.$topView=true;if(!n._inner)n._inner={};o=t._view(n)}if(u&&!o.setPosition)webix.ui._fixHeight();if(o._settings&&o._settings._hidden){o._settings._container=s}else if(!o.$apiOnly){if(s.appendChild){s.appendChild(o._viewobj);if((!o.setPosition||o._settings.fullscreen)&&s==document.body||o._settings.position)e.push(o);if(!n.skipResize)o.adjust()}else if(s.destructor){if(!i&&i!==0&&!webix.isArray(o)){i=s.config.id;s=s.getParentView()}if(s&&s._replace){if(o.getParentView&&o.getParentView())o.getParentView()._remove(o);s._replace(o,i)}}else webix.assert_error("Not existing parent:"+n.container)}webix._ui_creation=false;return o}}webix.ui._detectScrollSize=function(){var e=webix.html.create("div");e.className="webix_skin_mark";e.style.cssText="position:absolute;left:-1000px;width:100px;padding:0px;margin:0px;min-height:100px;overflow-y:scroll;";document.body.appendChild(e);var t=e.offsetWidth-e.clientWidth;var n={110:"air",120:"aircompact",130:"clouds",140:"web",150:"terrace",160:"metro",170:"light",180:"glamour",190:"touch",200:"flat",210:"compact"}[e.offsetHeight];document.body.removeChild(e);if(n){var r=webix.skin[n];if(r&&r!=webix.skin.$active)webix.skin.set(n)}if(webix.env.$customScroll)return 0;return t};webix.ui.scrollSize=webix.env.touch||webix.env.$customScroll?0:17;webix.ready(function(){var e=webix.ui._detectScrollSize();webix.ui.scrollSize=webix.env.touch?0:e});webix.ui._uid=function(e){return"$"+e+(this._namecount[e]=(this._namecount[e]||0)+1)};webix.ui._namecount={};webix.ui._fixHeight=function(){webix.html.addStyle("html, body{ height:100%; }");document.body.className+=" webix_full_screen";webix.ui._fixHeight=function(){}};webix.ui.resize=function(){if(!webix.ui._freeze)for(var t=e.length-1;t>=0;t--){if(e[t].$destructed)e.splice(t,1);else e[t].adjust()}};webix.ui.each=function(e,t,n){if(e){var r=e.getChildViews();for(var i=0;i<r.length;i++){if(t.call(n||webix,r[i])!==false)webix.ui.each(r[i],t,n)}}};webix.event(window,"resize",webix.ui.resize);t._delays={};t.delay=function(e){webix.ui._delays[e.id]=e};t.hasMethod=function(e,t){var n=webix.ui[e];if(!n)return false;if(n._webix_proto_wait)n=n.call(webix);return!!webix.ui[e].prototype[t]};webix.ui.zIndex=function(){return webix.ui.zIndexBase++};webix.ui.zIndexBase=100;t._view=function(e){webix.assert_config(e);if(e.view){var n=e.view;webix.assert(t[n],"unknown view:"+n);return new t[n](e)}else if(e.rows||e.cols){var r=e.rows||e.cols;var i=false;for(var s=0;s<r.length;s++){if(r[s].body&&!r[s].view)i=true}if(i){return new t.headerlayout(e)}else return new t.layout(e)}else if(e.cells)return new t.multiview(e);else if(e.template||e.content)return new t.template(e);else return new t.spacer(e)};t.views={};webix.$$=function(e){if(!e)return null;if(t.views[e])return t.views[e];if(t._delays[e])return webix.ui(t._delays[e]);var n=e;if(typeof e=="object"){if(e._settings)return e;n=e.target||e.srcElement||e}return t.views[webix.html.locate({target:webix.toNode(n)},"view_id")]};if(webix.isUndefined(window.$$))window.$$=webix.$$;webix.UIExtension=window.webix_view||{};webix.protoUI({name:"baseview",$init:function(e){if(!e.id)e.id=webix.ui._uid(this.name);this._parent_cell=webix._parent_cell;webix._parent_cell=null;this.$scope=e.$scope||(this._parent_cell?this._parent_cell.$scope:null);if(!this._viewobj){this._contentobj=this._viewobj=webix.html.create("DIV",{"class":"webix_view"});this.$view=this._viewobj}},$skin:false,defaults:{width:0,height:0,gravity:1},getNode:function(){return this._viewobj},getParentView:function(){return this._parent_cell||null},getTopParentView:function(){var e=this.getParentView();return e?e.getTopParentView():this},getFormView:function(){var e=this.getParentView();return!e||e.setValues?e:e.getFormView()},getChildViews:function(){return[]},isVisible:function(e,t){if(this._settings.hidden){if(e){if(!this._hidden_render){this._hidden_render=[];this._hidden_hash={}}if(!this._hidden_hash[e]){this._hidden_hash[e]=true;this._hidden_render.push(e)}}return false}var n=this.getParentView();if(n)return n.isVisible(e,this._settings.id);return true},isEnabled:function(){if(this._disable_cover)return false;var e=this.getParentView();if(e)return e.isEnabled();return true},disable:function(){webix.html.remove(this._disable_cover);this._settings.disabled=true;this._disable_cover=webix.html.create("div",{"class":"webix_disabled"});if(window.getComputedStyle)this._disabled_view_pos=window.getComputedStyle(this._viewobj,null).getPropertyValue("position");if(this._disabled_view_pos!="absolute")this._viewobj.style.position="relative";this._viewobj.appendChild(this._disable_cover);webix.UIManager._moveChildFocus(this)},enable:function(){this._settings.disabled=false;if(this._disable_cover){webix.html.remove(this._disable_cover);this._disable_cover=null;if(this._disabled_view_pos)this._viewobj.style.position=this._disabled_view_pos}},disabled_setter:function(e){if(e)this.disable();else this.enable();return e},container_setter:function(e){webix.assert(webix.toNode(e),"Invalid container");return true},css_setter:function(e){if(typeof e=="object")e=webix.html.createCss(e);this._viewobj.className+=" "+e;return e},id_setter:function(e){if(webix._global_collection&&webix._global_collection!=this){var t=e;webix._global_collection._elements[e]=this;e=webix.ui._uid(this.name);webix._global_collection._translate_ids[e]=t}webix.assert(!webix.ui.views[e],"Non unique view id: "+e);webix.ui.views[e]=this;this._viewobj.setAttribute("view_id",e);return e},$setSize:function(e,t){var n=this._last_size;if(n&&n[0]==e&&n[1]==t){webix.debug_size_box(this,[e,t,"not changed"]);return false}webix.debug_size_box(this,[e,t]);this._last_size=[e,t];this.$width=this._content_width=e-(this._scroll_y?webix.ui.scrollSize:0);this.$height=this._content_height=t-(this._scroll_x?webix.ui.scrollSize:0);this._viewobj.style.width=e+"px";this._viewobj.style.height=t+"px";return true},$getSize:function(e,t){var n=this._settings;if(this._scroll_y)e+=webix.ui.scrollSize;if(this._scroll_x)t+=webix.ui.scrollSize;var r=[n.width||n.minWidth||0,n.width||n.maxWidth||1e5,n.height||n.minHeight||0,n.height||n.maxHeight||1e5,n.gravity];r[0]+=e;r[1]+=e;r[2]+=t;r[3]+=t;return r},show:function(e,t){var n=this.getParentView();var r=!arguments[2];if(n){if(!t&&this._settings.animate)if(n._settings.animate)t=webix.extend(n._settings.animate?webix.extend({},n._settings.animate):{},this._settings.animate,true);if(r?n._show:n._hide)(r?n._show:n._hide).call(n,this,t);if(e&&r)n.show(e)}else{if(this._settings.hidden){if(r){var i=webix.toNode(this._settings._container||document.body);i.appendChild(this._viewobj);this._settings.hidden=false;this.adjust();this._render_hidden_views()}}else{if(!r){this._settings.hidden=this._settings._hidden=true;if(this._viewobj){this._settings._container=this._viewobj.parentNode;webix.html.remove(this._viewobj)}}}}},_render_hidden_views:function(){if(this._hidden_render){for(var e=0;e<this._hidden_render.length;e++){var t=webix.$$(this._hidden_render[e]);if(t)t.render()}this._hidden_render=[];this._hidden_hash={}}},hidden_setter:function(e){if(e)this.hide();return this._settings.hidden},hide:function(){this.show(null,null,true);webix.UIManager._moveChildFocus(this)},adjust:function(){var e=this._viewobj;if(!this._parent_cell)e=e.parentNode;if(!this._viewobj.parentNode)return false;var t=this._viewobj.parentNode.offsetWidth||0;var n=this._viewobj.parentNode.offsetHeight||0;var r=this.$getSize(0,0);if(r[0]>t)t=r[0];if(r[2]>n)n=r[2];if(t>r[1])t=r[1];if(n>r[3])n=r[3];this.$setSize(t,n)},resize:function(e){if(webix._child_sizing_active)return;var t=this.getParentView();if(t){if(t.resizeChildren)t.resizeChildren();else t.resize()}else{this.adjust()}}},webix.Settings,webix.Destruction,webix.BaseBind,webix.UIExtension);webix.protoUI({name:"view",$init:function(e){this._set_inner(e)},_set_inner:function(e){var t=webix.isUndefined(e.borderless);if(t&&!this.setPosition&&e.$topView){e.borderless=true;t=false}if(t&&this.defaults.borderless||e.borderless){e._inner={top:true,left:true,bottom:true,right:true}}else{if(!e._inner)e._inner={};this._contentobj.style.borderWidth="1px"}},$getSize:function(e,t){var n=this._settings._inner;if(n){e+=(n.left?0:1)+(n.right?0:1);t+=(n.top?0:1)+(n.bottom?0:1)}var r=webix.ui.baseview.prototype.$getSize.call(this,e,t);webix.debug_size_box(this,r,true);return r},$setSize:function(e,t){webix.debug_size_box(this,[e,t]);var n=this._settings._inner;if(n){e-=(n.left?0:1)+(n.right?0:1);t-=(n.top?0:1)+(n.bottom?0:1)}return webix.ui.baseview.prototype.$setSize.call(this,e,t)}},webix.ui.baseview)})();webix.ui.view.call(webix);webix.debug_size_indent=0;webix.debug_size_step=function(){var e="";for(var t=0;t<webix.debug_size_indent;t++)e+="|  ";return e};webix.debug_size_box_start=function(e,t){if(!webix.debug_size)return;if(!webix.debug_size_indent)webix.log(t?"--- get sizes ---":"--- set sizes ---");webix.log(webix.debug_size_step()+e.name+"@"+e.config.id);webix.debug_size_indent++};webix.debug_size_box_end=function(e,t){if(!webix.debug_size)return;webix.debug_size_indent--;webix.log(webix.debug_size_step()+t.join(","))};webix.debug_size_box=function(e,t,n){if(!webix.debug_size)return;if(!webix.debug_size_indent)webix.log(n?"--- get sizes ---":"--- set sizes ---");webix.log(webix.debug_size_step()+e.name+"@"+e.config.id+" "+t.join(","))};webix.protoUI({name:"spacer",defaults:{borderless:true},$init:function(){this._viewobj.className+=" webix_spacer"}},webix.ui.view);webix.protoUI({name:"baselayout",$init:function(e){this.$ready.push(this._parse_cells);this._dataobj=this._contentobj;this._layout_sizes=[];this._responsive=[];if(e.$topView){e.borderless=true;e._inner={top:true,left:true,bottom:true,right:true}}if(e.isolate)webix.extend(this,webix.IdSpace)},rows_setter:function(e){this._vertical_orientation=1;this._collection=e},cols_setter:function(e){this._vertical_orientation=0;this.$view.style.whiteSpace="nowrap";this._collection=e},_remove:function(e){webix.PowerArray.removeAt.call(this._cells,webix.PowerArray.find.call(this._cells,e));this.resizeChildren(true)},_replace:function(e,t){if(webix.isUndefined(t)){for(var n=0;n<this._cells.length;n++)this._cells[n].destructor();this._collection=e;this._parse_cells()}else{var r;if(typeof t=="number"){if(t<0||t>this._cells.length)t=this._cells.length;var i=(this._cells[t]||{})._viewobj;webix.PowerArray.insertAt.call(this._cells,e,t);webix.html.insertBefore(e._viewobj,i,this._dataobj)}else{r=webix.$$(t);t=webix.PowerArray.find.call(this._cells,r);webix.assert(t!=-1,"Attempt to replace the non-existing view");r._viewobj.parentNode.insertBefore(e._viewobj,r._viewobj);r.destructor();this._cells[t]=e}if(!this._vertical_orientation)this._fix_vertical_layout(e);this._cells[t]._parent_cell=this}this.resizeChildren(true);var s=this.elements?this:this.getFormView();if(s)s._recollect_elements();webix.callEvent("onReconstruct",[this])},_fix_vertical_layout:function(e){e._viewobj.style.display="inline-block";e._viewobj.style.verticalAlign="top"},addView:function(e,t){if(webix.isUndefined(t))t=this._cells.length;return webix.ui(e,this,t)._settings.id},removeView:function(e){var t;if(typeof e!="object")t=webix.$$(e);else t=e;var n=webix.PowerArray.find.call(this._cells,t);if(n>=0){var r=this.elements?this:this.getFormView();this._cells.splice(n,1);if(r&&t.name)delete r.getCleanValues()[t.name];t.destructor();this.resizeChildren(true);if(r)r._recollect_elements()}else webix.assert(false,"Attemp to remove not existing view: "+e);webix.callEvent("onReconstruct",[this])},reconstruct:function(){this._replace(this._collection)},_hide:function(e,t,n){if(e._settings.hidden)return;e._settings.hidden=true;webix.html.remove(e._viewobj);this._hiddencells++;if(!n&&!webix._ui_creation)this.resizeChildren(true)},resizeChildren:function(){if(this._layout_sizes){var e=this.getParentView();if(e){if(e.resizeChildren)return e.resizeChildren();else return e.resize()}var t=this.$getSize(0,0);var n,r,i,s;i=n=this._layout_sizes[0]||0;s=r=this._layout_sizes[1]||0;if(!e){if(t[0]>n)i=t[0];if(t[2]>r)s=t[2];if(n>t[1])i=t[1];if(r>t[3])s=t[3];this.$setSize(i,s)}else this._set_child_size(n,r)}},getChildViews:function(){return this._cells},index:function(e){if(e._settings)e=e._settings.id;for(var t=0;t<this._cells.length;t++)if(this._cells[t]._settings.id==e)return t;return-1},_show:function(e,t,n){if(!e._settings.hidden)return;e._settings.hidden=false;var r=this.index(e)+1;while(this._cells[r]&&this._cells[r]._settings.hidden)r++;var i=this._cells[r]?this._cells[r]._viewobj:null;webix.html.insertBefore(e._viewobj,i,this._dataobj||this._viewobj);this._hiddencells--;if(!n){this.resizeChildren(true);if(e.refresh&&!e.touchable)e.refresh()}},showBatch:function(e){if(this._settings.visibleBatch==e)return;this._settings.visibleBatch=e;var t=[];for(var n=0;n<this._cells.length;n++){if(!this._cells[n]._settings.batch)t.push(this._cells[n]);else if(this._cells[n]._settings.batch==e)t.push(this._cells[n]);else this._hide(this._cells[n],null,true)}for(var n=0;n<t.length;n++)this._show(t[n],null,true);this.resizeChildren(true)},_parse_cells:function(e){this._cells=[];webix.assert(e,this.name+" was incorrectly defined. <br><br> You have missed rows|cols|cells|elements collection");for(var t=0;t<e.length;t++){webix._parent_cell=this;if(!e[t]._inner)e[t].borderless=true;this._cells[t]=webix.ui._view(e[t],this);if(!this._vertical_orientation)this._fix_vertical_layout(this._cells[t]);if(this._settings.visibleBatch&&this._settings.visibleBatch!=this._cells[t]._settings.batch&&this._cells[t]._settings.batch){this._cells[t]._settings.hidden=true;this._hiddencells++}if(!this._cells[t]._settings.hidden){(this._dataobj||this._contentobj).appendChild(this._cells[t]._viewobj);if(this._cells[t].$nospace)this._hiddencells++}}if(this._parse_cells_ext_end)this._parse_cells_ext_end(e)},_bubble_size:function(e,t,n){if(this._vertical_orientation!=n)for(var r=0;r<this._cells.length;r++){this._cells[r]._settings[e]=t;if(this._cells[r]._bubble_size)this._cells[r]._bubble_size(e,t,n)}},$getSize:function(e,t){webix.debug_size_box_start(this,true);var n=0;var r=1e5;var i=1e5;var s=0;if(this._vertical_orientation)i=0;else r=0;var o=0;var u=0;var a=0;this._sizes=[];for(var f=0;f<this._cells.length;f++){if(this._cells[f]._settings.hidden)continue;var l=this._sizes[f]=this._cells[f].$getSize(0,0);if(this._cells[f].$nospace){u++;continue}if(this._vertical_orientation){if(l[0]>n)n=l[0];if(l[1]<r)r=l[1];s+=l[2];i+=l[3];if(l[2]==l[3]&&l[2]!=-1){o+=l[2];u++}else a+=l[4]}else{if(l[2]>s)s=l[2];if(l[3]<i)i=l[3];n+=l[0];r+=l[1];if(l[0]==l[1]&&l[0]!=-1){o+=l[0];u++}else a+=l[4]}}if(s>i)i=s;if(n>r)r=n;this._master_size=[o,this._cells.length-u,a];this._desired_size=[n+e,s+t];var c=webix.ui.baseview.prototype.$getSize.call(this,0,0);if(c[1]>=1e5)c[1]=0;if(c[3]>=1e5)c[3]=0;c[0]=(c[0]||n)+e;c[1]=Math.max(c[0],(c[1]||r)+e);c[2]=(c[2]||s)+t;c[3]=Math.max(c[2],(c[3]||i)+t);webix.debug_size_box_end(this,c);return c},$setSize:function(e,t){this._layout_sizes=[e,t];webix.debug_size_box_start(this);webix.ui.baseview.prototype.$setSize.call(this,e,t);this._set_child_size(e,t);webix.debug_size_box_end(this,[e,t])},_set_child_size_a:function(e,t,n){t=e[t];n=e[n];var r=t;if(t!=n){var i=this._set_size_delta*e[4]/this._set_size_gravity;if(i<t){r=t;this._set_size_gravity-=e[4];this._set_size_delta-=r}else if(i>n){r=n;this._set_size_gravity-=e[4];this._set_size_delta-=r}else{return-1}}return r},_responsive_hide:function(e,t){var n=webix.$$(t);if(n==="hide"||!n){e.hide();webix.delay(this.resize,this);e._responsive_marker="hide"}else{if(!n)n=webix.ui({view:"popup",body:[{}]});e._responsive_width=e._settings.width;e._responsive_height=e._settings.height;e._responsive_marker=n._settings.id;e._settings.width=0;if(!e._settings.height)e._settings.autoheight=true;webix.ui(e,n,this._responsive.length)}this._responsive.push(e)},_responsive_show:function(e){var t=e._responsive_marker;e._responsive_marker=0;if(t==="hide"||!t){e.show();webix.delay(this.resize,this)}else{e._settings.width=e._responsive_width;e._settings.height=e._responsive_height;delete e._settings.autoheight;webix.ui(e,this,0)}this._responsive.pop()},_responsive_cells:function(e,t){if(this._responsive_tinkery)return;this._responsive_tinkery=true;if(e<this._desired_size[0]){for(var n=0;n<this._cells.length-1;n++){var r=this._cells[n];if(!r._responsive_marker){this._responsive_hide(r,this._settings.responsive);break}}}else if(this._responsive.length){var r=this._responsive[this._responsive.length-1];var i=r._responsive_marker=="hide"?0:r._responsive_width;var s=r.$getSize(i,0);if(s[0]+this._desired_size[0]+this._paddingX+20<=e)this._responsive_show(r)}this._responsive_tinkery=false},_set_child_size:function(e,t){webix._child_sizing_active=(webix._child_sizing_active||0)+1;if(this._settings.responsive)this._responsive_cells(e,t);this._set_size_delta=(this._vertical_orientation?t:e)-this._master_size[0];this._set_size_gravity=this._master_size[2];var n=e;var r=t;var i=[];for(var s=0;s<this._cells.length;s++){if(this._cells[s]._settings.hidden)continue;var o=this._sizes[s];if(this._vertical_orientation){var r=this._set_child_size_a(o,2,3);if(r<0){i.push(s);continue}}else{var n=this._set_child_size_a(o,0,1);if(n<0){i.push(s);continue}}this._cells[s].$setSize(n,r)}for(var s=0;s<i.length;s++){var u=i[s];var o=this._sizes[u];var a=Math.round(this._set_size_delta*o[4]/this._set_size_gravity);this._set_size_delta-=a;this._set_size_gravity-=o[4];if(this._vertical_orientation)r=a;else{n=a}this._cells[u].$setSize(n,r)}webix._child_sizing_active-=1},_next:function(e,t){var n=this.index(e);if(n==-1)return null;return this._cells[n+t]},_first:function(){return this._cells[0]}},webix.EventSystem,webix.ui.baseview);webix.protoUI({name:"layout",$init:function(e){this._hiddencells=0},defaults:{type:"line"},_parse_cells:function(){if(this._parse_cells_ext)e=this._parse_cells_ext(e);this._viewobj.className+=" webix_layout_"+(this._settings.type||"");if(this._settings.margin!==webix.undefined)this._margin=this._settings.margin;if(this._settings.padding!=webix.undefined)this._paddingX=this._paddingY=this._settings.padding;if(this._settings.paddingX!==webix.undefined)this._paddingX=this._settings.paddingX;if(this._settings.paddingY!==webix.undefined)this._paddingY=this._settings.paddingY;if(this._paddingY||this._paddingX)this._padding=true;if(this._padding&&this._margin>0&&!this._settings.borderless){this._contentobj.style.borderWidth="1px";this._render_borders=true}var e=this._collection;if(this._settings.borderless)this._settings._inner={top:true,left:true,right:true,bottom:true};this._beforeResetBorders(e);webix.ui.baselayout.prototype._parse_cells.call(this,e);this._afterResetBorders(e)},$getSize:function(e,t){e=e||0;t=t||0;var n=this._margin*(this._cells.length-this._hiddencells-1);if(this._render_borders||this._padding&&this._margin>0){var r=this._settings._inner;if(r){e+=(r.left?0:1)+(r.right?0:1);t+=(r.top?0:1)+(r.bottom?0:1)}}if(this._vertical_orientation)t+=n;else e+=n;return webix.ui.baselayout.prototype.$getSize.call(this,e+(this._paddingX||0)*2,t+(this._paddingY||0)*2)},$setSize:function(e,t){this._layout_sizes=[e,t];webix.debug_size_box_start(this);var n;if(this._padding&&this._margin>0||this._render_borders)n=webix.ui.view.prototype.$setSize.call(this,e,t);else n=webix.ui.baseview.prototype.$setSize.call(this,e,t);t=this._content_height;e=this._content_width;var r=this._settings;if(r.scroll){t=Math.max(t,this._desired_size[1]);e=Math.max(e,this._desired_size[0])}this._set_child_size(e,t);webix.debug_size_box_end(this,[e,t])},_set_child_size:function(e,t){var n=this._margin*(this._cells.length-this._hiddencells-1);if(this._vertical_orientation){t-=n+this._paddingY*2;e-=this._paddingX*2}else{e-=n+this._paddingX*2;t-=this._paddingY*2}return webix.ui.baselayout.prototype._set_child_size.call(this,e,t)},resizeChildren:function(e){if(e){this._last_size=null;var t=[];for(var n=0;n<this._cells.length;n++){var r=this._cells[n];t[n]=r._settings;var i=r._layout_sizes&&!r._render_borders||r._settings.borderless?"0px":"1px";r._viewobj.style.borderTopWidth=r._viewobj.style.borderBottomWidth=r._viewobj.style.borderLeftWidth=r._viewobj.style.borderRightWidth=i}this._beforeResetBorders(t);for(var n=0;n<t.length;n++)if(t[n].borderless&&this._cells[n]._set_inner)this._cells[n]._set_inner(t[n]);this._afterResetBorders(this._cells)}webix.ui.baselayout.prototype.resizeChildren.call(this)},_beforeResetBorders:function(e){if(this._padding&&this._margin){for(var t=0;t<e.length;t++){if(!e[t]._inner||!e[t].borderless)e[t]._inner={top:false,left:false,right:false,bottom:false}}}else{for(var t=0;t<e.length;t++)e[t]._inner=webix.clone(this._settings._inner);var n=false;if(this._settings.type=="clean")n=true;var r=e.length;if(this._vertical_orientation){for(var t=1;t<r-1;t++)e[t]._inner.top=e[t]._inner.bottom=n;if(r>1){if(this._settings.type!="head")e[0]._inner.bottom=n;while(e[r-1].hidden&&r>1)r--;if(r>0)e[r-1]._inner.top=n}}else{for(var t=1;t<r-1;t++)e[t]._inner.left=e[t]._inner.right=n;if(r>1){if(this._settings.type!="head")e[0]._inner.right=n;e[r-1]._inner.left=n;while(r>1&&e[r-1].hidden)r--;if(r>0)e[r-1]._inner.left=n}}}},_fix_container_borders:function(e,t){if(t.top)e.borderTopWidth="0px";if(t.left)e.borderLeftWidth="0px";if(t.right)e.borderRightWidth="0px";if(t.bottom)e.borderBottomWidth="0px"},_afterResetBorders:function(e){var t=0;for(var n=0;n<e.length;n++){var r=this._cells[n];var i=r._settings._inner;if(r._settings.hidden&&this._cells[n+1]){var s=this._cells[n+1]._settings._inner;if(!i.top)s.top=false;if(!i.left)s.left=false;if(n==t)t++}this._fix_container_borders(r._viewobj.style,r._settings._inner)}var o=this._vertical_orientation?"marginLeft":"marginTop";var u=this._vertical_orientation?"marginTop":"marginLeft";var a=this._vertical_orientation?this._paddingX:this._paddingY;var f=this._vertical_orientation?this._paddingY:this._paddingX;for(var n=0;n<e.length;n++)this._cells[n]._viewobj.style[o]=(a||0)+"px";if(this._cells.length)this._cells[t]._viewobj.style[u]=(f||0)+"px";for(var l=t+1;l<e.length;l++)this._cells[l]._viewobj.style[u]=this._margin+"px"},type_setter:function(e){this._margin=typeof this._margin_set[e]!="undefined"?this._margin_set[e]:this._margin_set["line"];this._paddingX=this._paddingY=typeof this._margin_set[e]!="undefined"?this._padding_set[e]:this._padding_set["line"];return e},$skin:function(){var e=webix.skin.$active;this._margin_set=e.layoutMargin;this._padding_set=e.layoutPadding}},webix.ui.baselayout);webix.ui.layout.call(webix);webix.animate=function(e,t){var n=t;if(webix.isArray(e)){for(var r=0;r<e.length;r++){if(webix.isArray(t))n=t[r];if(n.type=="slide"){if(n.subtype=="out"&&r===0){continue}if(n.subtype=="in"&&r==1){continue}}if(n.type=="flip"){var i=webix.clone(n);if(r===0){i.type="flipback"}if(r==1){i.callback=null}webix.animate(e[r],i);continue}webix.animate(e[r],n)}return}var s=webix.toNode(e);if(s._has_animation)webix.animate.end(s,n);else webix.animate.start(s,n)};webix.animate.end=function(e,t){e.style[webix.env.transitionDuration]="1ms";e._has_animation=null;if(webix._wait_animate)window.clearTimeout(webix._wait_animate);webix._wait_animate=webix.delay(webix.animate,webix,[e,t],10)};webix.animate.isSupported=function(){return!webix.$testmode&&!webix.noanimate&&webix.env.transform&&webix.env.transition&&!webix.env.isOpera};webix.animate.formLine=function(e,t,n){var r=n.direction;t.parentNode.style.position="relative";t.style.position="absolute";e.style.position="absolute";var i=webix.env.isFF?r=="top"||r=="left"?-1:1:0;if(r=="top"||r=="bottom"){e.style.left="0px";e.style.top=(n.top||i)+(r=="top"?1:-1)*t.offsetHeight+"px"}else{e.style.top=(n.top||0)+"px";e.style.left=i+(r=="left"?1:-1)*t.offsetWidth+"px"}t.parentNode.appendChild(e);if(n.type=="slide"&&n.subtype=="out"){e.style.left="0px";e.style.top=(n.top||0)+"px";t.parentNode.removeChild(t);e.parentNode.appendChild(t)}return[e,t]};webix.animate.breakLine=function(e){webix.html.remove(e[1]);webix.animate.clear(e[0]);webix.animate.clear(e[1]);e[0].style.position=""};webix.animate.clear=function(e){e.style[webix.env.transform]="";e.style[webix.env.transition]="";e.style.top=e.style.left=""};webix.animate.defaults={type:"slide",delay:"0",duration:"500",timing:"ease-in-out",x:0,y:0};webix.animate.start=function(e,t){if(typeof t=="string")t={type:t};t=webix.Settings._mergeSettings(t,webix.animate.defaults);var n=webix.env.cssPrefix;var r=e._has_animation=t;var i,s;switch(r.type=="slide"&&r.direction){case"right":r.x=e.offsetWidth;break;case"left":r.x=-e.offsetWidth;break;case"top":r.y=-e.offsetHeight;break;case"bottom":default:r.y=r.y||e.offsetHeight;break}if(r.type=="flip"||r.type=="flipback"){i=[0,0];s="scaleX";if(r.subtype=="vertical"){i[0]=20;s="scaleY"}else i[1]=20;if(r.direction=="right"||r.direction=="bottom"){i[0]*=-1;i[1]*=-1}}var o=r.duration+"ms "+r.timing+" "+r.delay+"ms";var u=n+"TransformStyle: preserve-3d;";var a="";var f="";switch(r.type){case"fade":a="opacity "+o;u="opacity: 0;";break;case"show":a="opacity "+o;u="opacity: 1;";break;case"flip":o=r.duration/2+"ms "+r.timing+" "+r.delay+"ms";f="skew("+i[0]+"deg, "+i[1]+"deg) "+s+"(0.00001)";a="all "+o;break;case"flipback":r.delay+=r.duration/2;o=r.duration/2+"ms "+r.timing+" "+r.delay+"ms";e.style[webix.env.transform]="skew("+ -1*i[0]+"deg, "+ -1*i[1]+"deg) "+s+"(0.00001)";e.style.left="0";f="skew(0deg, 0deg) "+s+"(1)";a="all "+o;break;case"slide":var l=r.x+"px";var c=r.y+"px";f=webix.env.translate+"("+l+", "+c+(webix.env.translate=="translate3d"?", 0":"")+")";a=n+"transform "+o;break;default:break}webix.delay(function(){e.style[webix.env.transition]=a;webix.delay(function(){if(u)e.style.cssText+=u;if(f)e.style[webix.env.transform]=f;var t=false;var n=webix.event(e,webix.env.transitionEnd,function(i){e._has_animation=null;if(r.callback)r.callback.call(r.master||window,e,r,i);t=true;webix.eventRemove(n)});window.setTimeout(function(){if(!t){e._has_animation=null;if(r.callback)r.callback.call(r.master||window,e,r);t=true;webix.eventRemove(n)}},(r.duration*1+r.delay*1)*1.3)})})};webix.MouseEvents={$init:function(e){e=e||{};this._clickstamp=0;this._dbl_sensetive=300;this._item_clicked=null;this._mouse_action_extend(e.onClick,"on_click");this._mouse_action_extend(e.onContext,"on_context");this._mouse_action_extend(e.onDblClick,"on_dblclick");this._mouse_action_extend(e.onMouseMove,"on_mouse_move");if(this.on_click){webix.event(this._contentobj,"click",this._onClick,this);if(webix.env.isIE8)webix.event(this._contentobj,"dblclick",this._onDblClick,this)}if(this.on_context)webix.event(this._contentobj,"contextmenu",this._onContext,this);if(this.on_mouse_move)this._enable_mouse_move()},_enable_mouse_move:function(){if(!this._mouse_move_enabled){this.on_mouse_move=this.on_mouse_move||{};webix.event(this._contentobj,"mousemove",this._onMouse,this);webix.event(this._contentobj,webix.env.isIE?"mouseleave":"mouseout",this._onMouse,this);this._mouse_move_enabled=1}},_mouse_action_extend:function(e,t){if(e){var n=this[t];var r=n?webix.extend({},n):{};this[t]=webix.extend(r,e)}},_onClick:function(e){if(!this.isEnabled())return false;webix.UIManager._focus_action(this);if(this.on_dblclick){var t=(new Date).valueOf();if(t-this._clickstamp<=this._dbl_sensetive&&this.locate){var n=this.locate(e);if(""+n==""+this._item_clicked){this._clickstamp=0;return this._onDblClick(e)}}this._clickstamp=t}var r=this._mouseEvent(e,this.on_click,"ItemClick");return r},_onDblClick:function(e){return this._mouseEvent(e,this.on_dblclick,"ItemDblClick")},_onContext:function(e){if(this._mouseEvent(e,this.on_context,"BeforeContextMenu")){this._mouseEvent(e,{},"AfterContextMenu")}},_onMouse:function(e){if(webix.env.isIE)e=document.createEventObject(event);else if(!webix.$testmode&&!webix.isUndefined(e.webkitMovementY)&&!e.webkitMovementY&&!e.webkitMovementX)return;if(this._mouse_move_timer)window.clearTimeout(this._mouse_move_timer);this.callEvent("onMouseMoving",[e]);this._mouse_move_timer=window.setTimeout(webix.bind(function(){if(e.type=="mousemove")this._onMouseMove(e);else this._onMouseOut(e)},this),this._settings.mouseEventDelay||500)},_onMouseMove:function(e){if(!this._mouseEvent(e,this.on_mouse_move,"MouseMove"))this.callEvent("onMouseOut",[e||event])},_onMouseOut:function(e){this.callEvent("onMouseOut",[e||event])},_mouseEvent:function(e,t,n){e=e||event;var r=e.target||e.srcElement;var i="";var s=null;var o=false;while(r&&r.parentNode){if(!o&&r.getAttribute){s=r.getAttribute(this._id);if(s){this._item_clicked=s;if(this.callEvent){if(!this.callEvent("on"+n,[s,e,r]))return}o=true}}i=r.className;if(i){i=i.split(" ");i=i[0]||i[1];if(t[i]){var u=webix.toFunctor(t[i],this.$scope);var a=u.call(this,e,s||webix.html.locate(e,this._id),r);if(typeof a!="undefined"&&a!==true)return}}r=r.parentNode}return o}};webix.protoUI({name:"accordionitem",$init:function(e){this._viewobj.innerHTML="<div webix_ai_id='"+e.id+"'  class='webix_accordionitem_header'><div class='webix_accordionitem_button' ></div><div class='webix_accordionitem_label' ></div></div><div class='webix_accordionitem_body'></div>";this._contentobj=this._viewobj;this._headobj=this._contentobj.childNodes[0];if(!e.header)this._headobj.style.display="none";this._headlabel=this._contentobj.childNodes[0].childNodes[1];this._headbutton=this._contentobj.childNodes[0].childNodes[0];this._bodyobj=this._contentobj.childNodes[1];this._viewobj.className+=" webix_accordionitem";this._head_cell=this._body_cell=null;this._viewobj.className+=" "+(this.getParentView()._vertical_orientation?"vertical":"horizontal");this._cells=true},_remove:function(){this._body_cell={destructor:function(){}}},_replace:function(e){this._body_cell.destructor();this._body_cell=e;this._body_cell._parent_cell=this;this._bodyobj.appendChild(this._body_cell._viewobj);this.resize()},_id:"webix_ai_id",getChildViews:function(){return[this._body_cell]},body_setter:function(e){if(typeof e!="object")e={template:e};e._inner={top:true,left:true,right:true,bottom:true};this._body_cell=webix.ui._view(e);this._body_cell.$view.style.border="0px solid red";this._body_cell._parent_cell=this;this._bodyobj.appendChild(this._body_cell._viewobj);return e},header_setter:function(e){if(e)e=webix.template(e);return e},headerAlt_setter:function(e){if(e)e=webix.template(e);return e},$getSize:function(e,t){var n=this._body_cell.$getSize(0,0);var r=this._settings._inner;if(r){e+=(r.left?0:1)+(r.right?0:1);t+=(r.top?0:1)+(r.bottom?0:1)}var i=0;var s=webix.ui.baseview.prototype.$getSize.call(this,0,0);s[0]=(s[0]||n[0])+e;if(s[1]>=1e5)s[1]=n[1];s[1]+=e;s[2]=(s[2]||n[2])+t;if(s[3]>=1e5)s[3]=n[3];s[3]+=t;if(this.getParentView()._vertical_orientation){if(this._settings.collapsed){s[2]=s[3]=this._getHeaderSize()}else if(this._settings.header)i=this._settings.headerHeight}else{if(this._settings.collapsed)s[0]=s[1]=this._getHeaderSize();if(this._settings.header)i=this._settings.headerHeight}s[2]+=i;s[3]+=i;webix.debug_size_box(this,s,true);return s},on_click:{webix_accordionitem_header:function(e,t){this._toggle(e)},webix_accordionitem_header_v:function(e,t){this._toggle(e)}},_toggle:function(e){this.define("collapsed",!this._settings.collapsed);webix.callEvent("onClick",[this._settings.id]);return webix.html.preventEvent(e)},collapsed_setter:function(e){if(this._settings.header===false)return;var t=this.getParentView();if(!e)this._expand();else if(!t||t._canCollapse(this))this._collapse();else{if(t._cells.length>1)for(var n=0;n<t._cells.length;n++)if(this!=t._cells[n]){t._cells[n].expand();this._collapse()}}this._settings.collapsed=e;if(!e)this.getParentView()._afterOpen(this);this.refresh();if(!webix._ui_creation)this.resize();t.callEvent("onAfter"+(e?"Collapse":"Expand"),[this._settings.id]);this._settings.$noresize=e;return e},collapse:function(){this.define("collapsed",true);webix.UIManager._moveChildFocus(this)},expand:function(){this.define("collapsed",false)},_show:function(){this.show()},_hide:function(){this.hide()},_expand:function(){this._bodyobj.style.display="";webix.html.removeCss(this.$view,"collapsed");webix.html.removeCss(this._headobj,"collapsed")},_collapse:function(){var e=this.getParentView()._vertical_orientation;if(this._settings.headerAlt)this._headlabel.innerHTML=this._settings.headerAlt();this._bodyobj.style.display="none";webix.html.addCss(this.$view,"collapsed");webix.html.addCss(this._headobj,"collapsed")},refresh:function(){var e=this._settings[this._settings.collapsed?"headerAlt":"header"]||this._settings.header;if(e)this._headlabel.innerHTML=e()},_getHeaderSize:function(){return this._settings.collapsed?this._settings.headerAltHeight:this._settings.headerHeight},$setSize:function(e,t){if(webix.ui.view.prototype.$setSize.call(this,e,t)){e=this._content_width;t=this._content_height;var n=this._getHeaderSize();if(this._settings.header){this._headobj.style.height=n+"px";this._headobj.style.width="auto";this._headobj.style[webix.env.transform]="";this._headobj.style.borderBottomWidth=(this._settings.collapsed?0:1)+"px";if(this.getParentView()._vertical_orientation||!this._settings.collapsed){t-=this._getHeaderSize()}else if(this._settings.collapsed){if(webix.animate.isSupported()){this._headobj.style.width=t+"px";this._headobj.style.height=e+3+"px";var r=Math.floor(t/2-e/2)+(e-this._settings.headerAltHeight)/2;this._headobj.style[webix.env.transform]="rotate(90deg) translate("+r+"px, "+(r+1)+"px)"}else{this._headobj.style.width=e+"px";this._headobj.style.height=t+3+"px";this._headlabel.innerHTML=""}}}if(!this._settings.collapsed){this._body_cell.$setSize(e,t);this._last_size_y=t}}else if(!this._settings.collapsed){var i=this._body_cell;if(this._last_size_y)i.$setSize(this._content_width,this._last_size_y)}},$skin:function(){var e=this.defaults;e.headerAltHeight=e.headerHeight=webix.skin.$active.barHeight;if(webix.skin.$active.borderlessAccordion)e.borderless=true},defaults:{header:false,headerAlt:false,body:""}},webix.MouseEvents,webix.EventSystem,webix.ui.view);webix.protoUI({name:"accordion",defaults:{panelClass:"accordionitem",multi:false,collapsed:false},_parse_cells:function(){var e=this._settings.panelClass;var t=this._collection;for(var n=0;n<t.length;n++){if((t[n].body||t[n].header)&&!t[n].view)t[n].view=e;if(webix.isUndefined(t[n].collapsed))t[n].collapsed=this._settings.collapsed}this._skin_render_collapse=true;webix.ui.layout.prototype._parse_cells.call(this);this._skin_render_collapse=false;for(var n=0;n<this._cells.length;n++){if(this._cells[n].name==e)this._cells[n].refresh();this._cells[n]._accLastChild=false}var r=false;for(var n=this._cells.length-1;n>=0&&!r;n--){if(!this._cells[n]._settings.hidden){this._cells[n]._accLastChild=true;r=true}}},_afterOpen:function(e){if(this._settings.multi===false&&this._skin_render_collapse!==true){for(var t=0;t<this._cells.length;t++){if(e!=this._cells[t]&&!this._cells[t]._settings.collapsed&&this._cells[t].collapse)this._cells[t].collapse()}}},_canCollapse:function(e){if(this._settings.multi===true||this._skin_render_collapse)return true;for(var t=0;t<this._cells.length;t++)if(e!=this._cells[t]&&!this._cells[t]._settings.collapsed)return true;return false},$skin:function(){var e=this.defaults;if(webix.skin.$active.accordionType)e.type=webix.skin.$active.accordionType}},webix.ui.layout);webix.protoUI({name:"headerlayout",defaults:{type:"accordion",multi:"mixed",collapsed:false}},webix.ui.accordion);webix.DragControl={_drag_masters:webix.toArray(["dummy"]),addDrop:function(e,t,n){e=webix.toNode(e);e.webix_drop=this._getCtrl(t);if(n)e.webix_master=true},_getCtrl:function(e){e=e||webix.DragControl;var t=this._drag_masters.find(e);if(t<0){t=this._drag_masters.length;this._drag_masters.push(e)}return t},addDrag:function(e,t){e=webix.toNode(e);e.webix_drag=this._getCtrl(t);webix.event(e,webix.env.mouse.down,this._preStart,e);webix.event(e,"dragstart",webix.html.preventEvent)},_preStart:function(e){if(webix.DragControl._active){if(webix.DragControl._saved_event==e)return;webix.DragControl._preStartFalse();webix.DragControl.destroyDrag()}webix.DragControl._active=this;var t=webix.env.mouse.context(e);webix.DragControl._start_pos=t;webix.DragControl._saved_event=e;webix.DragControl._webix_drag_mm=webix.event(document.body,webix.env.mouse.move,webix.DragControl._startDrag);webix.DragControl._webix_drag_mu=webix.event(document.body,webix.env.mouse.up,webix.DragControl._preStartFalse);webix.html.addCss(document.body,"webix_noselect")},_preStartFalse:function(e){webix.DragControl._clean_dom_after_drag()},_startDrag:function(e){var t=webix.env.mouse.context(e);if(Math.abs(t.x-webix.DragControl._start_pos.x)<5&&Math.abs(t.y-webix.DragControl._start_pos.y)<5)return;webix.DragControl._clean_dom_after_drag(true);if(!webix.DragControl.createDrag(webix.DragControl._saved_event))return;webix.DragControl.sendSignal("start");webix.DragControl._webix_drag_mm=webix.event(document.body,webix.env.mouse.move,webix.DragControl._moveDrag);webix.DragControl._webix_drag_mu=webix.event(document.body,webix.env.mouse.up,webix.DragControl._stopDrag);webix.DragControl._moveDrag(e);if(webix.env.touch)return webix.html.preventEvent(e)},_stopDrag:function(e){webix.DragControl._clean_dom_after_drag();webix.DragControl._saved_event=null;if(webix.DragControl._last){webix.DragControl.$drop(webix.DragControl._active,webix.DragControl._last,e);webix.DragControl.$dragOut(webix.DragControl._active,webix.DragControl._last,null,e)}webix.DragControl.destroyDrag();webix.DragControl.sendSignal("stop")},_clean_dom_after_drag:function(e){this._webix_drag_mm=webix.eventRemove(this._webix_drag_mm);this._webix_drag_mu=webix.eventRemove(this._webix_drag_mu);if(!e)webix.html.removeCss(document.body,"webix_noselect")},_moveDrag:function(e){var t=webix.html.pos(e);var n=webix.env.mouse.context(e);webix.DragControl.$dragPos(t,e);webix.DragControl._html.style.top=t.y+webix.DragControl.top+"px";webix.DragControl._html.style.left=t.x+webix.DragControl.left+"px";if(webix.DragControl._skip)webix.DragControl._skip=false;else{var r=n.target=webix.env.touch?document.elementFromPoint(n.x,n.y):n.target;var i=webix.env.touch?n:e;webix.DragControl._checkLand(r,i)}return webix.html.preventEvent(e)},_checkLand:function(e,t){while(e&&e.tagName!="BODY"){if(e.webix_drop){if(this._last&&(this._last!=e||e.webix_master))this.$dragOut(this._active,this._last,e,t);if(!this._last||this._last!=e||e.webix_master){this._last=null;this._landing=this.$dragIn(webix.DragControl._active,e,t);if(this._landing)this._last=e;return}return}e=e.parentNode}if(this._last)this._last=this._landing=this.$dragOut(this._active,this._last,null,t)},sendSignal:function(e){webix.DragControl.active=e=="start"},getMaster:function(e){return this._drag_masters[e.webix_drag||e.webix_drop]},getContext:function(){return this._drag_context},getNode:function(){return this._html},createDrag:function(e){var t=webix.DragControl._active;webix.DragControl._drag_context={};var n=this._drag_masters[t.webix_drag];var r;if(n.$dragCreate){r=n.$dragCreate(t,e);if(!r)return false;r.style.position="absolute"}else{var i=webix.DragControl.$drag(t,e);if(!i)return false;r=document.createElement("DIV");r.innerHTML=i;r.className="webix_drag_zone";document.body.appendChild(r)}r.style.zIndex=Math.max(r.style.zIndex,webix.ui.zIndex());webix.DragControl._skipDropH=webix.event(r,webix.env.mouse.move,webix.DragControl._skip_mark);if(!webix.DragControl._drag_context.from)webix.DragControl._drag_context={source:t,from:t};webix.DragControl._html=r;return true},_skip_mark:function(){webix.DragControl._skip=true},destroyDrag:function(){var e=webix.DragControl._active;var t=this._drag_masters[e.webix_drag];if(t&&t.$dragDestroy){webix.DragControl._skipDropH=webix.eventRemove(webix.DragControl._skipDropH);if(webix.DragControl._html)t.$dragDestroy(e,webix.DragControl._html)}else{webix.html.remove(webix.DragControl._html)}webix.DragControl._landing=webix.DragControl._active=webix.DragControl._last=webix.DragControl._html=null},top:5,left:5,$dragPos:function(e,t){var n=this._drag_masters[webix.DragControl._active.webix_drag];if(n.$dragPos&&n!=this)n.$dragPos(e,t,webix.DragControl._html)},$dragIn:function(e,t,n){var r=this._drag_masters[t.webix_drop];if(r.$dragIn&&r!=this)return r.$dragIn(e,t,n);t.className=t.className+" webix_drop_zone";return t},$dragOut:function(e,t,n,r){var i=this._drag_masters[t.webix_drop];if(i.$dragOut&&i!=this)return i.$dragOut(e,t,n,r);t.className=t.className.replace("webix_drop_zone","");return null},$drop:function(e,t,n){var r=this._drag_masters[t.webix_drop];webix.DragControl._drag_context.from=webix.DragControl.getMaster(e);if(r.$drop&&r!=this)return r.$drop(e,t,n);t.appendChild(e)},$drag:function(e,t){var n=this._drag_masters[e.webix_drag];if(n.$drag&&n!=this)return n.$drag(e,t);return"<div style='"+e.style.cssText+"'>"+e.innerHTML+"</div>"}};webix.DataMove={copy:function(e,t,n,r){r=r||{};var i=r.newId||e;n=n||this;var s=this.getItem(e);webix.assert(s,"Incorrect ID in DataMove::copy");if(n)s=n._externalData(s);return n.data.add(n._externalData(s,i),t)},_next_move_index:function(e,t,n){if(t&&e){var r=this.getIndexById(e);return r+(n==this&&n.getIndexById(t)<r?0:1)}},move:function(e,t,n,r){r=r||{};var i=r.newId||e;n=n||this;webix.assert(n.data,"moving attempt to component without datastore");if(!n.data)return;if(webix.isArray(e)){if(e.length>3)this.$blockRender=n.$blockRender=true;for(var s=0;s<e.length;s++){var o=this.move(e[s],t,n,r);t=n._next_move_index(o,e[s+1],this)}this.$blockRender=n.$blockRender=false;if(e.length>3){this.refresh();if(n!=this)n.refresh()}return}var o=e;var u=this.getItem(e);webix.assert(u,"Incorrect ID in DataMove::move");if(!n||n==this){if(t<0)t=this.data.order.length-1;this.data.move(this.getIndexById(e),t);this.data.callEvent("onDataMove",[e,t])}else{o=n.data.add(n._externalData(u,i),t,r.parent||0);this.data.remove(e)}return o},moveUp:function(e,t){return this.move(e,this.getIndexById(e)-(t||1))},moveDown:function(e,t){return this.moveUp(e,(t||1)*-1)},moveTop:function(e){return this.move(e,0)},moveBottom:function(e){return this.move(e,this.data.count()-1)},_externalData:function(e,t){var n=webix.extend({},e);n.id=!t||this.data.pull[t]?webix.uid():t;n.$template=null;if(this._settings.externalData)n=this._settings.externalData.call(this,n,t);return n}};webix.Movable={move_setter:function(e){if(e){this._move_admin=webix.clone(this._move_admin);this._move_admin.master=this;webix.DragControl.addDrag(this._headobj,this._move_admin)}return e},_move_admin:{$dragCreate:function(e,t){var n=webix.html.offset(e);var r=webix.html.pos(t);webix.DragControl.top=n.y-r.y;webix.DragControl.left=n.x-r.x;return webix.toNode(this.master._viewobj)},$dragDestroy:function(e,t){var n=this.master;if(n._settings){n._settings.top=parseInt(t.style.top,10);n._settings.left=parseInt(t.style.left,10)}webix.DragControl.top=webix.DragControl.left=5;return}}};webix.Modality={_modal_set:function(e){if(e){if(!this._modal_cover){this._modal_cover=webix.html.create("div",{"class":"webix_modal"});var t=this._settings.zIndex||webix.ui.zIndex();this._previous_modality=webix._modality;webix._modality=t;this._modal_cover.style.zIndex=t-1;this._viewobj.style.zIndex=t;document.body.appendChild(this._modal_cover)}}else{if(this._modal_cover){webix.html.remove(this._modal_cover);var n=this._previous_modality;setTimeout(function(){webix._modality=n},1);this._modal_cover=null}}return e}};webix.protoUI({name:"window",$init:function(e){this._viewobj.innerHTML="<div class='webix_win_content'><div class='webix_win_head'></div><div class='webix_win_body'></div></div>";this._contentobj=this._viewobj.firstChild;this._headobj=this._contentobj.childNodes[0];this._dataobj=this._bodyobj=this._contentobj.childNodes[1];this._viewobj.className+=" webix_window";this._head_cell=this._body_cell=null;this._settings._inner={top:false,left:false,right:false,bottom:false};if(!e.id)e.id=webix.uid()},getChildViews:function(){if(this._head_cell)return[this._head_cell,this._body_cell];else return[this._body_cell]},zIndex_setter:function(e){this._viewobj.style.zIndex=e;return e},_remove:function(){this._body_cell={destructor:function(){}}},_replace:function(e){this._body_cell.destructor();this._body_cell=e;this._body_cell._parent_cell=this;this._bodyobj.appendChild(this._body_cell._viewobj);var t=this._body_cell._viewobj.style;t.borderTopWidth=t.borderBottomWidth=t.borderLeftWidth=t.borderRightWidth="1px";this._body_cell._settings._inner=webix.clone(this._settings._inner);this.resize(true)},show:function(e,t,n){this._settings.hidden=false;this._viewobj.style.zIndex=this._settings.zIndex||webix.ui.zIndex();if(this._settings.modal)this._modal_set(true);var r,i,s;t=t||{};if(!t.pos)t.pos=this._settings.relative;if(e){if(typeof e=="object"&&!e.tagName){if(e.target||e.srcElement){r=webix.html.pos(e);i=20;s=5}else r=e}else{e=webix.toNode(e);webix.assert(e,"Not existing target for window:show");r=webix.html.offset(e)}var o=Math.max(window.innerWidth||0,document.body.offsetWidth);var u=Math.max(window.innerHeight||0,document.body.offsetHeight);i=i||e.offsetWidth||0;s=s||e.offsetHeight||0;var a=this._last_size;var f=r.x;var l=r.y;var c=0;var h=0;if(this._settings.autofit){var p=6;var d=6;var v=6;n="top";l=0;f=0;if(o-r.x-i<a[0]&&t.pos=="right")t.pos="left";if(t.pos=="right"){f=r.x+p+i;d=-s;n="left";c=Math.round(r.y+s/2);h=f-v}else if(t.pos=="left"){f=r.x-p-a[0]-1;d=-s;n="right";c=Math.round(r.y+s/2);h=f+a[0]+1}else{if(r.x<0){f=0}else if(o-r.x>a[0]){f=r.x}else{f=o-p-a[0]}h=Math.round(r.x+i/2);if(h>f+a[0])h=f+a[0]/2}if((!a[1]||u-s-r.y-d>a[1])&&t.pos!="top"){l=s+r.y+d-4;if(!c){n="top";c=l-v}}else{l=r.y-d-a[1];if(l<0){l=0;if(n=="top")n=false}else if(!c){n="bottom";l--;c=l+a[1]+1}}}var m=t.x||0;var g=t.y||0;this.setPosition(f+m,l+g);if(this._set_point){if(n)this._set_point(n,h+m,c+g);else this._hide_point()}}else if(this._settings.position)this._setPosition();this._show_time=new Date;this._viewobj.style.display="block";this._render_hidden_views();if(this.config.autofocus){this._prev_focus=webix.UIManager.getFocus();webix.UIManager.setFocus(this)}if(-1==webix.ui._popups.find(this))webix.ui._popups.push(this);this.callEvent("onShow",[])},_hide:function(){if(this._settings.hidden||this._settings.modal)return;if(webix._modality&&this._settings.zIndex<=webix._modality)return;if(new Date-(this._show_time||0)>(webix.env.touch?400:100))this.hide()},hidden_setter:function(e){if(e)this.hide();else this.show();return!!e},hide:function(e){if(!e)if(this._settings.hidden)return;if(this._settings.modal)this._modal_set(false);if(this._settings.position=="top"){webix.animate(this._viewobj,{type:"slide",x:0,y:-(this._content_height+20),duration:300,callback:this._hide_callback,master:this})}else this._hide_callback();if(this._settings.autofocus){webix.UIManager.setFocus(this._prev_focus);this._prev_focus=null}webix.ui._popups.remove(this)},destructor:function(){if(this._settings.autofocus){if(!webix._final_destruction)webix.UIManager.setFocus(this._prev_focus);this._prev_focus=null}webix.ui._popups.remove(this);webix.Destruction.destructor.apply(this,[])},_hide_callback:function(){if(!this.$destructed){this._viewobj.style.display="none";this._settings.hidden=true;this.callEvent("onHide",[])}},close:function(){this._modal_set(false);webix.html.remove(this._viewobj);this.destructor()},_inner_body_set:function(e){e.borderless=true},body_setter:function(e){if(typeof e!="object")e={template:e};this._inner_body_set(e);webix._parent_cell=this;this._body_cell=webix.ui._view(e);this._body_cell._parent_cell=this;this._bodyobj.appendChild(this._body_cell._viewobj);return e},head_setter:function(e){if(e===false)return e;if(typeof e!="object")e={template:e,padding:0};e.borderless=true;webix._parent_cell=this;this._head_cell=webix.ui._view(e);this._head_cell._parent_cell=this;this._headobj.appendChild(this._head_cell._viewobj);return e},getBody:function(){return this._body_cell},getHead:function(){return this._head_cell},adjust:function(){return this.resize()},resizeChildren:function(){if(this._body_cell)this.resize()},resize:function(){webix.ui.baseview.prototype.adjust.call(this);this._setPosition(this._settings.left,this._settings.top)},_setPosition:function(e,t){if(this._settings.position){this.$view.style.position="fixed";var n=this._content_width;var r=this._content_height;webix.assert(n&&r,"Attempt to show not rendered window");var i=window.innerWidth||document.documentElement.offsetWidth;var s=window.innerHeight||document.documentElement.offsetHeight;var o=Math.round((i-n)/2);var u=Math.round((s-r)/2);if(typeof this._settings.position=="function"){var a={left:o,top:u,width:n,height:r,maxWidth:i,maxHeight:s};this._settings.position.call(this,a);if(a.width!=n||a.height!=r)this.$setSize(a.width,a.height);this.setPosition(a.left,a.top)}else{if(this._settings.position=="top"){if(webix.animate.isSupported())u=-1*r;else u=10}this.setPosition(o,u)}if(this._settings.position=="top")webix.animate(this._viewobj,{type:"slide",x:0,y:r-(this._settings.padding||0)*2,duration:300,callback:this._topPositionCallback,master:this})}else this.setPosition(e,t)},_topPositionCallback:function(e){webix.animate.clear(e);this._settings.top=-((this._settings.padding||0)*2);this.setPosition(this._settings.left,this._settings.top)},setPosition:function(e,t){this._viewobj.style.top=t+"px";this._viewobj.style.left=e+"px";this._settings.left=e;this._settings.top=t},$getSize:function(e,t){var n=this._settings._inner;if(n){e+=(n.left?0:1)+(n.right?0:1);t+=(n.top?0:1)+(n.bottom?0:1)}if(this._settings.head)t+=1;var r=this._body_cell.$getSize(0,0);if(this._head_cell){var i=this._head_cell.$getSize(0,0);if(i[3]==i[2])this._settings.headHeight=i[3];t+=this._settings.headHeight}if(this._settings.fullscreen){var s=window.innerWidth||document.body.clientWidth;var o=window.innerHeight||document.body.clientHeight;return[s,s,o,o]}var u=webix.ui.view.prototype.$getSize.call(this,0,0);u[1]=Math.min(u[1],(r[1]>=1e5&&u[1]>=1e5?Math.max(r[0],300):r[1])+e);u[3]=Math.min(u[3],(r[3]>=1e5&&u[3]>=1e5?Math.max(r[2],200):r[3])+t);u[0]=Math.min(Math.max(u[0],r[0]+e),u[1]);u[2]=Math.min(Math.max(u[2],r[2]+t),u[3]);return u},$setSize:function(e,t){webix.ui.view.prototype.$setSize.call(this,e,t);e=this._content_width;t=this._content_height;if(this._settings.head===false){this._headobj.style.display="none";this._body_cell.$setSize(e,t)}else{this._head_cell.$setSize(e,this._settings.headHeight);this._body_cell.$setSize(e,t-this._settings.headHeight)}},$skin:function(){this.defaults.headHeight=webix.skin.$active.barHeight},defaults:{top:0,left:0,autofit:true,relative:"bottom",body:"",head:"",hidden:true,autofocus:true}},webix.ui.view,webix.Movable,webix.Modality,webix.EventSystem);webix.protoUI({name:"popup",$init:function(){this._settings.head=false;this.$view.className+=" webix_popup";webix.event(this._contentobj,"click",webix.bind(this._clever_block,this));webix.attachEvent("onClick",webix.bind(this._hide,this));this.attachEvent("onHide",this._hide_point)},_clever_block:function(){var e=webix.ui._popups;var t=e.find(this);if(t==-1)t=e.length-1;for(var n=t;n>=0;n--)e[n]._show_time=new Date},close:function(){webix.html.remove(this._point_element);webix.ui.window.prototype.close.call(this)},$getSize:function(e,t){return webix.ui.window.prototype.$getSize.call(this,e+this._settings.padding*2,t+this._settings.padding*2)},$setSize:function(e,t){if(webix.ui.view.prototype.$setSize.call(this,e,t)){e=this._content_width-this._settings.padding*2;t=this._content_height-this._settings.padding*2;this._contentobj.style.padding=this._settings.padding+"px";this._headobj.style.display="none";this._body_cell.$setSize(e,t)}},_inner_body_set:function(){},defaults:{padding:8},head_setter:function(){},_set_point:function(e,t,n){this._hide_point();document.body.appendChild(this._point_element=webix.html.create("DIV",{"class":"webix_point_"+e},""));this._point_element.style.zIndex=webix.ui.zIndex();this._point_element.style.top=n+"px";this._point_element.style.left=t+"px"},_hide_point:function(){this._point_element=webix.html.remove(this._point_element)}},webix.ui.window);webix.ui._popups=webix.toArray();webix.protoUI({name:"suggest",defaults:{autofocus:false,type:"list",keyPressTimeout:1,body:{yCount:10,autoheight:true,body:true,select:true,borderless:true},filter:function(e,t){if(e.value.toString().toLowerCase().indexOf(t.toLowerCase())===0)return true;return false}},template_setter:webix.template,filter_setter:function(e){return webix.toFunctor(e,this.$scope)},$init:function(e){var t={};webix.extend(t,this.defaults.body);t.view=e.type||this.defaults.type;if(e.body)webix.extend(t,e.body,true);if(e.data)t.data=e.data;if(e.url)t.url=e.url;if(e.datatype)t.datatype=e.datatype;if(e.id)t.id=t.id||e.id+"_"+t.view;e.body=t;this.$ready.push(this._set_on_popup_click)},_preselectMasterOption:function(e){var t,n,r;if(this._settings.master){t=webix.$$(this._settings.master);if(t.options_setter&&(n=t.getInputNode())){r=this.getItemText(e.id);if(webix.isUndefined(n.value))n.innerHTML=r;else n.value=r.replace(/<[^>]*>/g,"")}}},setMasterValue:function(e,t){if(this._settings.master){var n=webix.$$(this._settings.master);if(t&&e.id)n.refresh();else if(n.options_setter)n.setValue(e.id);else n.setValue(e.text||e.value)}else if(this._last_input_target){this._last_input_target.value=e.text||e.value}if(!t){this.hide(true);if(this._last_input_target)this._last_input_target.focus()}this.callEvent("onValueSuggest",[e])},getMasterValue:function(){if(this._settings.master)return webix.$$(this._settings.master).getValue();return null},getItemText:function(e){var t=this.getList().getItem(e);if(!t)return e;if(this._settings.template)return this._settings.template.call(this,t,this.type);if(this._settings.textValue)return t[this._settings.textValue];var n=this.getList().type;return n.template.call(n,t,n)},getSuggestion:function(){var e=this.getList();var t;if(e.getSelectedId)t=e.getSelectedId();if(!t&&e.data.order.length)t=e.data.order[0];return t},getList:function(){return this._body_cell},_set_on_popup_click:function(){var e=this.getList();var t=this._settings.type;if(e.count){e.attachEvent("onItemClick",webix.bind(function(t){this.setMasterValue(e.getItem(t))},this));e.data.attachEvent("onstoreupdated",webix.bind(function(e,t,n){if(n=="delete"&&e==this.getMasterValue())this.setMasterValue({id:"",text:""},1);else if(n=="update"&&e==this.getMasterValue()){this.setMasterValue(t,1)}},this));e.data.attachEvent("onAfterFilter",webix.bind(this._suggest_after_filter,this));e.data.attachEvent("onStoreLoad",webix.bind(this._suggest_after_filter,this));if(webix.isUndefined(this._settings.fitMaster))this._settings.fitMaster=true}else if(t=="calendar"){e.attachEvent("onDateSelect",function(e){this.getParentView().setMasterValue({value:e})})}else if(t=="colorboard"){e.attachEvent("onSelect",function(e){this.getParentView().setMasterValue({value:e})})}},input_setter:function(e){this.linkInput(e);return 0},linkInput:function(e){var t;if(e.getInputNode){t=e.getInputNode();t.webix_master_id=e._settings.id}else t=webix.toNode(e);webix.event(t,"keydown",function(e){if(t!=document.body||this.isVisible())this._suggestions(e)},this);this._non_ui_mode=true},_suggestions:function(e){e=e||event;var t=this.getList();var n=e.target||e.srcElement;this._last_input_target=n;this._settings.master=n.webix_master_id;window.clearTimeout(this._key_timer);var r=e.keyCode;if(r==16||r==17)return;if(r==9)return this._tab_key(this,t);if(r==27)return this._escape_key(this,t);if(r==13)return this._enter_key(this,t);if(this._navigate(e)){webix.html.preventEvent(e);return false}if(webix.isUndefined(n.value))return;clearTimeout(this._last_delay);this._last_delay=webix.delay(function(){if(!this._non_ui_mode&&webix.UIManager.getFocus()!=webix.$$(this._settings.master))return;this._resolve_popup=true;var e=n.value;if(t.config.dataFeed)t.filter("value",e);else if(t.filter){t.filter(webix.bind(function(t){return this._settings.filter.call(this,t,e)},this))}},this,[],this._settings.keyPressTimeout)},_suggest_after_filter:function(){if(!this._resolve_popup)return true;this._resolve_popup=false;var e=this.getList();if(e.count()>0){this.adjust();this._dont_unfilter=true;this.show(this._last_input_target,null,true)}else{this.hide(true);this._last_input_target=null}},show:function(e){if(!this.isVisible()){var t=this.getList();if(t.filter&&!this._dont_unfilter){t.filter("");if(t.select)this._show_selection(t)}else this._dont_unfilter=false;if(e.tagName&&this._settings.fitMaster){this._settings.width=e.offsetWidth-2}if(t._zoom_level)t.render();this.adjust()}webix.ui.popup.prototype.show.apply(this,arguments)},_show_selection:function(e){var t=this.getMasterValue();if(t&&e.exists&&e.exists(t))e.select(t)},_enter_key:function(e,t){if(t.count&&t.count()){if(e.isVisible()){var n=t.getSelectedId(false,true);if(n)this.setMasterValue(t.getItem(n));e.hide(true)}else{e.show(this._last_input_target)}}else{if(e.isVisible())e.hide(true)}},_escape_key:function(e,t){return e.hide(true)},_tab_key:function(e,t){return e.hide(true)},_navigate:function(e){var t=this.getList();var n=e.keyCode;if(t.count&&t.moveSelection){if(n===38&&!e.ctrlKey&&!e.shiftKey&&!e.altKey){t.moveSelection("up");this._preselectMasterOption(t.getSelectedItem());return true}if(n===40&&!e.ctrlKey&&!e.shiftKey&&!e.altKey){var r=this.isVisible();if(!r){if(t.count())this.show(this._last_input_target);else return false}var i=t.getSelectedId();if(!i&&t.count)t.select(t.getFirstId());else if(r)t.moveSelection("down");this._preselectMasterOption(t.getSelectedItem());return true}}return false}},webix.ui.popup);webix.attachEvent("onClick",function(e){var t=webix.$$(e);if(t&&t.touchable){t.getNode(e);var n=e.target||e.srcElement;if(n.className=="webix_disabled")return;var r="";var i=null;var s=false;if(n.className&&n.className.indexOf("webix_view")===0)return;while(n&&n.parentNode){if(n.getAttribute){if(n.getAttribute("view_id"))break;r=n.className;if(r){r=r.split(" ");r=r[0]||r[1];if(t.on_click[r]){var o=t.on_click[r].call(t,e,t._settings.id,n);if(o===false)return}}}n=n.parentNode}if(t._settings.click){var u=webix.toFunctor(t._settings.click,t.$scope);if(u&&u.call)u.call(t,t._settings.id,e)}if(t._settings.popup){var a=webix.$$(t._settings.popup);webix.assert(a,"Unknown popup");a._settings.master=t._settings.id;a.show(t.getInputNode()||t.getNode(),null,true)}t.callEvent("onItemClick",[t._settings.id,e])}});webix.protoUI({name:"button",touchable:true,$skin:function(){this.defaults.height=webix.skin.$active.buttonHeight||webix.skin.$active.inputHeight;this._labelTopHeight=webix.skin.$active.labelTopHeight||15},defaults:{template:function(e,t){return"<div class='webix_el_box' style='width:"+e.awidth+"px; height:"+e.aheight+"px'>"+t._inputTemplate(e,t)+"</div>"},label:"",tabFocus:true,borderless:true},_inputTemplate:function(e){var t="class='webixtype_"+(e.type||"base")+"' ";return"<input type='button' "+t+' value="'+(e.label||e.value)+'">'},$init:function(e){this._viewobj.className+=" webix_control webix_el_"+(this.$cssName||this.name);this.data=this._settings;this._dataobj=this._viewobj},hotkey_setter:function(e){var t=this;this._addElementHotKey(e,function(e,n){var r=t.$view.firstChild;if(r.dispatchEvent){var i=document.createEvent("MouseEvents");i.initEvent("click",true,true);n.preventDefault();r.dispatchEvent(i)}})},_addElementHotKey:function(e,t,n){var r=webix.UIManager.addHotKey(e,t,n);this.attachEvent("onDestruct",function(){webix.UIManager.removeHotKey(r,t,n)})},tooltip_setter:function(e){if(this.$view.firstChild)this.$view.firstChild.title=e;return e},type_setter:function(e){if(this._types[e])this._inputTemplate=webix.template(this._types[e]);if(e=="prev"||e=="next")this._set_inner_size=this._set_inner_size_next;else this._set_inner_size=false;return e},_types:{htmlbutton:"<button class='webix_el_htmlbutton webixtype_base'>#label#</buttom>",prev:"<input type='button' class='webixtype_prev' value='#label#' /><div class='webix_el_arrow webixtype_prev_arrow'></div>",next:"<input type='button' class='webixtype_next' value='#label#' /><div class='webix_el_arrow webixtype_next_arrow'></div>",imageButton:"<button class='webix_img_btn_abs webixtype_base' style='width:100%; line-height:#cheight#px'><div class='webix_image' style='width:#dheight#px;height:#dheight#px;background-image:url(#image#);'> </div> #label#</button>",imageButtonTop:"<button class='webix_img_btn_abs webix_img_btn_abs_top webixtype_base'><div class='webix_image' style='width:100%;height:100%;background-image:url(#image#);'> </div> <div class='webix_img_btn_text'>#label#</div></button>",image:"<button class='webix_img_btn' style='line-height:#cheight#px;'><div class='webix_image' style='width:#cheight#px;height:#cheight#px;background-image:url(#image#);'> </div> #label#</button>",imageTop:"<button class='webix_img_btn_top' style='background-image:url(#image#);'><div class='webix_img_btn_text'>#label#</div></button>",icon:"<button class='webix_img_btn' style='line-height:#cheight#px;'><span class='webix_icon_btn fa-#icon#' style='max-width:#cheight#px;'></span>#label#</button>",iconButton:"<button class='webix_img_btn_abs webixtype_base' style='width:100%;'><span class='webix_icon fa-#icon#'></span> #label#</button>",iconTop:"<button class='webix_img_btn_top' style='width:100%;top:4px;text-align:center;'><span class='webix_icon fa-#icon#'></span><div class='webix_img_btn_text'>#label#</div></button>",iconButtonTop:"<button class='webix_img_btn_abs webix_img_btn_abs_top webixtype_base' style='width:100%;top:0px;text-align:center;'><span class='webix_icon fa-#icon#'></span><div class='webix_img_btn_text'>#label#</button></div>"},_findAllInputs:function(){var e=[];var t=["input","select","textarea"];for(var n=0;n<t.length;n++){var r=this.$view.getElementsByTagName(t[n]);for(var i=0;i<r.length;i++){e.push(r[i])}}return e},disable:function(){var e,t=this._getBox();webix.ui.baseview.prototype.disable.apply(this,arguments);if(t&&t.className.indexOf(" webix_disabled_box")==-1){t.className+=" webix_disabled_box";var n=this._findAllInputs();for(e=0;e<n.length;e++)n[e].setAttribute("disabled",true)}if(this._settings.labelPosition=="top"){var r=this._dataobj.firstChild;if(r)r.className+=" webix_disabled_top_label"}},enable:function(){webix.ui.baseview.prototype.enable.apply(this,arguments);var e=this._getBox();if(e){e.className=e.className.replace(" webix_disabled_box","");var t=this._findAllInputs();for(var n=0;n<t.length;n++)t[n].removeAttribute("disabled")}if(this._settings.labelPosition=="top"){var r=this._dataobj.firstChild;if(r)r.className=r.className.replace(" webix_disabled_top_label","")}},$setSize:function(e,t){if(webix.ui.view.prototype.$setSize.call(this,e,t)){this.render()}},setValue:function(e){var t=this._settings.value;if(t==e)return false;this._settings.value=e;if(this._rendered_input)this.$setValue(e);this.callEvent("onChange",[e,t])},$setValue:function(e){(this.getInputNode()||{}).value=e},getValue:function(){var e=this._rendered_input?this.$getValue():this._settings.value;return typeof e=="undefined"?"":e},$getValue:function(){return this._settings.value||""},focus:function(){var e=this.getInputNode();if(e&&e.focus)e.focus()},blur:function(){var e=this.getInputNode();if(e&&e.blur)e.blur()},getInputNode:function(){return this._dataobj.getElementsByTagName("input")[0]},_getBox:function(){for(var e=0;e<this._dataobj.childNodes.length;e++){if(this._dataobj.childNodes[e].className.indexOf("webix_el_box")>=0)return this._dataobj.childNodes[e]}return null},_sqrt_2:Math.sqrt(2),_set_inner_size_next:function(){var e=this._getBox().childNodes[1];var t=e.previousSibling;var n=this._settings.type=="next"?"right":"left";var r=this._settings.aheight-webix.skin.$active.inputPadding*2-2;var i=r*this._sqrt_2/2;e.style.width=i+"px";e.style.height=i+"px";e.style.top=(r-i)/2+webix.skin.$active.inputPadding+"px";e.style[n]=(r-i)/2+this._sqrt_2/2+"px";t.style.width=this._settings.awidth-r/2-2+"px";t.style.height=r+2+"px";t.style[n]=r/2+2+"px";t.style.top=webix.skin.$active.inputPadding+"px"},_calck_input_size:function(){this._input_width=this._settings.inputWidth||(this._content_width-this._settings.width>2?this._settings.width:0)||this._content_width;this._input_height=this._settings.inputHeight},render:function(){this._calck_input_size();this._settings.awidth=this._input_width||this._content_width;this._settings.aheight=this._input_height||this._content_height;this._settings.bheight=this._settings.aheight+2;this._settings.cheight=this._settings.aheight-2*webix.skin.$active.inputPadding;this._settings.dheight=this._settings.cheight-2;if(webix.AtomRender.render.call(this)){this._rendered_input=true;if(this._set_inner_size)this._set_inner_size();if(this._settings.align){var e=this._dataobj.firstChild;if(this._settings.labelPosition=="top"&&e.nextSibling)e=e.nextSibling;switch(this._settings.align){case"right":e.style.cssFloat="right";break;case"center":e.style.display="inline-block";e.parentNode.style.textAlign="center";break;case"middle":e.style.marginTop=Math.round((this._content_height-this._input_height)/2)+"px";break;case"bottom":e.style.marginTop=this._content_height-this._input_height+"px";break;case"left":e.style.cssFloat="left";break;default:webix.assert(false,"Unknown align mode: "+this._settings.align);break}}if(this.$render)this.$render(this.data);if(this._settings.disabled)this.disable();if(this._settings.tooltip)this.define("tooltip",this._settings.tooltip);if(this._init_once){this._init_once(this.data);this._init_once=0}}},refresh:function(){this.render()},on_click:{_handle_tab_click:function(e,t){var n=webix.html.locate(e,"button_id");if(n&&this.callEvent("onBeforeTabClick",[n,e])){this.setValue(n);this.callEvent("onAfterTabClick",[n,e])}},webix_all_segments:function(e,t){this.on_click._handle_tab_click.call(this,e,t)},webix_all_tabs:function(e,t){this.on_click._handle_tab_click.call(this,e,t)},webix_inp_counter_next:function(e,t,n){this.next()},webix_inp_counter_prev:function(e,t,n){this.prev()},webix_inp_combo:function(e,t,n){n.focus()},webix_inp_checkbox_border:function(e,t,n){if((e.target||e.srcElement).tagName!="DIV"&&!this._settings.readonly)this.toggle()},webix_inp_checkbox_label:function(e,t,n){if(!this._settings.readonly)this.toggle()},webix_inp_radio_border:function(e,t,n){var r=webix.html.locate(e,"radio_id");this.setValue(r)},webix_inp_radio_label:function(e,t,n){n=n.parentNode.getElementsByTagName("input")[0];return this.on_click.webix_inp_radio_border.call(this,n,t,n)},webix_tab_more_icon:function(e,t,n){this.getPopup().resize();this.getPopup().show(n,null,true)}},_check_options:function(e){webix.assert(e,this.name+": options not defined");for(var t=0;t<e.length;t++){webix.assert(!e[t].text,"Please replace .text with .value in control config");webix.assert(!e[t].label,"Please replace .label with .value in control config");if(typeof e[t]=="string"){e[t]={id:e[t],value:e[t]}}else{if(webix.isUndefined(e[t].id))e[t].id=e[t].value;if(webix.isUndefined(e[t].value))e[t].value=e[t].id}}return e}},webix.ui.view,webix.AtomRender,webix.Settings,webix.EventSystem);webix.protoUI({name:"label",defaults:{template:"<div style='height:100%;line-height:#cheight#px'>#label#</div>"},$skin:function(){this.defaults.height=webix.skin.$active.inputHeight},focus:function(){return false},_getBox:function(){return this._dataobj.firstChild},setHTML:function(e){this._settings.template=function(){return e};this.refresh()},setValue:function(e){this._settings.label=e;webix.ui.button.prototype.setValue.apply(this,arguments)},$setValue:function(e){this._dataobj.firstChild.innerHTML=e},_set_inner_size:function(){}},webix.ui.button);webix.protoUI({name:"icon",$skin:function(){this.defaults.height=webix.skin.$active.inputHeight},defaults:{template:"<button style='height:100%;width:100%' class='webix_icon_button'><span class='webix_icon fa-#icon# '></span></button>",width:33},_set_inner_size:function(){}},webix.ui.button);webix.protoUI({name:"text",_allowsClear:true,_init_onchange:function(){if(this._allowsClear){webix.event(this.getInputNode(),"change",function(){var e=this.getValue();if(e!=this._settings.value)this.setValue(this.getValue(),true)},this);if(this._settings.suggest)webix.$$(this._settings.suggest).linkInput(this)}},$skin:function(){this.defaults.height=webix.skin.$active.inputHeight;this.defaults.inputPadding=webix.skin.$active.inputPadding},$init:function(e){if(e.labelPosition=="top")if(webix.isUndefined(e.height))e.height=this.defaults.height+this._labelTopHeight;this._destroy_with_me=[];this._setSubmitEvent();this.attachEvent("onAfterRender",this._init_onchange)},$renderIcon:function(){var e=this._settings;if(e.icon){var t=e.aheight-2*e.inputPadding,n=(t-18)/2-1;return"<span style='height:"+(t-n)+"px;padding-top:"+n+"px;' class='webix_input_icon fa-"+e.icon+"'></span>"}return""},_setSubmitEvent:function(e){if(!this._skipSubmit){var t=this.getFormView();if(t){this._addElementHotKey("enter",function(e,n){t.callEvent("onSubmit",[e,n])},this)}}},relatedView_setter:function(e){this.attachEvent("onChange",function(){var e=this.getValue();var t=this._settings.relatedAction;var n=this._settings.relatedView;var r=webix.$$(n);if(!r){var i=this.getTopParentView();if(i&&i.$$)r=i.$$(n)}webix.assert(r,"Invalid relatedView: "+n);if(t=="enable")if(e)r.enable();else r.disable();else if(e)r.show();else r.hide()});return e},validateEvent_setter:function(e){if(e=="blur")this.attachEvent("onBlur",this.validate);if(e=="key")this.attachEvent("onTimedKeyPress",this.validate);return e},validate:function(){var e=this._settings.validate;if(!e&&this._settings.required)e=webix.rules.isNotEmpty;var t=this.getFormView();var n=this.config.name;var r=this.getValue();var i={};i[n]=r;webix.assert(t,"Validation works only for fields in the form");webix.assert(n,"Validation works only for fields with name");if(e&&!this.getFormView()._validate(e,r,i,n))return false;return true},$setSize:function(e,t){if(webix.ui.view.prototype.$setSize.call(this,e,t)){if(!e||!t)return;var n=this._settings;if(n.labelPosition=="top"){n.inputHeight=this._content_height-this._labelTopHeight;n.labelWidth=0}this.render()}},_get_input_width:function(e){var t=(this._input_width||0)-(e.label?this._settings.labelWidth:0)-webix.skin.$active.inputPadding*2-(e.iconWidth||0);return t<0?0:t},_render_div_block:function(e,t){var n=e.id||webix.uid();var r=t._get_input_width(e);var i=e.inputAlign||"left";var s=this.$renderIcon?this.$renderIcon(e):"";var o=this._settings.aheight-2*webix.skin.$active.inputPadding-2;var u=e.text||e.value||(e.placeholder?"<span class='webix_placeholder'>"+e.placeholder+"</span>":"");var a="<div class='webix_inp_static' tabindex='0' onclick='' style='line-height:"+o+"px;width: "+r+"px; text-align: "+i+";' >"+u+"</div>";return t.$renderInput(e,a,n)},_baseInputHTML:function(e){var t="<"+e+(this._settings.placeholder?" placeholder='"+this._settings.placeholder+"' ":" ");if(this._settings.readonly)t+="readonly='true' ";var n=this._settings.attributes;if(n)for(var r in n)t+=r+"='"+n[r]+"' ";return t},$renderInput:function(e,t,n){var r=e.inputAlign||"left";var i=e.labelAlign||"left";var s=this._settings.labelPosition=="top";var o=s?"display:block;":"width: "+this._settings.labelWidth+"px;";n=n||e.name||webix.uid();var u="";var a=s?this._labelTopHeight-2:this._settings.aheight-2*this._settings.inputPadding;if(e.label)u="<label style='"+o+"text-align: "+i+";line-height:"+a+"px' onclick='' for='"+n+"' class='webix_inp_"+(s?"top_":"")+"label "+(e.required?"webix_required":"")+"'>"+(e.label||"")+"</label>";var f="";if(t){f+=t}else{var l=this._get_input_width(e);f+=this._baseInputHTML("input")+"id='"+n+"' type='"+(e.type||this.name)+"' value='"+(e.value||"")+"' style='width: "+l+"px; text-align: "+r+";'";var c=this._settings.attributes;if(c)for(var h in c)f+=" "+h+"='"+c[h]+"'";f+=" />"}var p=this.$renderIcon?this.$renderIcon(e):"";f+=p;f+="</div>";if(s)return u+"<div class='webix_el_box' style='width:"+this._settings.awidth+"px; height:"+this._settings.aheight+"px'>"+f+"</div>";else return"<div class='webix_el_box' style='width:"+this._settings.awidth+"px; height:"+this._settings.aheight+"px'>"+u+f+"</div>"},defaults:{template:function(e,t){return t.$renderInput(e)},label:"",labelWidth:80},type_setter:function(e){return e},_set_inner_size:false,$setValue:function(e){this.getInputNode().value=e},$getValue:function(){return this.getInputNode().value},suggest_setter:function(e){if(e){webix.assert(e!==true,"suggest options can't be set as true, data need to be provided instead");if(typeof e=="string"){var t=webix.$$(e);if(t)return webix.$$(e)._settings.id;e={body:{url:e,dataFeed:e}}}else if(webix.isArray(e))e={body:{data:this._check_options(e)}};else if(!e.body)e.body={};webix.extend(e,{view:"suggest"});var n=webix.ui(e);this._destroy_with_me.push(n);return n._settings.id}return false}},webix.ui.button);webix.protoUI({name:"segmented",_allowsClear:false,$init:function(){this.attachEvent("onChange",function(e){if(this._settings.multiview){var t=this.getTopParentView();var n=null;if(t&&t.$$)n=t.$$(e);if(!n)n=webix.$$(e);if(n&&n.show)n.show()}})},defaults:{template:function(e,t){if(!e.options)webix.assert(false,"segmented: options undefined");var n=e.options;t._check_options(n);var r=t._get_input_width(e);var i=webix.uid();var s="<div style='width:"+r+"px' class='webix_all_segments'>";var o=e.optionWidth||Math.floor(r/n.length);if(!e.value)e.value=n[0].id;for(var u=0;u<n.length;u++){s+="<input type='button' style='width:"+(n[u].width||o)+"px' ";s+="class='"+(e.value==n[u].id?"webix_selected ":"")+"webix_segment_"+(u==n.length-1?"N":u>0?1:0)+"' button_id='"+n[u].id+"' value='"+n[u].value+"'>"}return t.$renderInput(e,s+"</div>",i)}},$setValue:function(e){this.refresh()},getValue:function(){return this._settings.value},getInputNode:function(){return null},optionIndex:function(e){var t=this._settings.options;for(var n=0;n<t.length;n++)if(t[n].id==e)return n;return-1},addOption:function(e,t,n,r){t=t||e;if(this.optionIndex(e)<0)webix.PowerArray.insertAt.call(this._settings.options,{id:e,value:t},r);if(n)this.setValue(e)},removeOption:function(e,t){var n=this.optionIndex(e);var r=this._settings.options;if(n>=0)webix.PowerArray.removeAt.call(r,n);if(this._settings.value==e){var i=Math.min(n,r.length-1);if(i>=0){this.setValue(r[i].id);return r[i].id}else{this._settings.value=-1}}this.refresh()},_set_inner_size:false},webix.ui.text);webix.protoUI({name:"search",$skin:function(){this.defaults.inputPadding=webix.skin.$active.inputPadding},on_click:{webix_input_icon:function(e){return this.callEvent("onSearchIconClick",[e])}},defaults:{type:"text",icon:"search"}},webix.ui.text);webix.protoUI({name:"toggle",_allowsClear:true,$init:function(){this.attachEvent("onItemClick",function(){this.toggle()})},$setValue:function(e){this.render()},toggle:function(){this.setValue(!this.getValue())},getValue:function(){var e=this._settings.value;return!e||e=="0"?0:1},defaults:{template:function(e,t){var n=e.value?" webix_pressed":"";e.label=(e.value?e.onLabel:e.offLabel)||e.label;e.icon=(e.value?e.onIcon:e.offIcon)||e.icon;return"<div class='webix_el_box"+n+"' style='width:"+e.awidth+"px; height:"+e.aheight+"px'>"+t._inputTemplate(e,t)+"</div>"}},_set_inner_size:false},webix.ui.button);webix.protoUI({name:"select",defaults:{template:function(e,t){var n=t._check_options(e.options);var r=e.name||"x"+webix.uid();var i=t._baseInputHTML("select")+"id='"+r+"' style='width:"+t._get_input_width(e)+"px;'>";var s=webix.$$(n);if(s&&s.data&&s.data.each){s.data.each(function(t){i+="<option"+(t.id==e.value?" selected='true'":"")+" value='"+t.id+"'>"+t.value+"</option>"})}else for(var o=0;o<n.length;o++){i+="<option"+(n[o].id==e.value?" selected='true'":"")+" value='"+n[o].id+"'>"+n[o].value+"</option>"}i+="</select>";return t.$renderInput(e,i,r)}},options_setter:function(e){if(e){if(typeof e=="string"){var t=new webix.DataCollection({url:e});t.data.attachEvent("onStoreLoad",webix.bind(this.refresh,this));return t}else return e}},getInputNode:function(){return this._dataobj.getElementsByTagName("select")[0]}},webix.ui.text);webix.protoUI({name:"textarea",$skin:function(){},defaults:{template:function(e,t){var n=e.name||e.id;var r="x"+webix.uid();var i=t._baseInputHTML("textarea")+"style='width:"+t._get_input_width(e)+"px;'";i+=" id='"+r+"' name='"+n+"' class='webix_inp_textarea'>"+(e.value||"")+"</textarea>";return t.$renderInput(e,i,r)},height:0,minHeight:60},_skipSubmit:true,getInputNode:function(){return this._dataobj.getElementsByTagName("textarea")[0]}},webix.ui.text);webix.protoUI({name:"counter",defaults:{template:function(e,t){var n=e.value||0;var r=e.name||"x"+webix.uid();var i="<div class='webix_el_group' style='width:"+t._get_input_width(e)+"px'>";i+="<input type='button' class='webix_inp_counter_prev' value='-' />";i+=t._baseInputHTML("input")+"type='text' class='webix_inp_counter_value' value='"+n+"'></input>";i+="<input id='"+r+"' type='button' class='webix_inp_counter_next' value='+'/><div>";return t.$renderInput(e,i,r)},min:0,max:Infinity,step:1},$setValue:function(e){this.getInputNode().value=e},getInputNode:function(){return this._dataobj.getElementsByTagName("input")[1]},getValue:function(e){return webix.ui.button.prototype.getValue.apply(this,arguments)*1},next:function(e){e=this._settings.step;this.shift(e)},prev:function(e){e=-1*this._settings.step;this.shift(e)},shift:function(e){var t=this._settings.min;var n=this._settings.max;var r=this.getValue()+e;if(r>=t&&r<=n)this.setValue(r)}},webix.ui.text);webix.protoUI({name:"checkbox",defaults:{checkValue:1,uncheckValue:0,template:function(e,t){var n=e.name||"x"+webix.uid();var r="";if(e.labelRight){r="<label class='webix_label_right'>"+e.labelRight+"</label>";if(e.labelWidth)e.label=e.label||"&nbsp;"}var i=e.checkValue==e.value;var s=Math.floor((t._settings.aheight-16)/2);var o=t._baseInputHTML("input")+"style='margin-top:"+s+"px;"+(e.customCheckbox?"display:none":"")+"' id='"+n+"' type='checkbox' "+(i?"checked='1'":"")+"/>";var u="webix_inp_checkbox_border webix_el_group webix_checkbox_"+(i?"1":"0");var a="<div style='line-height:"+t._settings.cheight+"px' class='"+u+"'>"+o+(e.customCheckbox||"")+r+"</div>";return t.$renderInput(e,a,n)}},_init_onchange:function(){},$setValue:function(e){var t=e==this._settings.checkValue;var n=this.getInputNode()?this.getInputNode().parentNode:null;if(n){n.className=n.className.replace(/(webix_checkbox_)\d/,"$1"+(t?1:0))}this.getInputNode().checked=t},toggle:function(){var e=this.getValue()!=this._settings.checkValue?this._settings.checkValue:this._settings.uncheckValue;this.setValue(e)},getValue:function(){var e=this._settings.value;return e==this._settings.checkValue?this._settings.checkValue:this._settings.uncheckValue},$skin:function(){if(webix.skin.$active.customCheckbox)this.defaults.customCheckbox="<a onclick='javascript:void(0)'><label class='webix_custom_checkbox'></label></a>"}},webix.ui.text);webix.protoUI({name:"radio",defaults:{template:function(e,t){var n=t._check_options(e.options);var r=[];var i;for(var s=0;s<n.length;s++){var o="x"+webix.uid();i=i||o;if(s&&(n[s].newline||e.vertical))r.push("<div class='webix_line_break'></div>");var u=n[s].id==e.value;var a=t._baseInputHTML("input")+"name='"+e.name+"' type='radio' "+(u?"checked='1'":"")+" value='"+n[s].id+"' id='"+o+"' style='"+(e.customRadio?"display:none":"")+"' />";var f="<div radio_id='"+n[s].id+"' class='webix_inp_radio_border webix_radio_"+(u?"1":"0")+"'>"+a+(e.customRadio||"")+"</div>";var l=n[s].value||"";if(l)l="<label for='"+o+"' class='webix_label_right'>"+l+"</label>";r.push(f+l)}r="<div class='webix_el_group' style='margin-left:"+(e.label?e.labelWidth:0)+"px;'>"+r.join("")+"</div>";return t.$renderInput(e,r,i)}},$getSize:function(e,t){var n=webix.ui.button.prototype.$getSize.call(this,e,t);if(this._settings.options){var r=1;for(var i=0;i<this._settings.options.length;i++)if(this._settings.vertical||this._settings.options[i].newline)r++;n[3]=n[2]=Math.max(n[2],(this.config.optionHeight||25)*r)}return n},_getInputNode:function(){return this._dataobj.getElementsByTagName("input")},$setValue:function(e){var t=this._getInputNode();for(var n=0;n<t.length;n++){if(t[n].parentNode.getAttribute("radio_id")==e){t[n].className="webix_inp_radio_on";t[n].checked=true}else{t[n].className="webix_inp_radio_on webix_hidden";t[n].checked=false}var r=t[n]?t[n].parentNode:null;if(r){r.className=r.className.replace(/(webix_radio_)\d/,"$1"+(t[n].checked?1:0))}}},getValue:function(e){return this._settings.value},$skin:function(){if(webix.skin.$active.customRadio)this.defaults.customRadio="<a onclick='javascript:void(0)'><label class='webix_custom_radio'></label></a>";if(webix.skin.$active.optionHeight)this.defaults.optionHeight=webix.skin.$active.optionHeight}},webix.ui.text);webix.protoUI({name:"richselect",defaults:{template:function(e,t){return t._render_div_block(e,t)},popupWidth:200,icon:"angle-down"},suggest_setter:function(e){return this.options_setter(e)},options_setter:function(e){var t=this._settings.popup=this._settings.suggest=webix.ui.text.prototype.suggest_setter.call(this,e);var n=webix.$$(t).getList();if(n)n.attachEvent("onAfterLoad",webix.bind(this._reset_value,this));return t},_reset_value:function(){var e=this._settings.value;if(!webix.isUndefined(e)&&!this.getPopup().isVisible())this.$setValue(e)},$skin:function(){this.defaults.inputPadding=webix.skin.$active.inputPadding},$render:function(e){if(webix.isUndefined(e.value))return;this.$setValue(e.value)},getInputNode:function(){return this._dataobj.getElementsByTagName("DIV")[1]},getPopup:function(){return webix.$$(this._settings.popup)},getText:function(){var e=this.getInputNode();return typeof e.value=="undefined"?e.innerHTML:e.value},$setValue:function(e){if(!this._rendered_input)return;var t=e;var n=this.getPopup();if(n)var t=this.getPopup().getItemText(e);this._settings.value=e;this._settings.text=t;var r=this.getInputNode();if(webix.isUndefined(r.value))r.innerHTML=t;else r.value=t.replace(/<[^>]*>/g,"")},getValue:function(){return this._settings.value||""}},webix.ui.text);webix.protoUI({name:"combo",$init:function(){this.attachEvent("onBlur",webix.bind(function(e){if(this._settings.text==this.getText())return;var t=this.getPopup().getSuggestion();if(t&&!(this.getInputNode().value===""&&webix.$$(this.config.suggest).getList().getItem(t).value!==""))this.$setValue(t);else if(!this.config.editable){var n=this.getValue();this.$setValue(webix.isUndefined(n)?"":n)}},this))},getInputNode:function(){return this._dataobj.getElementsByTagName("input")[0]},$render:function(e){if(webix.isUndefined(e.value))return;this.$setValue(e.value)},defaults:{template:function(e,t){return t.$renderInput(e)},icon:"angle-down"}},webix.ui.richselect);webix.protoUI({name:"datepicker",$init:function(){this.$ready.push(this._init_popup)},defaults:{template:function(e,t){return t._render_div_block(e,t)},stringResult:false,timepicker:false,icon:"calendar"},$skin:function(){this.defaults.inputPadding=webix.skin.$active.inputPadding},getPopup:function(){return webix.$$(this._settings.popup)},_init_popup:function(){var e=this._settings;if(e.suggest)e.popup=e.suggest;else if(!e.popup){var t=this._settings.timepicker;e.popup=e.suggest=this.suggest_setter({type:"calendar",height:240+(t?30:0),width:250,body:{timepicker:t}})}this._init_once=function(){}},$render:function(e){if(webix.isUndefined(e.value))return;this.$setValue(e.value)},$setValue:function(e){var t=webix.$$(this._settings.popup.toString());var n=t._body_cell;if(typeof e=="string"&&e)e=webix.i18n.parseFormatDate(e);if(e&&isNaN(e.getTime()))e="";n.selectDate(e,true);this._settings.value=e?n.config.date:"";this._settings.text=e?(this._settings.format||webix.i18n.parseFormatStr)(this._settings.value):"";this.getInputNode().innerHTML=this._settings.text||this._settings.placeholder||""},format_setter:function(e){return webix.Date.dateToStr(e)},getInputNode:function(){return this._dataobj.getElementsByTagName("DIV")[1]},getValue:function(){if(this._settings.stringResult&&typeof this._settings.value!="string"){return this._settings.value?webix.i18n.parseFormatStr(this._settings.value):""}return this._settings.value||null}},webix.ui.text);webix.protoUI({name:"colorpicker",$init:function(){this.$ready.push(this._init_popup)},defaults:{template:function(e,t){return t._render_div_block(e,t)},icon:false},_init_popup:function(){var e=this._settings;if(e.suggest)e.popup=e.suggest;else if(!e.popup)e.popup=e.suggest=this.suggest_setter({type:"colorboard",height:200});this._init_once=function(){}},$render:function(e){if(webix.isUndefined(e.value))return;this.$setValue(e.value)},$setValue:function(e){var t=webix.$$(this._settings.popup.toString());var n=t._body_cell;n.setValue(e);this._settings.value=e;var r=this._settings.value;var i=this._settings.icon?"":"<div style='background-color:"+r+";'>&nbsp;</div>"+r;this.getInputNode().innerHTML=i}},webix.ui.datepicker);webix.RenderStack={$init:function(){webix.assert(this.data,"RenderStack :: Component doesn't have DataStore");webix.assert(webix.template,"webix.template :: webix.template is not accessible");this._html=document.createElement("DIV");this.data.attachEvent("onIdChange",webix.bind(this._render_change_id,this));this.attachEvent("onItemClick",this._call_onclick);if(!this.types){this.types={"default":this.type};this.type.name="default"}this.type=webix.clone(this.type)},customize:function(e){webix.type(this,e)},type_setter:function(e){if(!this.types[e])this.customize(e);else{this.type=webix.clone(this.types[e]);if(this.type.css)this._contentobj.className+=" "+this.type.css}if(this.type.on_click)webix.extend(this.on_click,this.type.on_click);return e},template_setter:function(e){this.type.template=webix.template(e)},_toHTML:function(e){var t=this.data._marks[e.id];webix.assert(!e.$template||this.type["template"+e.$template],"RenderStack :: Unknown template: "+e.$template);this.callEvent("onItemRender",[e]);return this.type.templateStart(e,this.type,t)+(e.$template?this.type["template"+e.$template]:this.type.template)(e,this.type,t)+this.type.templateEnd(e,this.type,t)},_toHTMLObject:function(e){this._html.innerHTML=this._toHTML(e);return this._html.firstChild},_render_change_id:function(e,t){var n=this.getItemNode(e);if(n){n.setAttribute(this._id,t);this._htmlmap[t]=this._htmlmap[e];delete this._htmlmap[e]}},_call_onclick:function(){if(this._settings.click){var e=webix.toFunctor(this._settings.click,this.$scope);if(e&&e.call)e.apply(this,arguments)}},getItemNode:function(e){if(this._htmlmap)return this._htmlmap[e];this._htmlmap={};var t=this._dataobj.childNodes;for(var n=0;n<t.length;n++){var r=t[n].getAttribute(this._id);if(r)this._htmlmap[r]=t[n]}return this.getItemNode(e)},locate:function(e){return webix.html.locate(e,this._id)},showItem:function(e){var t=this.getItemNode(e);if(t&&this.scrollTo){var n=t.offsetLeft;var r=n+t.offsetWidth;var i=t.offsetTop;var s=i+t.offsetHeight;var o=this.getScrollState();var u=o.x;if(u>n||u+this._content_width<r)u=n;var a=o.y;if(a>i||a+this._content_height<s)a=i-5;this.scrollTo(u,a);if(this._setItemActive)this._setItemActive(e)}},render:function(e,t,n){if(!this.isVisible(this._settings.id)||this.$blockRender)return;if(webix.debug_render)webix.log("Render: "+this.name+"@"+this._settings.id+", mode:"+(n||"#")+", item:"+(e||"#"));if(e){var r=this.getItemNode(e);switch(n){case"paint":case"update":if(!r)return;var i=this._htmlmap[e]=this._toHTMLObject(t);webix.html.insertBefore(i,r);webix.html.remove(r);break;case"delete":if(!r)return;webix.html.remove(r);delete this._htmlmap[e];break;case"add":var i=this._htmlmap[e]=this._toHTMLObject(t);webix.html.insertBefore(i,this.getItemNode(this.data.getNextId(e)),this._dataobj);break;case"move":webix.html.insertBefore(this.getItemNode(e),this.getItemNode(this.data.getNextId(e)),this._dataobj);break;default:webix.assert_error("Unknown render command: "+n);break}}else{if(this.callEvent("onBeforeRender",[this.data])){(this._renderobj||this._dataobj).innerHTML=this.data.getRange().map(this._toHTML,this).join("");this._htmlmap=null;this.callEvent("onAfterRender",[]);var i=this._dataobj.offsetHeight}}}};webix.ValidateData={$init:function(){if(this._events)this.attachEvent("onChange",this.clearValidation)},clearValidation:function(){if(this.elements){for(var e in this.elements){this._clear_invalid(e)}}},validate:function(e){webix.assert(this.callEvent,"using validate for eventless object");this.callEvent("onBeforeValidate",[]);var t=this._validate_details={};var n=true;var r=this._settings.rules;var i={},s=[];for(var o in this.elements){var u=this.elements[o].config.name;if(this.elements[o].isVisible())i[u]=this.elements[o];else s.push(u)}if(r||i)if(!e&&this.getValues)e=this.getValues();if(r){if(r.$obj)n=this._validate(r.$obj,e,e,"")&&n;var a=r.$all;if(a)for(var f in e){if(s.indexOf(f)!==-1)continue;var l=this._validate(a,e[f],e,f);if(!l)t[f]=true;n=l&&n}for(var f in r){if(s.indexOf(f)!==-1)continue;if(f.indexOf("$")!==0&&!t[f]){webix.assert(r[f],"Invalid rule for:"+f);var l=this._validate(r[f],e[f],e,f);if(!l)t[f]=true;n=l&&n}}}if(i){for(var f in i){if(t[f])continue;var c=i[f];if(c.validate){var l=c.validate();n=l&&n;if(!l)t[f]=true}else{var h=c._settings;if(h){var p=h.validate;if(!p&&h.required)p=webix.rules.isNotEmpty;if(p){var l=this._validate(p,e[f],e,f);if(!l)t[f]=true;n=l&&n}}}}}this.callEvent("onAfterValidation",[n,this._validate_details]);return n},_validate:function(e,t,n,r){if(typeof e=="string")e=webix.rules[e];if(e.call(this,t,n,r)){if(this.callEvent("onValidationSuccess",[r,n])&&this._clear_invalid)this._clear_invalid(r,n);return true}else{if(this.callEvent("onValidationError",[r,n])&&this._mark_invalid)this._mark_invalid(r,n)}return false}};webix.ValidateCollection={_validate_init_once:function(){this.data.attachEvent("onStoreUpdated",webix.bind(function(e,t,n){if(e&&(n=="add"||n=="update"))this.validate(e)},this));this.attachEvent("onClearAll",this.clearValidation);this._validate_init_once=function(){}},rules_setter:function(e){if(e){this._validate_init_once()}return e},clearValidation:function(){this.data.clearMark("webix_invalid",true)},validate:function(e){var t=true;if(!e)for(var n in this.data.pull)var t=this.validate(n)&&t;else{this._validate_details={};var r=this.getItem(e);t=webix.ValidateData.validate.call(this,r);if(t){if(this.callEvent("onValidationSuccess",[e,r]))this._clear_invalid(e)}else{if(this.callEvent("onValidationError",[e,r,this._validate_details]))this._mark_invalid(e,this._validate_details)}}return t},_validate:function(e,t,n,r){if(typeof e=="string")e=webix.rules[e];var i=e.call(this,t,n,r);if(!i){this._validate_details[r]=true}return i},_clear_invalid:function(e){this.data.removeMark(e,"webix_invalid",true)},_mark_invalid:function(e,t){this.data.addMark(e,"webix_invalid",true)}};webix.rules={isEmail:function(e){return/^[^@]+@[^@]+\.[^@]+$/.test((e||"").toString())},isNumber:function(e){return parseFloat(e)==e},isNotEmpty:function(e){return e===0||e}};webix.DataLoader=webix.proto({$init:function(e){e=e||"";this._ajax_queue=webix.toArray();this.data=new webix.DataStore;this.data.attachEvent("onClearAll",webix.bind(this._call_onclearall,this));this.data.attachEvent("onServerConfig",webix.bind(this._call_on_config,this));this.data.feed=this._feed},_feed:function(e,t,n){if(this._load_count)return this._load_count=[e,t,n];else this._load_count=true;this._feed_last=[e,t];this._feed_common.call(this,e,t,n)},_feed_common:function(e,t,n){var r=this.data.url;if(e<0)e=0;var i=[this._feed_callback,n];if(r&&typeof r!="string"){var s={from:e,count:t};if(this.getState){var o=this.getState();s.sort=o.sort;s.filter=o.filter}this.load(r,i,s)}else{var u=r+(r.indexOf("?")==-1?"?":"&")+(this.count()?"continue=true":"");if(t!=-1)u+="&count="+t;if(e)u+="&start="+e;if(this.getState){var o=this.getState();if(o.sort)u+="&sort["+o.sort.id+"]="+o.sort.dir;if(o.filter)for(var a in o.filter)u+="&filter["+a+"]="+o.filter[a]}this.load(u,i)}},_feed_callback:function(){var e=this._load_count;var t=this._feed_last;this._load_count=false;if(typeof e=="object"&&(e[0]!=t[0]||e[1]!=t[1]))this.data.feed.apply(this,e)},load:function(e,t){var n=webix.AtomDataLoader.load.apply(this,arguments);if(!this.data.url)this.data.url=e;return n},loadNext:function(e,t,n,r,i){var s=this._settings;if(s.datathrottle&&!i){if(this._throttle_request)window.clearTimeout(this._throttle_request);this._throttle_request=webix.delay(function(){this.loadNext(e,t,n,r)},this,0,s.datathrottle);return}if(!t&&t!==0)t=this.count();if(!e)e=s.datafetch||this.count();this.data.url=this.data.url||r;if(this.callEvent("onDataRequest",[t,e,n,r])&&this.data.url)this.data.feed.call(this,t,e,n)},_maybe_loading_already:function(e,t){var n=this._feed_last;if(this._load_count&&n){if(n[0]<=t&&n[1]+n[0]>=e+t)return true}return false},_onLoad:function(e,t,n){var r;if(n===-1)r=t;else{this._ajax_queue.remove(n);r=this.data.driver.toObject(e,t)}if(r)this.data._parse(r);else return this._onLoadError(e,t,n);this._call_onready();this.callEvent("onAfterLoad",[])},removeMissed_setter:function(e){return this.data._removeMissed=e},_init_dataprocessor:function(){var e=this._settings.save;if(e===true)e=this._settings.save=this._settings.url;var t={master:this};if(e&&e.url)webix.extend(t,e);else t.url=e;webix.dp(t)},save_setter:function(e){if(e)this.$ready.push(this._init_dataprocessor);return e},scheme_setter:function(e){this.data.scheme(e)},dataFeed_setter:function(e){if(typeof e=="string"&&e.indexOf("->")!=-1){var t=e.split("->");e=webix.proxy(t[0],t[1])}this.data.attachEvent("onBeforeFilter",webix.bind(function(e,t){if(typeof e=="function")return true;if(this._settings.dataFeed&&(e||t)){e=e||"id";if(t&&typeof t=="object")t=t.id;this.clearAll();var n=this._settings.dataFeed;if(typeof n=="function"){var r={};r[e]=t;n.call(this,t,r)}else if(n.$proxy){if(n.load){var i={};i[e]=t;n.load(this,null,i)}}else{var s="filter["+e+"]="+encodeURIComponent(t);this.load(n+(n.indexOf("?")<0?"?":"&")+s,this._settings.datatype)}return false}},this));return e},_call_onready:function(){if(this._settings.ready&&!this._ready_was_used){var e=webix.toFunctor(this._settings.ready,this.$scope);if(e)webix.delay(e,this,arguments);this._ready_was_used=true}},_call_onclearall:function(){for(var e=0;e<this._ajax_queue.length;e++)this._ajax_queue[e].abort();this._ajax_queue=webix.toArray()},_call_on_config:function(e){this._parseSeetingColl(e)}},webix.AtomDataLoader);webix.DataMarks={addCss:function(e,t,n){if(!this.addRowCss&&!n){if(!this.hasCss(e,t)){var r=this.getItemNode(e);if(r){r.className+=" "+t;n=true}}}return this.data.addMark(e,t,1,1,n)},removeCss:function(e,t,n){if(!this.addRowCss&&!n){if(this.hasCss(e,t)){var r=this.getItemNode(e);if(r){r.className=r.className.replace(t,"").replace("  "," ");n=true}}}return this.data.removeMark(e,t,1,n)},hasCss:function(e,t){return this.data.getMark(e,t)},clearCss:function(e,t){return this.data.clearMark(e,1,t)}};webix.DataStore=function(){this.name="DataStore";webix.extend(this,webix.EventSystem);this.setDriver("json");this.pull={};this.order=webix.toArray();this._marks={}};webix.DataStore.prototype={setDriver:function(e){webix.assert(webix.DataDriver[e],"incorrect DataDriver");this.driver=webix.DataDriver[e]},_parse:function(e,t){this.callEvent("onParse",[this.driver,e]);if(this._filter_order)this.filter();var n=this.driver.getInfo(e);if(n._key)webix.securityKey=n._key;if(n._config)this.callEvent("onServerConfig",[n._config]);var r=this.driver.getOptions(e);if(r)this.callEvent("onServerOptions",[r]);var i=this.driver.getRecords(e);this._inner_parse(n,i);if(this._scheme_group&&this._group_processing&&!this._not_grouped_order)this._group_processing(this._scheme_group);if(this._scheme_sort){this.blockEvent();this.sort(this._scheme_sort);this.unblockEvent()}this.callEvent("onStoreLoad",[this.driver,e]);this.refresh()},_inner_parse:function(e,t){var n=(e._from||0)*1;var r=true;var i=false;if(n===0&&this.order[0]){if(this._removeMissed){i={};for(var s=0;s<this.order.length;s++)i[this.order[s]]=true}r=false;n=this.order.length}var o=0;for(var s=0;s<t.length;s++){var u=this.driver.getDetails(t[s]);var a=this.id(u);if(!this.pull[a]){this.order[o+n]=a;o++}else if(r&&this.order[o+n])o++;if(this.pull[a]){webix.extend(this.pull[a],u,true);if(this._scheme_update)this._scheme_update(this.pull[a]);if(i)delete i[a]}else{this.pull[a]=u;if(this._scheme_init)this._scheme_init(u)}}if(i){this.blockEvent();for(var f in i)this.remove(f);this.unblockEvent()}if(!this.order[e._size-1])this.order[e._size-1]=webix.undefined},id:function(e){return e.id||(e.id=webix.uid())},changeId:function(e,t){if(this.pull[e])this.pull[t]=this.pull[e];this.pull[t].id=t;this.order[this.order.find(e)]=t;if(this._filter_order)this._filter_order[this._filter_order.find(e)]=t;if(this._marks[e]){this._marks[t]=this._marks[e];delete this._marks[e]}this.callEvent("onIdChange",[e,t]);if(this._render_change_id)this._render_change_id(e,t);delete this.pull[e]},getItem:function(e){return this.pull[e]},updateItem:function(e,t){var n=this.getItem(e);webix.assert(n,"Ivalid ID for updateItem");webix.assert(!t||!t.id||t.id==e,"Attempt to change ID in updateItem");if(!webix.isUndefined(t)&&n!==t)webix.extend(n,t,true);if(this._scheme_update)this._scheme_update(n);this.callEvent("onDataUpdate",[e,n]);this.callEvent("onStoreUpdated",[e,n,"update"])},refresh:function(e){if(this._skip_refresh)return;if(e){if(this.exists(e))this.callEvent("onStoreUpdated",[e,this.pull[e],"paint"])}else this.callEvent("onStoreUpdated",[null,null,null])},silent:function(e,t){this._skip_refresh=true;e.call(t||this);this._skip_refresh=false},getRange:function(e,t){if(e)e=this.getIndexById(e);else e=this.$min||this.startOffset||0;if(t)t=this.getIndexById(t);else{t=this.$max===0?0:Math.min(this.$max||this.endOffset||Infinity,this.count()-1);if(t<0)t=0}if(e>t){var n=t;t=e;e=n}return this.getIndexRange(e,t)},getIndexRange:function(e,t){t=Math.min(t===0?0:t||Infinity,this.count()-1);var n=webix.toArray();for(var r=e||0;r<=t;r++)n.push(this.getItem(this.order[r]));return n},count:function(){return this.order.length},exists:function(e){return!!this.pull[e]},move:function(e,t){webix.assert(e>=0&&t>=0,"DataStore::move","Incorrect indexes");if(e==t)return;var n=this.getIdByIndex(e);var r=this.getItem(n);if(this._filter_order)this._move_inner(this._filter_order,0,0,this.getIdByIndex(e),this.getIdByIndex(t));this._move_inner(this.order,e,t);this.callEvent("onStoreUpdated",[n,r,"move"])},_move_inner:function(e,t,n,r,i){if(r||i){t=n=-1;for(var s=0;s<e.length;s++){if(e[s]==r&&t<0)t=s;if(e[s]==i&&n<0)n=s}}var o=e[t];e.removeAt(t);e.insertAt(o,Math.min(e.length,n))},scheme:function(e){this._scheme={};this._scheme_save=e.$save;this._scheme_init=e.$init||e.$change;this._scheme_update=e.$update||e.$change;this._scheme_serialize=e.$serialize;this._scheme_group=e.$group;this._scheme_sort=e.$sort;for(var t in e)if(t.substr(0,1)!="$")this._scheme[t]=e[t]},importData:function(e,t){var n=e.data||e;this._filter_order=null;if(typeof n.serialize=="function"){this.order=webix.toArray([].concat(n.order));this.pull=n.pull}else{this.order=webix.toArray();this.pull={};var r,i;if(webix.isArray(e))for(var s=0;s<e.length;s++){i=r=e[s];if(typeof i=="object")r=i.id;else i={id:r,value:r};this.order.push(i.id);this.pull[i.id]=i}else for(var s in n){this.order.push(s);this.pull[s]={id:s,value:n[s]}}}if(!t)this.callEvent("onStoreUpdated",[])},sync:function(e,t,n){var r=typeof e;if(r=="string")e=webix.$$("source");if(r!="function"&&r!="object"){n=t;t=null}if(webix.debug_bind){this.debug_sync_master=e;webix.log("[sync] "+this.debug_bind_master.name+"@"+this.debug_bind_master._settings.id+" <= "+this.debug_sync_master.name+"@"+this.debug_sync_master._settings.id)}if(e.name!="DataStore"){if(e.data&&e.data.name=="DataStore")e=e.data;else return webix.callEvent("onSyncUnknown",[this,e,t])}var i=webix.bind(function(r,i,s){if(this._skip_next_sync)return;this.importData(e,true);if(t)this.silent(t);if(this._on_sync)this._on_sync();if(webix.debug_bind)webix.log("[sync:request] "+this.debug_sync_master.name+"@"+this.debug_sync_master._settings.id+" <= "+this.debug_bind_master.name+"@"+this.debug_bind_master._settings.id);this.callEvent("onSyncApply",[]);if(!n)this.refresh();else n=false},this);this._sync_events=[e.attachEvent("onStoreUpdated",i),e.attachEvent("onIdChange",webix.bind(function(e,t){this.changeId(e,t);this.refresh(t)},this))];this._sync_source=e;this._back_sync_handler=this.attachEvent("onStoreUpdated",function(t,n,r){if(r=="update"||r=="save"){this._skip_next_sync=1;e.updateItem(t,n);this._skip_next_sync=0}});i()},unsync:function(){if(this._sync_source){var e=this._sync_source;if(e.name!="DataStore"&&(!e.data||e.data.name!="DataStore")){webix.callEvent("onUnSyncUnknown",[this,e])}else{for(var t=0;t<this._sync_events.length;t++)e.detachEvent(this._sync_events[t]);this.detachEvent(this._back_sync_handler)}this._sync_source=null}},destructor:function(){this.unsync();this.pull=this.order=this._marks=null;this._evs_events=this._evs_handlers={}},add:function(e,t){if(this._scheme)for(var n in this._scheme)if(webix.isUndefined(e[n]))e[n]=this._scheme[n];if(this._scheme_init)this._scheme_init(e);var r=this.id(e);var i=arguments[2]||this.order;var s=i.length;if(webix.isUndefined(t)||t<0)t=s;if(t>s){webix.log("Warning","DataStore:add","Index of out of bounds");t=Math.min(i.length,t)}if(this.callEvent("onBeforeAdd",[r,e,t])===false)return false;webix.assert(!this.exists(r),"Not unique ID");this.pull[r]=e;i.insertAt(r,t);if(this._filter_order){var o=this._filter_order.length;if(!t&&this.order.length)o=0;this._filter_order.insertAt(r,o)}this.callEvent("onAfterAdd",[r,t]);this.callEvent("onStoreUpdated",[r,e,"add"]);return r},remove:function(e){if(webix.isArray(e)){for(var t=0;t<e.length;t++)this.remove(e[t]);return}if(this.callEvent("onBeforeDelete",[e])===false)return false;webix.assert(this.exists(e),"Not existing ID in remove command"+e);var n=this.getItem(e);this.order.remove(e);if(this._filter_order)this._filter_order.remove(e);delete this.pull[e];if(this._marks[e])delete this._marks[e];this.callEvent("onAfterDelete",[e]);this.callEvent("onStoreUpdated",[e,n,"delete"])},clearAll:function(){this.pull={};this._marks={};this.order=webix.toArray();this._filter_order=this.url=null;this.callEvent("onClearAll",[]);this.refresh()},getIdByIndex:function(e){webix.assert(e>=0,"DataStore::getIdByIndex Incorrect index");return this.order[e]},getIndexById:function(e){var t=this.order.find(e);if(!this.pull[e])return-1;return t},getNextId:function(e,t){return this.order[this.getIndexById(e)+(t||1)]},getFirstId:function(){return this.order[0]},getLastId:function(){return this.order[this.order.length-1]},getPrevId:function(e,t){return this.order[this.getIndexById(e)-(t||1)]},sort:function(e,t,n){var r=e;if(typeof e=="function")r={as:e,dir:t};else if(typeof e=="string")r={by:e.replace(/#/g,""),dir:t,as:n};var i=[r.by,r.dir,r.as,r];if(!this.callEvent("onBeforeSort",i))return;this._sort_core(r);this.refresh();this.callEvent("onAfterSort",i)},_sort_core:function(e){if(this.order.length){var t=this._sort._create(e);var n=this.getRange(this.getFirstId(),this.getLastId());n.sort(t);this.order=n.map(function(e){webix.assert(e,"Client sorting can't be used with dynamic loading");return this.id(e)},this)}},_filter_reset:function(e){if(this._filter_order&&!e){this.order=this._filter_order;delete this._filter_order}},_filter_core:function(e,t,n){var r=webix.toArray();for(var i=0;i<this.order.length;i++){var s=this.order[i];if(e(this.getItem(s),t))r.push(s)}if(!n||!this._filter_order)this._filter_order=this.order;this.order=r},filter:function(e,t,n){if(!this.callEvent("onBeforeFilter",[e,t]))return;this._filter_reset(n);if(!this.order.length)return;if(e){var r=e;t=t||"";if(typeof e=="string"){e=e.replace(/#/g,"");if(typeof t=="function")r=function(n){return t(n[e])};else{t=t.toString().toLowerCase();r=function(t,n){webix.assert(t,"Client side filtering can't be used with dynamic loading");return(t[e]||"").toString().toLowerCase().indexOf(n)!=-1}}}this._filter_core(r,t,n,this._filterMode)}this.refresh();this.callEvent("onAfterFilter",[])},_obj_array:function(){var e=[];for(var t=this.order.length-1;t>=0;t--)e[t]=this.pull[this.order[t]];return e},each:function(e,t,n){var r=this.order;if(n)r=this._filter_order||r;for(var i=0;i<r.length;i++)e.call(t||this,this.getItem(r[i]),i)},_methodPush:function(e,t){return function(){return e[t].apply(e,arguments)}},provideApi:function(e,t){this.debug_bind_master=e;if(t){this.mapEvent({onbeforesort:e,onaftersort:e,onbeforeadd:e,onafteradd:e,onbeforedelete:e,onafterdelete:e,ondataupdate:e})}var n=["sort","add","remove","exists","getIdByIndex","getIndexById","getItem","updateItem","refresh","count","filter","getNextId","getPrevId","clearAll","getFirstId","getLastId","serialize","sync"];for(var r=0;r<n.length;r++)e[n[r]]=this._methodPush(this,n[r])},addMark:function(e,t,n,r,i){var s=this._marks[e]||{};this._marks[e]=s;if(!s[t]){s[t]=r||true;if(n){var o=s["$css"]||"";s["$css"]=o+" "+t}if(!i)this.refresh(e)}return s[t]},removeMark:function(e,t,n,r){var i=this._marks[e];if(i){if(i[t])delete i[t];if(n){var s=i["$css"];if(s){i["$css"]=s.replace(t,"").replace("  "," ")}}if(!r)this.refresh(e)}},getMark:function(e,t){var n=this._marks[e];return n?n[t]:false},clearMark:function(e,t,n){for(var r in this._marks){var i=this._marks[r];if(i[e]){delete i[e];if(t&&i.$css)i.$css=i.$css.replace(e,"").replace("  "," ");if(!n)this.refresh(r)}}},serialize:function(e){var t=this.order;if(e&&this._filter_order)t=this._filter_order;var n=[];for(var r=0;r<t.length;r++){var i=this.pull[t[r]];if(this._scheme_serialize){i=this._scheme_serialize(i);if(i===false)continue}n.push(i)}return n},_sort:{_create:function(e){return this._dir(e.dir,this._by(e.by,e.as))},_as:{server:function(){return false},date:function(e,t){e=e-0;t=t-0;return e>t?1:e<t?-1:0},"int":function(e,t){e=e*1;t=t*1;return e>t?1:e<t?-1:0},string_strict:function(e,t){e=e.toString();t=t.toString();return e>t?1:e<t?-1:0},string:function(e,t){if(!t)return 1;if(!e)return-1;e=e.toString().toLowerCase();t=t.toString().toLowerCase();return e>t?1:e<t?-1:0}},_by:function(e,t){if(!e)return t;if(typeof t!="function")t=this._as[t||"string"];webix.assert(t,"Invalid sorting method");return function(n,r){return t(n[e],r[e])}},_dir:function(e,t){if(e=="asc"||!e)return t;return function(e,n){return t(e,n)*-1}}}};webix.DataCollection=webix.proto({name:"DataCollection",isVisible:function(){if(!this.data.order.length&&!this.data._filter_order&&!this._settings.dataFeed)return false;return true},$init:function(e){this.data.provideApi(this,true);var t=e&&e.id?e.id:webix.uid();this._settings.id=t;webix.ui.views[t]=this;this.data.attachEvent("onStoreLoad",webix.bind(function(){this.callEvent("onBindRequest",[])},this))},refresh:function(){this.callEvent("onBindRequest",[])}},webix.ValidateCollection,webix.DataLoader,webix.EventSystem,webix.BaseBind,webix.Destruction,webix.Settings);webix.Scrollable={$init:function(e){if(e&&!e.scroll&&this._one_time_scroll)return this._dataobj=this._dataobj||this._contentobj;(this._dataobj||this._contentobj).appendChild(webix.html.create("DIV",{"class":"webix_scroll_cont"},""));this._dataobj=(this._dataobj||this._contentobj).firstChild},scroll_setter:function(e){if(!e)return false;e=e=="x"?"x":e=="xy"?"xy":"y";if(webix.Touch&&webix.Touch.$active){this._dataobj.setAttribute("touch_scroll",e);if(this.attachEvent)this.attachEvent("onAfterRender",webix.bind(this._refresh_scroll,this));this._touch_scroll=true}else{if(webix.env.$customScroll){webix.CustomScroll.enable(this,e)}else{var t=this._dataobj.parentNode.style;if(e.indexOf("x")!=-1){this._scroll_x=true;t.overflowX="scroll"}if(e.indexOf("y")!=-1){this._scroll_y=true;t.overflowY="scroll"}}}return e},_onoff_scroll:function(e){if(!!this._settings.scroll==!!e)return;if(!webix.env.$customScroll){var t=this._dataobj.parentNode.style;t.overflowX=t.overflowY=e?"auto":"hidden"}this._scroll_x=this._scroll_y=!!e;this._settings.scroll=!!e},getScrollState:function(){if(webix.Touch&&webix.Touch.$active){var e=webix.Touch._get_matrix(this._dataobj);return{x:-e.e,y:-e.f}}else return{x:this._dataobj.parentNode.scrollLeft,y:this._dataobj.parentNode.scrollTop}},scrollTo:function(e,t){if(webix.Touch&&webix.Touch.$active){t=Math.max(0,Math.min(t,this._dataobj.offsetHeight-this._content_height));e=Math.max(0,Math.min(e,this._dataobj.offsetWidth-this._content_width));webix.Touch._set_matrix(this._dataobj,-e,-t,this._settings.scrollSpeed||"100ms")}else{this._dataobj.parentNode.scrollLeft=e;this._dataobj.parentNode.scrollTop=t}},_refresh_scroll:function(){if(this._settings.scroll.toString().indexOf("x")!=-1){this._dataobj.style.width=this._content_width+"px";this._dataobj.style.width=this._dataobj.scrollWidth+"px"}if(webix.Touch&&webix.Touch.$active&&this._touch_scroll){webix.Touch._clear_artefacts();webix.Touch._scroll_end();webix.Touch._set_matrix(this._dataobj,0,0,0)}}};webix.protoUI({defaults:{size:10,page:0,group:5,template:"{common.pages()}",maxWidth:1e5,height:30,borderless:true},name:"pager",on_click:{webix_pager_item:function(e,t){this.select(t)}},$init:function(e){this.data=this._settings;this._dataobj=this._viewobj;this._viewobj.className+=" webix_pager";if(e.master===false||e.master===0)this.$ready.push(this._remove_master)},_remove_master:function(){this.refresh();this.$master={refresh:function(){},select:function(){}}},select:function(e){if(this.$master&&this.$master.name=="pager")return this.$master.select(e);switch(e){case"next":e=this._settings.page+1;break;case"prev":e=this._settings.page-1;break;case"first":e=0;break;case"last":e=this._settings.limit-1;break;default:break}if(e<0)e=0;if(e>=this.data.limit)e=this.data.limit-1;var t=this.data.page;this.data.page=e*1;if(this.refresh()){if(!this._settings.animate||!this._animate(t,e*1,this._settings.animate))this.$master.refresh()}},_id:"webix_p_id",template_setter:webix.template,type:{template:function(e,t){return e.template.call(this,e,t)},pages:function(e){var t="";if(e.page==-1)return"";e.$min=e.page-Math.round((e.group-1)/2);e.$max=e.$min+e.group*1-1;if(e.$min<0){e.$max+=e.$min*-1;e.$min=0}if(e.$max>=e.limit){e.$min-=Math.min(e.$min,e.$max-e.limit+1);e.$max=e.limit-1}for(var n=e.$min||0;n<=e.$max;n++)t+=this.button({id:n,index:n+1,selected:n==e.page?"_selected":""});return t},page:function(e){return e.page+1},first:function(){return this.button({id:"first",index:webix.locale.pager.first,selected:""})},last:function(){return this.button({id:"last",index:webix.locale.pager.last,selected:""})},prev:function(){return this.button({id:"prev",index:webix.locale.pager.prev,selected:""})},next:function(){return this.button({id:"next",index:webix.locale.pager.next,selected:""})},button:webix.template("<button webix_p_id='{obj.id}' class='webix_pager_item{obj.selected}'>{obj.index}</button>")},clone:function(e){if(!e.$view){e.view="pager";e=webix.ui(e)}this._clone=e;e.$master=this;this._refresh_clone()},refresh:function(){var e=this._settings;if(!e.count)return;e.limit=Math.ceil(e.count/e.size);e.page=Math.min(e.limit-1,e.page);var t=e.page;if(t>=0&&t!=e.old_page||e.limit!=e.old_limit){this.render();this._refresh_clone();e.old_limit=e.limit;e.old_page=e.page;return true}},apiOnly_setter:function(e){return this.$apiOnly=e},_refresh_clone:function(){if(this._clone){this._clone._settings.count=this._settings.count;this._clone._settings.page=this._settings.page;this._clone.refresh()}},_animate:function(e,t,n){if(e==t)return false;if(this._pgInAnimation){if(this._pgAnimateTimeout){window.clearTimeout(this._pgAnimateTimeout)}return this._pgAnimateTimeout=webix.delay(this._animate,this,[e,t,n],100)}var r=t>e?"left":"right";if(n.direction=="top"||n.direction=="bottom")r=t>e?"top":"bottom";if(n.flip)r="";var i=0;var s=0;var o=this.$master._dataobj;if(this.$master._body){o=this.$master._body;s=this.$master._header;s.style.position="relative";s.style.zIndex="10";i=o.offsetTop}var u=o.cloneNode(true);u.style.width=o.style.width="100%";u.style.backgroundColor=o.style.backgroundColor="white";this.$master.refresh();o.parentNode.appendChild(u);var a;var f=n!==true?n:{};var l=webix.extend({direction:r,callback:webix.bind(function(){l.callback=null;webix.animate.breakLine(a);this._pgInAnimation=false;if(s)s.style.position=""},this),top:i},f);a=webix.animate.formLine(o,u,l);webix.animate([o,u],l);this._pgInAnimation=true}},webix.MouseEvents,webix.SingleRender,webix.ui.view,webix.EventSystem);webix.locale.pager={first:" &lt;&lt; ",last:" &gt;&gt; ",next:" &gt; ",prev:" &lt; "};webix.PagingAbility={pager_setter:function(e){function n(t){if(e.config.autosize&&this.getVisibleCount){var r=this.getVisibleCount();if(isNaN(r)){e.config.size=1;webix.delay(n,this,[true])}else if(r!=e.config.size){e.config.size=r;e.refresh();if(t===true)this.refresh()}}var i=this._settings.pager;if(i.page==-1)return false;this.data.$min=i.page*i.size;this.data.$pagesize=i.size;this.data.$max=(i.page+1)*i.size-1;return true}if(typeof e=="string"){var t=webix.$$(e);if(!t){this.$blockRender=true;webix.delay(function(){var t=webix.$$(e);this._settings.pager=this.pager_setter(t);t._settings.count=this.count();t.refresh();this.$blockRender=false;this.render()},this);return null}e=t}this.attachEvent("onBeforeRender",n);if(!e.$view){e.view="pager";e=webix.ui(e)}this._pager=e;e.$master=this;this.data.attachEvent("onStoreUpdated",function(){e._settings.count=this.count();e.refresh()},null,true);return e._settings},setPage:function(e){if(this._pager)this._pager.select(e)},getPage:function(){return this._pager._settings.page},getPager:function(){return this._pager}};webix.protoUI({name:"tooltip",defaults:{dy:0,dx:20},$init:function(e){if(typeof e=="string"){e={template:e}}this.type=webix.extend({},this.type);this._viewobj=this._contentobj=this._dataobj=document.createElement("DIV");this._contentobj.className="webix_tooltip";webix.html.insertBefore(this._contentobj,document.body.firstChild)},adjust:function(){},isVisible:function(){return true},show:function(e,t){if(this._disabled)return;if(this.data!=e){this.data=webix.extend({},e);this.render(e)}if(this._dataobj.firstChild){this._contentobj.style.top=t.y+this._settings.dy+"px";this._contentobj.style.left=t.x+this._settings.dx+"px";this._contentobj.style.display="block"}},hide:function(){this.data=null;this._contentobj.style.display="none"},disable:function(){this._disabled=true},enable:function(){this._disabled=false},type:{template:webix.template("{obj.id}"),templateStart:webix.template.empty,templateEnd:webix.template.empty}},webix.SingleRender,webix.Settings,webix.EventSystem,webix.ui.view);webix.AutoTooltip={tooltip_setter:function(e){if(e){var t,n=[],r=new webix.ui.tooltip(e);this._enable_mouse_move();n[0]=this.attachEvent("onMouseMove",function(e,t){if(this.getColumnConfig){var n=this.getColumnConfig(e.column);if(!n.tooltip&&n.tooltip!=webix.undefined)return;if(n.tooltip)r.type.template=n.tooltip=webix.template(n.tooltip);else{var i=this.getText(e.row,e.column);r.type.template=function(){return i}}}if(!webix.DragControl.active)r.show(this.getItem(e),webix.html.pos(t))});n[1]=this.attachEvent("onMouseOut",function(e,t){r.hide()});n[2]=this.attachEvent("onMouseMoving",function(e,t){r.hide()});this.attachEvent("onDestruct",function(){if(this.config.tooltip)this.config.tooltip.destructor()});r.attachEvent("onDestruct",webix.bind(function(){for(t=0;t<n.length;t++)this.detachEvent(n[t])},this));return r}}};webix.protoUI({name:"proto",$init:function(){this.data.provideApi(this,true);this._dataobj=this._dataobj||this._contentobj;this.data.attachEvent("onStoreUpdated",webix.bind(function(){this.render.apply(this,arguments)},this))},$setSize:function(){if(webix.ui.view.prototype.$setSize.apply(this,arguments))this.render()},_id:"webix_item",on_mouse_move:{},type:{}},webix.PagingAbility,webix.DataMarks,webix.AutoTooltip,webix.ValidateCollection,webix.RenderStack,webix.DataLoader,webix.ui.view,webix.EventSystem,webix.Settings);webix.Values={$init:function(){this.elements={}},focus:function(e){var t;if(e){webix.assert(this.elements[e],"unknown input name: "+e);t=this.elements[e]}else if(this._cells){var n=0;do{t=this._cells[n];n++}while(t&&!t.focus)}if(t&&t.focus)t.focus()},setValues:function(e,t){this._is_form_dirty=t;this._inner_setValues(e,t);this.callEvent("onChange",[])},_inner_setValues:function(e,t){if(t)this._values=webix.extend(this.getValues(),e,true);else this._values=webix.copy(e);if(webix.debug_render)webix.log("Render: "+this.name+"@"+this._settings.id);for(var n in this.elements){var r=this.elements[n];if(r){if(!webix.isUndefined(this._values[n]))r.setValue(e[n]||this._values[n]);else{if(r._allowsClear)r.setValue("");this._values[n]=r.getValue()}}}},isDirty:function(){if(this._is_form_dirty)return true;if(this.getDirtyValues(1)===1)return true;return false},setDirty:function(e){this._is_form_dirty=e;if(!e)this._values=this.getValues()},getDirtyValues:function(){var e={};if(this._values){for(var t in this.elements){var n=this.elements[t].getValue();if(this._values[t]!=n){e[t]=n;if(arguments[0])return 1}}}return e},getCleanValues:function(){return this._values},getValues:function(e){var t,n=null,r=this._values?webix.copy(this._values):{};for(var i in this.elements){n=this.elements[i];t=true;if(e){if(typeof e=="object"){if(e.hidden===false)t=n.isVisible();if(t&&e.disabled===false)t=n.isEnabled()}else t=e.call(this,n)}if(t)r[i]=n.getValue();else delete r[i]}return r},clear:function(){this._is_form_dirty=false;var e={};for(var t in this.elements)if(this.elements[t]._allowsClear)e[t]=this.elements[t]._settings.defaultValue||"";this.setValues(e)},_onLoad:function(e,t,n){var r=this.data.driver;var i;if(n===-1){i=t}else{i=r.toObject(e,t)}if(i){var s=r.getRecords(i)[0];this.setValues(r?r.getDetails(s):e)}else this._onLoadError(e,t,n);this.callEvent("onAfterLoad",[])},_mark_invalid:function(e,t){if(e&&this.elements[e]){this._clear_invalid(e,t);webix.html.addCss(this.elements[e]._viewobj,"webix_invalid")}},_clear_invalid:function(e,t){if(e&&this.elements[e]&&this.elements[e]._dataobj.firstChild)webix.html.removeCss(this.elements[e]._viewobj,"webix_invalid")}};webix.protoUI({name:"toolbar",defaults:{type:"toolbar"},_render_borders:true,_form_classname:"webix_toolbar",_form_vertical:false,$init:function(e){if(!e.borderless)this._contentobj.style.borderWidth="1px";this._contentobj.className+=" "+this._form_classname},_recollect_elements:function(){var e=this;e.elements={};webix.ui.each(this,function(t){if(t._settings.name&&t.getValue&&t.setValue){e.elements[t._settings.name]=t;t.mapEvent({onbeforetabclick:e,onaftertabclick:e,onitemclick:e})}if(t.setValues)return false});this.setDirty(false)},_parse_cells_ext_end:function(){this._recollect_elements()},_parse_cells_ext:function(e){var t=this._settings;if(t.elements&&!e){this._collection=e=t.elements;this._vertical_orientation=this._form_vertical;delete t.elements}if(this._settings.elementsConfig)this._rec_apply_settings(this._collection,t.elementsConfig);return e},_rec_apply_settings:function(e,t){for(var n=0;n<e.length;n++){var r=e[n];webix.extend(r,t);var i=t;if(r.elementsConfig)i=webix.extend(webix.extend({},r.elementsConfig),t);var s;if(r.body)s=[r.body];else s=r.rows||r.cols||r.cells||r.body;if(s)this._rec_apply_settings(s,i)}},$getSize:function(e,t){var n=webix.ui.layout.prototype.$getSize.call(this,e,t);var r=this.getParentView();var i=this._vertical_orientation?3:1;if(r&&this._vertical_orientation!=r._vertical_orientation)n[i]+=1e5;webix.debug_size_box(this,n,true);return n},render:function(){},refresh:function(){this.render()}},webix.Scrollable,webix.AtomDataLoader,webix.Values,webix.ui.layout,webix.ValidateData);webix.protoUI({name:"template",$init:function(e){var t=this._template_types[e.type];if(t){webix.extend(e,t);if(e.borderless){delete e._inner;this._set_inner(e)}}if(this._dataobj==this._viewobj){this._dataobj=webix.html.create("DIV");this._dataobj.className=" webix_template";this._viewobj.appendChild(this._dataobj)}else this._dataobj.className+=" webix_template";this.attachEvent("onAfterLoad",this._render_me);this.attachEvent("onAfterRender",this._correct_width_scroll)},setValues:function(e){this.data=e;this.render()},$skin:function(){this._template_types.header.height=this._template_types.section.height=webix.skin.$active.barHeight},_template_types:{header:{css:"webix_header"},section:{css:"webix_section",borderless:true},clean:{css:"webix_clean",borderless:true}},onClick_setter:function(e){this.on_click=webix.extend(this.on_click||{},e,true);if(!this._onClick)webix.extend(this,webix.MouseEvents);return e},defaults:{template:webix.template.empty},_render_me:function(){this._not_render_me=false;this._probably_render_me();this.resize()},_probably_render_me:function(){if(!this._not_render_me){this._not_render_me=true;this.render()}},src_setter:function(e){this._not_render_me=true;this.callEvent("onBeforeLoad",[]);webix.ajax(e,webix.bind(function(e){this._settings.template=webix.template(e);this._render_me();this.callEvent("onAfterLoad",[])},this));return e},_correct_width_scroll:function(){if(this._settings.autoheight){this._last_size=null;this.resize()}if(this._settings.scroll&&this._settings.scroll.indexOf("x")!=-1)this._dataobj.style.width=this._dataobj.scrollWidth+"px"},content_setter:function(e){if(e){this._not_render_me=true;this.render=function(){};this._dataobj.appendChild(webix.toNode(e))}},refresh:function(){this.render()},setHTML:function(e){this._settings.template=function(){return e};this.refresh()},setContent:function(e){this._dataobj.innerHTML="";this.content_setter(e)},waitMessage_setter:function(e){webix.extend(this,webix.OverlayBox);return e},$setSize:function(e,t){if(webix.ui.view.prototype.$setSize.call(this,e,t)){this._probably_render_me();if(this._settings.autoheight){var n=this.getTopParentView();clearTimeout(n._template_resize_timer);n._template_resize_timer=webix.delay(this.resize,this)}}},$getSize:function(e,t){if(this._settings.autoheight&&!this._settings.type)this._settings.height=this._get_auto_height();return webix.ui.view.prototype.$getSize.call(this,e,t)},_get_auto_height:function(){var e;this._probably_render_me();var t=webix.skin.$active.layoutPadding.space;this._dataobj.style.height="1px";if(webix.env.isFF){var n=this._dataobj.style;var r=n.overflow;n.overflow="scroll";e=this._dataobj.scrollHeight+t;n.overflow=r}else e=this._dataobj.scrollHeight+t;this._dataobj.style.height="";return e},_one_time_scroll:true},webix.Scrollable,webix.AtomDataLoader,webix.AtomRender,webix.EventSystem,webix.ui.view);webix.protoUI({name:"iframe",$init:function(e){this._dataobj=this._contentobj;this._contentobj.innerHTML="<iframe style='width:100%; height:100%' frameborder='0' onload='var t= $$(\""+e.id+"\"); if (t) t.callEvent(\"onAfterLoad\",[]);' src='about:blank'></iframe>"},load:function(e){this.src_setter(e)},src_setter:function(e){this.getIframe().src=e;this.callEvent("onBeforeLoad",[]);return e},getIframe:function(){return this._contentobj.getElementsByTagName("iframe")[0]},getWindow:function(){return this.getIframe().contentWindow},waitMessage_setter:function(e){if(e)webix.extend(this,webix.OverlayBox);return e}},webix.ui.view,webix.EventSystem);webix.OverlayBox={$init:function(){if(webix.isUndefined(this._overlay)&&this.attachEvent){this.attachEvent("onBeforeLoad",this.showOverlay);this.attachEvent("onAfterLoad",this.hideOverlay);this._overlay=null}},showOverlay:function(e){if(!this._overlay){this._overlay=webix.html.create("DIV",{"class":"webix_loading_overlay"},e||"");webix.html.insertBefore(this._overlay,this._viewobj.firstChild,this._viewobj);this._viewobj.style.position="relative"}},hideOverlay:function(){if(this._overlay){webix.html.remove(this._overlay);this._overlay=null}}};webix.protoUI({name:"scrollview",defaults:{scroll:"y",scrollSpeed:"0ms"},$init:function(){this._viewobj.className+=" webix_scrollview"},body_setter:function(e){e.borderless=true;this._body_cell=webix.ui._view(e);this._body_cell._parent_cell=this;this._dataobj.appendChild(this._body_cell._viewobj)},getChildViews:function(){return[this._body_cell]},getBody:function(){return this._body_cell},resizeChildren:function(){this._desired_size=this._body_cell.$getSize(0,0);this._resizeChildren()},_resizeChildren:function(){var e=Math.max(this._content_width,this._desired_size[0]);var t=Math.max(this._content_height,this._desired_size[2]);this._body_cell.$setSize(e,t);this._dataobj.style.width=this._body_cell._content_width+"px";this._dataobj.style.height=this._body_cell._content_height+"px";if(webix.env.touch){var n=this.getScrollState();var r=this._body_cell._content_height-this._content_height;if(r<n.y)this.scrollTo(null,r)}},$getSize:function(e,t){var n=this._desired_size=this._body_cell.$getSize(0,0);var r=webix.ui.view.prototype.$getSize.call(this,e,t);var i=webix.ui.scrollSize;if(this._settings.scroll=="x"){r[2]=Math.max(r[2],n[2])+i;r[3]=Math.min(r[3],n[3])+i}else if(this._settings.scroll=="y"){r[0]=Math.max(r[0],n[0])+i;r[1]=Math.min(r[1],n[1])+i}return r},$setSize:function(e,t){if(webix.ui.view.prototype.$setSize.call(this,e,t)){this._resizeChildren()}},_replace:function(e){this._body_cell.destructor();this._body_cell=e;this._body_cell._parent_cell=this;this._bodyobj.appendChild(this._body_cell._viewobj);this.resize()},showView:function(e){var t=webix.$$(e).$view.offsetTop-webix.$$(e).$view.parentNode.offsetTop;this.scrollTo(0,t)}},webix.Scrollable,webix.ui.view);webix.TreeRenderStack={$init:function(){webix.assert(this.render,"TreeRenderStack :: Object must use RenderStack first")},_toHTMLItem:function(e){var t=this.data._marks[e.id];this.callEvent("onItemRender",[e]);return this.type.templateStart(e,this.type,t)+(e.$template?this.type["template"+e.$template](e,this.type,t):this.type.template(e,this.type,t))+this.type.templateEnd()},_toHTMLItemObject:function(e){this._html.innerHTML=this._toHTMLItem(e);return this._html.firstChild},_toHTML:function(e){webix.assert(!e.$template||this.type["template"+e.$template],"RenderStack :: Unknown template: "+e.$template);var t="<div class='webix_tree_branch_"+e.$level+"'>"+this._toHTMLItem(e);if(e.open){if(e.$count==-1){this.loadBranch(e.id)}t+=this._toHTMLLevel(e.id)}t+="</div>";return t},_toHTMLLevel:function(e){var t="";var n=this.data.branch[e];if(n){t+="<div class='webix_tree_leaves'>";var r=n.length-1;for(var i=0;i<=r;i++){var s=this.getItem(n[i]);this.type._tree_branch_render_state[s.$level]=i==r;t+=this._toHTML(s)}t+="</div>"}return t},render:function(e,t,n){webix.TreeRenderStack._obj=this;if(!this.isVisible(this._settings.id)||this.$blockRender)return;if(webix.debug_render)webix.log("Render: "+this.name+"@"+this._settings.id);if(e){var r;var i=this.getItem(e);if(n!="add"){r=this.getItemNode(e);if(!r)return}switch(n){case"branch":var s=r.parentNode;var o=this._toHTMLObject(i);webix.html.insertBefore(o,s);webix.html.remove(s);this._htmlmap=null;break;case"paint":case"update":var o=this._htmlmap[e]=this._toHTMLItemObject(i);webix.html.insertBefore(o,r);webix.html.remove(r);break;case"delete":webix.html.remove(r.parentNode);break;case"add":var u;if(i.$parent==0){u=this._dataobj.firstChild}else{u=this.getItemNode(i.$parent);if(u)u=u.nextSibling}if(u){var a=this.data.getNextSiblingId(e);a=this.getItemNode(a);if(a)a=a.parentNode;var o=this._toHTMLObject(i);this._htmlmap[e]=o.firstChild;webix.html.insertBefore(o,a,u)}break;default:return false}this.callEvent("onPartialRender",[e,t,n])}else if(this.callEvent("onBeforeRender",[this.data])){this.type._tree_branch_render_state=[];this._dataobj.innerHTML=this._toHTMLLevel(0);this._htmlmap=null;this.callEvent("onAfterRender",[])}this.type._tree_branch_render_state=0;webix.TreeRenderStack._obj=null;return true},getItemNode:function(e){if(this._htmlmap)return this._htmlmap[e];this._htmlmap={};var t=this._dataobj.getElementsByTagName("DIV");for(var n=0;n<t.length;n++){var r=t[n].getAttribute(this._id);if(r)this._htmlmap[r]=t[n]}return this.getItemNode(e)},_branch_render_supported:1};webix.SelectionModel={$init:function(){this._selected=webix.toArray();webix.assert(this.data,"SelectionModel :: Component doesn't have DataStore");this.data.attachEvent("onStoreUpdated",webix.bind(this._data_updated,this));this.data.attachEvent("onStoreLoad",webix.bind(this._data_loaded,this));this.data.attachEvent("onAfterFilter",webix.bind(this._data_filtered,this));this.data.attachEvent("onIdChange",webix.bind(this._id_changed,this))},_id_changed:function(e,t){for(var n=this._selected.length-1;n>=0;n--)if(this._selected[n]==e)this._selected[n]=t},_data_filtered:function(){for(var e=this._selected.length-1;e>=0;e--){if(this.data.getIndexById(this._selected[e])<0){var t=this._selected[e];this.removeCss(t,"webix_selected",true);this._selected.splice(e,1);this.callEvent("onSelectChange",[t])}}},_data_updated:function(e,t,n){if(n=="delete"){if(this.loadBranch){for(var r=this._selected.length-1;r>=0;r--)if(!this.exists(this._selected[r]))this._selected.splice(r,1)}else this._selected.remove(e)}else if(!e&&!this.data.count()&&!this.data._filter_order){this._selected=webix.toArray()}},_data_loaded:function(){if(this._settings.select)this.data.each(function(e){if(e.$selected)this.select(e.id)},this)},_select_mark:function(e,t,n){if(!n&&!this.callEvent("onBeforeSelect",[e,t]))return false;if(t)this.addCss(e,"webix_selected",true);else this.removeCss(e,"webix_selected",true);if(n)n.push(e);else{if(t)this._selected.push(e);else this._selected.remove(e);this._refresh_selection(e)}return true},select:function(e,t){var n=arguments[2];var r=arguments[3];if(!e)return this.selectAll();if(webix.isArray(e)){for(var i=0;i<e.length;i++)this.select(e[i],i?1:t,n,r);return}webix.assert(this.data.exists(e),"Incorrect id in select command: "+e);if(r&&this._selected.length)return this.selectAll(this._selected[this._selected.length-1],e);if(!n&&!t&&(this._selected.length!=1||this._selected[0]!=e)){this._silent_selection=true;this.unselectAll();this._silent_selection=false}if(this.isSelected(e)){if(n)this.unselect(e);return}if(this._select_mark(e,true)){this.callEvent("onAfterSelect",[e])}},unselect:function(e){if(!e)return this.unselectAll();if(!this.isSelected(e))return;this._select_mark(e,false)},selectAll:function(e,t){var n;var r=[];if(e||t)n=this.data.getRange(e||null,t||null);else n=this.data.getRange();n.each(function(e){if(!this.data.getMark(e.id,"webix_selected")){this._selected.push(e.id);this._select_mark(e.id,true,r)}},this);this._refresh_selection(r)},unselectAll:function(){var e=[];this._selected.each(function(t){this._select_mark(t,false,e)},this);this._selected=webix.toArray();this._refresh_selection(e)},isSelected:function(e){return this._selected.find(e)!=-1},getSelectedId:function(e){switch(this._selected.length){case 0:return e?[]:"";case 1:return e?[this._selected[0]]:this._selected[0];default:return[].concat(this._selected)}},getSelectedItem:function(e){var t=this.getSelectedId(true);if(t.length>1||e){for(var n=t.length-1;n>=0;n--)t[n]=this.getItem(t[n]);return t}else if(t.length)return this.getItem(t[0])},_is_mass_selection:function(e){return e.length>100||e.length>this.data.count/2},_refresh_selection:function(e){if(typeof e!="object")e=[e];if(!e.length)return;if(this._is_mass_selection(e))this.data.refresh();else for(var t=0;t<e.length;t++)this.render(e[t],this.data.getItem(e[t]),"update");if(!this._silent_selection)this.callEvent("onSelectChange",[e])}};webix.TreeDataMove={$init:function(){webix.assert(this.data,"DataMove :: Component doesn't have DataStore")},copy:function(e,t,n,r){r=r||{};r.copy=true;return this.move(e,t,n,r)},_next_move_index:function(e,t,n){if(t&&e){var r=this.getBranchIndex(e);return r+(n==this&&n.getBranchIndex(t)<r?0:1)}},move:function(e,t,n,r){r=r||{};t=t||0;var i=r.newId||e;var s=r.parent||0;n=n||this;webix.assert(n.data,"moving attempt to component without datastore");if(!n.data)return;if(webix.isArray(e)){for(var o=0;o<e.length;o++){var u=this.move(e[o],t,n,r);t=n._next_move_index(u,e[o+1],this)}return}if(this!=n||r.copy){i=n.data.add(n._externalData(this.getItem(e),i),t,s||0);if(this.data.branch[e]&&n.getBranchIndex){var a=this.data._scheme_serialize;this.data._scheme_serialize=function(e){var t=webix.copy(e);delete t.$parent;delete t.$level;delete t.$child;if(n.data.pull[t.id])t.id=webix.uid();return t};var f={data:this.serialize(e),parent:i};this.data._scheme_serialize=a;n.parse(f)}if(!r.copy)this.data.remove(e)}else{if(e==s||this.isBranch(e,s))return;var l=this.getItem(e);var c=this.data.branch[s];if(!c)c=this.data.branch[s]=[];var h=this.data.branch[l.$parent];var p=webix.PowerArray.find.call(h,e);if(t<0)t=Math.max(c.length-1,0);if(h===c&&t===p)return;webix.PowerArray.removeAt.call(h,p);webix.PowerArray.insertAt.call(c,e,Math.min(c.length,t));h=this.data.branch[l.$parent];if(l.$parent&&l.$parent!="0")this.getItem(l.$parent).$count--;if(s&&s!="0"){var d=n.getItem(s);d.$count++;this._set_level_rec(l,d.$level+1)}else this._set_level_rec(l,1);l.$parent=s;n.data.callEvent("onDataMove",[e,t,s])}this.refresh();return i},_set_level_rec:function(e,t){e.$level=t;var n=this.data.branch[e.id];if(n)for(var r=0;r<n.length;r++)this._set_level_rec(this.getItem(n[r]),t+1)},_drag_pause:function(e){if(e&&!e.header)this.open(e)},$dropAllow:function(e){if(e.from!=e.to)return true;for(var t=0;t<e.source.length;t++)if(e.source==e.target||this.isBranch(e.source,e.target))return false;return true},_externalData:function(e,t){var n=webix.DataMove._externalData.call(this,e,t);delete n.open;return n}};webix.TreeDataLoader={$init:function(){this.data.attachEvent("onStoreUpdated",webix.bind(this._sync_hierarchy,this));this._feed_common=this._feed_commonA;this.loadNext=this._loadNextA;this.$ready.unshift(this._sync_hierarchy)},_feed_commonA:function(e,t,n){var r=this.data.url;this.load(r+(r.indexOf("?")==-1?"?":"&")+(this.count()?"continue=true&":"")+"parent="+encodeURIComponent(e),[this._feed_callback,n])},loadBranch:function(e,t,n){e=e||0;this.data.url=this.data.url||n;if(this.callEvent("onDataRequest",[e,t,n])&&this.data.url)this.data.feed.call(this,e,0,t)},_loadNextA:function(e,t,n,r,i){webix.assert(false,"Dynamical loading not implemented")},_sync_hierarchy:function(e,t,n){if(!n||n=="add"||n=="delete"||n=="branch"){this.data._sync_to_order(this)}}};webix.TreeStore={name:"TreeStore",$init:function(){this._filterMode={showSubItems:true};this.branch={0:[]};this.attachEvent("onParse",function(e,t){this._set_child_scheme(e.child);var n=e.getInfo(t)._parent})},filterMode_setter:function(e){return webix.extend(this._filterMode,e,true)},_filter_reset:function(e){if(this._filter_branch&&!e){this.branch=this._filter_branch;this.order=webix.copy(this.branch[0]);for(var t in this.branch)if(t!="0")this.getItem(t).$count=this.branch[t].length;delete this._filter_branch}},_filter_core:function(e,t,n,r){if(!n||!this._filter_branch){this._filter_branch=this.branch;this.branch=webix.clone(this.branch)}this.branch[0]=this._filter_branch_rec(e,t,this.branch[0],1,r||{})},_filter_branch_rec:function(e,t,n,r,i){var s=[];var o=i.level&&i.level!=r;for(var u=0;u<n.length;u++){var a=n[u];var f=this.getItem(a);var l=false;var c=this.branch[a];if(o){l=true}else if(e(this.getItem(a),t)){s.push(a);var h=this.getParentId(a);while(h!=0){this.getItem(h).open=1;h=this.getParentId(h)}if(i.level||i.showSubItems)continue}else{l=true}if(o||!i.level){if(c){var p=this.branch[a]=this._filter_branch_rec(e,t,c,r+1,i);f.$count=p.length;if(l&&p.length)s.push(a)}}}return s},count:function(){if(this.order.length)return this.order.length;var e=0;this.eachOpen(function(){e++});return e},changeId:function(e,t){if(this.branch[e]){var n=this.branch[t]=this.branch[e];for(var r=0;r<n.length;r++)this.getItem(n[r]).$parent=t;delete this.branch[e]}var i=this.getItem(e).$parent;if(i!=="0"){var s=webix.PowerArray.find.call(this.branch[i],e);this.branch[i][s]=t}return webix.DataStore.prototype.changeId.call(this,e,t)},clearAll:function(){this.branch={0:[]};webix.DataStore.prototype.clearAll.call(this)},getPrevSiblingId:function(e){var t=this.branch[this.getItem(e).$parent];var n=webix.PowerArray.find.call(t,e)-1;if(n>=0)return t[n];return null},getNextSiblingId:function(e){var t=this.branch[this.getItem(e).$parent];var n=webix.PowerArray.find.call(t,e)+1;if(n<t.length)return t[n];return null},getParentId:function(e){return this.getItem(e).$parent},getFirstChildId:function(e){var t=this.branch[e];if(t&&t.length)return t[0];return null},isBranch:function(e,t){var n=this.branch[e];if(n&&n.length){for(var r=0;r<n.length;r++){if(n[r]==t)return true;if(this.isBranch(n[r],t))return true}}return false},getBranchIndex:function(e){var t=this.branch[this.pull[e].$parent];return webix.PowerArray.find.call(t,e)},_set_child_scheme:function(e){if(typeof e=="string")this._datadriver_child=function(t){var n=t[e];if(n)delete t[e];return n};else this._datadriver_child=e},_inner_parse:function(e,t){var n=e._parent||0;for(var r=0;r<t.length;r++){var i=this.driver.getDetails(t[r]);var s=this.id(i);this.pull[s]=i;if(this._scheme_init)this._scheme_init(i);this._extraParser(i,n)}if(n&&n!=="0")this.pull[n].$count=t.length},_extraParser:function(e,t,n){e.$parent=t||0;e.$level=n||(t!="0"?this.pull[t].$level+1:1);if(!this.branch[e.$parent])this.branch[e.$parent]=[];this.branch[e.$parent].push(e.id);var r=this._datadriver_child(e);if(e.webix_kids){return e.$count=-1}if(!r)return e.$count=0;if(!webix.isArray(r))r=[r];e.$count=r.length;for(var i=0;i<r.length;i++){var s=webix.DataDriver.json.getDetails(r[i]);this.pull[this.id(s)]=s;if(this._scheme_init)this._scheme_init(s);this._extraParser(s,e.id,e.$level+1)}},_sync_to_order:function(e){this.order=webix.toArray();this._sync_each_child(0,e)},_sync_each_child:function(e,t){var n=this.branch[e];for(var r=0;r<n.length;r++){var i=n[r];this.order.push(i);if(this.pull[i].open){if(this.pull[i].$count==-1)t.loadBranch(i);else if(this.pull[i].$count)this._sync_each_child(i,t)}}},provideApi:function(e,t){var n=["getPrevSiblingId","getNextSiblingId","getParentId","getFirstChildId","isBranch","getBranchIndex","filterMode_setter"];for(var r=0;r<n.length;r++)e[n[r]]=this._methodPush(this,n[r]);webix.DataStore.prototype.provideApi.call(this,e,t)},getTopRange:function(){return webix.toArray([].concat(this.branch[0])).map(function(e){return this.getItem(e)},this)},eachChild:function(e,t,n,r){var i=this.branch;if(r&&this._filter_branch)i=this._filter_branch;var s=i[e];if(s)for(var o=0;o<s.length;o++)t.call(n||this,this.getItem(s[o]))},each:function(e,t,n,r){this.eachChild(r||0,function(r){e.call(t||this,r);if(r.$count)this.each(e,t,n,r.id)},this,n)},eachOpen:function(e,t,n){this.eachChild(n||0,function(n){e.call(t||this,n);if(n.$count&&n.open)this.eachOpen(e,t,n.id)})},eachSubItem:function(e,t){var n=this.branch[e||0];if(n)for(var r=0;r<n.length;r++){var i=n[r];if(this.branch[i]){t.call(this,this.getItem(i),true);this.eachSubItem(i,t)}else t.call(this,this.getItem(i),false)}},_sort_core:function(e){var t=this._sort._create(e);for(var n in this.branch){var r=this.branch[n];var i=[];for(var s=0;s<r.length;s++)i.push(this.pull[r[s]]);i.sort(t);for(var s=0;s<r.length;s++)i[s]=i[s].id;this.branch[n]=i}},add:function(e,t,n){var r=false;this.branch[n||0]=this.order=webix.toArray(this.branch[n||0]);var i=this.getItem(n||0);if(i){if(!i.$count)r=true;i.$count++}e.$count=0;e.$level=i?i.$level+1:1;e.$parent=i?i.id:0;var s=webix.DataStore.prototype.add.call(this,e,t);if(r)this.refresh(n);return s},_rec_remove:function(e,t){var n=this.pull[e];if(n.$count>0){var r=this.branch[e];for(var i=0;i<r.length;i++)this._rec_remove(r[i],true)}delete this.branch[e];delete this.pull[e];if(this._marks[e])delete this._marks[e]},remove:function(e){webix.assert(this.exists(e),"Not existing ID in remove command"+e);var t=this.pull[e];var n=t.$parent||0;if(this.callEvent("onBeforeDelete",[e])===false)return false;this._rec_remove(e);this.callEvent("onAfterDelete",[e]);var r=this.pull[n];var i=this.branch[n];if(i.length==1&&n)delete this.branch[n];else webix.toArray(i).remove(e);if(r){r.$count--;if(!r.$count){r.open=0;this.refresh(r.id)}}this.callEvent("onStoreUpdated",[e,t,"delete"])},serialize:function(e){var t=this.branch[e||0];var n=[];for(var r=0;r<t.length;r++){var i=this.pull[t[r]];var s;if(this._scheme_serialize){s=this._scheme_serialize(i);if(s===false)continue}else s=webix.copy(i);if(i.$count)s.data=this.serialize(i.id);n.push(s)}return n}};webix.TreeType={space:function(e,t){var n="";for(var r=1;r<e.$level;r++)n+="<div class='webix_tree_none'></div>";return n},icon:function(e,t){if(e.$count){if(e.open)return"<div class='webix_tree_open'></div>";else return"<div class='webix_tree_close'></div>"}else return"<div class='webix_tree_none'></div>"},checkbox:function(e,t){if(e.nocheckbox)return"";return"<input type='checkbox' class='webix_tree_checkbox' "+(e.checked?"checked":"")+(e.disabled?" disabled":"")+">"},folder:function(e,t){if(e.icon)return"<div class='webix_tree_file webix_tree_"+e.icon+"'></div>";if(e.$count){if(e.open)return"<div class='webix_tree_folder_open'></div>";else return"<div class='webix_tree_folder'></div>"}return"<div class='webix_tree_file'></div>"}};webix.TreeAPI={open:function(e){if(!e)return;var t=this.getItem(e);if(!t.$count)return;if(this.callEvent("onBeforeOpen",[e])){t.open=true;this.data.callEvent("onStoreUpdated",[e,0,"branch"]);this.callEvent("onAfterOpen",[e])}},close:function(e){if(!e)return;if(this.callEvent("onBeforeClose",[e])){this.getItem(e).open=false;this.data.callEvent("onStoreUpdated",[e,0,"branch"]);this.callEvent("onAfterClose",[e])}},openAll:function(e){this.data.eachSubItem(e||0,function(e,t){if(t)e.open=true});this.data.refresh()},closeAll:function(e){this.data.eachSubItem(e||0,function(e,t){if(t)e.open=false});this.data.refresh()},_tree_check_uncheck:function(e,t){if(this._settings.threeState)return this._tree_check_uncheck_3(e,arguments.length>1?t:"");var n=this.getItem(e);n.checked=arguments.length>1?t:!n.checked;this.callEvent("onItemCheck",[e,n.checked])},isBranchOpen:function(e){if(e=="0")return true;var t=this.getItem(e);if(t.open)return this.isBranchOpen(t.$parent);return false},getOpenItems:function(){var e=[];for(var t in this.data.branch){if(this.exists(t)&&this.getItem(t).open)e.push(t)}return e},getState:function(){return{open:this.getOpenItems(),select:this.getSelectedId(true)}},_repeat_set_state:function(e,t){var n=this.data.attachEvent("onStoreLoad",function(){e.setState.call(e,t);e.data.detachEvent(n);e=null})},setState:function(e){var t=false;var n=false;if(e.open){this.closeAll();var r=e.open;for(var i=0;i<r.length;i++){var s=this.getItem(r[i]);if(s&&s.$count){s.open=true;if(s.$count==-1){this._repeat_set_state(this,e);this.refresh();return 0}}}this.refresh()}if(e.select&&this.select){var o=e.select;this.unselect();for(var i=0;i<o.length;i++)if(this.exists(o[i]))this.select(o[i],true)}return 1}};webix.TreeClick={webix_tree_open:function(e,t){this.close(t);return false},webix_tree_close:function(e,t){this.open(t);return false},webix_tree_checkbox:function(e,t){this._tree_check_uncheck(t);return false}};webix.TreeCollection=webix.proto({name:"TreeCollection",$init:function(){webix.extend(this.data,webix.TreeStore,true)}},webix.TreeDataLoader,webix.DataCollection);webix.DragOrder={_do_not_drag_selection:true,$drag:function(e,t){var n=webix.DragItem.$drag.call(this,e,t);if(n){var r=webix.DragControl.getContext();if(this.getBranchIndex)this._drag_order_stored_left=this._drag_order_complex?this.getItem(r.start).$level*16:0;if(!r.fragile)this.addCss(r.start,"webix_transparent")}return n},$dragPos:function(e,t,n){var r=webix.html.offset(this.$view);var i=r.x+(this._drag_order_complex?+r.width-webix.ui.scrollSize-1:1);n.style.display="none";var s=document.elementFromPoint(i,e.y);if(s!=this._last_sort_dnd_node){var o=webix.$$(s);if(o&&o==this){var u=this.locate(s);if(u&&this._translate_id)u=this._translate_id(u);var a=webix.DragControl.getContext().start;if(u){if(u!=this._last_sort_dnd_node){if(u!=a){var f,l;if(this.getBranchIndex){f={parent:this.getParentId(u)};l=this.getBranchIndex(u)}else{f={};l=this.getIndexById(u)}if(this.callEvent("onBeforeDropOrder",[a,l,t,f])){this.move(a,l,this,f);this._last_sort_dnd_node=u}}webix.DragControl._last=this._contentobj}}else{u="$webix-last";if(this._last_sort_dnd_node!=u){if(!this.callEvent("onBeforeDropOrder",[a,-1,t,{parent:0}]))return;this._last_sort_dnd_node=u}}}}n.style.display="block";r.y+=this._header_height;e.x=this._drag_order_stored_left||r.x;e.y=e.y-18;if(e.y<r.y)e.y=r.y;else{var c=r.y+this.$view.offsetHeight-60;if(e.y>c)e.y=c}webix.DragControl._skip=true},$dragIn:function(){return false},$drop:function(e,t,n){var r=webix.DragControl.getContext();var i=r.start;this.removeCss(i,"webix_transparent");var s=this.getIndexById(i);this.callEvent("onAfterDropOrder",[i,s,n]);if(r.fragile)this.refresh()}};webix.DragItem={_initHandlers:function(e,t,n){if(!t)webix.DragControl.addDrop(e._contentobj,e,true);if(!n)webix.DragControl.addDrag(e._contentobj,e);this.attachEvent("onDragOut",function(e,t){this.$dragMark(e,t)})},drag_setter:function(e){if(e){if(e=="order")webix.extend(this,webix.DragOrder,true);if(e=="inner")this._inner_drag_only=true;this._initHandlers(this,e=="source",e=="target");delete this.drag_setter}return e},$dragIn:function(e,t,n){var r=this.locate(n)||null;var i=webix.DragControl._drag_context;if((this._inner_drag_only||i.from._inner_drag_only)&&i.from!==this)return false;var s=webix.DragControl.getMaster(t);var o=this.getItemNode(r,n)||this._dataobj;if(o==webix.DragControl._landing)return o;i.target=r;i.to=s;if(this._auto_scroll_delay)this._auto_scroll_delay=window.clearTimeout(this._auto_scroll_delay);this._auto_scroll_delay=webix.delay(this._auto_scroll,this,[webix.html.pos(n),r],250);if(!this.$dropAllow(i,n)||!this.callEvent("onBeforeDragIn",[i,n])){i.to=i.target=null;return null}this.$dragMark(i,n);return o},$dropAllow:function(){return true},_drag_pause:function(e){},_auto_scroll:function(e,t){var n=this._body||this.$view;var r=webix.html.offset(n);var i=r.y;var s=i+n.offsetHeight;var o=this.getScrollState();var u=false;this._drag_pause(t);if(e.y<i+30){this.scrollTo(o.x,o.y-60);u=true}else if(e.y>s-30){this.scrollTo(o.x,o.y+60);u=true}if(u)this._auto_scroll_delay=webix.delay(this._auto_scroll,this,[e],100)},$dragOut:function(e,t,n,r){var i=this.locate(r)||null;var s=webix.DragControl._drag_context;if((s.target||"").toString()==(i||"").toString())return null;if(this._auto_scroll_delay)this._auto_scroll_delay=window.clearTimeout(this._auto_scroll_delay);s.target=s.to=null;this.callEvent("onDragOut",[s,r]);return null},$drop:function(e,t,n){if(this._auto_scroll_delay)this._auto_scroll_delay=window.clearTimeout(this._auto_scroll_delay);var r=webix.DragControl._drag_context;r.to=this;var i=this._translate_id?this._translate_id(r.target):r.target;if(this.getBranchIndex){if(i){r.parent=this.getParentId(i);r.index=this.getBranchIndex(i)}}else r.index=i?this.getIndexById(i):this.count();this.$dragMark({},n);if(r.from&&r.from!=r.to&&r.from.callEvent){r.from.callEvent("onBeforeDropOut",[r,n])}if(!this.callEvent("onBeforeDrop",[r,n]))return;this._context_to_move(r,n);this.callEvent("onAfterDrop",[r,n])},_context_to_move:function(e,t){webix.assert(e.from,"Unsopported d-n-d combination");if(e.from){var n={parent:e.parent,mode:e.pos};e.from.move(e.source,e.index,e.to,n)}},$drag:function(e,t){var n=this.locate(t);if(this._translate_id)n=this._translate_id(n,true);if(n){var r=[n];if(this.getSelectedId&&!this._do_not_drag_selection){var i=this.getSelectedId(true,true);if(i&&i.length>1&&webix.PowerArray.find.call(i,n)!=-1){var s={};var r=[];for(var o=0;o<i.length;o++)s[i[o]]=true;for(var o=0;o<this.data.order.length;o++){var u=this.data.order[o];if(s[u])r.push(u)}}}var a=webix.DragControl._drag_context={source:r,start:n};a.fragile=this.addRowCss&&webix.env.touch&&(webix.env.isWebKit||webix.env.isFF);a.from=this;if(this.callEvent("onBeforeDrag",[a,t])){if(webix.Touch)webix.Touch._start_context=null;return a.html||this.$dragHTML(this.getItem(n),t)}}return null},$dragHTML:function(e,t){return this._toHTML(e)},$dragMark:function(e,t){var n=null;if(e.target)n=this._translate_id?this._translate_id(e.target):e.target;if(this._marked&&this._marked!=n){if(!e.fragile)this.removeCss(this._marked,"webix_drag_over");this._marked=null}if(!this._marked&&n){this._marked=n;if(!e.fragile)this.addCss(n,"webix_drag_over");return n}if(e.to){return true}else return false}};webix.Group={$init:function(){webix.extend(this.data,webix.GroupStore);this.data.attachEvent("onClearAll",webix.bind(function(){this.data._not_grouped_order=this.data._not_grouped_pull=null;this._group_level_count=0},this))},group:function(e){this.data.ungroup(true);this.data.group(e)},ungroup:function(e){this.data.ungroup(e)}};webix.GroupMethods={sum:function(e,t){t=t||this;var n=0;for(var r=0;r<t.length;r++)n+=e(t[r])*1;return n},min:function(e,t){t=t||this;var n=Infinity;for(var r=0;r<t.length;r++)if(e(t[r])*1<n)n=e(t[r])*1;return n*1},max:function(e,t){t=t||this;var n=-Infinity;for(var r=0;r<t.length;r++)if(e(t[r])*1>n)n=e(t[r])*1;return n*1},count:function(e,t){return t.length},any:function(e,t){return e(t[0])},string:function(e,t){return e.$name}};webix.GroupStore={ungroup:function(e){if(this.getBranchIndex)return this._ungroup_tree.apply(this,arguments);if(this._not_grouped_order){this.order=this._not_grouped_order;this.pull=this._not_grouped_pull;this._not_grouped_pull=this._not_grouped_order=null}if(!e){this.callEvent("onStoreUpdated",[])}},_group_processing:function(e){this.blockEvent();this.group(e);this.unblockEvent()},_group_prop_accessor:function(e){if(typeof e=="function")return e;var t=function(t){return t[e]};t.$name=e;return t},group:function(e){if(this.getBranchIndex)return this._group_tree.apply(this,arguments);var t=this._group_prop_accessor(e.by);if(!e.map[t])e.map[t]=[t,this._any];var n={};var r=[];this.each(function(i){var s=t(i);if(!n[s]){r.push({id:s,$group:true,$row:e.row});n[s]=webix.toArray()}n[s].push(i)});for(var i in e.map){var s=e.map[i][1]||"any";var o=this._group_prop_accessor(e.map[i][0]);if(typeof s!="function"){webix.assert(webix.GroupMethods[s],"unknown grouping rule: "+s);s=webix.GroupMethods[s]}for(var u=0;u<r.length;u++){r[u][i]=s.call(this,o,n[r[u].id])}}this._not_grouped_order=this.order;this._not_grouped_pull=this.pull;this.order=webix.toArray();this.pull={};for(var u=0;u<r.length;u++){var a=this.id(r[u]);this.pull[a]=r[u];this.order.push(a)}this.callEvent("onStoreUpdated",[])},_group_tree:function(e,t){this._group_level_count=(this._group_level_count||0)+1;var n;if(typeof e=="string"){n={by:this._group_prop_accessor(e),map:{}};n.map[e]=[e]}else if(typeof e=="function"){n={by:e,map:{}}}else n=e;var r;if(t)r=this.getItem(t).$level;else{t=0;r=0}var i=this.branch[t];var s=this._group_prop_accessor(n.by);var o=[];var u=[];for(var a=0;a<i.length;a++){var f=this.getItem(i[a]);var l=s(f);var c=r+"$"+l;var h=this.branch[c];if(!h){var p=this.pull[c]={id:c,value:l,$group:true,$row:n.row};u.push(p);h=this.branch[c]=[];h._formath=[];o.push(c)}h.push(f.id);h._formath.push(f)}this.branch[t]=o;for(var d in n.map){var v=n.map[d][1]||"any";var m=this._group_prop_accessor(n.map[d][0]);if(typeof v!="function"){webix.assert(webix.GroupMethods[v],"unknown grouping rule: "+v);v=webix.GroupMethods[v]}for(var a=0;a<u.length;a++)u[a][d]=v.call(this,m,this.branch[u[a].id]._formath)}for(var a=0;a<u.length;a++){var g=u[a];if(this.hasEvent("onGroupCreated"))this.callEvent("onGroupCreated",[g.id,g.value,this.branch[g.id]._formath]);if(n.footer){var y="footer$"+g.id;var b=this.pull[y]={id:y,$footer:true,value:g.value,$level:r,$count:0,$parent:g.id,$row:n.footer.row};for(var d in n.footer){var v=n.footer[d][1]||"any";var m=this._group_prop_accessor(n.footer[d][0]);if(typeof v!="function"){webix.assert(webix.GroupMethods[v],"unknown grouping rule: "+v);v=webix.GroupMethods[v]}b[d]=v.call(this,m,this.branch[u[a].id]._formath)}this.branch[g.id].push(b.id);this.callEvent("onGroupFooter",[b.id,b.value,this.branch[g.id]._formath])}delete this.branch[g.id]._formath}this._fix_group_levels(o,t,r+1);this.callEvent("onStoreUpdated",[])},_ungroup_tree:function(e,t){if(!t&&!this._group_level_count)return;this._group_level_count=Math.max(0,this._group_level_count-1);e=e||0;var n=[];var r=this.branch[e];for(var i=0;i<r.length;i++){var s=r[i];var o=this.branch[s];if(o)n=n.concat(o);delete this.pull[s];delete this.branch[s]}this.branch[e]=n;for(var i=n.length-1;i>=0;i--){if(this.pull[n[i]].$footer)n.splice(i,1)}this._fix_group_levels(n,0,1);this.callEvent("onStoreUpdated",[])},_fix_group_levels:function(e,t,n){if(t)this.getItem(t).$count=e.length;for(var r=0;r<e.length;r++){var i=this.pull[e[r]];i.$level=n;i.$parent=t;var s=this.branch[i.id];if(s)this._fix_group_levels(s,i.id,n+1)}}};webix.clipbuffer={_area:null,_blur_id:null,_ctrl:0,init:function(){if(this._area!==null)return this._area;webix.destructors.push(this);this._area=document.createElement("textarea");this._area.style.width="1px";this._area.style.height="1px";this._area.style.left="3px";this._area.style.top="3px";this._area.style.position="fixed";this._area.style.opacity="0";document.body.appendChild(this._area);webix.event(document.body,"keydown",webix.bind(function(e){var t=e.keyCode;var n=!!(e.ctrlKey||e.metaKey);if(t===86&&n)webix.delay(this._paste,this,[],100)},this));return this._area},destructor:function(){this._area=null},set:function(e){this.init();this._area.value=e;this.focus()},focus:function(){this.init();this._area.focus();this._area.select()},_paste:function(){var e=this._area.value;var t=webix.UIManager.getFocus();if(t){t.callEvent("onPaste",[e]);this._area.select()}}};webix.CopyPaste={clipboard_setter:function(e){if(e===true||e===1)e="modify";this.attachEvent("onAfterSelect",function(e){var t=this.getItem(e);var n=this.type.templateCopy(t);webix.clipbuffer.set(n,this);webix.clipbuffer.focus()});this.attachEvent("onPaste",function(e){if(!webix.isUndefined(this._paste[this._settings.clipboard]))this._paste[this._settings.clipboard].call(this,e)});this.attachEvent("onFocus",function(){webix.clipbuffer.focus()});return e},_paste:{insert:function(e){this.add({value:e})},modify:function(e){var t=this.getSelectedId(true);for(var n=0;n<t.length;n++){this.getItem(t[n]).value=e;this.refresh(t[n])}},custom:function(e){}},templateCopy_setter:function(e){this.type.templateCopy=webix.template(e)},type:{templateCopy:function(e){return this.template(e)}}};webix.KeysNavigation={_navigation_helper:function(e){return function(t){if(t&&t.moveSelection&&t.config.navigation&&!t._in_edit_mode)return t.moveSelection(e);return true}},moveSelection:function(e){var t=this.getSelectedId();if(t){if(e=="top"){t=this.getFirstId()}else if(e=="bottom"){t=this.getLastId()}else if(e=="up"||e=="left"||e=="pgup"){var n=this.getIndexById(t);var r=e=="pgup"?10:1;t=this.getIdByIndex(Math.max(0,n-r))}else if(e=="down"||e=="right"||e=="pgdown"){var n=this.getIndexById(t);var r=e=="pgdown"?10:1;t=this.getIdByIndex(Math.min(this.count()-1,n+r))}else{webix.assert(false,"Not supported selection moving mode");return}this.showItem(t);this.select(t)}return false},navigation_setter:function(e){if(e&&!webix.UIManager._global_nav_grid_hotkeys){webix.UIManager._global_nav_grid_hotkeys=true;webix.UIManager.addHotKey("up",this._navigation_helper("up"));webix.UIManager.addHotKey("down",this._navigation_helper("down"));webix.UIManager.addHotKey("pageup",this._navigation_helper("pgup"));webix.UIManager.addHotKey("pagedown",this._navigation_helper("pgdown"));webix.UIManager.addHotKey("home",this._navigation_helper("top"));webix.UIManager.addHotKey("end",this._navigation_helper("bottom"));webix.UIManager.addHotKey("right",this._navigation_helper("right"));webix.UIManager.addHotKey("left",this._navigation_helper("left"))}return e}};webix.protoUI({name:"tree",$init:function(){this._viewobj.className+=" webix_tree";webix.extend(this.data,webix.TreeStore,true);webix.extend(this.on_click,webix.TreeClick);this.data.provideApi(this,true)},_id:"webix_tm_id",on_context:{},on_dblclick:{},on_click:{webix_tree_item:function(e,t){if(this._settings.activeTitle){var n=this.getItem(t);if(n.open)this.close(t);else this.open(t)}if(this._settings.select){if(this._settings.select=="multiselect"||this._settings.multiselect){if(this._settings.multiselect=="level"){var r=this.getSelectedId(true)[0];if(r&&this.getParentId(t)!=this.getParentId(r))return}this.select(t,false,e.ctrlKey||this._settings.multiselect=="touch",e.shiftKey)}else this.select(t)}}},_paste:{insert:function(e){var t=this.getSelectedId()||"0";this.add({value:e},null,t)},modify:function(e){var t=this.getSelectedId(true);for(var n=0;n<t.length;n++){this.getItem(t[n]).value=e;this.refresh(t[n])}},custom:function(e){}},_drag_order_complex:true,$dragHTML:function(e){return"<div class='borderless'>"+this.type.template(e,this.type)+"</div>"},type:webix.extend({template:function(e,t){var n=t["template"+e.level]||t.templateCommon;return n.apply(this,arguments)},classname:function(e,t,n){var r="webix_tree_item";if(e.$css)r+=" "+e.$css;if(n&&n.$css)r+=" "+n.$css;return r},templateCommon:webix.template("{common.icon()} {common.folder()} <span>#value#</span>"),templateStart:webix.template('<div webix_tm_id="#id#" class="{common.classname()}">'),templateEnd:webix.template("</div>"),templateCopy:webix.template("#value#")},webix.TreeType),moveSelection:function(e){var t=this.getSelectedId(true);if(t.length==1){t=t[0];if(e=="top"){t=this.getFirstId()}else if(e=="bottom"){t=this.getLastId()}else if(e=="up"||e=="left"||e=="pgup"){var n=this.getIndexById(t);var r=e=="pgup"?10:1;t=this.getIdByIndex(Math.max(0,n-r))}else if(e=="down"||e=="right"||e=="pgdown"){var n=this.getIndexById(t);var r=e=="pgdown"?10:1;t=this.getIdByIndex(Math.min(this.count()-1,n+r))}else{webix.assert(false,"Not supported selection moving mode");return}this.showItem(t);this.select(t)}return false}},webix.AutoTooltip,webix.Group,webix.TreeAPI,webix.DragItem,webix.TreeDataMove,webix.SelectionModel,webix.KeysNavigation,webix.MouseEvents,webix.Scrollable,webix.TreeDataLoader,webix.ui.proto,webix.TreeRenderStack,webix.CopyPaste,webix.EventSystem);webix.TreeStateCheckbox={_init_render_tree_state:function(){if(this._branch_render_supported){var e=this.render;this.render=function(t,n,r){var i=e.apply(this,arguments);if(this._settings.threeState&&i&&n!="checkbox")this._setThirdState.apply(this,arguments)};this._init_render_tree_state=function(){}}},threeState_setter:function(e){if(e)this._init_render_tree_state();return e},_setThirdState:function(e){var t,n,r,i,s;r=[];s=this;if(e&&!s.data.pull[e]){e=0}if(!e||s.data.pull[e].$count){n=this._getAllLeaves(e);n.sort(function(e,t){return s.data.pull[t].$level-s.data.pull[e].$level});for(t=0;t<n.length;t++){if(!t||s.data.pull[n[t]].$parent!=s.data.pull[n[t-1]].$parent)r=r.concat(s._setParentThirdState(n[t]))}}else{r=r.concat(s._setParentThirdState(e))}i={};for(t=0;t<r.length;t++){if(!i[r[t]]){i[r[t]]=1;this._setCheckboxIndeterminate(r[t])}}s=null},_setCheckboxIndeterminate:function(e){var t,n;n=this.getItemNode(e);if(n){this.render(e,"checkbox","update");if(this.getItem(e).indeterminate){n=this.getItemNode(e);t=n.getElementsByTagName("input")[0];if(t)t.indeterminate=this.getItem(e).indeterminate}}},_setParentThirdState:function(e){var t,n,r,i,s,o,u,a;i=this.getParentId(e);o=this;s=[];while(i&&i!="0"){u=0;n=0;this.data.eachChild(i,function(e){if(e.indeterminate){u++}else if(e.checked){n++}});t=r=a=false;var f=this.getItem(i);if(n==f.$count){t=true}else if(n>0||u>0){r=true}if(r||r!=f.indeterminate)a=true;f.indeterminate=r;if(f.checked!=t)a=true;f.checked=t;if(a){s.push(i);i=this.getParentId(i)}else i=0}return s},getChecked:function(){var e=[];var t=this;this.data.eachSubItem(0,function(n){if(t.isChecked(n.id))e.push(n.id)});return e},_tree_check_uncheck_3:function(e,t){var n=this.getItem(e);if(n){if(t==="")t=!n.checked;if(n.checked!=t){n.checked=t;this._correctThreeState(e);var r=this._setParentThirdState(e);if(this._branch_render_supported&&r.length<5){for(var i=0;i<r.length;i++)this._setCheckboxIndeterminate(r[i])}else this.refresh();this.callEvent("onItemCheck",[e,t])}}},checkItem:function(e){this._tree_check_uncheck(e,true);this.updateItem(e)},uncheckItem:function(e){this._tree_check_uncheck(e,false);this.updateItem(e)},_checkUncheckAll:function(e,t){var n=t?"checkItem":"uncheckItem";if(!e)e=0;else this[n](e);if(this._settings.threeState){if(!e)this.data.eachChild(0,function(e){this[n](e.id)},this)}else this.data.each(function(e){this[n](e.id)},this,e)},checkAll:function(e){this._checkUncheckAll(e,true)},uncheckAll:function(e){this._checkUncheckAll(e,false)},_correctThreeState:function(e){var t,n,r;var i=this.getItem(e);i.indeterminate=false;r=i.checked;this.data.eachSubItem(e,function(e){e.indeterminate=false;e.checked=r});if(this._branch_render_supported&&this.isBranchOpen(i.$parent)){this.render(e,0,"branch")}},isChecked:function(e){return this.getItem(e).checked},_getAllLeaves:function(e){var t=[];this.data.eachSubItem(e,function(e,n){if(!n)t.push(e.id)});return t}};if(webix.ui.tree)webix.extend(webix.ui.tree,webix.TreeStateCheckbox,true);webix.type(webix.ui.tree,{name:"lineTree",css:"webixLineTree",icon:function(e,t){var n="";var r="";for(var i=1;i<=e.$level;i++){if(i==e.$level)var r=e.$count?e.open?"webix_tree_open ":"webix_tree_close ":"webix_tree_none ";var s=this._icon_src(e,t,i);if(s)n+="<div class='"+r+" webix_tree_img webix_tree_"+s+"'></div>"}return n},_icon_src:function(e,t,n){var r=t._tree_branch_render_state;var i=webix.TreeRenderStack._obj;if(r===0&&i){var s=e.$level;var o=e.id;r=[];while(s){var u=i.getParentId(o);var a=i.data.branch[u];if(a[a.length-1]==o)r[s]=true;o=u;s--}t._tree_branch_render_state=r}if(!r)return 0;if(n==e.$level){var f=3;if(!e.$parent){if(e.$index===0)f=4}if(r[e.$level])f=2;if(e.$count){if(e.open)return"minus"+f;else return"plus"+f}else return"line"+f}else{if(!r[n])return"line1";return"blank"}}});webix.NavigationButtons={_renderPanel:function(){webix.html.remove(this._navPanel);this._navPanel=webix.html.create("DIV",{"class":"webix_nav_panel "+"webix_nav_panel_"+this._settings.navigation.type,style:"z-index:"+webix.ui.zIndex()+";"},"");this._viewobj.appendChild(this._navPanel);this._renderNavItems();this._renderNavButtons();this._setLinkEventHandler()},_setLinkEventHandler:function(){var e=[];if(this._navPanel)e[0]=webix.event(this._navPanel,"click",webix.bind(function(e){var t=e.srcElement||e.target;var n=false;while(t!=this._navPanel&&!n){var r=t.getAttribute(this._linkAttr);if(r){n=true;this._showPanelBind(r)}t=t.parentNode}},this));if(this._prevNavButton)e[1]=webix.event(this._prevNavButton,"click",webix.bind(function(e){this._showNavItem(-1)},this));if(this._nextNavButton)e[1]=webix.event(this._nextNavButton,"click",webix.bind(function(e){this._showNavItem(1)},this));this.attachEvent("onDestruct",function(){for(var t=0;t<e.length;t++){this.detachEvent(e[t])}e=null})},_showNavItem:function(e){if(this._cells){var t=this._active_cell+e;if(t>=this._cells.length||t<0){t=t<0?this._cells.length-1:0}this.setActiveIndex(t)}},_showPanelBind:function(e){if(this._cells)webix.$$(e).show()},_renderNavItems:function(){var e,t;t=this._settings.navigation;if(t.items){this._linkAttr=t.linkAttr||"bind_id";if(!this._navPanel)this._renderPanel();else this._clearPanel();var n=this._cells?this._cells:this.data.order;if(n.length>1){for(var r=0;r<n.length;r++){e=webix.html.create("DIV",{"class":"webix_nav_item webix_nav_"+(r==this._active_cell?"active":"inactive")},"<div></div>");var i=this._cells?this._cells[r]._settings.id:n[r];if(i)e.setAttribute(this._linkAttr,i);this._navPanel.appendChild(e)}}}},_clearPanel:function(){if(this._navPanel){var e=this._navPanel.childNodes;for(var t=e.length-1;t>=0;t--)webix.html.remove(e[t])}},_renderNavButtons:function(){var e,t;t=this._settings.navigation;if(t.buttons){if(this._prevNavButton)webix.html.remove(this._prevNavButton);if(this._prevNavButton)webix.html.remove(this._nextNavButton);var n=webix.ui.zIndex();this._prevNavButton=webix.html.create("DIV",{"class":"webix_nav_button_"+t.type+" webix_nav_button_prev ",style:"z-index:"+n+";"},'<div class="webix_nav_button_inner"></div>');this._viewobj.appendChild(this._prevNavButton);this._nextNavButton=webix.html.create("DIV",{"class":"webix_nav_button_"+t.type+" webix_nav_button_next ",style:"z-index:"+n+";"},'<div class="webix_nav_button_inner"></div>');this._viewobj.appendChild(this._nextNavButton)}}};webix.protoUI({name:"list",_listClassName:"webix_list",$init:function(e){webix.html.addCss(this._viewobj,this._listClassName+((e.layout||this.defaults.layout)=="x"?"-x":""));this.data.provideApi(this,true);this._auto_resize=webix.bind(this._auto_resize,this);this.data.attachEvent("onStoreLoad",this._auto_resize);this.data.attachEvent("onStoreUpdated",this._auto_resize);this.data.attachEvent("onSyncApply",this._auto_resize);this.attachEvent("onAfterRender",this._correct_width_scroll)},$dragHTML:function(e,t){if(this._settings.layout=="y"&&this.type.width=="auto"){this.type.width=this._content_width;var n=this._toHTML(e);this.type.width="auto";return n}return this._toHTML(e)},defaults:{select:false,scroll:true,layout:"y"},_id:"webix_l_id",on_click:{webix_list_item:function(e,t){if(this._settings.select){this._no_animation=true;if(this._settings.select=="multiselect"||this._settings.multiselect)this.select(t,false,e.ctrlKey||this._settings.multiselect=="touch",e.shiftKey);else this.select(t);this._no_animation=false}}},getVisibleCount:function(){return Math.floor(this._content_height/this.type.height)},_auto_resize:function(){if(this._settings.autoheight||this._settings.autowidth)this.resize()},_auto_height_calc:function(e){var t=this.data.$pagesize||this.count();this._onoff_scroll(e&&e<t);if(this._settings.autoheight&&t<(e||Infinity))e=t;return Math.max(this.type.height*e,this._settings.minHeight||0)},_auto_width_calc:function(e){var t=this.data.$pagesize||this.count();this._onoff_scroll(e&&e<t);if(this._settings.autowidth&&t<(e||Infinity))e=t;return this.type.width*e},_correct_width_scroll:function(){if(this._settings.layout=="x"&&this.type.width!="auto")this._dataobj.style.width=this.type.width*this.count()+"px"},$getSize:function(e,t){if(this._settings.layout=="y"){if(this.type.width!="auto")this._settings.width=this.type.width;if(this._settings.yCount||this._settings.autoheight)this._settings.height=this._auto_height_calc(this._settings.yCount)||1}else{if(this.type.height!="auto")this._settings.height=this.type.height;if(this._settings.xCount||this._settings.autowidth)this._settings.width=this._auto_width_calc(this._settings.xCount)||1}return webix.ui.view.prototype.$getSize.call(this,e,t)},$setSize:function(){webix.ui.view.prototype.$setSize.apply(this,arguments)},type:{css:"",widthSize:function(e,t){return t.width+(t.width>-1?"px":"")},heightSize:function(e,t){return t.height+(t.height>-1?"px":"")},classname:function(e,t,n){var r="webix_list_item";if(e.$css)r+=" "+e.$css;if(n&&n.$css)r+=" "+n.$css;return r},template:webix.template("#value#"),width:"auto",templateStart:webix.template('<div webix_l_id="#id#" class="{common.classname()}" style="width:{common.widthSize()}; height:{common.heightSize()}; overflow:hidden;">'),templateEnd:webix.template("</div>")},$skin:function(){this.type.height=webix.skin.$active.listItemHeight}},webix.KeysNavigation,webix.DataMove,webix.DragItem,webix.MouseEvents,webix.SelectionModel,webix.Scrollable,webix.ui.proto,webix.CopyPaste);webix.protoUI({name:"grouplist",defaults:{animate:{}},_listClassName:"webix_grouplist",$init:function(){webix.extend(this.data,webix.TreeStore,true);this.data.count=function(){return this.order.length};this.data.provideApi(this,true);this.data.attachEvent("onClearAll",webix.bind(this._onClear,this));this._onClear()},_onClear:function(){this._nested_cursor=[];this._nested_chain=[]},$setSize:function(){if(webix.ui.view.prototype.$setSize.apply(this,arguments)){this._dataobj.style.width=this._content_width}},on_click:{webix_list_item:function(e,t){if(this._in_animation){return false}for(var n=0;n<this._nested_chain.length;n++){if(this._nested_chain[n]==t){for(var r=n;r<this._nested_chain.length;r++){this.data.getItem(this._nested_chain[r]).$template=""}if(!n){this._nested_cursor=this.data.branch[0];this._nested_chain=[]}else{this._nested_cursor=this.data.branch[this._nested_chain[n-1]];this._nested_chain.splice(n)}this._is_level_down=false;return this.render()}}var i=this.getItem(t);if(i.$count){this._is_level_down=true;this._nested_chain.push(t);i.$template="Back";this._nested_cursor=this.data.branch[i.id];return this.render()}else{if(this._settings.select){this._no_animation=true;if(this._settings.select=="multiselect"||this._settings.multiselect)this.select(t,false,this._settings.multiselect=="touch"||e.ctrlKey,e.shiftKey);else this.select(t);this._no_animation=false}}}},getOpenState:function(){return{parents:this._nested_chain,branch:this._nested_cursor}},render:function(e,t,n,r){var i,s;this._nested_chain=webix.copy(this._nested_chain);this._nested_cursor=webix.copy(this._nested_cursor);if(this._nested_chain.length){for(i=0;i<this._nested_chain.length;i++){if(!this.data.branch[this._nested_chain[i]]){this._nested_chain.splice(i,1);i--}}}s=this._nested_chain.length?this._nested_chain[this._nested_chain.length-1]:0;this._nested_cursor=webix.copy(this.data.branch[s]);if(!this._nested_cursor.length&&this._nested_chain.length){this._nested_cursor=[s];this._nested_chain.pop()}if(this._in_animation){return webix.delay(this.render,this,arguments,100)}for(i=0;i<this._nested_cursor.length;i++)this.data.getItem(this._nested_cursor[i]).$template="";if(!this._nested_cursor.length)this._nested_cursor=this.data.branch[0];this.data.order=webix.toArray([].concat(this._nested_chain).concat(this._nested_cursor));if(this.callEvent("onBeforeRender",[this.data])){if(this._no_animation||!this._dataobj.innerHTML||!(webix.animate.isSupported()&&this._settings.animate)||this._prev_nested_chain_length==this._nested_chain.length){webix.RenderStack.render.apply(this,arguments)}else{if(this.callEvent("onBeforeRender",[this.data])){if(!this._back_scroll_states)this._back_scroll_states=[];var o=this._dataobj.cloneNode(false);o.innerHTML=this.data.getRange().map(this._toHTML,this).join("");var u=webix.extend({},this._settings.animate);u.direction=this._is_level_down?"left":"right";var a=[webix.clone(u),webix.clone(u)];if(this._is_level_down){this._back_scroll_states.push(this.getScrollState());if(webix.Touch&&webix.Touch.$active){a[0].y=0;a[1].y=-this.getScrollState().y}}else{var f=this._back_scroll_states.pop();if(webix.Touch&&webix.Touch.$active){a[0].y=-f.y;a[1].y=-this.getScrollState().y}}var l=webix.animate.formLine(o,this._dataobj,u);if(webix.Touch&&webix.Touch.$active)webix.Touch._set_matrix(o,0,this._is_level_down?0:a[0].y,"0ms");u.master=this;u.callback=function(){this._dataobj=o;if(!this._is_level_down){if(webix.Touch&&webix.Touch.$active){webix.delay(function(){webix.Touch._set_matrix(o,0,a[0].y,"0ms")},this)}else if(f)this.scrollTo(0,f.y)}else if(!(webix.Touch&&webix.Touch.$active)){this.scrollTo(0,0)}webix.animate.breakLine(l);u.master=u.callback=null;this._htmlmap=null;this._in_animation=false;this.callEvent("onAfterRender",[])};this._in_animation=true;webix.animate(l,a)}}this._prev_nested_chain_length=this._nested_chain.length}},templateBack_setter:function(e){this.type.templateBack=webix.template(e)},templateItem_setter:function(e){this.type.templateItem=webix.template(e)},templateGroup_setter:function(e){this.type.templateGroup=webix.template(e)},type:{template:function(e,t){if(e.$count)return t.templateGroup(e,t);return t.templateItem(e,t)},css:"group",classname:function(e,t,n){return"webix_list_item webix_"+(e.$count?"group":"item")+(e.$template?"_back":"")+(n&&n.webix_selected?" webix_selected ":"")+(e.$css?e.$css:"")},templateStart:webix.template('<div webix_l_id="#id#" class="{common.classname()}" style="width:{common.width}px; height:{common.height}px; padding:{common.padding}px; margin:{common.margin}px; overflow:hidden;">'),templateBack:webix.template("#value#"),templateItem:webix.template("#value#"),templateGroup:webix.template("#value#"),templateEnd:function(e,t){var n="";if(e.$count)n+="<div class='webix_arrow_icon'></div>";n+="</div>";return n}},showItem:function(e){var t,n;if(e){t=this.getItem(e);n=t.$parent;if(t.$count)n=t.id}this._nested_cursor=this.data.branch[n||0];this._nested_chain=[];while(n){this.getItem(n).$template="Back";this._nested_chain.unshift(n);n=this.getItem(n).$parent}this._no_animation=true;this.render();this._no_animation=false;webix.RenderStack.showItem.call(this,e)}},webix.Group,webix.ui.list);webix.type(webix.ui.grouplist,{});webix.protoUI({name:"unitlist",_id:"webix_item_id",uniteBy_setter:webix.template,sort_setter:function(e){if(typeof e!="object")e={};this._mergeSettings(e,{dir:"asc",as:"string"});return e},render:function(e,t,n,r){var i=this._settings;if(!this.isVisible(i.id))return;if(webix.debug_render)webix.log("Render: "+this.name+"@"+i.id);if(!i.uniteBy){if(webix.debug_render){webix.log("uniteBy is undefined")}return false}if(e){var s=this.getItemNode(e);if(s&&n=="update"&&this._settings.uniteBy.call(this,t)==this.getItem(e).$unitValue){var o=this._htmlmap[e]=this._toHTMLObject(t);webix.html.insertBefore(o,s);webix.html.remove(s);return}}if(this.callEvent("onBeforeRender",[this.data])){this.units=null;this._setUnits();if(this.units){this._dataobj.innerHTML=this._getUnitRange().map(this._toHTML,this).join("");this._htmlmap=null}this.callEvent("onAfterRender",[])}},getUnits:function(){var e=[];if(this.units){for(var t in this.units){e.push(t)}}return e},getUnitList:function(e){return this.units?this.units[e]:null},_toHTML:function(e){var t=this.data._marks[e.id];webix.assert(!e.$template||this.type["template"+e.$template],"RenderStack :: Unknown template: "+e.$template);this.callEvent("onItemRender",[e]);if(e.$unit){return this.type.templateStartHeader(e,this.type)+this.type.templateHeader.call(this,e.$unit)+this.type.templateEnd(e,this.type)}return this.type.templateStart(e,this.type,t)+(e.$template?this.type["template"+e.$template]:this.type.template)(e,this.type)+this.type.templateEnd(e,this.type)},_getUnitRange:function(){var e,t,n,r;e=[];var i=this.data.$min||0;var s=this.data.$max||Infinity;var o=0;for(n in this.units){e.push({$unit:n});r=this.units[n];for(t=0;t<r.length;t++){if(o==i)e=[{$unit:n}];e.push(this.getItem(r[t]));if(o==s)return webix.toArray(e);o++}}return webix.toArray(e)},_setUnits:function(){var e=this;this.units={};this.data.each(function(t){var n=e._settings.uniteBy.call(this,t);t.$unitValue=n;if(!e.units[n])e.units[n]=[];e.units[n].push(t.id)})},type:{headerHeight:20,templateHeader:function(e){return"<span class='webix_unit_header_inner'>"+e+"</span>"},templateStart:function(e,t,n){if(e.$unit)return t.templateStartHeader.apply(this,arguments);var r="webix_list_item webix_list_"+t.css+"_item"+(n&&n.webix_selected?" webix_selected":"");var i="width:"+t.width+"px; height:"+t.height+"px; padding:"+t.padding+"px; margin:"+t.margin+"px; overflow:hidden;"+(t.layout&&t.layout=="x"?"float:left;":"");return'<div webix_item_id="'+e.id+'" class="'+r+'" style="'+i+'">'},templateStartHeader:function(e,t){var n="webix_unit_header webix_unit_"+t.css+"_header"+(e.$selected?"_selected":"");var r="width:"+t.width+"px; height:"+t.headerHeight+"px; overflow:hidden;";return'<div webix_unit_id="'+e.$unit+'" class="'+n+'" style="'+r+'">'}},$skin:function(){this.type.headerHeight=webix.skin.$active.unitHeaderHeight||20}},webix.ui.list);webix.EditAbility={defaults:{editaction:"click"},$init:function(e){this._editors={};this._in_edit_mode=0;this._edit_open_time=0;this._contentobj.style.position="relative";if(e)e.onDblClick=e.onDblClick||{};this.attachEvent("onAfterRender",this._refocus_inline_editor);if(this._settings.editable)this._init_edit_events_once()},_refocus_inline_editor:function(){var e=this.getEditor();if(e&&e.$inline&&!e.getPopup){var t=this._locateInput(e);if(t&&t!=e.node){var n=e.node.value;e.node=t;t.value=n;t.focus();if(typeof t.selectionStart=="number"){t.selectionStart=t.selectionEnd=t.value.length}else if(typeof t.createTextRange!="undefined"){var r=t.createTextRange();r.collapse(false);r.select()}}else this.editStop()}},editable_setter:function(e){if(e)this._init_edit_events_once();return e},_init_edit_events_once:function(){webix.attachEvent("onEditEnd",webix.bind(function(){if(this._in_edit_mode)this.editStop()},this));webix.attachEvent("onClick",webix.bind(function(e){if(this._in_edit_mode&&new Date-this._edit_open_time>200){if(!this._last_editor||this._last_editor.popupType||!e||this._last_editor.node!=e.target)this.editStop()}},this));if(this.data.attachEvent)this.data.attachEvent("onIdChange",webix.bind(function(e,t){this._changeEditorId(e,t)},this));this.attachEvent("onItemClick",function(e){if(this._settings.editable&&this._settings.editaction=="click")this.edit(e)});this.attachEvent("onItemDblClick",function(e){if(this._settings.editable&&this._settings.editaction=="dblclick")this.edit(e)});this._reset_active_editor=webix.bind(function(){this._edit_open_time=new Date},this);this._init_edit_events_once=function(){};if(this._component_specific_edit_init)this._component_specific_edit_init()},_handle_live_edits:function(){webix.delay(function(){var e=this.getEditor();if(e&&e.config.liveEdit){var t={value:e.getValue(),old:e.value};if(t.value==t.old)return;e.value=t.value;this._set_new_value(e,t.value);this.callEvent("onLiveEdit",[t,e])}},this)},_show_editor_form:function(e){var t=this._settings.form;if(typeof t!="string")this._settings.form=t=webix.ui(t).config.id;var t=webix.$$(t);var n=t.setValues?t:t.getChildViews()[0];n.setValues(this.getItem(e.row||e));t.config.master=this.config.id;t.show(this.getItemNode(e));var r=n.getChildViews()[0];if(r.focus())r.focus()},edit:function(e,t,n){if(!this.callEvent("onBeforeEditStart",[e]))return;if(this._settings.form)return this._show_editor_form(e);var r=this._get_editor_type(e);if(r){if(this.getEditor(e))return;if(!t)this.editStop();this._edit_open_time=new Date;webix.assert(webix.editors[r],"Invalid editor type: "+r);var i=webix.extend({},webix.editors[r]);var s=this._init_editor(e,i,n);if(i.config.liveEdit)this._live_edits_handler=this.attachEvent("onKeyPress",this._handle_live_edits);var o=i.getPopup?i.getPopup(s)._viewobj:s;if(o)webix.event(o,"click",this._reset_active_editor);if(s)webix.event(s,"change",this._on_editor_change,{view:this,id:e});if(n!==false)i.focus();webix.UIManager.setFocus(this,true);this.callEvent("onAfterEditStart",[e]);return i}return null},getEditor:function(e){if(!e)return this._last_editor;return this._editors[e]},_changeEditorId:function(e,t){var n=this._editors[e];if(n){this._editors[t]=n;n.id=t;delete this._editors[e]}},_on_editor_change:function(e){if(this.view.hasEvent("onEditorChange"))this.view.callEvent("onEditorChange",[this.id,this.view.getEditorValue(this.id)])},_get_edit_config:function(e){return this._settings},_init_editor:function(e,t,n){var r=t.config=this._get_edit_config(e);var i=t.render();if(t.$inline)i=this._locateInput(e);t.node=i;var s=this.getItem(e);var o=s[this._settings.editValue||"value"];if(webix.isUndefined(o))o="";t.setValue(o);t.value=o;this._addEditor(e,t);if(n!==false)this.showItem(e);if(!t.$inline)this._sizeToCell(e,i,true);if(t.afterRender)t.afterRender();return i},_locate_cell:function(e){return this.getItemNode(e)},_locateInput:function(e){var t=this._locate_cell(e);if(t)t=t.getElementsByTagName("input")[0]||t;return t},_get_editor_type:function(e){return this._settings.editor},_addEditor:function(e,t){t.id=e;this._editors[e]=this._last_editor=t;this._in_edit_mode++},_removeEditor:function(e){if(this._last_editor==e)this._last_editor=0;if(e.destroy)e.destroy();delete e.popup;delete e.node;delete this._editors[e.id];this._in_edit_mode--},focusEditor:function(e){var t=this.getEditor.apply(this,arguments);if(t&&t.focus)t.focus()},editCancel:function(){this.editStop(null,null,true)},editStop:function(e){var t=arguments[2];var n=1;if(!e){this._for_each_editor(function(e){n=n*this._editStop(e,t)})}else n=this._editStop(this._editors[e],t);return n},_cellPosition:function(e){var t=this.getItemNode(e);return{left:t.offsetLeft,top:t.offsetTop,height:t.offsetHeight,width:t.offsetWidth,parent:this._contentobj}},_sizeToCell:function(e,t,n){if(!t.style)return;var r=this._cellPosition(e);t.style.top=r.top+"px";t.style.left=r.left+"px";t.style.width=r.width-1+"px";t.style.height=r.height-1+"px";t.top=r.top;if(n)r.parent.appendChild(t)},_for_each_editor:function(e){for(var t in this._editors)e.call(this,this._editors[t])},_editStop:function(e,t){if(!e)return;var n={value:e.getValue(),old:e.value};if(this.callEvent("onBeforeEditStop",[n,e,t])){if(!t){if(n.value!=n.old)this.updateItem(this._set_new_value(e,n.value))}if(e.$inline)e.node=null;else webix.html.remove(e.node);this._removeEditor(e);if(this._live_edits_handler)this.detachEvent(this._live_edits_handler);this.callEvent("onAfterEditStop",[n,e,t]);return 1}return 0},validateEditor:function(e){var t=true;if(this._settings.rules){var n=this.getEditor(e);var r=n.column||this._settings.editValue||"value";var i=this._settings.rules[r];var s=this._settings.rules.$all;if(i||s){var o=this.data.getItem(n.row||n.id);var u=n.getValue();var a=n.getInputNode();if(i)t=i.call(this,u,o,r);if(s)t=s.call(this,u,o,r)&&t;if(t)webix.html.removeCss(a,"webix_invalid");else webix.html.addCss(a,"webix_invalid");webix.callEvent("onLiveValidation",[n,t,o,u])}}return t},getEditorValue:function(e){var t;if(arguments.length===0)t=this._last_editor;else t=this.getEditor(e);if(t)return t.getValue()},getEditState:function(){return this._last_editor||false},editNext:function(e,t){e=e!==false;if(this._in_edit_mode==1||t){var n=this._find_cell_next(this._last_editor||t,function(e){if(this._get_editor_type(e))return true;return false},e);if(this.editStop()){if(n){this.edit(n);this._after_edit_next(n)}return false}}},_after_edit_next:function(){},_find_cell_next:function(e,t,n){var r=this.getIndexById(e.id);var i=this.data.order;if(n){for(var s=r+1;s<i.length;s++){if(t.call(this,i[s]))return i[s]}}else{for(var s=r-1;s>=0;s--){if(t.call(this,i[s]))return i[s]}}return null},_set_new_value:function(e,t){this.getItem(e.id)[this._settings.editValue||"value"]=t;return e.id}};webix.editors={text:{focus:function(){this.getInputNode(this.node).focus();this.getInputNode(this.node).select()},getValue:function(){return this.getInputNode(this.node).value},setValue:function(e){this.getInputNode(this.node).value=e},getInputNode:function(){return this.node.firstChild},render:function(){return webix.html.create("div",{"class":"webix_dt_editor"},"<input type='text'>")}},"inline-checkbox":{render:function(){return{}},getValue:function(){return this.node.checked},setValue:function(){},focus:function(){this.node.focus()},getInputNode:function(){},$inline:true},"inline-text":{render:function(){return{}},getValue:function(){return this.node.value},setValue:function(){},focus:function(){this.node.select();this.node.focus()},getInputNode:function(){},$inline:true},checkbox:{focus:function(){this.getInputNode().focus()},getValue:function(){return this.getInputNode().checked},setValue:function(e){this.getInputNode().checked=!!e},getInputNode:function(){return this.node.firstChild.firstChild},render:function(){return webix.html.create("div",{"class":"webix_dt_editor"},"<div><input type='checkbox'></div>")}},select:{focus:function(){this.getInputNode().focus()},getValue:function(){return this.getInputNode().value},setValue:function(e){this.getInputNode().value=e},getInputNode:function(){return this.node.firstChild},render:function(){var e="";var t=this.config.options||this.config.collection;webix.assert(t,"options not defined for select editor");if(t.data&&t.data.each)t.data.each(function(t){e+="<option value='"+t.id+"'>"+t.value+"</option>"});else{if(webix.isArray(t)){for(var n=0;n<t.length;n++)e+="<option value='"+t[n]+"'>"+t[n]+"</option>"}else for(var r in t){e+="<option value='"+r+"'>"+t[r]+"</option>"}}return webix.html.create("div",{"class":"webix_dt_editor"},"<select>"+e+"</select>")}},popup:{focus:function(){this.getInputNode().focus()},destroy:function(){this.getPopup().hide()},getValue:function(){return this.getInputNode().getValue()||""},setValue:function(e){this.getPopup().show(this.node);this.getInputNode().setValue(e)},getInputNode:function(){return this.getPopup().getChildViews()[0]},getPopup:function(){if(!this.config.popup)this.config.popup=this.createPopup();return webix.$$(this.config.popup)},createPopup:function(){if(this.config.popup)return webix.$$(this.config.popup);var e=webix.editors.$popup[this.popupType];if(typeof e!="string"){e=webix.editors.$popup[this.popupType]=webix.ui(e);this.popupInit(e)}return e._settings.id},popupInit:function(e){},popupType:"text",render:function(){return{}},$inline:true}};webix.editors.color=webix.extend({focus:function(){},popupType:"color",popupInit:function(e){e.getChildViews()[0].attachEvent("onSelect",function(e){webix.callEvent("onEditEnd",[e])})}},webix.editors.popup);webix.editors.date=webix.extend({focus:function(){},popupType:"date",setValue:function(e){this._is_string=typeof e=="string";webix.editors.popup.setValue.call(this,e)},getValue:function(){return this.getInputNode().getValue(this._is_string?webix.i18n.parseFormatStr:"")||""},popupInit:function(e){e.getChildViews()[0].attachEvent("onDateSelect",function(e){webix.callEvent("onEditEnd",[e])})}},webix.editors.popup);webix.editors.combo=webix.extend({_create_suggest:function(e){if(this.config.popup){return this.config.popup.config.id}else if(e){if(typeof e=="string")return e;if(e.linkInput)return e._settings.id;var t={view:"suggest",type:"list"};if(typeof e=="object")webix.extend(t,e,true);var n=webix.ui(t);return n.config.id}else return this._shared_suggest(e)},_shared_suggest:function(){var e=webix.editors.combo;return e._suggest=e._suggest||this._create_suggest(true)},render:function(){var e=webix.html.create("div",{"class":"webix_dt_editor"},"<input type='text'>");var t=this.config.suggest=this._create_suggest(this.config.suggest);if(t){webix.$$(t).linkInput(e.firstChild,true);webix.event(e.firstChild,"click",webix.bind(this.showPopup,this))}return e},showPopup:function(){var e=webix.$$(this.config.suggest);var t=e.getList();var n=this.getInputNode();var r=this.getValue();e.show(n);if(r){webix.assert(t.exists(r),"Option with ID "+r+" doesn't exist");if(t.exists(r)){t.select(r);t.showItem(r)}}else{t.unselect();t.showItem(t.getFirstId())}e._last_input_target=n},afterRender:function(){this.showPopup()},setValue:function(e){this._initial_value=e;if(this.config.suggest){var t=webix.$$(this.config.suggest);var n=this.config.collection||this.config.options;if(n)t.getList().data.importData(n);this._initial_text=this.getInputNode(this.node).value=t.getItemText(e)}},getValue:function(){var e=this.getInputNode().value;if(this.config.suggest){if(e==this._initial_text)return this._initial_value;return webix.$$(this.config.suggest).getSuggestion()}else return e}},webix.editors.text);webix.editors.richselect=webix.extend({focus:function(){},getValue:function(){return this.getInputNode().getSelectedId().id||this.getInputNode().getSelectedId()||""},setValue:function(e){var t=this.config.collection||this.config.options;var n=this.getInputNode();if(t)this.getPopup().getList().data.importData(t);this.getPopup().show(this.node);if(e){webix.assert(n.exists(e),"Option with ID "+e+" doesn't exist");if(n.exists(e)){n.select(e);n.showItem(e)}}else{n.unselect();n.showItem(n.getFirstId())}},getInputNode:function(){return this.getPopup().getList()},popupInit:function(e){e.attachEvent("onValueSuggest",function(e){webix.delay(function(){webix.callEvent("onEditEnd",[e.id])})});e.linkInput(document.body)},popupType:"richselect"},webix.editors.popup);webix.editors.$popup={text:{view:"popup",width:250,height:150,body:{view:"textarea"}},color:{view:"popup",body:{view:"colorboard"}},date:{view:"popup",width:250,height:250,body:{view:"calendar",borderless:true}},richselect:{view:"suggest",body:{view:"list",select:true}}};webix.VirtualRenderStack={$init:function(){webix.assert(this.render,"VirtualRenderStack :: Object must use RenderStack first");this._htmlmap={};webix.event(this._viewobj,"scroll",webix.bind(this._render_visible_rows,this));if(webix.env.touch){this.attachEvent("onAfterScroll",webix.bind(this._render_visible_rows,this))}this._unrendered_area=[]},getItemNode:function(e){return this._htmlmap[e]},showItem:function(e){var t=this._getVisibleRange();var n=this.data.getIndexById(e);var r=Math.floor(n/t._dx)*t._y;var i=this.getScrollState();if(r<i.y||r+this._settings.height>=i.y+this._content_height)this.scrollTo(0,r)},render:function(e,t,n){if(!this.isVisible(this._settings.id)||this.$blockRender)return;if(webix.debug_render)webix.log("Render: "+this.name+"@"+this._settings.id);if(e){var r=this.getItemNode(e);switch(n){case"update":if(!r)return;var i=this._htmlmap[e]=this._toHTMLObject(t);webix.html.insertBefore(i,r);webix.html.remove(r);break;default:this._render_delayed();break}}else{if(this.callEvent("onBeforeRender",[this.data])){this._htmlmap={};this._render_visible_rows(null,true);this._wait_for_render=false;this.callEvent("onAfterRender",[])}}},_render_delayed:function(){if(this._wait_for_render)return;this._wait_for_render=true;window.setTimeout(webix.bind(function(){this.render()},this),1)},_create_placeholder:function(e){var t=document.createElement("DIV");t.style.cssText="height:"+e+"px; width:100%; overflow:hidden;";return t},_render_visible_rows:function(e,t){this._unrendered_area=[];var n=this._getVisibleRange();if(!this._dataobj.firstChild||t){this._dataobj.innerHTML="";this._dataobj.appendChild(this._create_placeholder(n._max));this._htmlrows=[this._dataobj.firstChild]}var r=n._from;while(r<=n._height){while(this._htmlrows[r]&&this._htmlrows[r]._filled&&r<=n._height){r++}if(r>n._height)break;var i=r;while(!this._htmlrows[i])i--;var s=this._htmlrows[i];var o=r*n._dx+(this.data.$min||0);if(o>(this.data.$max||Infinity))break;var u=Math.min(o+n._dx-1,this.data.$max||Infinity);var a=this._create_placeholder(n._y);var f=this.data.getIndexRange(o,u);if(!f.length)break;var l={$template:"Loading"};for(var c=0;c<f.length;c++){if(!f[c])this._unrendered_area.push(o+c);f[c]=this._toHTML(f[c]||l)}a.innerHTML=f.join("");for(var c=0;c<f.length;c++)this._htmlmap[this.data.getIdByIndex(o+c)]=a.childNodes[c];var h=parseInt(s.style.height,10);var p=(r-i)*n._y;var d=h-p-n._y;webix.html.insertBefore(a,p?s.nextSibling:s,this._dataobj);this._htmlrows[r]=a;a._filled=true;if(p<=0&&d>0){s.style.height=d+"px";this._htmlrows[r+1]=s}else{if(p<0)webix.html.remove(s);else s.style.height=p+"px";if(d>0){var v=this._htmlrows[r+1]=this._create_placeholder(d);webix.html.insertBefore(v,a.nextSibling,this._dataobj)}}r++}if(this._unrendered_area.length){var m=this._unrendered_area[0];var g=this._unrendered_area.pop()+1;if(g>m){var y=g-m;if(this._maybe_loading_already(y,m))return;y=Math.max(y,this._settings.datafetch||this._settings.loadahead||0);this.loadNext(y,m)}}},_getVisibleRange:function(){var e=this.getScrollState();var t=e.y;var n=this._content_width;var r=this._content_height;var i=this.type;var s=Math.floor(n/i.width)||1;var o=Math.floor(t/i.height);var u=Math.ceil((r+t)/i.height)-1;var a=this.data.$max?this.data.$max-this.data.$min:this.data.count();var f=Math.ceil(a/s)*i.height;return{_from:o,_height:u,_top:t,_max:f,_y:i.height,_dx:s}},_cellPosition:function(e){var t=this.getItemNode(e);if(!t){this.showItem(e);this._render_visible_rows();t=this.getItemNode(e)}return{left:t.offsetLeft,top:t.offsetTop,height:t.offsetHeight,width:t.offsetWidth,parent:this._contentobj}}};webix.protoUI({name:"dataview",$init:function(e){if(e.sizeToContent)this.$ready.unshift(this._after_init_call);if(e.prerender===false||e.prerender!==true&&e.height!=="auto"&&!e.autoheight)webix.extend(this,webix.VirtualRenderStack,true);if(e.autoheight)e.scroll=false;this._contentobj.className+=" webix_dataview"},_after_init_call:function(){var e=webix.html.create("DIV",0,this.type.template({}));e.style.position="absolute";document.body.appendChild(e);this.type.width=e.offsetWidth;this.type.height=e.offsetHeight;webix.html.remove(e)},defaults:{scroll:true,datafetch:50},_id:"webix_f_id",on_click:{webix_dataview_item:function(e,t){if(this._settings.select){if(this._settings.select=="multiselect"||this._settings.multiselect)this.select(t,false,this._settings.multiselect=="touch"||e.ctrlKey,e.shiftKey);else this.select(t)}}},on_dblclick:{},on_mouse_move:{},type:{template:webix.template("#value#"),templateLoading:webix.template("Loading..."),width:160,height:50,classname:function(e,t,n){var r="webix_dataview_item ";if(t.css)r+=t.css+" ";if(e.$css)r+=e.$css+" ";if(n&&n.$css)r+=n.$css+" ";return r},templateStart:webix.template('<div webix_f_id="#id#" class="{common.classname()}" style="width:{common.width}px; height:{common.height}px; float:left; overflow:hidden;">'),templateEnd:webix.template("</div>")},_calck_autoheight:function(e){return this._settings.height=this.type.height*Math.ceil(this.data.count()/Math.floor(e/this.type.width))},autoheight_setter:function(e){if(e){this.data.attachEvent("onStoreLoad",webix.bind(this.resize,this));this._contentobj.style.overflowY="hidden"}return e},$getSize:function(e,t){if(this._settings.xCount&&this.type.width!="auto")this._settings.width=this.type.width*this._settings.xCount;if(this._settings.yCount&&this.type.height!="auto")this._settings.height=this.type.height*this._settings.yCount;var n=this._settings.width||this._content_width;if(this._settings.autoheight&&n){this._calck_autoheight(n);this.scroll_setter(false)}return webix.ui.view.prototype.$getSize.call(this,e,t)},$setSize:function(e,t){if(webix.ui.view.prototype.$setSize.call(this,e,t)){if(this._settings.autoheight&&this._calck_autoheight()!=this._content_height)return webix.delay(this.resize,this);var n=false;if(this._settings.yCount&&this.type.height=="auto"){this.type.height=Math.floor(this._content_height/this._settings.yCount);n=true}if(this._settings.xCount&&this.type.width=="auto"){this.type.width=Math.floor(this._content_width/this._settings.xCount);n=true}if(n||this._render_visible_rows)this.render()}}},webix.DataMove,webix.DragItem,webix.MouseEvents,webix.KeysNavigation,webix.SelectionModel,webix.Scrollable,webix.ui.proto);webix.DataDriver.htmltable={toObject:function(e){e=webix.toNode(e);webix.assert(e,"table is not found");webix.assert(e.tagName.toLowerCase()==="table","Incorrect table object");var t=e.rows;webix.html.remove(e);return t},getRecords:function(e){var t=[];var n=e[0]&&e[0]._webix_skip?1:0;for(;n<e.length;n++)t.push(e[n]);return t},getDetails:function(e){var t=e.getElementsByTagName("td");e={};for(var n=0;n<t.length;n++){e["data"+n]=t[n].innerHTML}return e},getInfo:function(e){return{_size:0,_from:0}},getOptions:function(){},getConfig:function(e){var t=[];var n=e[0].getElementsByTagName("th");if(n.length)e[0]._webix_skip=true;for(var r=0;r<n.length;r++){var i={id:"data"+r,header:this._de_json(n[r].innerHTML)};var s=this._get_attrs(n[r]);i=webix.extend(i,s);t.push(i)}return t},_de_json:function(e){var t=e.indexOf("json://");if(t!=-1)e=JSON.parse(e.substr(t+7));return e},_get_attrs:function(e){var t=e.attributes;var n={};for(var r=0;r<t.length;r++){n[t[r].nodeName]=this._de_json(t[r].nodeValue)}n.width=parseInt(n.width,10);return n}};webix.protoUI({name:"vscroll",defaults:{scroll:"x",scrollStep:40,scrollPos:0,scrollSize:18,scrollVisible:1,zoom:1},$init:function(e){var t=e.scroll||"x";var n=this._viewobj=webix.toNode(e.container);n.className+=" webix_vscroll_"+t;n.innerHTML="<div class='webix_vscroll_body'></div>";webix.event(n,"scroll",this._onscroll,this);this._last_set_size=0},_check_quantum:function(e){if(e>15e5){this._settings.zoom=Math.floor(e/15e5)+1;this._zoom_limit=e-this._last_set_size;e=Math.floor(e/this._settings.zoom)+this._last_set_size}else{this._settings.zoom=1;this._zoom_limit=Infinity}return e},scrollWidth_setter:function(e){e=this._check_quantum(e);this._viewobj.firstChild.style.width=e+"px";return e},scrollHeight_setter:function(e){e=this._check_quantum(e);this._viewobj.firstChild.style.height=e+"px";return e},sizeTo:function(e,t,n){e=e-(t||0)-(n||0);var r=this._settings.scrollSize;if(webix.env.isIE&&r)r+=1;if(!r&&this._settings.scrollVisible&&!webix.env.$customScroll){this._viewobj.style.pointerEvents="none";r=14}if(!r){this._viewobj.style.display="none"}else{if(t)this._viewobj.style.marginTop=t+"px";this._viewobj.style[this._settings.scroll=="x"?"width":"height"]=e+"px";this._viewobj.style[this._settings.scroll=="x"?"height":"width"]=r+"px"}this._last_set_size=e},getScroll:function(){return this._settings.scrollPos*this._settings.zoom},getSize:function(){return(this._settings.scrollWidth||this._settings.scrollHeight)*this._settings.zoom},scrollTo:function(e){if(e<0)e=0;var t=this._settings;e=Math.min(((t.scrollWidth||t.scrollHeight)-this._last_set_size)*t.zoom,e);var n=e/t.zoom;if(n<0)n=0;if(t.scrollPos!=e){this._viewobj[t.scroll=="x"?"scrollLeft":"scrollTop"]=n;t.scrollPos=e;this._onscroll_inner(n);return true}},_onscroll:function(){var e=this._viewobj[this._settings.scroll=="x"?"scrollLeft":"scrollTop"];if(e!=this._last_scroll_pos)this._onscroll_inner(e)},_onscroll_inner:function(e){this._last_scroll_pos=e;this._settings.scrollPos=Math.min(this._zoom_limit,e*this._settings.zoom);this.callEvent("onScroll",[this._settings.scrollPos])},activeArea:function(e,t){this._x_scroll_mode=t;webix.event(e,"mousewheel",this._on_wheel,this);webix.event(e,"DOMMouseScroll",this._on_wheel,this)},_on_wheel:function(e){var t=0;if(e.wheelDeltaX&&Math.abs(e.wheelDeltaX)>Math.abs(e.wheelDeltaY)){if(this._x_scroll_mode)t=e.wheelDeltaX/-40}else{if(!this._x_scroll_mode)if(webix.isUndefined(e.wheelDelta))t=e.detail;else t=e.wheelDelta/-40}if(t)if(this.scrollTo(this._settings.scrollPos+t*this._settings.scrollStep))return webix.html.preventEvent(e)}},webix.EventSystem,webix.Settings);webix.Number={format:function(e,t){if(e===""||typeof e==="undefined")return e;t=t||webix.i18n;e=parseFloat(e);var n=e<0?"-":"";e=Math.abs(e);var r=e.toFixed(t.decimalSize).toString();r=r.split(".");var i="";if(t.groupSize){var s=t.groupSize;var o=r[0].length;do{o-=s;var u=o>0?r[0].substr(o,s):r[0].substr(0,s+o);i=u+(i?t.groupDelimiter+i:"")}while(o>0)}else i=r[0];if(t.decimalSize)return n+i+t.decimalDelimeter+r[1];else return n+i},numToStr:function(e){return function(t){return webix.Number.format(t,e)}}};webix.Date={startOnMonday:false,toFixed:function(e){if(e<10)return"0"+e;return e},weekStart:function(e){e=this.copy(e);var t=e.getDay();if(this.startOnMonday){if(t===0)t=6;else t--}return this.datePart(this.add(e,-1*t,"day"))},monthStart:function(e){e=this.copy(e);e.setDate(1);return this.datePart(e)},yearStart:function(e){e=this.copy(e);e.setMonth(0);return this.monthStart(e)},dayStart:function(e){return this.datePart(e,true)},dateToStr:function(e,t){if(typeof e=="function")return e;e=e.replace(/%[a-zA-Z]/g,function(e){switch(e){case"%d":return'"+webix.Date.toFixed(date.getDate())+"';case"%m":return'"+webix.Date.toFixed((date.getMonth()+1))+"';case"%j":return'"+date.getDate()+"';case"%n":return'"+(date.getMonth()+1)+"';case"%y":return'"+webix.Date.toFixed(date.getFullYear()%100)+"';case"%Y":return'"+date.getFullYear()+"';case"%D":return'"+webix.i18n.calendar.dayShort[date.getDay()]+"';case"%l":return'"+webix.i18n.calendar.dayFull[date.getDay()]+"';case"%M":return'"+webix.i18n.calendar.monthShort[date.getMonth()]+"';case"%F":return'"+webix.i18n.calendar.monthFull[date.getMonth()]+"';case"%h":return'"+webix.Date.toFixed((date.getHours()+11)%12+1)+"';case"%g":return'"+((date.getHours()+11)%12+1)+"';case"%G":return'"+date.getHours()+"';case"%H":return'"+webix.Date.toFixed(date.getHours())+"';case"%i":return'"+webix.Date.toFixed(date.getMinutes())+"';case"%a":return'"+(date.getHours()>11?"pm":"am")+"';case"%A":return'"+(date.getHours()>11?"PM":"AM")+"';case"%s":return'"+webix.Date.toFixed(date.getSeconds())+"';case"%W":return'"+webix.Date.toFixed(webix.Date.getISOWeek(date))+"';default:return e}});if(t===true)e=e.replace(/date\.get/g,"date.getUTC");return new Function("date","if (!date) return ''; if (!date.getMonth) date=webix.i18n.parseFormatDate(date);  return \""+e+'";')},strToDate:function(e,t){if(typeof e=="function")return e;var n="var temp=date.split(/[^0-9a-zA-Z]+/g);";var r=e.match(/%[a-zA-Z]/g);var i,s,o;if(!webix.i18n.calendar.monthShort_hash){o=webix.i18n.calendar.monthShort;s=webix.i18n.calendar.monthShort_hash={};for(i=0;i<o.length;i++)s[o[i]]=i;o=webix.i18n.calendar.monthFull;s=webix.i18n.calendar.monthFull_hash={};for(i=0;i<o.length;i++)s[o[i]]=i}for(i=0;i<r.length;i++){switch(r[i]){case"%j":case"%d":n+="set[2]=temp["+i+"]||1;";break;case"%n":case"%m":n+="set[1]=(temp["+i+"]||1)-1;";break;case"%y":n+="set[0]=temp["+i+"]*1+(temp["+i+"]>50?1900:2000);";break;case"%g":case"%G":case"%h":case"%H":n+="set[3]=temp["+i+"]||0;";break;case"%i":n+="set[4]=temp["+i+"]||0;";break;case"%Y":n+="set[0]=temp["+i+"]||0;";break;case"%a":case"%A":n+="set[3]=set[3]%12+((temp["+i+"]||'').toLowerCase()=='am'?0:12);";break;case"%s":n+="set[5]=temp["+i+"]||0;";break;case"%M":n+="set[1]=webix.i18n.calendar.monthShort_hash[temp["+i+"]]||0;";break;case"%F":n+="set[1]=webix.i18n.calendar.month_full_hash[temp["+i+"]]||0;";break;default:break}}var u="set[0],set[1],set[2],set[3],set[4],set[5]";if(t)u=" Date.UTC("+u+")";return new Function("date","if (!date) return ''; if (typeof date == 'object') return date; var set=[0,0,1,0,0,0]; "+n+" return new Date("+u+");")},getISOWeek:function(e){if(!e)return false;var t=e.getDay();if(t===0){t=7}var n=new Date(e.valueOf());n.setDate(e.getDate()+(4-t));var r=n.getFullYear();var i=Math.floor((n.getTime()-(new Date(r,0,1)).getTime())/864e5);var s=1+Math.floor(i/7);return s},getUTCISOWeek:function(e){return this.getISOWeek(e)},add:function(e,t,n,r){if(r)e=this.copy(e);switch(n){case"day":e.setDate(e.getDate()+t);break;case"week":e.setDate(e.getDate()+7*t);break;case"month":e.setMonth(e.getMonth()+t);break;case"year":e.setYear(e.getFullYear()+t);break;case"hour":e.setHours(e.getHours()+t);break;case"minute":e.setMinutes(e.getMinutes()+t);break;default:webix.Date.add[n](e,t,n);break}return e},datePart:function(e,t){if(t)e=this.copy(e);e.setHours(0);e.setMinutes(0);e.setSeconds(0);e.setMilliseconds(0);return e},timePart:function(e,t){if(t)e=this.copy(e);return(e.valueOf()/1e3-e.getTimezoneOffset()*60)%86400},copy:function(e){return new Date(e.valueOf())},equal:function(e,t){if(!e||!t)return false;return e.valueOf()===t.valueOf()},isHoliday:function(e){e=e.getDay();if(e===0||e==6)return"webix_cal_event"}};webix.i18n={_dateMethods:["fullDateFormat","timeFormat","dateFormat","longDateFormat","parseFormat"],parseFormat:"%Y-%m-%d",numberFormat:webix.Number.format,priceFormat:function(e){return webix.i18n._price_format(webix.i18n.numberFormat(e,webix.i18n._price_settings))},setLocale:function(e){if(typeof e=="string")e=this.locales[e];if(e)webix.extend(this,e,true);var t=webix.i18n._dateMethods;for(var n=0;n<t.length;n++){var r=t[n];var i=webix.i18n[r+"UTC"];webix.i18n[r+"Str"]=webix.Date.dateToStr(webix.i18n[r],i);webix.i18n[r+"Date"]=webix.Date.strToDate(webix.i18n[r],i)}this._price_format=webix.template(this.price);this._price_settings=this.priceSettings||this;this.intFormat=webix.Number.numToStr({groupSize:this.groupSize,groupDelimiter:this.groupDelimiter,decimalSize:0})}};webix.i18n.locales={};webix.i18n.locales["en-US"]={groupDelimiter:",",groupSize:3,decimalDelimeter:".",decimalSize:2,dateFormat:"%m/%d/%Y",timeFormat:"%h:%i %A",longDateFormat:"%d %F %Y",fullDateFormat:"%m/%d/%Y %h:%i %A",price:"${obj}",priceSettings:{groupDelimiter:",",groupSize:3,decimalDelimeter:".",decimalSize:2},fileSize:["b","Kb","Mb","Gb","Tb","Pb","Eb"],calendar:{monthFull:["January","February","March","April","May","June","July","August","September","October","November","December"],monthShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayFull:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],hours:"Hours",minutes:"Minutes",done:"Done"}};webix.i18n.setLocale("en-US");webix.MapCollection={_build_data_map:function(e){var t=[];for(var n=0;n<e.length;n++){var r=e[n].map;var i=e[n].id;if(!i){i=e[n].id="i"+webix.uid();if(!e[n].header)e[n].header=""}if(r){var s="";var o="";if(r.indexOf("(date)")===0){s="webix.i18n.parseFormatDate(";o=")";if(!e[n].format)e[n].format=webix.i18n.dateFormatStr;r=r.replace("(date)","")}else if(r.indexOf("(number)")===0){s="(";o=")*1";r=r.replace("(number)","")}if(r!==""){r=r.replace(/\{obj\.([^}]*)\}/g,"\"+(obj.$1||'')+\"");r=r.replace(/#([^#'";, ]+)#/gi,"\"+(obj.$1||'')+\"")}else r='"+(obj.'+i+"||'')+\"";t.push("obj."+i+" = "+s+'"'+r+'"'+o+";")}this._map_options(e[n])}if(t.length){try{this.data._scheme_init=Function("obj",t.join("\n"))}catch(u){webix.assert_error("Invalid data map:"+t.join("\n"))}}},_map_options:function(e){var t=e.options||e.collection;if(t){if(typeof t==="string"){var n=webix.$$(t);if(!n){n=new webix.DataCollection({url:t});this._destroy_with_me.push(n)}if(n.getBody)n=n.getBody();this._bind_collection(n,e)}else if(!t.loadNext){if(t[0]&&typeof t[0]=="object"){t=new webix.DataCollection({data:t});this._bind_collection(t,e);this._destroy_with_me.push(t)}else{if(webix.isArray(t)){var r={};for(var i=0;i<t.length;i++)r[t[i]]=t[i];e.options=t=r}e.template=e.template||this._collection_accesser(t,e.id)}}else{this._bind_collection(t,e)}}},_bind_collection:function(e,t){if(t){delete t.options;t.collection=e;t.template=t.template||this._bind_accesser(e,t.id);e.data.attachEvent("onStoreUpdated",webix.bind(this.refresh,this))}},_collection_accesser:function(e,t){return function(n,r){return e[n[t]]||n.value||""}},_bind_accesser:function(e,t){return function(n,r){var i=n[t]||n.value,s=e.data.pull[i];return s?s.value||"":""}}};webix.protoUI({name:"datatable",defaults:{leftSplit:0,rightSplit:0,columnWidth:100,minColumnWidth:20,minColumnHeight:26,prerender:false,autoheight:false,autowidth:false,header:true,fixedRowHeight:true,scrollAlignY:true,datafetch:50},$skin:function(){var e=webix.skin.$active.rowHeight;var t=this.defaults;t.rowHeight=e;t.headerRowHeight=webix.skin.$active.barHeight},on_click:{webix_table_checkbox:function(e,t){t=this.locate(e);var n=this.getItem(t.row);var r=this.getColumnConfig(t.column);var i=n[t.column]!=r.checkValue?r.checkValue:r.uncheckValue;n[t.column]=i;this.callEvent("onCheck",[t.row,t.column,i]);this.data.callEvent("onStoreUpdated",[t.row,n,this._settings.checkboxRefresh?"update":"save"]);return false},webix_table_radio:function(e){var t=this.locate(e);var n=this.getItem(t.row);var r=this.getColumnConfig(t.column);if(this._last_checked_radio[t.column]){var i=this.getItem(this._last_checked_radio[t.column]);if(i)i[t.column]=r.uncheckValue}n[t.column]=r.checkValue;this._last_checked_radio[t.column]=t.row;this.callEvent("onCheck",[t.row,t.column,true]);this.refresh();return false}},on_dblclick:{},on_context:{},$init:function(e){this.on_click=webix.extend({},this.on_click);var t="<div class='webix_ss_header'><div class='webix_hs_left'></div><div class='webix_hs_center'></div><div class='webix_hs_right'></div></div><div class='webix_ss_body'><div class='webix_ss_left'><div class='webix_ss_center_scroll'></div></div>";t+="<div class='webix_ss_center'><div class='webix_ss_center_scroll'></div></div>";t+="<div class='webix_ss_right' ><div class='webix_ss_center_scroll'></div></div></div>";t+="<div class='webix_ss_hscroll'></div><div class='webix_ss_footer'><div class='webix_hs_left'></div><div class='webix_hs_center'></div><div class='webix_hs_right'></div></div><div class='webix_ss_vscroll_header'></div><div class='webix_ss_vscroll'></div><div class='webix_ss_vscroll_footer'></div>";this._contentobj.innerHTML=t;this._top_id=this._contentobj.id=this.name+webix.uid();this._contentobj.className+=" webix_dtable";this._dataobj=this._contentobj;this._header=this._contentobj.firstChild;this._body=this._header.nextSibling;this._footer=this._body.nextSibling.nextSibling;this.data.provideApi(this,true);this.data.attachEvent("onParse",webix.bind(this._call_onparse,this));this.$ready.push(this._first_render);this._columns=[];this._rows_cache=[];this._active_headers={};this._filter_elements={};this._header_height=this._footer_height=0;this._last_checked_radio={};this._destroy_with_me=[];this.data.attachEvent("onServerConfig",webix.bind(this._config_table_from_file,this));this.data.attachEvent("onServerOptions",webix.bind(this._config_options_from_file,this));webix.callEvent("onDataTable",[this,e])},_render_initial:function(){this._scrollSizeX=this._scrollSizeY=webix.ui.scrollSize;webix.html.addStyle("#"+this._top_id+" .webix_cell { height:"+this._settings.rowHeight+"px; line-height:"+(this._settings.rowLineHeight||this._settings.rowHeight)+"px;"+(this._settings.fixedRowHeight?"":"white-space:normal;")+" }");webix.html.addStyle("#"+this._top_id+" .webix_hcell { max-height:"+this._settings.headerRowHeight+"px; line-height:"+this._settings.headerRowHeight+"px;}");this._render_initial=function(){}},_first_render:function(){this.data.attachEvent("onStoreLoad",webix.bind(this.refreshHeaderContent,this));this.data.attachEvent("onSyncApply",webix.bind(this.refreshHeaderContent,this));this.data.attachEvent("onStoreUpdated",webix.bind(this.render,this));this.data.attachEvent("onStoreUpdated",webix.bind(this._refresh_tracking_header_content,this));this.render()},refresh:function(){this.render()},render:function(e,t,n){if(n=="save")return;if(n=="move"){var r=webix.DragControl.getContext();if(r&&r.fragile)return}if(!this._columns.length){if(!this._settings.columns){if(this._settings.autoConfig&&this.data.order.length)this._autoDetectConfig();else return}this._define_structure()}if(!this.isVisible(this._settings.id)||this.$blockRender)return this._render_initial();if(e&&t!=-1&&(n=="paint"||n=="update")){if(this._render_timer)clearTimeout(this._render_timer);if(!this._render_timer)this._render_timer=webix.delay(function(){this.render(e,-1,n)},this);else this._render_timer=webix.delay(function(){this.render()},this);return}else if(this._render_timer)clearTimeout(this._render_timer);if(this.callEvent("onBeforeRender",[this.data])){this._render_initial();if(!this._dtable_fully_ready)this._apply_headers();if(this._content_width)this._check_rendered_cols(true,true);if(!e||n!="update"){this._dtable_height=this._get_total_height();this._set_split_sizes_y()}this.callEvent("onAfterRender",[this.data]);return true}},columns_setter:function(e){this._build_data_map(e);return e},getColumnConfig:function(e){return this._columns_pull[e]||this._hidden_column_hash[e]},_config_options_from_file:function(e){for(var t in e){var n=this.getColumnConfig(t);webix.assert(n,"Orphan collection: "+t);var r=new webix.DataCollection({data:e[t]});this._destroy_with_me.push(r);this._bind_collection(r,n)}},_config_table_from_file:function(){var e=this._settings.columns;if(e&&e.column)this._settings.columns=e.column},_define_structure:function(){if(this._settings.columns){this._columns=this._settings.columns;this._columns_pull={};for(var e=0;e<this._columns.length;e++){var t=this._columns[e];this._columns_pull[t.id]=t;var n=t.cssFormat;if(n)t.cssFormat=webix.toFunctor(n,this.$scope);t.width=t.width||this._settings.columnWidth;if(typeof t.format=="string")t.format=webix.i18n[t.format]||window[t.format];if(webix.isUndefined(t.checkValue))t.checkValue=1;if(webix.isUndefined(t.uncheckValue))t.uncheckValue=0;if(t.css&&typeof t.css=="object")t.css=webix.html.createCss(t.css)}this._normalize_headers("header");this._normalize_headers("footer")}this.callEvent("onStructureLoad",[])},_define_structure_and_render:function(){this._apply_headers()},_apply_headers:function(){this._rightSplit=this._columns.length-this._settings.rightSplit;this._dtable_width=0;for(var e=0;e<this._columns.length;e++){if(!this._columns[e].node){var t=webix.html.create("DIV");t.style.width=this._columns[e].width+"px";this._columns[e].node=t}if(e>=this._settings.leftSplit&&e<this._rightSplit)this._dtable_width+=this._columns[e].width;var n=this._columns[e].template;if(n){if(typeof n=="string")n=n.replace(/#value#/g,"#"+this._columns[e].id+"#");this._columns[e].template=webix.template(n)}}var r=[];if(this._settings.rightSplit){var i=this._columns.length-this._settings.rightSplit;r[i]=" webix_first";r[i-1]=" webix_last"}if(this._settings.leftSplit){var s=this._settings.leftSplit;r[s]=" webix_first";r[s-1]=" webix_last"}r[0]=(r[0]||"")+" webix_first";var o=this._columns.length-1;r[o]=(r[o]||"")+" webix_last";for(var e=0;e<this._columns.length;e++){var u=this._columns[e].node;u.setAttribute("column",e);u.className="webix_column "+(this._columns[e].css||"")+(r[e]||"")}this._create_scrolls();this._set_columns_positions();this._set_split_sizes_x();this._render_header_and_footer();this._dtable_fully_ready=true},_set_columns_positions:function(){var e=0;for(var t=0;t<this._columns.length;t++){var n=this._columns[t];if(t==this._settings.leftSplit||t==this._rightSplit)e=0;if(n.node){n.node.style.left=e+"px";if(this._settings.leftSplit||this._settings.rightSplit){webix.html.remove(n.node);n.attached=false}}e+=n.width}},_render_header_and_footer:function(){if(!this._header_fix_width)this._header_fix_width=0;if(this._settings.header){this._refreshHeaderContent(this._header,0,1);this._header_height=(this._settings.headerRowHeight+1)*this._normalize_headers("header");this._render_header_section(this._header,"header")}if(this._settings.footer){this._refreshHeaderContent(this._footer,0,1);this._footer_height=(this._settings.headerRowHeight+1)*this._normalize_headers("footer");this._render_header_section(this._footer,"footer")}this.refreshHeaderContent();this._size_header_footer_fix()},_normalize_headers:function(e){var t=0;for(var n=0;n<this._columns.length;n++){var r=this._columns[n][e];if(!r||typeof r!="object"||!r.length){if(webix.isUndefined(r)){if(e=="header")r=this._columns[n].id;else r=""}r=[r]}for(var i=0;i<r.length;i++){if(typeof r[i]!="object")r[i]={text:r[i]}}t=Math.max(t,r.length);this._columns[n][e]=r}for(var n=0;n<this._columns.length;n++){var s=this._columns[n][e];for(var i=0;i<s.length;i++){if(s[i]&&s[i].rowspan)for(var o=1;o<s[i].rowspan;o++)s[i+o]=null;if(s[i]&&s[i].colspan)for(var o=1;o<s[i].colspan;o++)this._columns[n+o][e][i]=null}}for(var n=0;n<this._columns.length;n++){var r=this._columns[n][e];if(r.length<t){var u=r.length-1;r[u].rowspan=t-r.length+1;for(var i=u+1;i<t;i++)r[i]=null}}return t},_find_header_content:function(e,t){var n=e.getElementsByTagName("TD");for(var r=0;r<n.length;r++)if(n[r].getAttribute("active_id")==t)return n[r]},getHeaderContent:function(e){var t=this._find_header_content(this._header,e);if(!t)t=this._find_header_content(this._footer,e);if(t){var n=this._active_headers[e];var r=webix.ui.datafilter[n.content];if(r.getHelper)return r.getHelper(t,n);return{getValue:function(){return r.getValue(t)},setValue:function(e){return r.setValue(t,e)}}}},_render_subheader:function(e,t,n,r){if(e==t)return"";var i="<table style='width:"+n+"px' cellspacing='0' cellpadding='0'>";for(var s=e;s<t;s++){i+="<tr>";for(var s=e;s<t;s++)i+="<th  style='width:"+this._columns[s].width+"px'></th>";i+="</tr>"}var o=this._columns[0][r].length;var u=[];for(var a=0;a<o;a++){i+="<tr section='"+r+"'>";for(var s=e;s<t;s++){var f=this._columns[s][r][a];if(f===null)continue;if(f.content){f.contentId=f.contentId||webix.uid();f.columnId=this._columns[s].id;f.format=this._columns[s].format;webix.assert(webix.ui.datafilter,"Filtering extension was not included");webix.assert(webix.ui.datafilter[f.content],"Unknown content type: "+f.content);f.text=webix.ui.datafilter[f.content].render(this,f);this._active_headers[f.contentId]=f;this._has_active_headers=true}i+="<td column='"+(f.colspan?f.colspan-1+s:s)+"'";var l="";if(s==e)l+="webix_first";var c=s+(f.colspan?f.colspan-1:0);if(c>=t-1)l+=" webix_last";if(l)i+=' class="'+l+'"';var h="";if(f.contentId)i+=" active_id='"+f.contentId+"'";if(f.colspan)i+=" colspan='"+f.colspan+"'";if(f.rowspan){i+=" rowspan='"+f.rowspan+"'";var p=(this._settings.headerRowHeight+1)*f.rowspan;h=" style='max-height:"+(p-1)+"px;'";i+=" style='height:"+p+"px;'"}var d="webix_hcell";var v=f.css;if(v){if(typeof v=="object")f.css=v=webix.html.createCss(v);d+=" "+v}if(this._columns[s].$selected)d+=" webix_sel_hcell";i+="><div class='"+d+"'"+h+">";i+=(f.text===""?"&nbsp;":f.text)+"</div></td>"}i+="</tr>"}i+="</tr></table>";return i},showItemByIndex:function(e,t){var n=this._settings.pager;if(n){var r=Math.floor(e/n.size);if(r!=n.page)webix.$$(n.id).select(r)}if(e!=-1){var i=this._get_y_range();if(e<i[0]+1||e>=i[1]-1){var s=this._getHeightByIndexSumm(0,e);if(e<i[0]+1){s=Math.max(0,s-1)}else{s+=this._getHeightByIndex(e)-this._dtable_offset_height;if(e>0)s+=this._getHeightByIndex(e-1)-1}this._y_scroll.scrollTo(s)}}if(t!=-1){if(t<this._settings.leftSplit)return;if(t>=this._rightSplit)return;var i=this._get_x_range();if(t<i[0]+1||t>=i[1]-1){var s=0;for(var o=this._settings.leftSplit;o<t;o++)s+=this._columns[o].width;if(t<i[0]+1){}else{s+=this._columns[t].width-this._center_width}this._x_scroll.scrollTo(s)}}},showCell:function(e,t){if(!t||!e){var n=this.getSelectedId(true);if(n.length==1){t=t||n[0].column;e=e||n[0].row}}t=t?this.getColumnIndex(t):-1;e=e?this.getIndexById(e):-1;this.showItemByIndex(e,t)},scrollTo:function(e,t){if(!this._x_scroll)return;if(this._scrollTo_touch)return this._scrollTo_touch(e,t);if(e!==null)this._x_scroll.scrollTo(e);if(t!==null)this._y_scroll.scrollTo(t)},getScrollState:function(){if(this._getScrollState_touch)return this._getScrollState_touch();var e=this._getHeightByIndexSumm(0,this._render_scroll_top||0);return{x:this._scrollLeft,y:e-(this._render_scroll_shift||0)}},showItem:function(e){this.showItemByIndex(this.getIndexById(e),-1)},_render_header_section:function(e,t){e.childNodes[0].innerHTML=this._render_subheader(0,this._settings.leftSplit,this._left_width,t);e.childNodes[1].innerHTML=this._render_subheader(this._settings.leftSplit,this._rightSplit,this._dtable_width,t);e.childNodes[1].onscroll=webix.bind(this._scroll_with_header,this);e.childNodes[2].innerHTML=this._render_subheader(this._rightSplit,this._columns.length,this._right_width,t)},_scroll_with_header:function(){var e=this.getScrollState().x;var t=this._header.childNodes[1].scrollLeft;if(t!=e)this.scrollTo(t,null)},_refresh_tracking_header_content:function(){this.refreshHeaderContent(true)},refreshHeaderContent:function(e){e=e===true;if(this._settings.header)this._refreshHeaderContent(this._header,e);if(this._settings.footer)this._refreshHeaderContent(this._footer,e)},refreshFilter:function(e){this._refreshHeaderContent(this._header,0,1,e);this._refreshHeaderContent(this._header,0,0,e);this._refreshHeaderContent(this._footer,0,1,e);this._refreshHeaderContent(this._footer,0,0,e)},_refreshHeaderContent:function(e,t,n,r){if(this._has_active_headers&&e){var i=e.getElementsByTagName("TD");for(var s=0;s<i.length;s++){if(i[s].getAttribute("active_id")){var o=this._active_headers[i[s].getAttribute("active_id")];if(r&&r!=o.columnId)continue;var u=webix.ui.datafilter[o.content];if(n)o.value=u.getValue(i[s]);else if(!t||u.trackCells){u.refresh(this,i[s],o)}}}}},headerContent:[],_set_size_scroll_area:function(e,t,n){if(this._scrollSizeY){e.style.height=Math.max(t,1)-1+"px";e.style.width=n+this._scrollSizeY-1+"px"}else e.style.display="none"},_size_header_footer_fix:function(){if(this._settings.header)this._set_size_scroll_area(this._header_scroll,this._header_height,this._header_fix_width);if(this._settings.footer)this._set_size_scroll_area(this._footer_scroll,this._footer_height,this._header_fix_width)},_create_scrolls:function(){this._scrollTop=0;this._scrollLeft=0;var e,t;e=t=1;if(this._settings.autoheight||this._settings.scrollY===false)t=this._scrollSizeY=0;if(this._settings.autowidth||this._settings.scrollX===false)e=this._scrollSizeX=0;if(webix.env.touch)e=t=0;if(!this._x_scroll){this._x_scroll=new webix.ui.vscroll({container:this._footer.previousSibling,scrollWidth:this._dtable_width,scrollSize:this._scrollSizeX,scrollVisible:e});if(e&&!this._scrollSizeX&&!webix.env.$customScroll)this._x_scroll._viewobj.style.position="absolute";this._x_scroll.attachEvent("onScroll",webix.bind(this._onscroll_x,this))}if(!this._y_scroll){this._header_scroll=this._footer.nextSibling;var n=this._header_scroll.nextSibling;this._footer_scroll=n.nextSibling;this._y_scroll=new webix.ui.vscroll({container:n,scrollHeight:100,scroll:"y",scrollSize:this._scrollSizeY,scrollVisible:t});this._y_scroll.activeArea(this._body);this._x_scroll.activeArea(this._body,true);this._y_scroll.attachEvent("onScroll",webix.bind(this._onscroll_y,this))}if(this._content_width)this.callEvent("onResize",[this._content_width,this._content_height]);if(webix.env.$customScroll)webix.CustomScroll._enable_datatable(this);this._create_scrolls=function(){}},columnId:function(e){return this._columns[e].id},getColumnIndex:function(e){for(var t=0;t<this._columns.length;t++)if(this._columns[t].id==e)return t;return-1},_getNodeBox:function(e,t){var n=0,r=0,i=0,s=0;var o;var u=0;for(o=0;o<this._columns.length;o++){if(this._rightSplit==o||this._settings.leftSplit==o){n=0;u++}if(this._columns[o].id==t)break;n+=this._columns[o].width}r+=this._columns[o].width;for(o=0;o<this.data.order.length;o++){if(this.data.order[o]==e)break;s+=this._getHeightByIndex(o)}i+=this._getHeightByIndex(o);return[n,r,s-this._scrollTop,i,this._body.childNodes[u]]},_id_to_string:function(){return this.row},locate:function(e){e=e.target||e.srcElement||e;while(e&&e.getAttribute){if(e.getAttribute("view_id"))break;var t=e.className;var n=null;if(t.indexOf("webix_cell")!=-1){n=this._locate(e);if(n)n.row=this.data.order[n.rind]}if(t.indexOf("webix_hcell")!=-1){n=this._locate(e);if(n)n.header=true}if(n){n.column=this._columns[n.cind].id;n.toString=this._id_to_string;return n}e=e.parentNode}return null},_locate:function(e){var t=e.parentNode;if(!t)return null;var n=t.getAttribute("column")*1;var r=0;for(var i=0;i<t.childNodes.length;i++){if(t.childNodes[i]==e)r=i+this._columns[n]._yr0}return{rind:r,cind:n}},_updateColsSizeSettings:function(e){if(!this._dtable_fully_ready)return;this._set_columns_positions();this._set_split_sizes_x();this._render_header_and_footer();if(!e)this._check_rendered_cols(false,false)},setColumnWidth:function(e,t,n){return this._setColumnWidth(this.getColumnConfig(e),t,n)},_setColumnWidth:function(e,t,n){if(isNaN(t))return;var r=this._columns[e]||e;if(r.minWidth&&t<r.minWidth)t=r.minWidth;else if(t<this._settings.minColumnWidth)t=this._settings.minColumnWidth;var i=r.width;if(i!=t){if(e>=this._settings.leftSplit&&e<this._rightSplit)this._dtable_width+=t-i;r.width=t;if(r.node)r.node.style.width=t+"px";else return false;if(!n)this._updateColsSizeSettings();this.callEvent("onColumnResize",[r.id]);return true}return false},_getHeightByIndex:function(e){var t=this.data.order[e];if(!t)return this._settings.rowHeight;return this.data.pull[t].$height||this._settings.rowHeight},_getHeightByIndexSumm:function(e,t){if(this._settings.fixedRowHeight)return(t-e)*this._settings.rowHeight;else{var n=0;for(;e<t;e++)n+=this._getHeightByIndex(e);return n}},_cellPosition:function(e,t){if(arguments.length==1){t=e.column;e=e.row}var n=this.getItem(e);var r=this.getColumnConfig(t);var i=0;var s=0;for(var o=0;o<this._columns.length;o++){if(o==this._settings.leftSplit||o==this._rightSplit)i=0;var u=this._columns[o];if(u.id==t){var a=o<this._settings.leftSplit?0:o>=this._rightSplit?2:1;s=this._body.childNodes[a].firstChild;break}i+=u.width}var f=this.data.order.length;var l=this._getHeightByIndexSumm(this._render_scroll_top||0,this.getIndexById(e));return{parent:s,top:l+(this._render_scroll_shift||0),left:i,width:r.width,height:n.$height||this._settings.rowHeight}},_get_total_height:function(){var e=this._settings.pager;var t=0;var n=this.data.order.length;if(e){t=e.size*e.page;n=Math.min(n,t+e.size)}return this._getHeightByIndexSumm(t,n)},setRowHeight:function(e,t){if(isNaN(t))return;if(t<this._settings.minColumnHeight)t=this._settings.minColumnHeight;var n=this.getItem(e);var r=n.$height||this._settings.rowHeight;if(r!=t){n.$height=t;this.render();this.callEvent("onRowResize",[e])}},_onscroll_y:function(e){this._body.childNodes[1].scrollTop=this._scrollTop=e;if(!this._settings.prerender){this._check_rendered_cols()}else{var t=this._body.childNodes;for(var n=0;n<t.length;n++){t[n].scrollTop=e}}if(webix.env.$customScroll)webix.CustomScroll._update_scroll(this._body);this.callEvent("onScrollY",[])},_onscroll_x:function(e){this._body.childNodes[1].scrollLeft=this._scrollLeft=e;if(this._settings.header)this._header.childNodes[1].scrollLeft=e;if(this._settings.footer)this._footer.childNodes[1].scrollLeft=e;if(this._settings.prerender===false)this._check_rendered_cols(this._minimize_dom_changes?false:true);if(webix.env.$customScroll)webix.CustomScroll._update_scroll(this._body);this.callEvent("onScrollX",[])},_get_x_range:function(e){if(e)return[0,this._columns.length];var t=this._scrollLeft;var n=this._settings.leftSplit;while(t>0){t-=this._columns[n].width;n++}var r=n;if(t)n--;t+=this._center_width;while(t>0&&r<this._rightSplit){t-=this._columns[r].width;r++}return[n,r]},getVisibleCount:function(){return Math.floor(this._dtable_offset_height/this.config.rowHeight)},_get_y_range:function(e){var t=this._scrollTop;var n=0;var r=this.count();var i=this._settings.pager;if(i){var n=i.page*i.size;var r=Math.min(r,n+i.size)}if(this._settings.autoheight)return[n,r,0];if(e)return[n,r];var s=n;var o=this._settings.fixedRowHeight?this._settings.rowHeight:0;if(o){var u=Math.ceil(t/o);t-=u*o;s+=u}else while(t>0){t-=this._getHeightByIndex(s);s++}var a=s>0?-(this._getHeightByIndex(s-1)+t):0;var f=s;if(t)s--;t+=this._dtable_offset_height||this._content_height;if(o){var u=Math.ceil(t/o);t-=u*o;f+=u;if(f>r)f=r}else while(t>0&&f<r){t-=this._getHeightByIndex(f);f++}return[s,f,a]},_check_rendered_cols:function(e,t){if(!this._columns.length)return;if(t)this._clearColumnCache();if(webix.debug_render)webix.log("Render: "+this.name+"@"+this._settings.id);var n=this._get_x_range(this._settings.prerender);var r=this._get_y_range(this._settings.prerender===true);if(e){for(var i=this._settings.leftSplit;i<n[0];i++)this._hideColumn(i,t);for(var i=n[1];i<this._rightSplit;i++)this._hideColumn(i,t)}this._render_full_rows=[];var s=0;for(var i=0;i<this._settings.leftSplit;i++)s+=this._renderColumn(i,r,t);for(var i=n[0];i<n[1];i++)s+=this._renderColumn(i,r,t,i==n[0]);for(var i=this._rightSplit;i<this._columns.length;i++)s+=this._renderColumn(i,r,t);this._check_and_render_full_rows(r[0],r[1],t);this._check_load_next(r)},_delete_full_rows:function(e,t){this._rows_cache_start=e;this._rows_cache_end=t;webix.html.remove(this._rows_cache);this._rows_cache=[]},_check_and_render_full_rows:function(e,t,n){if(!n&&e==this._rows_cache_start&&t==this._rows_cache_end)return;this._delete_full_rows(e,t);if(this._render_full_row_some)this._render_full_row_some=false;else return;for(var r=0;r<this._render_full_rows.length;r++){var i=this._render_full_rows[r];var s=this.getItem(i.id);var o;if(typeof s.$row=="function"){o=s.$row.call(this,s,this.type)}else{o=this._getValue(s,this.getColumnConfig(s.$row),r)}var u=this._rows_cache[r]=webix.html.create("DIV",null,o);u.className="webix_cell webix_dtable_colrow";u.setAttribute("column",0);u.setAttribute("row",i.index);if(s.$height)u.style.height=s.$height+"px";u.style.top=i.top+"px";this._body.appendChild(u)}},_check_load_next:function(e){var t=this._settings.pager;var n=this._settings.datafetch;var r=!this._last_valid_render_pos||e[0]>=this._last_valid_render_pos;this._last_valid_render_pos=e[0];if(this._data_request_flag){if(t&&(!n||n>=t.size))if(this._check_rows([0,t.size*t.page],Math.max(n,t.size),true))return this._data_request_flag=null;this._run_load_next(this._data_request_flag,r);this._data_request_flag=null}else{if(this._settings.loadahead)var i=this._check_rows(e,this._settings.loadahead,r)}},_check_rows:function(e,t,n){var r=e[1];var i=r+t;if(!n){r=e[0]-t;i=e[0]}if(r<0)r=0;i=Math.min(i,this.data.order.length-1);var s=false;for(var o=r;o<i;o++)if(!this.data.order[o]){if(!s)s={start:o,count:i-r};else{s.last=o;s.count=o-r}}if(s){this._run_load_next(s,n);return true}},_run_load_next:function(e,t){var n=Math.max(e.count,this._settings.datafetch||this._settings.loadahead||0);var r=t?e.start:e.last-n+1;if(this._maybe_loading_already(e.count,e.start))return;this.loadNext(n,r)},_hideColumn:function(e){var t=this._columns[e];webix.html.remove(t.node);t.attached=false},_clearColumnCache:function(){for(var e=0;e<this._columns.length;e++)this._columns[e]._yr0=-1;if(this._rows_cache.length){webix.html.remove(this._rows_cache);this._rows_cache=[]}},getText:function(e,t){return this._getValue(this.getItem(e),this.getColumnConfig(t),0)},_getValue:function(e,t,n){if(!e)return null;var r;r=e[t.id];if(r===webix.undefined)r="";else if(t.format)r=t.format(r);if(t.template)r=t.template(e,this.type,r,t,n);return r},type:{checkbox:function(e,t,n,r){var i=n==r.checkValue?'checked="true"':"";return"<input class='webix_table_checkbox' type='checkbox' "+i+">"},radio:function(e,t,n,r){var i=n==r.checkValue?'checked="true"':"";return"<input class='webix_table_radio' type='radio' "+i+">"},editIcon:function(){return"<span class='webix_icon fa-pencil'></span>"},trashIcon:function(){return"<span class='webix_icon fa-trash'></span>"}},type_setter:function(e){if(!this.types||!this.types[e])webix.type(this,e);else{this.type=webix.clone(this.types[e]);if(this.type.css)this._contentobj.className+=" "+this.type.css}if(this.type.on_click)webix.extend(this.on_click,this.type.on_click);return e},_renderColumn:function(e,t,n,r){var i=this._columns[e];if(!i.attached){var s=e<this._settings.leftSplit?0:e>=this._rightSplit?2:1;this._body.childNodes[s].firstChild.appendChild(i.node);i.attached=true;i.split=s}this._render_scroll_top=t[0];this._render_scroll_shift=0;var o=0;if(this._settings.scrollAlignY){if(t[1]==(this.data.$pagesize||this.data.order.length)){o=this._render_scroll_shift=t[2];i.node.style.top=o+"px"}else if(i._yr2)i.node.style.top="0px"}else if(t[2]!=i._yr2){o=t[2];i.node.style.top=o+"px"}if(!n&&i._yr0==t[0]&&i._yr1==t[1])return 0;var u="";var a=this._settings.columns[e];var f=a.$selected;var l=this._settings.rowHeight;for(var c=t[0];c<t[1];c++){var h=this.data.order[c];var p=this.data.getItem(h);var d;if(p){if(r&&p.$row){this._render_full_row_some=true;this._render_full_rows.push({top:o,id:p.id,index:c});u+="<div class='webix_cell'></div>";o+=l;continue}var d=this._getValue(p,a,c);var v="webix_cell";if(a.cssFormat){var m=a.cssFormat(d,p,h,a.id);if(m){if(typeof m=="object")v+=" "+webix.html.createCss(m);else v+=" "+m}}var g=p.$css;if(g){if(typeof g=="object")p.$css=g=webix.html.createCss(g);v+=" "+g}var y=this.data._marks[h];if(y){if(y.$css)v+=" "+y.$css;if(y.$cellCss){var b=y.$cellCss[a.id];if(b)v+=" "+b}}if(p.$cellCss){var w=p.$cellCss[a.id];if(w){if(typeof w=="object")w=webix.html.createCss(w);v+=" "+w}}var E=this.data.getMark(p.id,"webix_selected");if(E&&(E.$row||E[a.id])||f)v+=this._select_css;if(p.$height){u+="<div class='"+v+"' style='height:"+p.$height+"px'>"+d+"</div>";o+=p.$height-l}else{u+="<div class='"+v+"'>"+d+"</div>"}}else{u+="<div class='webix_cell'></div>";if(!this._data_request_flag)this._data_request_flag={start:c,count:t[1]-c};else this._data_request_flag.last=c}o+=l}i.node.innerHTML=u;i._yr0=t[0];i._yr1=t[1];i._yr2=t[2];return 1},_set_split_sizes_y:function(){if(!this._columns.length||isNaN(this._content_height*1))return;webix.debug_size_box(this,["y-sizing"],true);var e=this._dtable_height+(this._scrollSizeX?this._scrollSizeX:0);if((this._settings.autoheight||this._settings.yCount)&&this.resize())return;this._y_scroll.sizeTo(this._content_height,this._header_height,this._footer_height);this._y_scroll.define("scrollHeight",e);this._dtable_offset_height=this._content_height-this._scrollSizeX-this._header_height-this._footer_height;for(var t=0;t<3;t++){this._body.childNodes[t].style.height=this._dtable_offset_height+"px";if(this._settings.prerender)this._body.childNodes[t].firstChild.style.height=this._dtable_height+"px";else this._body.childNodes[t].firstChild.style.height=this._dtable_offset_height+"px"}},_set_split_sizes_x:function(){if(!this._columns.length)return;if(webix.debug_size)webix.log("  - "+this.name+"@"+this._settings.id+" X sizing");var e=0;this._left_width=0;this._right_width=0;this._center_width=0;while(e<this._settings.leftSplit){this._left_width+=this._columns[e].width;e++}e=this._columns.length-1;while(e>=this._rightSplit){this._right_width+=this._columns[e].width;e--}if(!this._content_width)return;if(this._settings.autowidth&&this.resize())return;this._center_width=this._content_width-this._right_width-this._left_width-this._scrollSizeY;this._body.childNodes[1].firstChild.style.width=this._dtable_width+"px";this._body.childNodes[0].style.width=this._left_width+"px";this._body.childNodes[1].style.width=this._center_width+"px";this._body.childNodes[2].style.width=this._right_width+"px";this._header.childNodes[0].style.width=this._left_width+"px";this._header.childNodes[1].style.width=this._center_width+"px";this._header.childNodes[2].style.width=this._right_width+"px";this._footer.childNodes[0].style.width=this._left_width+"px";this._footer.childNodes[1].style.width=this._center_width+"px";this._footer.childNodes[2].style.width=this._right_width+"px";var t=this._center_width-this._dtable_width;if(t<0)t=0;if(t!=this._header_fix_width){this._header_fix_width=t;this._size_header_footer_fix()}this._x_scroll.sizeTo(this._content_width-this._scrollSizeY);this._x_scroll.define("scrollWidth",this._dtable_width+this._left_width+this._right_width)},$getSize:function(e,t){if((this._settings.autoheight||this._settings.yCount)&&this._settings.columns){var n=(this._settings.yCount||0)*this._settings.rowHeight;if(!n)n=this.isVisible()?this._dtable_height:this.count()*this._settings.rowHeight;this._settings.height=Math.max(n+(this._scrollSizeX?this._scrollSizeX:0)-1,this._settings.minHeight||0)+this._header_height+this._footer_height}if(this._settings.autowidth&&this._settings.columns)this._settings.width=Math.max(this._dtable_width+this._left_width+this._right_width+this._scrollSizeY,this._settings.minWidth||0);var r=this._left_width+this._right_width+this._scrollSizeY;var i=webix.ui.view.prototype.$getSize.call(this,e,t);i[0]=Math.max(i[0]||r);return i},$setSize:function(e,t){if(webix.ui.view.prototype.$setSize.apply(this,arguments)){if(this._dtable_fully_ready){this.callEvent("onResize",[this._content_width,this._content_height]);this._set_split_sizes_x();this._set_split_sizes_y()}this.render()}},_on_header_click:function(e){var t=this.getColumnConfig(e);if(!t.sort)return;var n="asc";if(t.id==this._last_sorted)n=this._last_order=="asc"?"desc":"asc";this._sort(t.id,n,t.sort)},markSorting:function(e,t){if(!this._sort_sign)this._sort_sign=webix.html.create("DIV");webix.html.remove(this._sort_sign);if(t){var n=this._get_header_cell(this.getColumnIndex(e));this._sort_sign.className="webix_ss_sort_"+t;n.style.position="relative";n.appendChild(this._sort_sign)}},scroll_setter:function(e){return this._settings.scrollX=this._settings.scrollY=e},_get_header_cell:function(e){var t=this._header.getElementsByTagName("TD");for(var n=t.length-1;n>=0;n--)if(t[n].getAttribute("column")==e&&!t[n].getAttribute("active_id"))return t[n].firstChild;return null},_sort:function(e,t,n){this._last_sorted=e;this._last_order=t;this.markSorting(e,t);if(n=="server"){this.loadNext(-1,0,{before:function(){var e=this.data.url;this.clearAll();this.data.url=e}},0,1)}else{if(n=="text"){this.data.each(function(t){t.$text=this.getText(t.id,e)},this);n="string";e="$text"}if(typeof n=="function")this.data.sort(n,t||"asc");else this.data.sort(e,t||"asc",n||"string")}},_mouseEvent:function(e,t,n){e=e||event;var r=e.target||e.srcElement;var i=[];var s="";var o=null;var u=false;while(r&&r.parentNode){if(s=r.className){s=s.split(" ");for(var a=s.length-1;a>=0;a--)if(t[s[a]])i.push(t[s[a]])}if(r.parentNode.getAttribute){var f=r.parentNode.getAttribute("column")||r.getAttribute("column");if(f){var l=r.parentNode.tagName=="DIV";u=true;if(l){var c=r.parentNode.getAttribute("row")||webix.html.index(r)+this._columns[f]._yr0;this._item_clicked=o={row:this.data.order[c],column:this._columns[f].id};o.toString=this._id_to_string}else this._item_clicked=o={column:this._columns[f].id};if(i.length){for(var a=0;a<i.length;a++){var h=webix.toFunctor(i[a],this.$scope);var p=h.call(this,e,o,r);if(p===false)return}}if(l)this.callEvent("on"+n,[o,e,r]);else if(n=="ItemClick"){var d=r.parentNode.parentNode.getAttribute("section")=="header";if(d&&this.callEvent("onHeaderClick",[o,e,r]))this._on_header_click(o.column)}break}}r=r.parentNode}return u},showOverlay:function(e){if(!this._datatable_overlay){var t=webix.html.create("DIV",{"class":"webix_datatable_overlay"},"");this._body.appendChild(t);this._datatable_overlay=t}this._datatable_overlay.innerHTML=e},hideOverlay:function(){if(this._datatable_overlay){webix.html.remove(this._datatable_overlay);this._datatable_overlay=null}},mapCells:function(e,t,n,r,i){if(e===null&&this.data.order.length>0)e=this.data.order[0];if(t===null)t=this.columnId(0);if(n===null)n=this.data.order.length;if(r===null)r=this._settings.columns.length;if(!this.exists(e))return;e=this.getIndexById(e);t=this.getColumnIndex(t);if(t===null)return;for(var s=0;s<n&&e+s<this.data.order.length;s++){var o=e+s;var u=this.data.order[o];var a=this.getItem(u);for(var f=0;f<r&&t+f<this._settings.columns.length;f++){var l=t+f;var c=this.columnId(l);a[c]=i(a[c],u,c,s,f)}}},_call_onparse:function(e,t){if(!this._settings.columns&&e.getConfig)this.define("columns",e.getConfig(t))},_autoDetectConfig:function(){var e=this.getItem(this.getFirstId());var t=this._settings.columns=[];for(var n in e)if(n!="id")t.push({id:n,header:n[0].toUpperCase()+n.substr(1),sort:"string",editor:"text"});if(t.length)t[0].fillspace=true;if(typeof this._settings.select=="undefined")this.define("select","row")}},webix.AutoTooltip,webix.Group,webix.DataMarks,webix.DataLoader,webix.MouseEvents,webix.MapCollection,webix.ui.view,webix.EventSystem,webix.Settings);webix.ui.datafilter={textWaitDelay:500,summColumn:{getValue:function(){},setValue:function(){},refresh:function(e,t,n){var r=0;e.mapCells(null,n.columnId,null,1,function(e){e=e*1;if(!isNaN(e))r+=e;return e});if(n.format)r=n.format(r);if(n.template)r=n.template({value:r});t.firstChild.innerHTML=r},trackCells:true,render:function(e,t){if(t.template)t.template=webix.template(t.template);return""}},masterCheckbox:{getValue:function(){},setValue:function(){},getHelper:function(e,t){return{check:function(){t.checked=false;e.onclick()},uncheck:function(){t.checked=true;e.onclick()},isChecked:function(){return t.checked}}},refresh:function(e,t,n){t.onclick=function(){this.getElementsByTagName("input")[0].checked=n.checked=!n.checked;var t=e.getColumnConfig(n.columnId);var r=n.checked?t.checkValue:t.uncheckValue;e.data.each(function(t){t[n.columnId]=r;e.callEvent("onCheck",[t.id,n.columnId,r]);this.callEvent("onStoreUpdated",[t.id,t,"save"])});e.refresh()}},render:function(e,t){return"<input type='checkbox' "+(t.checked?"checked='1'":"")+">"}},textFilter:{getInputNode:function(e){return e.firstChild.firstChild},getValue:function(e){return this.getInputNode(e).value},setValue:function(e,t){this.getInputNode(e).value=t},refresh:function(e,t,n){t.component=e._settings.id;e.registerFilter(t,n,this);t._comp_id=e._settings.id;if(n.value)this.setValue(t,n.value);t.onclick=webix.html.preventEvent;webix.event(t,"keydown",this._on_key_down)},render:function(e,t){if(this.init)this.init(t);t.css="webix_ss_filter";return"<input "+(t.placeholder?'placeholder="'+t.placeholder+'" ':"")+"type='text'>"},_on_key_down:function(e,t,n){var r=this._comp_id;if((e.which||e.keyCode)==9)return;if(this._filter_timer)window.clearTimeout(this._filter_timer);this._filter_timer=window.setTimeout(function(){webix.$$(r).filterByAll()},webix.ui.datafilter.textWaitDelay)}},selectFilter:{getInputNode:function(e){return e.firstChild.firstChild},getValue:function(e){return this.getInputNode(e).value},setValue:function(e,t){this.getInputNode(e).value=t},refresh:function(e,t,n){n.compare=n.compare||function(e,t){return e==t};t.component=e._settings.id;e.registerFilter(t,n,this);var r;if(n.options)r=n.options;else r=e.collectValues(n.columnId);var i="";for(var s=0;s<r.length;s++)i+="<option value='"+r[s].id+"'>"+r[s].value+"</option>";t.firstChild.innerHTML="<select>"+i+"</select>";if(n.value)this.setValue(t,n.value);t.onclick=webix.html.preventEvent;var o=t.firstChild.firstChild;o._comp_id=e._settings.id;webix.event(o,"change",this._on_change)},render:function(e,t){if(this.init)this.$init(t);t.css="webix_ss_filter";return""},_on_change:function(e,t,n){webix.$$(this._comp_id).filterByAll()}}};webix.ui.datafilter.serverFilter=webix.extend({_on_key_down:function(e,t,n){var r=this._comp_id;if((e.which||e.keyCode)==9)return;if(this._filter_timer)window.clearTimeout(this._filter_timer);this._filter_timer=window.setTimeout(function(){webix.$$(r).loadNext(-1,0,{before:function(){var e=this.data.url;this.clearAll();this.data.url=e}},0,1)},webix.ui.datafilter.textWaitDelay)}},webix.ui.datafilter.textFilter);webix.ui.datafilter.numberFilter=webix.extend({init:function(e){e.prepare=function(t,n){var r=t.indexOf("=")!=-1?1:0;var i=this.format(t);if(i==="")return"";if(t.indexOf(">")!=-1)e.compare=this._greater;else if(t.indexOf("<")!=-1){e.compare=this._lesser;r*=-1}else{e.compare=this._equal;r=0}return i-r}},format:function(e){return e.replace(/[^0-9]/g,"")},_greater:function(e,t){return e*1>t},_lesser:function(e,t){return e*1<t},_equal:function(e,t){return e*1==t}},webix.ui.datafilter.textFilter);webix.ui.datafilter.dateFilter=webix.extend({format:function(e){if(e==="")return"";var t=new Date;if(e.indexOf("today")!=-1){t=webix.Date.dayStart(t)}else if(e.indexOf("now")==-1){var n=e.match(/[0-9]+/g);if(!n||!n.length)return"";if(n.length<3){n.reverse();t=new Date(n[0],(n[1]||1)-1,1)}else t=webix.i18n.dateFormatDate(e.replace(/^[>< =]+/,""))}return t.valueOf()}},webix.ui.datafilter.numberFilter);webix.extend(webix.ui.datatable,{filterByAll:function(){this.data.silent(function(){this.filter();var e=false;for(var t in this._filter_elements){webix.assert(t,"empty column id for column with filtering");var n=this._filter_elements[t];var r=n[2].getValue(n[0]);if(n[1].prepare)r=n[1].prepare.call(n[2],r,n[1],this);n.value=r;var i=n[1].compare;if(!this.callEvent("onBeforeFilter",[t,r,n[1]]))continue;if(r==="")continue;if(i)this.filter(function(e,n){if(!e)return false;var r=e[t];return i(r,n,e)},r,e);else this.filter(t,r,e);e=true}},this);this.refresh();this.callEvent("onAfterFilter",[])},filterMode_setter:function(e){return webix.extend(this.data._filterMode,e,true)},getFilter:function(e){var t=this._filter_elements[e];webix.assert(t,"Filter doesn't exists for column in question");return t[2].getInputNode(t[0])},registerFilter:function(e,t,n){this._filter_elements[t.columnId]=[e,t,n]},collectValues:function(e){var t=[{id:"",value:""}];var n={"":true};var r=this.getColumnConfig(e);var i=r.options||r.collection;if(i){if(typeof i=="object"&&!i.loadNext){if(webix.isArray(i))for(var s=0;s<i.length;s++)t.push({id:i[s],value:i[s]});else for(var o in i)t.push({id:o,value:i[o]});return t}else{if(typeof i==="string")i=webix.$$(i);if(i.getBody)i=i.getBody();this._collectValues.call(i,"id","value",t,n)}}else this._collectValues(r.id,r.id,t,n);return t},_collectValues:function(e,t,n,r){this.data.each(function(i){var s=i?i[t]:"";if(!r[s]){r[s]=true;n.push({id:i[e],value:s})}},this,true);n.sort(function(e,t){return e.value>t.value?1:-1})}});webix.extend(webix.ui.datatable,{select_setter:function(e){if(!this.select&&e){webix.extend(this,this._selections._commonselect,true);if(e===true)e="row";else if(e=="multiselect"){e="row";this._settings.multiselect=true}webix.assert(this._selections[e],"Unknown selection mode: "+e);webix.extend(this,this._selections[e],true)}return e},getSelectedId:function(e){return e?[]:""},_selections:{_commonselect:{_select_css:" webix_cell_select",$init:function(){this._reinit_selection();this.on_click.webix_cell=webix.bind(this._click_before_select,this);this._data_cleared=this._data_filtered=function(){this.unselect()};this.data.attachEvent("onStoreUpdated",webix.bind(this._data_updated,this));this.data.attachEvent("onClearAll",webix.bind(this._data_cleared,this));this.data.attachEvent("onAfterFilter",webix.bind(this._data_filtered,this));this.data.attachEvent("onIdChange",webix.bind(this._id_changed,this))},_id_changed:function(e,t){for(var n=0;n<this._selected_rows.length;n++)if(this._selected_rows[n]==e)this._selected_rows[n]=t;for(var n=0;n<this._selected_areas.length;n++){var r=this._selected_areas[n];if(r.row==e){e=this._select_key(r);r.row=t;t=this._select_key(r);r.id=t;delete this._selected_pull[e];this._selected_pull[t]=true}}},_data_updated:function(e,t,n){if(n=="delete")this.unselect(e)},_reinit_selection:function(){this._selected_areas=[];this._selected_pull={};this._selected_rows=[]},getSelectedId:function(e,t){var n;if(this._selected_areas.length>1||e){n=[].concat(this._selected_areas);if(t)for(var r=0;r<n.length;r++)n[r]=n[r].id}else{n=this._selected_areas[0];if(t&&n)return n.id}return n},_id_to_string:function(){return this.row},_select:function(e,t){var n=this._select_key(e);if(n===null)return;e.id=n;e.toString=this._id_to_string;if(!this.callEvent("onBeforeSelect",[e,t]))return false;if(this._selected_pull[n]&&(t||this._selected_areas.length==1))return;if(!t)this._clear_selection();this._selected_areas.push(e);this._selected_pull[n]=true;this.callEvent("onAfterSelect",[e,t]);this._finalize_select(this._post_select(e));return true},_clear_selection:function(){if(!this._selected_areas.length)return false;for(var e=0;e<this._selected_rows.length;e++){var t=this.getItem(this._selected_rows[e]);if(t)this.data.removeMark(t.id,"webix_selected",0,1)}var n=this._settings.columns;if(n)for(var e=0;e<n.length;e++){n[e].$selected=null}this._reinit_selection();return true},clearSelection:function(){if(this._clear_selection()){this.callEvent("onSelectChange",[]);this.render()}},_unselect:function(e){var t=this._select_key(e);if(!t&&this._selected_areas.length){this.clearSelection();this.callEvent("onSelectChange",[])}if(!this._selected_pull[t])return;if(!this.callEvent("onBeforeUnSelect",[e]))return false;for(var n=0;n<this._selected_areas.length;n++){if(this._selected_areas[n].id==t){this._selected_areas.splice(n,1);break}}delete this._selected_pull[t];this.callEvent("onAfterUnselect",[e]);this._finalize_select(0,this._post_unselect(e))},_add_item_select:function(e){var t=this.getItem(e);return this.data.addMark(t.id,"webix_selected",0,{$count:0},true)},_finalize_select:function(e){if(e)this._selected_rows.push(e);if(!this._silent_selection){this.render();this.callEvent("onSelectChange",[])}},_click_before_select:function(e,t){var n=e.ctrlKey||this._settings.multiselect=="touch";var r=e.shiftKey;if(!this._settings.multiselect&&this._settings.select!="multiselect")n=r=false;if(r&&this._selected_areas.length){var i=this._selected_areas[this._selected_areas.length-1];this._selectRange(t,i)}else{if(n&&this._selected_pull[this._select_key(t)])this._unselect(t);else this._select({row:t.row,column:t.column},n)}},_mapSelection:function(e,t,n){var r=this._settings.columns;if(t){var i=[];for(var s=0;s<r.length;s++)if(r[s].$selected)i.push(r[s]);r=i}var o=this.data.order;var u=0;for(var s=0;s<o.length;s++){var a=this.getItem(o[s]);if(!a)continue;var f=this.data.getMark(a.id,"webix_selected");if(f||t){var l=0;for(var c=0;c<r.length;c++){var h=r[c].id;if(n||t||f[h]){if(e)a[h]=e(a[h],o[s],h,u,l);else return{row:o[s],column:h};l++}}u++}}}},row:{_select_css:" webix_row_select",_select_key:function(e){return e.row},select:function(e,t){webix.assert(this.data.exists(e),"Incorrect id in select command: "+e);this._select({row:e},t)},_post_select:function(e){this._add_item_select(e.row).$row=true;return e.row},unselect:function(e){this._unselect({row:e})},_post_unselect:function(e){this.data.removeMark(e.row,"webix_selected",0,1);return e.row},mapSelection:function(e){return this._mapSelection(e,false,true)},_selectRange:function(e,t){return this.selectRange(e.row,t.row)},selectRange:function(e,t){var n=this.getIndexById(e);var r=this.getIndexById(t);if(n>r){var i=n;n=r;r=i}this._silent_selection=true;for(var s=n;s<=r;s++)this.select(this.getIdByIndex(s),true);this._silent_selection=false;this._finalize_select()}},cell:{_select_key:function(e){if(!e.column)return null;return e.row+"_"+e.column},select:function(e,t,n){webix.assert(this.data.exists(e),"Incorrect id in select command: "+e);this._select({row:e,column:t},n)},_post_select:function(e){var t=this._add_item_select(e.row);t.$count++;t[e.column]=true;return e.row},unselect:function(e,t){this._unselect({row:e,column:t})},_post_unselect:function(e){var t=this._add_item_select(e.row);t.$count--;t[e.column]=false;if(t.$count<=0)this.data.removeMark(e.row,"webix_selected");return e.row},mapSelection:function(e){return this._mapSelection(e,false,false)},_selectRange:function(e,t){return this.selectRange(e.row,e.column,t.row,t.column)},selectRange:function(e,t,n,r){var i=this.getIndexById(e);var s=this.getIndexById(n);var o=this.getColumnIndex(t);var u=this.getColumnIndex(r);if(i>s){var a=i;i=s;s=a}if(o>u){var a=o;o=u;u=a}this._silent_selection=true;for(var f=i;f<=s;f++)for(var l=o;l<=u;l++)this.select(this.getIdByIndex(f),this.columnId(l),true);this._silent_selection=false;this._finalize_select()}},column:{_select_css:" webix_column_select",_select_key:function(e){return e.column},_id_to_string:function(){return this.column},select:function(e,t){this._select({column:e},t)},_post_select:function(e){this._settings.columns[this.getColumnIndex(e.column)].$selected=true;if(!this._silent_selection)this._render_header_and_footer()},unselect:function(e){this._unselect({column:e})},_post_unselect:function(e){this._settings.columns[this.getColumnIndex(e.column)].$selected=null;this._render_header_and_footer()},mapSelection:function(e){return this._mapSelection(e,true,false)},_selectRange:function(e,t){return this.selectRange(e.column,t.column)},selectRange:function(e,t){var n=this.getColumnIndex(e);var r=this.getColumnIndex(t);if(n>r){var i=n;n=r;r=i}this._silent_selection=true;for(var s=n;s<=r;s++)this.select(this.columnId(s),true);this._silent_selection=false;this._render_header_and_footer();this._finalize_select()}}}});webix.extend(webix.ui.datatable,{blockselect_setter:function(e){if(e&&this._block_sel_flag){webix.event(this._viewobj,"mousemove",this._bs_move,this);webix.event(this._viewobj,"mousedown",this._bs_down,this);webix.event(document.body,"mouseup",this._bs_up,this);this._block_sel_flag=this._bs_ready=this._bs_progress=false}return e},_block_sel_flag:true,_childOf:function(e,t){var n=e.target||e.srcElement;while(n){if(n==t)return true;n=n.parentNode}return false},_bs_down:function(e){if(this._childOf(e,this._body)){this._bs_position=webix.html.offset(this._body);var t=webix.html.pos(e);this._bs_ready=[t.x-this._bs_position.x,t.y-this._bs_position.y]}},_bs_up:function(){if(this._block_panel){var e=this._locate_cell_xy.apply(this,this._bs_ready);var t=this._locate_cell_xy.apply(this,this._bs_progress);this._selectRange(e,t);this._block_panel=webix.html.remove(this._block_panel)}this._bs_ready=this._bs_progress=false},_bs_start:function(){this.clearSelection();this._block_panel=webix.html.create("div",{"class":"webix_block_selection"},"");this._body.appendChild(this._block_panel)},_bs_move:function(e){if(this._bs_ready!==false){if(this._bs_progress===false)this._bs_start(e);var t=webix.html.pos(e);this._bs_progress=[t.x-this._bs_position.x,t.y-this._bs_position.y];this._setBlockPosition(this._bs_ready[0],this._bs_ready[1],this._bs_progress[0],this._bs_progress[1])}},_setBlockPosition:function(e,t,n,r){var i=this._block_panel.style;var s=Math.min(e,n);var o=Math.max(e,n);var u=Math.min(t,r);var a=Math.max(t,r);i.left=s+"px";i.top=u+"px";i.width=o-s+"px";i.height=a-u+"px"},_locate_cell_xy:function(e,t){if(this._right_width&&e>this._left_width+this._center_width)e+=this._x_scroll.getSize()-this._center_width-this._left_width-this._right_width;else if(!this._left_width||e>this._left_width)e+=this._x_scroll.getScroll();t+=this._y_scroll.getScroll();var n=null;var r=null;if(e<0)e=0;if(t<0)t=0;var i=this._settings.columns;var s=this.data.order;var o=0;for(var u=0;u<i.length;u++){o+=i[u].width;if(o>=e){r=i[u].id;break}}if(!r)r=i[i.length-1].id;if(this._settings.fixedRowHeight){n=s[Math.floor(t/this._settings.rowHeight)]}else for(var u=0;u<s.length;u++){o+=this._getHeightByIndex(u);if(o>=t){n=s[u];break}}if(!n)n=s[s.length-1];return{row:n,column:r}}});webix.protoUI({name:"resizearea",defaults:{dir:"x"},$init:function(e){var t=e.dir||"x";var n=webix.toNode(e.container);var r=t=="x"?"width":"height";var i=e.margin?e.margin+"px":0;this._key_property=t=="x"?"left":"top";this._viewobj=webix.html.create("DIV",{"class":"webix_resize_area webix_dir_"+t});webix.event(this._viewobj,webix.env.mouse.down,webix.html.stopEvent);if(i){if(t=="x")i=i+" 0 "+i;else i="0 "+i+" 0 "+i}this._dragobj=webix.html.create("DIV",{"class":"webix_resize_handle_"+t,style:i?"padding:"+i:""},"<div class='webix_handle_content'></div>");this._originobj=webix.html.create("DIV",{"class":"webix_resize_origin_"+t});if(e[r]){this._originobj.style[r]=e[r]+(e.border?1:0)+"px";this._dragobj.style[r]=e[r]+"px"}if(e.cursor)this._dragobj.style.cursor=this._originobj.style.cursor=this._viewobj.style.cursor=e.cursor;this._moveev=webix.event(n,webix.env.mouse.move,this._onmove,this);this._upev=webix.event(document.body,webix.env.mouse.up,this._onup,this);this._dragobj.style[this._key_property]=this._originobj.style[this._key_property]=e.start+"px";n.appendChild(this._viewobj);n.appendChild(this._dragobj);n.appendChild(this._originobj)},_onup:function(){this.callEvent("onResizeEnd",[this._last_result]);webix.eventRemove(this._moveev);webix.eventRemove(this._upev);webix.html.remove(this._viewobj);webix.html.remove(this._dragobj);webix.html.remove(this._originobj);this._viewobj=this._dragobj=this._originobj=null},_onmove:function(e){var t=webix.html.pos(e);this._last_result=(this._settings.dir=="x"?t.x:t.y)+this._settings.start-this._settings.eventPos;this._dragobj.style[this._key_property]=this._last_result+"px";this.callEvent("onResize",[this._last_result])}},webix.EventSystem,webix.Settings);webix.extend(webix.ui.datatable,{resizeRow_setter:function(e){this._settings.scrollAlignY=false;this._settings.fixedRowHeight=false;return this.resizeColumn_setter(e)},resizeColumn_setter:function(e){if(e&&this._rs_init_flag){webix.event(this._viewobj,"mousemove",this._rs_move,this);webix.event(this._viewobj,"mousedown",this._rs_down,this);webix.event(this._viewobj,"mouseup",this._rs_up,this);this._rs_init_flag=false}return e},_rs_init_flag:true,_rs_down:function(e){if(!this._rs_ready)return;this._rs_process=[webix.html.pos(e),this._rs_ready[2]];webix.html.denySelect()},_rs_up:function(){this._rs_process=false;webix.html.allowSelect()},_rs_start:function(e){e=e||event;if(this._rs_progress)return;var t=this._rs_ready[0];var n=this._rs_process[1];var r=this._locate(n);var i=this._rs_process[0];var s;if(t=="x"){s=webix.html.offset(n).x+this._rs_ready[1]-webix.html.offset(this._body).x;i=i.x;if(!this._rs_ready[1])r.cind-=n.parentNode.colSpan||1}else{s=webix.html.offset(n).y+this._rs_ready[1]-webix.html.offset(this._body).y+this._header_height;i=i.y;if(!this._rs_ready[1])r.rind--}if(r.cind>=0&&r.rind>=0){this._rs_progress=[t,r,s];var o=new webix.ui.resizearea({container:this._viewobj,dir:t,eventPos:i,start:s,cursor:(t=="x"?"e":"n")+"-resize"});o.attachEvent("onResizeEnd",webix.bind(this._rs_end,this))}this._rs_down=this._rs_ready=false},_rs_end:function(e){if(this._rs_progress){var t=this._rs_progress[0];var n=this._rs_progress[1];var r=e-this._rs_progress[2];if(t=="x"){if(this._settings.rightSplit&&n.cind+1>=this._rightSplit){n.cind++;r*=-1}var i=this._columns[n.cind].width;this._setColumnWidth(n.cind,i+r)}else{var s=this.getIdByIndex(n.rind);var o=this.getItem(s).$height||this._settings.rowHeight;this.setRowHeight(s,o+r)}this._rs_up()}this._rs_progress=null},_rs_move:function(e){if(this._rs_ready&&this._rs_process)return this._rs_start(e);e=e||event;var t=e.target||e.srcElement;var n=false;if(t.tagName=="TD"||t.tagName=="TABLE")return;var r=t.className||"";var i=r.indexOf("webix_cell")!=-1;if(i&&this.config.drag)return;var s=r.indexOf("webix_hcell")!=-1;this._rs_ready=false;if(i||s){var o=t.offsetWidth;var u=t.offsetHeight;var a=webix.html.posRelative(e);if(i&&this._settings.resizeRow){if(a.y<3){this._rs_ready=["y",0,t];n="n-resize"}else if(u-a.y<4){this._rs_ready=["y",u,t];n="n-resize"}}if(this._settings.resizeColumn){if(a.x<3){this._rs_ready=["x",0,t];n="e-resize"}else if(o-a.x<4){this._rs_ready=["x",o,t];n="e-resize"}}}if(this._cursor_timer)window.clearTimeout(this._cursor_timer);this._cursor_timer=webix.delay(this._mark_resize_ready,this,[n],n?100:0)},_mark_resize_ready:function(e){if(this._last_cursor_mode!=e){this._last_cursor_mode=e;this._viewobj.style.cursor=e||"default"}}});webix.extend(webix.ui.datatable,webix.PagingAbility);webix.csv={escape:true,delimeter:{rows:"\n",cols:"	"},parse:function(e,t){t=t||this.delimeter;if(!this.escape)return this._split_clip_data(e,t);var n=e.split(t.rows);var r=0;while(r<n.length-1){if(this._substr_count(n[r],'"')%2===1){n[r]+=t.rows+n[r+1];delete n[r+1];r++}r++}var i=[];for(r=0;r<n.length;r++){if(typeof n[r]!=="undefined"){var s=n[r].split(t.cols);for(var o=0;o<s.length;o++){if(s[o].indexOf('"')===0)s[o]=s[o].substr(1,s[o].length-2);s[o]=s[o].replace('""','"')}i.push(s)}}return i},_split_clip_data:function(e,t){var n=e.split(t.rows);for(var r=0;r<n.length;r++){n[r]=n[r].split(t.cols)}return n},_substr_count:function(e,t){var n=e.split(t);return n.length-1},stringify:function(e,t){t=t||this.delimeter;if(!this.escape){for(var n=0;n<e.length;n++)e[n]=e[n].join(t.cols);return e.join(t.rows)}var r=/\n|\"|;|,/;for(var n=0;n<e.length;n++){for(var i=0;i<e[n].length;i++){if(r.test(e[n][i])){e[n][i]=e[n][i].replace(/"/g,'""');e[n][i]='"'+e[n][i]+'"'}}e[n]=e[n].join(t.cols)}e=e.join(t.rows);return e}};webix.TablePaste={clipboard_setter:function(e){if(e===true||e===1)this._settings.clipboard="block";webix.clipbuffer.init();this.attachEvent("onSelectChange",this._sel_to_clip);this.attachEvent("onPaste",this._clip_to_sel);return e},_sel_to_clip:function(){var e=this._get_sel_text();webix.clipbuffer.set(e);webix.UIManager.setFocus(this)},_get_sel_text:function(){var e=[];this.mapSelection(function(t,n,r,i,s){if(!e[i])e[i]=[];e[i].push(t);return t});return webix.csv.stringify(e,this._settings.delimiter)},_clip_to_sel:function(e){if(!webix.isUndefined(this._paste[this._settings.clipboard])){var t=webix.csv.parse(e,this._settings.delimiter);this._paste[this._settings.clipboard].call(this,t)}},_paste:{block:function(e){var t=this.mapSelection(null);if(!t)return;this.mapCells(t.row,t.column,e.length,null,function(t,n,r,i,s){if(e[i]&&e[i].length>s){return e[i][s]}return t});this.render()},selection:function(e){this.mapSelection(function(t,n,r,i,s){if(e[i]&&e[i].length>s)return e[i][s];return t});this.render()},repeat:function(e){this.mapSelection(function(t,n,r,i,s){n=e[i%e.length];t=n[s%n.length];return t});this.render()},custom:function(e){}}};webix.extend(webix.ui.datatable,webix.TablePaste);(function(){function e(e,i){var s=n(e,i);var o='<rows profile="color">';o+=t("header","head",e,s);if(e.config.footer)o+=t("footer","foot",e,s);o+=r(e,s,i);o+="</rows>";return o}function t(e,t,n,r){var i="<"+t+">";var s=1;for(var o=0;o<r.length;o++)if(r[o][e]&&r[o][e].length>s)s=r[o][e].length;for(var o=0;o<s;o++){i+="<columns>";for(var u=0;u<r.length;u++){var a=r[u];i+="<column";i+=a.width?' width="'+a.width+'"':"";var f=a[e][o];i+=f&&f.colspan?' colspan="'+f.colspan+'"':"";i+=f&&f.rowspan?' rowspan="'+f.rowspan+'"':"";i+=a.exportAsTree?' type="tree"':"";i+=' align="left"';i+="><![CDATA[";i+=(a[e][o]?a[e][o].text:"").replace(/<[^>]*>/g," ");i+="]]></column>"}i+="</columns>"}i+="</"+t+">";return i}function n(e,t){function i(e,t){var r=e?webix.clone(e):{};if(typeof t=="object")webix.extend(r,t,true);n.push(r)}var n=[];var r=t.columns;if(t.id)n.push({id:"id",width:50,header:[{text:"ID"}],footer:[""]});if(r){for(var s in r)i(e.getColumnConfig(s),r[s])}else{var o=e._settings.columns;for(var u=0;u<o.length;u++)i(o[u])}return n}function r(e,t,n){var r="";var i=e.data;for(var s=0;s<i.order.length;s++){var o=i.order[s];var u=i.pull[o];if(n.level&&n.level!=u.$level)continue;var a=u.$level?' level="'+(u.$level-1)+'"':"";r+='<row id="'+o+'"'+a+">";for(var f=0;f<t.length;f++)r+="<cell><![CDATA["+e._getValue(u,t[f],s).toString().replace(/<[^>]*>/g,"")+"]]></cell>";r+="</row>"}return r}function i(e,t){webix.send(e,{grid_xml:t},null,"_blank")}webix.extend(webix.ui.datatable,{exportToPDF:function(t,n){var r=e(this,n||{});t=t||"http://webix-export.appspot.com/export/pdf";i(t,r)},exportToExcel:function(t,n){var r=e(this,n||{});t=t||"http://webix-export.appspot.com/export/excel";i(t,r)}})})();if(!window.webix)webix={};if(!webix.storage)webix.storage={};webix.storage.local={put:function(e,t){if(e&&window.JSON&&window.localStorage){window.localStorage.setItem(e,window.JSON.stringify(t))}},get:function(e){if(e&&window.JSON&&window.localStorage){var t=window.localStorage.getItem(e);if(!t)return null;return webix.DataDriver.json.toObject(t)}else return null},remove:function(e){if(e&&window.JSON&&window.localStorage){window.localStorage.removeItem(e)}}};webix.storage.session={put:function(e,t){if(e&&window.JSON&&window.sessionStorage){window.sessionStorage.setItem(e,window.JSON.stringify(t))}},get:function(e){if(e&&window.JSON&&window.sessionStorage){var t=window.sessionStorage.getItem(e);if(!t)return null;return webix.DataDriver.json.toObject(t)}else return null},remove:function(e){if(e&&window.JSON&&window.sessionStorage){window.sessionStorage.removeItem(e)}}};webix.storage.cookie={put:function(e,t,n,r){if(e&&window.JSON){document.cookie=e+"="+window.JSON.stringify(t)+(r&&r instanceof Date?";expires="+r.toUTCString():"")+(n?";domain="+n:"")}},_get_cookie:function(e){var t=document.cookie.split(";");var n="";var r="";var i="";var s=false;for(var o=0;o<t.length;o++){n=t[o].split("=");r=n[0].replace(/^\s+|\s+$/g,"");if(r==e){s=true;if(n.length>1){i=unescape(n[1].replace(/^\s+|\s+$/g,""))}return i}n=null;r=""}if(!s){return null}return null},get:function(e){if(e&&window.JSON){var t=this._get_cookie(e);if(!t)return null;return webix.DataDriver.json.toObject(t)}else return null},remove:function(e,t){if(e&&this._get_cookie(e))document.cookie=e+"="+(t?";domain="+t:"")+";expires=Thu, 01-Jan-1970 00:00:01 GMT"}};webix.DataState={getState:function(){var e=this.config.columns.length;var t=this.config.columns;var n={ids:[],size:[],select:this.getSelectedId(true),scroll:this.getScrollState()};for(var r=0;r<e;r++){n.ids.push(t[r].id);n.size.push(t[r].width)}if(this._last_sorted){n.sort={id:this._last_sorted,dir:this._last_order}}if(this._filter_elements){var i={};var s=0;for(var o in this._filter_elements){var u=this._filter_elements[o];i[o]=u[2].getValue(u[0]);s=1}if(s)n.filter=i}n.hidden=[];for(var o in this._hidden_column_hash)n.hidden.push(o);return n},setState:function(e){var t=this.config.columns;if(!e)return;if(e.hidden){var n={};for(var r=0;r<e.hidden.length;r++){n[e.hidden[r]]=true;if(!this._hidden_column_order.length)this.hideColumn(e.hidden[r])}if(this._hidden_column_order.length){for(var r=0;r<this._hidden_column_order.length;r++){var i=this._hidden_column_order[r];if(!!n[i]==!this._hidden_column_hash[i])this.hideColumn(i,!!n[i])}}}if(e.filter){for(var s in e.filter){var o=e.filter[s];if(!this._filter_elements[s])continue;var u=this._filter_elements[s];u[2].setValue(u[0],o);var a=u[1].contentId;if(a)this._active_headers[a].value=o}this.filterByAll()}if(e.size&&e.ids){var f=e.ids.length;for(var r=0;r<f;r++){if(t[r]&&t[r].width!=e.size[r])this._setColumnWidth(r,e.size[r],true)}this._updateColsSizeSettings();if(e.sort){this._sort(e.sort.id,e.sort.dir,t[this.getColumnIndex(e.sort.id)].sort)}var l=false;var c=this.config.columns;for(var r=0;r<c.length;r++)if(c[r].id!=e.ids[r])l=true;if(l){for(var r=0;r<e.ids.length;r++)c[r]=this.getColumnConfig(e.ids[r]);this.refreshColumns()}}if(e.select&&this.select){var h=e.select;this.unselect();for(var r=0;r<h.length;r++)if(!h[r].row||this.exists(h[r].row))this._select(h[r],true)}if(e.scroll)this.scrollTo(e.scroll.x,e.scroll.y)}};webix.extend(webix.ui.datatable,webix.DataState);(function(){var e=webix.Touch={config:{longTouchDelay:1e3,scrollDelay:150,gravity:500,deltaStep:30,speed:"0ms",finish:1500,ellastic:true},limit:function(t){e._limited=t!==false},disable:function(){e._disabled=true},enable:function(){e._disabled=false},$init:function(){e.$init=function(){};webix.event(document.body,t.down,e._touchstart);webix.event(document.body,t.move,e._touchmove);webix.event(document.body,t.up,e._touchend);webix.event(document.body,"dragstart",function(e){return webix.html.preventEvent(e)});webix.event(document.body,"touchstart",function(t){if(e._disabled||e._limited)return;if(webix.env.isSafari){var n=t.srcElement.tagName.toLowerCase();if(n=="input"||n=="textarea"||n=="select"||n=="label")return true;e._fire_fast_event=true;return webix.html.preventEvent(t)}});e._clear_artefacts();e._scroll=[null,null];e.$active=true},_clear_artefacts:function(){e._start_context=e._current_context=e._prev_context=null;e._scroll_mode=e._scroll_node=e._scroll_stat=this._long_touched=null;e._delta={_x_moment:0,_y_moment:0,_time:0};if(e._css_button_remove){webix.html.removeCss(e._css_button_remove,"webix_touch");e._css_button_remove=null}window.clearTimeout(e._long_touch_timer);e._was_not_moved=true;e._axis_x=true;e._axis_y=true;if(!e._active_transion)e._scroll_end()},_touchend:function(t){if(e._start_context){if(!e._scroll_mode){if(!this._long_touched){if(e._axis_y&&!e._axis_x){e._translate_event("onSwipeX")}else if(e._axis_x&&!e._axis_y){e._translate_event("onSwipeY")}else{if(webix.env.isSafari&&e._fire_fast_event){e._fire_fast_event=false;var n=e._start_context.target;webix.delay(function(){var e=document.createEvent("MouseEvents");e.initEvent("click",true,true);n.dispatchEvent(e)})}}}}else{var r=e._get_matrix(e._scroll_node);var i=r.e;var s=r.f;var o=e.config.finish;var u=e._get_delta(t,true);if(u._time){var a=i+e.config.gravity*u._x_moment/u._time;var f=s+e.config.gravity*u._y_moment/u._time;var l=e._scroll[0]?e._correct_minmax(a,false,false,e._scroll_stat.dx,e._scroll_stat.px):i;var c=e._scroll[1]?e._correct_minmax(f,false,false,e._scroll_stat.dy,e._scroll_stat.py):s;var h=Math.max(Math.abs(l-i),Math.abs(c-s));if(h<150)o=o*h/150;if(l!=i||c!=s)o=Math.round(o*Math.max((l-i)/(a-i),(c-s)/(f-s)));var p={e:l,f:c};var d=webix.$$(e._scroll_node);if(d&&d.adjustScroll)d.adjustScroll(p);o=Math.max(100,o);if(i!=p.e||s!=p.f){e._set_matrix(e._scroll_node,p.e,p.f,o+"ms");if(e._scroll_master)e._scroll_master._sync_scroll(p.e,p.f,o+"ms");e._set_scroll(p.e,p.f,o+"ms")}else{e._scroll_end()}}else e._scroll_end()}e._translate_event("onTouchEnd");e._clear_artefacts()}},_touchmove:function(t){if(!e._start_context)return;var n=e._get_delta(t);e._translate_event("onTouchMove");if(e._scroll_mode){e._set_scroll_pos(n)}else{e._axis_x=e._axis_check(n._x,"x",e._axis_x);e._axis_y=e._axis_check(n._y,"y",e._axis_y);if(e._scroll_mode){var r=e._get_event_view("onBeforeScroll");if(r){var i={};r.callEvent("onBeforeScroll",[i]);if(i.update){e.config.speed=i.speed;e.config.scale=i.scale}}e._init_scroller(n)}}return webix.html.preventEvent(t)},_set_scroll_pos:function(){if(!e._scroll_node)return;var t=e._get_matrix(e._scroll_node);var n=t.e,r=t.f;var i=e._prev_context||e._start_context;if(e._scroll[0])t.e=e._correct_minmax(t.e-i.x+e._current_context.x,e.config.ellastic,t.e,e._scroll_stat.dx,e._scroll_stat.px);if(e._scroll[1])t.f=e._correct_minmax(t.f-i.y+e._current_context.y,e.config.ellastic,t.f,e._scroll_stat.dy,e._scroll_stat.py);e._set_matrix(e._scroll_node,t.e,t.f,"0ms");if(e._scroll_master)e._scroll_master._sync_scroll(t.e,t.f,"0ms");e._set_scroll(t.e,t.f,"0ms")},_set_scroll:function(t,n,r){var i=e._scroll_stat.px/e._scroll_stat.dx*-t;var s=e._scroll_stat.py/e._scroll_stat.dy*-n;if(e._scroll[0])e._set_matrix(e._scroll[0],i,0,r);if(e._scroll[1])e._set_matrix(e._scroll[1],0,s,r)},scrollTo:function(t,n,r,i){e._set_matrix(t,n,r,i)},_set_matrix:function(t,n,r,i){if(!e._in_anim_frame&&window.setAnimationFrame){window.setAnimationFrame(function(){e._in_anim_frame=true;return e._set_matrix(t,n,r,i)})}e._in_anim_frame=null;e._active_transion=true;if(t){var s=e.config.translate||webix.env.translate;t.style[webix.env.transform]=s+"("+Math.round(n)+"px, "+Math.round(r)+"px"+(s=="translate3d"?", 0":"")+")";t.style[webix.env.transitionDuration]=i}},_get_matrix:function(t){var n=window.getComputedStyle(t)[webix.env.transform];var r;if(n=="none")r={e:0,f:0};else{if(window.WebKitCSSMatrix)r=new WebKitCSSMatrix(n);else if(window.MSCSSMatrix)r=new MSCSSMatrix(n);else{var i=n.replace(/(matrix\()(.*)(\))/gi,"$2");i=i.replace(/\s/gi,"");i=i.split(",");var r={};var s=["a","b","c","d","e","f"];for(var o=0;o<s.length;o++){r[s[o]]=parseInt(i[o],10)}}}if(e._scroll_master)e._scroll_master._sync_pos(r);return r},_correct_minmax:function(e,t,n,r,i){if(e===n)return e;var s=Math.abs(e-n);var o=s/(e-n);if(e>0)return t?n+o*Math.sqrt(s):0;var u=r-i;if(u+e<0)return t?n-Math.sqrt(-(e-n)):-u;return e},_init_scroll_node:function(t){if(!t.scroll_enabled){t.scroll_enabled=true;t.parentNode.style.position="relative";var n=webix.env.cssPrefix;t.style.cssText+=n+"transition: "+n+"transform; "+n+"user-select:none; "+n+"transform-style:flat;";t.addEventListener(webix.env.transitionEnd,e._scroll_end,false)}},_init_scroller:function(t){if(e._scroll_mode.indexOf("x")!=-1)e._scroll[0]=e._create_scroll("x",e._scroll_stat.dx,e._scroll_stat.px,"width");if(e._scroll_mode.indexOf("y")!=-1)e._scroll[1]=e._create_scroll("y",e._scroll_stat.dy,e._scroll_stat.py,"height");e._init_scroll_node(e._scroll_node);window.setTimeout(e._set_scroll_pos,1)},_create_scroll:function(t,n,r,i){if(n-r<2){var s=e._get_matrix(e._scroll_node);var o=t=="y"?s.e:0;var u=t=="y"?0:s.f;if(!e._scroll_master)e._set_matrix(e._scroll_node,o,u,"0ms");e._scroll_mode=e._scroll_mode.replace(t,"");return""}var a=webix.html.create("DIV",{"class":"webix_scroll_"+t},"");a.style[i]=Math.max(r*r/n-7,10)+"px";e._scroll_node.parentNode.appendChild(a);return a},_axis_check:function(t,n,r){if(t>e.config.deltaStep){if(e._was_not_moved){e._long_move(n);e._locate(n);if((e._scroll_mode||"").indexOf(n)==-1)e._scroll_mode=""}return false}return r},_scroll_end:function(){var t,n,r;r=webix.$$(e._scroll_node||this);if(r){if(e._scroll_node)t=e._get_matrix(e._scroll_node);else if(r.getScrollState){n=r.getScrollState();t={e:n.x,f:n.y}}webix.callEvent("onAfterScroll",[t]);if(r.callEvent)r.callEvent("onAfterScroll",[t])}if(!e._scroll_mode){webix.html.remove(e._scroll);e._scroll=[null,null]}e._active_transion=false},_long_move:function(t){window.clearTimeout(e._long_touch_timer);e._was_not_moved=false},_stop_old_scroll:function(t){if(e._scroll[0]||e._scroll[1]){e._stop_scroll(t,e._scroll[0]?"x":"y")}else return true},_touchstart:function(n){var r=n.target||event.srcElement;if(e._disabled||r.tagName&&r.tagName.toLowerCase()=="textarea")return;e._start_context=t.context(n);if(e._limited&&!e._is_scroll()){e._stop_old_scroll(n);e._start_context=null;return}e._translate_event("onTouchStart");if(e._stop_old_scroll(n))e._long_touch_timer=window.setTimeout(e._long_touch,e.config.longTouchDelay);var i=webix.$$(n);if(i&&i.touchable&&(!r.className||r.className.indexOf("webix_view")!==0)){e._css_button_remove=i.getNode(n);webix.html.addCss(e._css_button_remove,"webix_touch")}},_long_touch:function(t){if(e._start_context){e._translate_event("onLongTouch");webix.callEvent("onClick",[e._start_context]);e._long_touched=true}},_stop_scroll:function(n,r){e._locate(r);var i=e._scroll[0]||e._scroll[1];if(i){var s=e._get_event_view("onBeforeScroll");if(s)s.callEvent("onBeforeScroll",[e._start_context,e._current_context])}if(i&&(!e._scroll_node||i.parentNode!=e._scroll_node.parentNode)){e._clear_artefacts();e._scroll_end();e._start_context=t.context(n)}e._touchmove(n)},_get_delta:function(n,r){e._prev_context=e._current_context;e._current_context=t.context(n);e._delta._x=Math.abs(e._start_context.x-e._current_context.x);e._delta._y=Math.abs(e._start_context.y-e._current_context.y);if(e._prev_context){if(e._current_context.time-e._prev_context.time<e.config.scrollDelay){e._delta._x_moment=e._delta._x_moment/1.3+e._current_context.x-e._prev_context.x;e._delta._y_moment=e._delta._y_moment/1.3+e._current_context.y-e._prev_context.y}else{e._delta._y_moment=e._delta._x_moment=0}e._delta._time=e._delta._time/1.3+(e._current_context.time-e._prev_context.time)}return e._delta},_get_sizes:function(t){e._scroll_stat={dx:t.offsetWidth,dy:t.offsetHeight,px:t.parentNode.offsetWidth,py:t.parentNode.offsetHeight}},_is_scroll:function(t){var n=e._start_context.target;if(!webix.env.touch&&!webix.env.transition&&!webix.env.transform)return null;while(n&&n.tagName!="BODY"){if(n.getAttribute){var r=n.getAttribute("touch_scroll");if(r&&(!t||r.indexOf(t)!=-1))return[n,r]}n=n.parentNode}return null},_locate:function(t){var n=this._is_scroll(t);if(n){e._scroll_mode=n[1];e._scroll_node=n[0];e._get_sizes(n[0])}return n},_translate_event:function(t){webix.callEvent(t,[e._start_context,e._current_context]);var n=e._get_event_view(t);if(n)n.callEvent(t,[e._start_context,e._current_context])},_get_event_view:function(t){var n=webix.$$(e._start_context);if(!n)return null;while(n){if(n.hasEvent&&n.hasEvent(t))return n;n=n.getParentView()}return null},_get_context:function(t){if(!t.touches[0]){var n=e._current_context;n.time=new Date;return n}return{target:t.target,x:t.touches[0].pageX,y:t.touches[0].pageY,time:new Date}},_get_context_m:function(e){return{target:e.target||e.srcElement,x:e.pageX,y:e.pageY,time:new Date}}};webix.ready(function(){if(webix.env.touch){e.$init();if(window.MSCSSMatrix)webix.html.addStyle(".webix_view{ -ms-touch-action: none; }")}});var t=webix.env.mouse={down:"mousedown",up:"mouseup",move:"mousemove",context:e._get_context_m};if(window.navigator.pointerEnabled){t.down="pointerdown";t.move="pointermove";t.up="pointerup"}else if(window.navigator.msPointerEnabled){t.down="MSPointerDown";t.move="MSPointerMove";t.up="MSPointerUp"}else if(webix.env.touch){t.down="touchstart";t.move="touchmove";t.up="touchend";t.context=e._get_context}})();webix.attachEvent("onDataTable",function(e,t){if(webix.env.touch){webix.Touch.$init();t.scrollSize=0;webix.extend(e,t.prerender===true?e._touchNative:e._touch)}});webix.extend(webix.ui.datatable,{_touchNative:{_scrollTo_touch:function(e,t){webix.Touch._set_matrix(this._body.childNodes[1].firstChild,0,0,"0ms");this._sync_scroll(e,t,"0ms")},_getScrollState_touch:function(){var e=webix.Touch._get_matrix(this._body.childNodes[1].firstChild);return{x:-e.e,y:-e.f}},$init:function(){webix.Touch.limit();this.defaults.scrollAlignY=false;this._body.setAttribute("touch_scroll","xy");this.attachEvent("onBeforeScroll",function(){webix.Touch._scroll_node=this._body.childNodes[1].firstChild;webix.Touch._get_sizes(webix.Touch._scroll_node);webix.Touch._scroll_master=this});this.attachEvent("onTouchEnd",function(){webix.Touch._scroll_master=null});webix.Touch._init_scroll_node(this._body.childNodes[1].firstChild);webix.Touch._set_matrix(this._body.childNodes[1].firstChild,0,0,"0ms");this._sync_scroll(0,0,"0ms")},_sync_scroll:function(e,t,n){if(this._settings.leftSplit)webix.Touch._set_matrix(this._body.childNodes[0].firstChild,0,t,n);if(this._settings.rightSplit)webix.Touch._set_matrix(this._body.childNodes[2].firstChild,0,t,n);if(this._settings.header)webix.Touch._set_matrix(this._header.childNodes[1].firstChild,e,0,n);if(this._settings.footer)webix.Touch._set_matrix(this._footer.childNodes[1].firstChild,e,0,n);this.callEvent("onSyncScroll",[e,t,n])},_sync_pos:function(){}},_touch:{_scrollTo_touch:function(e,t){webix.delay(function(){this.callEvent("onAfterScroll",[{e:-e,f:-t}])},this)},$init:function(){webix.Touch.limit();this.defaults.scrollAlignY=false;this._body.setAttribute("touch_scroll","xy");this.attachEvent("onBeforeScroll",function(){var e=webix.Touch;e._scroll_node=this._body.childNodes[1].firstChild;e._get_sizes(e._scroll_node);e._scroll_stat.dy=this._dtable_height;e._scroll_master=this;this._touch_ellastic=e.config.ellastic;this._touch_gravity=e.config.gravity;this._touch_saved=1;e.config.ellastic=false;e.config.gravity=0});this.attachEvent("onAfterScroll",function(e){webix.Touch._scroll_master=null;webix.Touch._fix_f=null;if(this._touch_saved){webix.Touch.config.ellastic=this._touch_ellastic;webix.Touch.config.gravity=this._touch_gravity;this._touch_saved=0}this._scrollTop=0;var t=webix.Touch.config.translate;webix.Touch.config.translate="translate";this._sync_scroll(e.e,0,"0ms");webix.Touch.config.translate=t;this._scrollLeft=-e.e;this._scrollTop=-e.f;this.render();return false});webix.Touch._init_scroll_node(this._body.childNodes[1].firstChild);webix.Touch._set_matrix(this._body.childNodes[1].firstChild,0,0,"0ms");this._sync_scroll(0,0,"0ms")},_sync_scroll:function(e,t,n){t+=this._scrollTop;webix.Touch._set_matrix(this._body.childNodes[1].firstChild,e,t,n);if(this._settings.leftSplit)webix.Touch._set_matrix(this._body.childNodes[0].firstChild,0,t,n);if(this._settings.rightSplit)webix.Touch._set_matrix(this._body.childNodes[2].firstChild,0,t,n);if(this._settings.header)webix.Touch._set_matrix(this._header.childNodes[1].firstChild,e,0,n);if(this._settings.footer)webix.Touch._set_matrix(this._footer.childNodes[1].firstChild,e,0,n);this.callEvent("onSyncScroll",[e,t,n])},_sync_pos:function(e){e.f-=this._scrollTop}}});webix.extend(webix.ui.datatable,{$init:function(){this.data.attachEvent("onStoreLoad",webix.bind(this._adjustColumns,this));this.attachEvent("onStructureLoad",this._adjustColumns);this.attachEvent("onStructureUpdate",this._resizeColumns);this.attachEvent("onResize",this._resizeColumns)},_adjustColumns:function(){if(!this.count())return;var e=false;var t=this._columns;for(var n=0;n<t.length;n++)if(t[n].adjust)e=this._adjustColumn(n,t[n].adjust,true)||e;if(e)this._updateColsSizeSettings()},_resizeColumns:function(){var e=this._settings.columns;var t=[];var n=0;if(e&&!this._settings.autowidth)for(var r=0;r<e.length;r++){var i=e[r].fillspace;if(i){t[r]=i;n+=i*1||1}}if(n)this._fillColumnSize(t,n)},_fillColumnSize:function(e,t){var n=this._settings.columns;if(!n)return;var r=this._content_width-this._scrollSizeY;var i=false;for(var s=0;s<n.length;s++)if(!e[s])r-=n[s].width||this.config.columnWidth;if(r>0){for(var s=0;s<e.length;s++)if(e[s]){var o=Math.min(r,Math.round(r*e[s]/t));i=this._setColumnWidth(s,o,true)||i;r=r-n[s].width;t=t-e[s]}}if(i)this._updateColsSizeSettings(true)},_getColumnConfigSize:function(e,t){var n=webix.html.create("DIV",{"class":"webix_view webix_table_cell webix_measure_size webix_cell"},"");n.style.cssText="width:1px; visibility:hidden; position:absolute; top:0px; left:0px; overflow:hidden;";document.body.appendChild(n);var r=this._settings.columns[e];var i=-Infinity;if(t!="header")for(var s=0;s<this.data.order.length;s++){var o=this.getItem(this.data.order[s]);var u=this._getValue(o,r,s);n.innerHTML=u;i=Math.max(n.scrollWidth,i)}if(t&&t!="data"){for(var s=0;s<r.header.length;s++){var a=r.header[s];if(a){n.innerHTML=a.text;i=Math.max(n.scrollWidth,i)}}}n=webix.html.remove(n);return i-1+(webix.env.isIE?webix.skin.$active.layoutPadding.space:0)},_adjustColumn:function(e,t,n){var r=this._getColumnConfigSize(e,t);return this._setColumnWidth(e,r,n)},adjustColumn:function(e,t){this._adjustColumn(this.getColumnIndex(e),t)},adjustRowHeight:function(e,t){var n=this.getColumnConfig(e);var r=this.data.count();var i=webix.html.create("DIV",{"class":"webix_table_cell webix_measure_size webix_cell"},"");i.style.cssText="width:"+n.width+"px; height:1px; visibility:hidden; position:absolute; top:0px; left:0px; overflow:hidden;";this.$view.appendChild(i);this.data.each(function(e){i.innerHTML=this._getValue(e,n,0);e.$height=Math.max(i.scrollHeight,this._settings.rowHeight)},this);i=webix.html.remove(i);if(!t)this.refresh()}});webix.extend(webix.ui.datatable,{math_setter:function(e){if(e)this._math_init();return e},_math_pref:"$",_math_init:function(){this.data.attachEvent("onStoreUpdated",webix.bind(this._parse_row_math,this));this.data.attachEvent("onStoreLoad",webix.bind(this._parse_math,this));this.attachEvent("onStructureLoad",this._parse_math)},_parse_row_math:function(e,t,n){if(!e||n=="delete"||n=="paint")return;for(var r=0;r<this._columns.length;r++)this._parse_cell_math(e,this._columns[r].id,true)},_parse_cell_math:function(e,t,n){var r=this.getItem(e);var i;if(n===true)i=r[this._math_pref+t]||r[t];else{i=r[t];this._math_recalc={}}if(typeof i==="undefined"||i===null)return;if(i.length>0&&i.substr(0,1)==="="){if(typeof r[this._math_pref+t]==="undefined"||n!==true)r[this._math_pref+t]=r[t];r[t]=this._calculate(i,e,t)}else{if(typeof r[this._math_pref+t]!=="undefined")delete r[this._math_pref+t];this._remove_old_triggers(e,t)}if(typeof r.depends!=="undefined"&&typeof r.depends[t]!=="undefined"){for(var s in r.depends[t]){var o=r.depends[t][s][0]+"__"+r.depends[t][s][1];if(typeof this._math_recalc[o]==="undefined"){this._math_recalc[o]=true;this._parse_cell_math(r.depends[t][s][0],r.depends[t][s][1],true)}}}},_set_original_value:function(e,t){var n=this.getItem(e);if(typeof n[this._math_pref+t]!=="undefined")n[t]=n[this._math_pref+t]},_parse_math:function(){if(!this._columns||!this.count())return;this._exprs_by_columns();for(var e=0;e<this._columns.length;e++){var t=this.columnId(e);this.data.each(function(e){this._parse_cell_math(e.id,t)},this)}},_exprs_by_columns:function(){for(var e=0;e<this._columns.length;e++){if(this._columns[e].math){var t=this.columnId(e);var n="="+this._columns[e].math;n=n.replace(/\$r/g,"#$r#");n=n.replace(/\$c/g,"#$c#");this.data.each(function(e){e[t]=this._parse_relative_expr(n,e.id,t)},this)}}},_parse_relative_expr:function(e,t,n){return webix.template(e)({$r:t,$c:n})},_get_calc_value:function(e,t){var n;if(this.exists(e))n=this.getItem(e);else return"#out_of_range";var r=n[this._math_pref+t]||n[t]||0;r=r.toString();if(r.substring(0,1)!=="=")return r;else{if(typeof n[this._math_pref+t]==="undefined")n[this._math_pref+t]=n[t];n[t]=this._calculate(r,e,t,true);return n[t]}},_calculate:function(e,t,n,r){if(r===true){if(this._in_math_trace(t,n))return"#selfreference"}else this._start_math_trace();this._to_math_trace(t,n);var i=this.getItem(t);e=e.substring(1);var s=this._get_operations(e);var o=this._get_refs(e);if(s){e=this._replace_refs(e,o);e=this._parse_args(e,s)}else{e=this._replace_refs(e,o,true);var o=[]}var u=this._math_exception(e);if(u!==false)return u;this._from_math_trace(t,n);this._remove_old_triggers(t,n);for(var a=0;a<o.length;a++){this._add_trigger([t,n],o[a])}var u=this._math_exception(e);if(u!==false)return u;if(s===null)return e;e=this._compute(e);var u=this._math_exception(e);if(u!==false)return u;return e},_get_operations:function(e){var t=/(\+|\-|\*|\/)/g;var n=e.replace(/\[[^)]*?\]/g,"").match(t);return n},_get_refs:function(e){var t=/\[([^\]]+),([^\]]+)\]/g;var n=e.match(t);if(n===null)n=[];for(var r=0;r<n.length;r++){var i=n[r];var s=i;i=i.substr(1,i.length-2);i=i.split(",");i[0]=this._trim(i[0]);i[1]=this._trim(i[1]);if(i[0].substr(0,1)===":")i[0]=this.getIdByIndex(i[0].substr(1));if(i[1].substr(0,1)===":")i[1]=this.columnId(i[1].substr(1));i[2]=s;n[r]=i}return n},_replace_refs:function(e,t,n){var r="(",i=")";if(n)r=i="";for(var s=0;s<t.length;s++){var o=t[s];var u=this._get_calc_value(o[0],o[1]);e=e.replace(o[2],r+u+i)}return e},_parse_args:function(e,t){var n=[];for(var r=0;r<t.length;r++){var i=t[r];var s=this._split_by(e,i);n.push(s[0]);e=s[1]}n.push(e);var o=/^(-?\d|\.|\(|\))+$/;for(var r=0;r<n.length;r++){var u=this._trim(n[r]);if(o.test(u)===false)return"#error";n[r]=u}var a="";for(var r=0;r<n.length-1;r++){a+=n[r]+t[r]}a+=n[n.length-1];return a},_compute:function(expr){try{webix.temp_value="";expr="webix.temp_value = "+expr;eval(expr)}catch(ex){webix.assert(false,"Math error in datatable<br>"+expr);webix.temp_value=""}var result=webix.temp_value;webix.temp_value=null;return result.toString()},_split_by:function(e,t){var n=e.indexOf(t);var r=e.substr(0,n);var i=e.substr(n+1);return[r,i]},_trim:function(e){e=e.replace(/^ */g,"");e=e.replace(/ *$/g,"");return e},_start_math_trace:function(){this._math_trace=[]},_to_math_trace:function(e,t){this._math_trace[e+"__"+t]=true},_from_math_trace:function(e,t){if(typeof this._math_trace[e+"__"+t]!=="undefined")delete this._math_trace[e+"__"+t]},_in_math_trace:function(e,t){if(typeof this._math_trace[e+"__"+t]!=="undefined")return true;else return false},_add_trigger:function(e,t){var n=this.getItem(t[0]);if(typeof n.depends==="undefined")n.depends={};if(typeof n.depends[t[1]]==="undefined")n.depends[t[1]]={};n.depends[t[1]][e[0]+"__"+e[1]]=e;n=this.getItem(e[0]);if(typeof n.triggers==="undefined")n.triggers={};if(typeof n.triggers[e[1]]==="undefined")n.triggers[e[1]]={};n.triggers[e[1]][t[0]+"__"+t[1]]=t},_remove_old_triggers:function(e,t){if(!this.exists(e,t))return;var n=this.getItem(e,t);if(typeof n.triggers==="undefined")return;for(var r in n.triggers[t]){var i=n.triggers[t][r];delete this.getItem(i[0]).depends[i[1]][e+"__"+t]}},_math_exception:function(e){var t=/#\w+/;var n=e.match(t);if(n!==null&&n.length>0)return n[0];return false}});webix.extend(webix.ui.datatable,{_get_editor_type:function(e){return this.getColumnConfig(e.column).editor},getEditor:function(e,t){if(!e)return this._last_editor;if(arguments.length==1){t=e.column;e=e.row}return(this._editors[e]||{})[t]},_for_each_editor:function(e){for(var t in this._editors){var n=this._editors[t];for(var r in n)if(r!="$count")e.call(this,n[r])}},_init_editor:function(e,t,n){var r=e.row;var i=e.column;var s=t.config=this.getColumnConfig(i);if(n!==false)this.showCell(r,i);var o=t.render();if(t.$inline)o=this._locateInput(e);t.node=o;var u=this.getItem(r);var a=s.editFormat;var f;if(this._settings.editMath)f=u["$"+i];f=f||u[i];if(webix.isUndefined(f))f="";t.setValue(a?a(f):f);t.value=u[i];this._addEditor(e,t);if(!t.$inline)this._sizeToCell(e,o,true);if(t.afterRender)t.afterRender();if(this._settings.liveValidation){webix.event(t.node,"keyup",this._bind_live_validation(e,this));this.validateEditor(e)}return o},_bind_live_validation:function(e,t){return function(){t.validateEditor(e)}},_set_new_value:function(e,t){var n=this.getColumnConfig(e.column).editParse;var r=this.getItem(e.row);r[e.column]=n?n(t):t;if(this._settings.editMath)delete r["$"+e.column];return e.row},_addEditor:function(e,t,n){var r=this._editors[e.row]=this._editors[e.row]||{};r.$count=(r.$count||0)+1;t.row=e.row;t.column=e.column;this._last_editor=r[e.column]=t;this._in_edit_mode++;this._last_editor_scroll=this.getScrollState()},_removeEditor:function(e){if(this._last_editor==e)this._last_editor=0;if(e.destroy)e.destroy();var t=this._editors[e.row];delete t[e.column];t.$count--;if(!t.$count)delete this._editors[e.row];this._in_edit_mode--},_changeEditorId:function(e,t){var n=this._editors[e];if(n){this._editors[t]=n;delete this._editors[e];for(var r in n)n[r].row=t}},_locate_cell:function(e){var t=this.getColumnConfig(e.column);if(t&&t.node&&t.attached){var n=this.getIndexById(e.row);if(n>=t._yr0&&n<t._yr1)return t.node.childNodes[n-t._yr0]}return 0},editCell:function(e,t,n,r){t=t||this._settings.columns[0].id;return webix.EditAbility.edit.call(this,{row:e,column:t},n,r)},editRow:function(e,t){if(e&&e.row)e=e.row;var n=false;this.eachColumn(function(t){this.edit({row:e,column:t},n,!n);n=true})},editColumn:function(e,t){if(e&&e.column)e=e.column;var n=false;this.eachRow(function(t){this.edit({row:t,column:e},n,!n);n=true})},eachRow:function(e,t){var n=this.data.order;if(t)n=this.data._filter_order||n;for(var r=0;r<n.length;r++)e.call(this,n[r])},eachColumn:function(e,t){for(var n in this._columns_pull){var r=this._columns_pull[n];if(!this._hidden_column_hash[r.id]||t)e.call(this,r.id,n,r)}},_after_edit_next:function(e){if(this.getSelectedId){var t=this.getSelectedId(true);if(t.length==1){this._select(e);return false}}},_custom_tab_handler:function(e,t){if(this._settings.editable&&!this._in_edit_mode){if(t.target&&t.target.tagName=="INPUT")return true;var n=this.getSelectedId(true);if(n.length==1){this.editNext(e,n[0]);return false}}return true},_find_cell_next:function(e,t,n){var r=this.getIndexById(e.row);var i=this.getColumnIndex(e.column);var s=this.data.order;var o=this._columns;if(n){for(var u=r;u<s.length;u++){for(var a=i+1;a<o.length;a++){var f={row:s[u],column:o[a].id};if(t.call(this,f))return f}i=-1}}else{for(var u=r;u>=0;u--){for(var a=i-1;a>=0;a--){var f={row:s[u],column:o[a].id};if(t.call(this,f))return f}i=o.length}}return null},_correct_after_focus_y:function(){if(this._in_edit_mode){if(this._ignore_after_focus_scroll)this._ignore_after_focus_scroll=false;else{this._y_scroll.scrollTo(this.getScrollState().y+this._body.childNodes[1].firstChild.scrollTop);this._body.childNodes[1].firstChild.scrollTop=0;this._ignore_after_focus_scroll=true}}},_correct_after_focus_x:function(){if(this._in_edit_mode){this._x_scroll.scrollTo(this._body.childNodes[1].scrollLeft)}},_component_specific_edit_init:function(){this.attachEvent("onScrollY",this._update_editor_y_pos);this.attachEvent("onScrollX",this._update_editor_y_pos);this.attachEvent("onScrollY",this._refocus_inline_editor);this.attachEvent("onColumnResize",function(){this.editStop()});this.attachEvent("onAfterFilter",function(){this.editStop()});this.attachEvent("onRowResize",function(){this.editStop()});this._body.childNodes[1].firstChild.onscroll=webix.bind(this._correct_after_focus_y,this);this._body.childNodes[1].onscroll=webix.bind(this._correct_after_focus_x,this)},_update_editor_y_pos:function(){if(this._in_edit_mode){var e=this._last_editor_scroll;this._last_editor_scroll=this.getScrollState();var t=this._last_editor_scroll.y-e.y;this._for_each_editor(function(e){if(e.getPopup){var n=this.getItemNode(e);if(n)e.getPopup().show(n);else e.getPopup().show({x:-1e4,y:-1e4})}else if(!e.$inline){e.node.top-=t;e.node.style.top=e.node.top+"px"}})}}});webix.extend(webix.ui.datatable,webix.EditAbility);webix.extend(webix.ui.datatable,{$init:function(){this._hidden_column_hash={};this._hidden_column_order=[];this._hidden_split=[0,0];this.attachEvent("onStructureLoad",this._hideInitialColumns)},_hideInitialColumns:function(){var e=this._columns;for(var t=e.length-1;t>=0;t--){if(e[t].hidden)this.hideColumn(e[t].id,true,true);else if(e[t].batch&&this.config.visibleBatch&&e[t].batch!=this.config.visibleBatch){this.hideColumn(e[t].id,true,true)}}},moveColumn:function(e,t){var n=this.getColumnIndex(e);if(n==t)return;var r=this._settings.columns;var i=r.splice(n,1);var s=t-(t>n?1:0);webix.PowerArray.insertAt.call(r,i[0],s);this._refresh_columns()},isColumnVisible:function(e){return!this._hidden_column_hash[e]},hideColumn:function(e,t,n){var r=this._settings.columns;var i=this._hidden_column_order;var s=this._hidden_column_hash;if(t!==false){var o=this.getColumnIndex(e);webix.assert(o!=-1,"hideColumn: invalid ID or already hidden");if(o==-1)return;if(!i.length){for(var u=0;u<r.length;u++)i[u]=r[u].id;this._hidden_split=[this._settings.leftSplit,this._rightSplit]}if(o<this._settings.leftSplit)this._settings.leftSplit--;if(o>=this._rightSplit)this._settings.rightSplit--;this._fixColspansHidden(o,r[o],0);this._hideColumn(o);var a=s[e]=r.splice(o,1)[0];a._yr0=-1}else{var a=s[e];webix.assert(a,"showColumn: invalid ID or already visible");if(!a)return;var f=null;var u=0;for(;u<i.length;u++){if(i[u]==e)break;if(!s[i[u]])f=i[u]}var o=f?this.getColumnIndex(f)+1:0;webix.PowerArray.insertAt.call(r,a,o);this._fixColspansHidden(o,a,1);delete a.hidden;if(u<this._hidden_split[0])this._settings.leftSplit++;if(u>=this._hidden_split[1])this._settings.rightSplit++;delete s[e]}if(!n)this._refresh_columns()},_fixColspansHidden:function(e,t,n){for(var r=t.header.length-1;r>=0;r--){if(t.header[r]===null){for(var i=e;i>=0;i--){var s=this._columns[i];if(s.header[r]!==null){if(s.header[r].colspan+n>e-i)s.header[r].colspan-=n?-1:1;break}}}}},refreshColumns:function(e){for(var t=0;t<this._columns.length;t++){var n=this._columns[t];n.attached=n.node=null}for(var t=0;t<3;t++)this._body.childNodes[t].firstChild.innerHTML="";this._columns=this.config.columns=e||this.config.columns;this._dtable_fully_ready=0;this.callEvent("onStructureUpdate");this._define_structure();this.render()},_refresh_columns:function(){this._dtable_fully_ready=0;this.callEvent("onStructureUpdate");this._apply_headers();this.render()},showColumn:function(e){return this.hideColumn(e,false)},showColumnBatch:function(e){for(var t in this._columns_pull){var n=this._columns_pull[t];if(n.batch){if(n.batch==e&&this._hidden_column_hash[n.id])this.showColumn(n.id);else if(n.batch!=e&&!this._hidden_column_hash[n.id])this.hideColumn(n.id,true)}}}});webix.extend(webix.ui.datatable,{moveSelection:function(e){var t=this.getSelectedId(true);if(t.length==1){var n=t[0].row;var r=t[0].column;if(e=="top"||e=="bottom"){if(n){if(e=="top")n=this.data.getFirstId();else if(e=="bottom")n=this.data.getLastId()}if(r){var i=0;if(e=="bottom")i=this.config.columns.length-1;r=this.columnId(i)}}else if(n&&(e=="up"||e=="down"||e=="pgup"||e=="pgdown")){var i=this.getIndexById(n);var s=e=="pgup"||e=="pgdown"?Math.round(this._dtable_offset_height/this._settings.rowHeight):1;if(e=="up"||e=="pgup")i-=s;else if(e=="down"||e=="pgdown")i+=s;if(i<0)i=0;if(i>=this.data.order.length)i=this.data.order.length-1;n=this.getIdByIndex(i)}else if(r&&(e=="right"||e=="left")){var i=this.getColumnIndex(r);if(e=="right")i++;else if(e=="left")i--;if(i<0||i>=this.config.columns.length)return;r=this.columnId(i)}else{webix.assert(false,"Not supported selection moving mode");return}this.showCell(n,r);this._select({row:n,column:r})}return false}});webix.extend(webix.ui.datatable,webix.KeysNavigation);webix.extend(webix.ui.datatable,webix.DataMove);webix.extend(webix.ui.datatable,{$dragHTML:function(e,t){var n=this._content_width-this._scrollSizeY;var r="<div class='webix_dd_drag' style='width:"+(n-2)+"px;'>";var i=this._settings.columns;for(var s=0;s<i.length;s++){var o=this._getValue(e,i[s]);r+="<div style='width:"+i[s].width+"px;'>"+o+"</div>"}return r+"</div>"},getHeaderNode:function(e,t){var n=this.getColumnIndex(e);t=t||0;var r=this._header.childNodes[1].getElementsByTagName("TR")[t+1].childNodes;for(var i=0;i<r.length;i++)if(r[i].getAttribute("column")==n)return r[i].firstChild;return null},getItemNode:function(e,t){if(e&&!e.header){var n=e.row||e;var r=this.getIndexById(n);var i=this._get_y_range();if(r<i[0]&&r>i[1])return;var s=this._get_x_range();var o=this._settings.leftSplit?0:s[0];if(e.column){o=this.getColumnIndex(e.column);if(o<this._rightSplit&&o>=this._settings.leftSplit&&(o<s[0]||o>s[1]))return}var u=this._settings.columns[o];if(u.attached&&u.node)return u.node.childNodes[r-i[0]]}},_translate_id:function(e,t){if(e&&(!e.header||!t))return this.data.order[e.rind];return 0},dragColumn_setter:function(e){var t;if(e=="order"){t={$drag:webix.bind(function(e,n){var r=this.locate(n);if(!r||!this.callEvent("onBeforeColumnDrag",[r.column,n]))return false;webix.DragControl._drag_context={from:t,start:r,custom:"column_dnd"};var i=this.getColumnConfig(r.column);this._relative_column_drag=webix.html.posRelative(n);this._limit_column_drag=i.width;return"<div class='webix_dd_drag_column' style='width:"+i.width+"px'>"+(i.header[0].text||"&nbsp;")+"</div>"},this),$dragPos:webix.bind(function(e,t,n){var r=webix.DragControl.getContext();var i=webix.html.offset(this.$view);n.style.display="none";var s=document.elementFromPoint(e.x,i.y+1);var o=this.locate(s);var u=webix.DragControl.getContext().start.column;if(o&&o.column!=u&&(!this._column_dnd_temp_block||o.column!=this._last_sort_dnd_node)){if(r.custom=="column_dnd"&&webix.$$(s)==this){if(!this.callEvent("onBeforeColumnDropOrder",[u,o.column,t]))return;var a=this.getColumnIndex(u);var f=this.getColumnIndex(o.column);this.moveColumn(u,f+(a<f?1:0));this._last_sort_dnd_node=o.column;this._column_dnd_temp_block=true}}if(o&&o.column==u){this._column_dnd_temp_block=false}n.style.display="block";e.x=e.x-this._relative_column_drag.x;e.y=i.y;if(e.x<i.x)e.x=i.x;else{var l=i.x+this.$view.offsetWidth-this._scrollSizeY-this._limit_column_drag;if(e.x>l)e.x=l}webix.DragControl._skip=true},this),$dragDestroy:webix.bind(function(e,t){webix.html.remove(t);var n=webix.DragControl.getContext().start;this.callEvent("onAfterColumnDropOrder",[n.column,this._last_sort_dnd_node,e])},this)}}else if(e){t={_inner_drag_only:true,$drag:webix.bind(function(e,n){var r=this.locate(n);if(!r||!this.callEvent("onBeforeColumnDrag",[r.column,n]))return false;webix.DragControl._drag_context={from:t,start:r,custom:"column_dnd"};return"<div class='webix_dd_drag_column'>"+(this.getColumnConfig(r.column).header[0].text||"&nbsp;")+"</div>"},this),$drop:webix.bind(function(e,t,n){var r=this.locate(n);if(!r)return false;var i=webix.DragControl.getContext().start.column;if(i!=r.column){if(!this.callEvent("onBeforeColumnDrop",[i,r.column,n]))return;var s=this.getColumnIndex(i);var o=this.getColumnIndex(r.column);this.moveColumn(i,o+(s<o?1:0));this.callEvent("onAfterColumnDrop",[i,r.column,n])}},this),$dragIn:webix.bind(function(e,n,r){var i=webix.DragControl.getContext();if(i.custom!="column_dnd"||i.from!=t)return false;var s=r.target||r.srcElement;if(s!=this._drag_column_last){if(this._drag_column_last)webix.html.removeCss(this._drag_column_last,"webix_dd_over_column");webix.html.addCss(s,"webix_dd_over_column")}return this._drag_column_last=s},this),$dragDestroy:webix.bind(function(e,t){if(this._drag_column_last)webix.html.removeCss(this._drag_column_last,"webix_dd_over_column");webix.html.remove(t)},this)}}if(e){webix.DragControl.addDrag(this._header,t);webix.DragControl.addDrop(this._header,t,true)}}});webix.extend(webix.ui.datatable,webix.DragItem);webix.extend(webix.ui.datatable,{_mark_invalid:function(e,t){this._clear_invalid_css(e);for(var n in t)this.addCellCss(e,n,"webix_invalid_cell");this.addCss(e,"webix_invalid")},_clear_invalid:function(e){this._clear_invalid_css(e);this.removeCss(e,"webix_invalid")},_clear_invalid_css:function(e){var t=this.getItem(e);var n=this.data.getMark(e,"$cellCss");if(n){for(var r in n)n[r]=n[r].replace("webix_invalid_cell","").replace("  "," ")}},addRowCss:function(e,t,n){this.addCss(e,t,n)},removeRowCss:function(e,t,n){this.removeCss(e,t,n)},addCellCss:function(e,t,n,r){var i=this.data.getMark(e,"$cellCss");var s=i||{};var o=s[t]||"";s[t]=o.replace(n,"").replace("  "," ")+" "+n;if(!i)this.data.addMark(e,"$cellCss",false,s,true);if(!r)this.refresh(e)},removeCellCss:function(e,t,n,r){var i=this.data.getMark(e,"$cellCss");if(i){var s=i[t]||"";if(s)i[t]=s.replace(n,"").replace("  "," ");if(!r)this.refresh(e)}}});webix.extend(webix.ui.datatable,webix.ValidateCollection);webix.TreeTableClick={};webix.TreeTablePaste={insert:function(e){var t=this.getSelectedId(true,true);for(var n=0;n<e.length;n++){var r={};for(var i=0;i<this._settings.columns.length;i++){r[this._settings.columns[i].id]=e[n][i]||""}if(!webix.isUndefined(r.id)&&this.exists(r.id))r.id=webix.uid();this.add(r,null,t[0])}}};webix.protoUI({name:"treetable",$init:function(){webix.extend(this.data,webix.TreeStore,true);webix.extend(this.type,webix.TreeType);webix.extend(this,webix.TreeDataMove,true);for(var e in webix.TreeClick)if(!this.on_click[e])this.on_click[e]=this._unwrap_id(webix.TreeClick[e]);this.type.treetable=webix.template("{common.space()}{common.icon()} {common.folder()}");this.type.treecheckbox=function(e,t){if(e.indeterminate&&!e.nocheckbox)return"<div class='webix_tree_checkbox webix_indeterminate'></div>";else return webix.TreeType.checkbox.apply(this,arguments)};this.data.provideApi(this,true)},_drag_order_complex:false,_unwrap_id:function(e){return function(t,n){n=n.row;return e.call(this,t,n)}},getState:function(){var e=webix.DataState.getState.call(this);webix.extend(e,webix.TreeAPI.getState.call(this));return e},setState:function(e){if(webix.TreeAPI.setState.call(this,e)){webix.DataState.setState.call(this,e)}},clipboard_setter:function(e){webix.extend(this._paste,webix.TreeTablePaste);return webix.TablePaste.clipboard_setter.call(this,e)}},webix.TreeAPI,webix.TreeStateCheckbox,webix.TreeDataLoader,webix.ui.datatable);webix.Canvas=webix.proto({$init:function(e){this._canvas_labels=[];this._canvas_name=e.name;this._obj=webix.toNode(e.container||e);var t=e.width*(window.devicePixelRatio||1);var n=e.height*(window.devicePixelRatio||1);var r=e.style||"";r+=";width:"+e.width+"px;height:"+e.height+"px;";this._prepareCanvas(e.name,r,t,n)},_prepareCanvas:function(e,t,n,r){this._canvas=webix.html.create("canvas",{width:n,height:r,canvas_id:e,style:t||""});this._obj.appendChild(this._canvas);if(!this._canvas.getContext){if(webix.env.isIE){webix.require("legacy/excanvas/excanvas.js");G_vmlCanvasManager.init_(document);G_vmlCanvasManager.initElement(this._canvas)}else webix.assert(this._canvas.getContext,"Canvas is not supported in the browser")}return this._canvas},getCanvas:function(e){var t=(this._canvas||this._prepareCanvas(this._contentobj)).getContext(e||"2d");if(!this._webixDevicePixelRatio){this._webixDevicePixelRatio=true;t.scale(window.devicePixelRatio||1,window.devicePixelRatio||1)}return t},_resizeCanvas:function(e,t){if(this._canvas){this._canvas.setAttribute("width",e*(window.devicePixelRatio||1));this._canvas.setAttribute("height",t*(window.devicePixelRatio||1));this._canvas.style.width=e+"px";this._canvas.style.height=t+"px";this._webixDevicePixelRatio=false}},renderText:function(e,t,n,r,i){if(!n)return;if(i)i=Math.max(i,0);if(t)t=Math.max(t,0);var s=webix.html.create("DIV",{"class":"webix_canvas_text"+(r?" "+r:""),style:"left:"+e+"px; top:"+t+"px;"},n);this._obj.appendChild(s);this._canvas_labels.push(s);if(i)s.style.width=i+"px";return s},renderTextAt:function(e,t,n,r,i,s,o){var u=this.renderText.call(this,n,r,i,s,o);if(u){if(e){if(e=="middle")u.style.top=parseInt(r-u.offsetHeight/2,10)+"px";else u.style.top=r-u.offsetHeight+"px"}if(t){if(t=="left")u.style.left=n-u.offsetWidth+"px";else u.style.left=parseInt(n-u.offsetWidth/2,10)+"px"}}return u},clearCanvas:function(e){var t=[],n;for(n=0;n<this._canvas_labels.length;n++)this._obj.removeChild(this._canvas_labels[n]);this._canvas_labels=[];if(!e&&this._obj._htmlmap){t=this._getMapAreas();while(t.length){t[0].parentNode.removeChild(t[0]);t.splice(0,1)}t=null;if(!this._obj._htmlmap.getElementsByTagName("AREA").length){this._obj._htmlmap.parentNode.removeChild(this._obj._htmlmap);this._obj._htmlmap=null}}this.getCanvas().clearRect(0,0,this._canvas.offsetWidth,this._canvas.offsetHeight)},toggleCanvas:function(){this._toggleCanvas(this._canvas.style.display=="none")},showCanvas:function(){this._toggleCanvas(true)},hideCanvas:function(){this._toggleCanvas(false)},_toggleCanvas:function(e){var t,n;for(n=0;n<this._canvas_labels.length;n++)this._canvas_labels[n].style.display=e?"":"none";if(this._obj._htmlmap){t=this._getMapAreas();for(n=0;n<t.length;n++){if(e)t[n].removeAttribute("disabled");else t[n].setAttribute("disabled","true")}}this._canvas.style.display=e?"":"none"},_getMapAreas:function(){var e=[],t,n;t=this._obj._htmlmap.getElementsByTagName("AREA");for(n=0;n<t.length;n++){if(t[n].getAttribute("userdata")==this._canvas_name){e.push(t[n])}}return e}});webix.color={_toHex:["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],toHex:function(e,t){e=parseInt(e,10);var n="";while(e>0){n=this._toHex[e%16]+n;e=Math.floor(e/16)}while(n.length<t)n="0"+n;return n},hexToDec:function(e){return parseInt(e,16)},toRgb:function(e){var t,n,r,i;if(typeof e!="string"){t=e[0];n=e[1];r=e[2]}else if(e.indexOf("rgb")!=-1){i=e.substr(e.indexOf("(")+1,e.lastIndexOf(")")-e.indexOf("(")-1).split(",");t=i[0];n=i[1];r=i[2]}else{if(e.substr(0,1)=="#"){e=e.substr(1)}t=this.hexToDec(e.substr(0,2));n=this.hexToDec(e.substr(2,2));r=this.hexToDec(e.substr(4,2))}t=parseInt(t,10)||0;n=parseInt(n,10)||0;r=parseInt(r,10)||0;if(t<0||t>255)t=0;if(n<0||n>255)n=0;if(r<0||r>255)r=0;return[t,n,r]},hsvToRgb:function(e,t,n){var r,i,s,o,u,a,f,l;r=Math.floor(e/60)%6;i=e/60-r;s=n*(1-t);o=n*(1-i*t);u=n*(1-(1-i)*t);a=0;f=0;l=0;switch(r){case 0:a=n;f=u;l=s;break;case 1:a=o;f=n;l=s;break;case 2:a=s;f=n;l=u;break;case 3:a=s;f=o;l=n;break;case 4:a=u;f=s;l=n;break;case 5:a=n;f=s;l=o;break;default:break}a=Math.floor(a*255);f=Math.floor(f*255);l=Math.floor(l*255);return[a,f,l]},rgbToHsv:function(e,t,n){var r,i,s,o,u,a,f,l;r=e/255;i=t/255;s=n/255;o=Math.min(r,i,s);u=Math.max(r,i,s);f=0;a=u===0?0:1-o/u;l=u;if(u==o){f=0}else if(u==r&&i>=s){f=60*(i-s)/(u-o)+0}else if(u==r&&i<s){f=60*(i-s)/(u-o)+360}else if(u==i){f=60*(s-r)/(u-o)+120}else if(u==s){f=60*(r-i)/(u-o)+240}return[f,a,l]}};webix.HtmlMap=webix.proto({$init:function(e){this._id="map_"+webix.uid();this._key=e;this._map=[]},addRect:function(e,t,n){this._createMapArea(e,"RECT",t,n)},addPoly:function(e,t){this._createMapArea(e,"POLY",t)},_createMapArea:function(e,t,n,r){var i="";if(arguments.length==4)i="userdata='"+r+"'";this._map.push("<area "+this._key+"='"+e+"' shape='"+t+"' coords='"+n.join()+"' "+i+"></area>")},addSector:function(e,t,n,r,i,s,o){var u=[];u.push(r);u.push(Math.floor(i*o));for(var a=t;a<n;a+=Math.PI/18){u.push(Math.floor(r+s*Math.cos(a)));u.push(Math.floor((i+s*Math.sin(a))*o))}u.push(Math.floor(r+s*Math.cos(n)));u.push(Math.floor((i+s*Math.sin(n))*o));u.push(r);u.push(Math.floor(i*o));return this.addPoly(e,u)},render:function(e){var t=webix.html.create("DIV");t.style.cssText="position:absolute; width:100%; height:100%; top:0px; left:0px;";e.appendChild(t);var n=webix.env.isIE?"":"src='data:image/gif;base64,R0lGODlhEgASAIAAAP///////yH5BAUUAAEALAAAAAASABIAAAIPjI+py+0Po5y02ouz3pwXADs='";t.innerHTML="<map id='"+this._id+"' name='"+this._id+"'>"+this._map.join("\n")+"</map><img "+n+" class='webix_map_img' usemap='#"+this._id+"'>";e._htmlmap=t;this._map=[]}});webix.protoUI({name:"chart",$init:function(e){this._series=[this._settings];this._legend_labels=[];this._contentobj.className+=" webix_chart";this.$ready.push(this._after_init_call);if(e.preset){this._definePreset(e)}this.attachEvent("onMouseMove",this._switchSerie);this.data.provideApi(this,true)},_after_init_call:function(){this.data.attachEvent("onStoreUpdated",webix.bind(function(){this.render()},this))},defaults:{color:"RAINBOW",alpha:"1",label:false,value:"{obj.value}",padding:{},type:"pie",lineColor:"#ffffff",cant:.5,barWidth:30,line:{width:2,color:"#1293f8"},item:{radius:3,borderColor:"#636363",borderWidth:1,color:"#ffffff",alpha:1,type:"r",shadow:false},shadow:true,gradient:false,border:true,labelOffset:20,origin:"auto",scale:"linear"},_id:"webix_area_id",on_click:{webix_chart_legend_item:function(e,t,n){var r=n.getAttribute("series_id");if(this.callEvent("onLegendClick",[e,r,n])){var i=this._settings;var s=i.legend.values;var o=s&&s[r].toggle||i.legend.toggle;if(typeof r!="undefined"&&this._series.length>1){if(o){if(n.className.indexOf("hidden")!=-1){this.showSeries(r)}else{this.hideSeries(r)}}}}}},on_dblclick:{},on_mouse_move:{},locate:function(e){return webix.html.locate(e,this._id)},$setSize:function(e,t){if(webix.ui.view.prototype.$setSize.call(this,e,t)){for(var n in this.canvases){this.canvases[n]._resizeCanvas(this._content_width,this._content_height)}this.render()}},type_setter:function(e){webix.assert(this["$render_"+e],"Chart type is not supported, or extension is not loaded: "+e);if(typeof this._settings.offset=="undefined"){this._settings.offset=!(e=="area"||e=="stackedArea")}if(e=="radar"&&!this._settings.yAxis)this.define("yAxis",{});if(e=="scatter"){if(!this._settings.yAxis)this.define("yAxis",{});if(!this._settings.xAxis)this.define("xAxis",{})}return e},removeAllSeries:function(){this.clearCanvas();if(this._legendObj){this._legendObj.innerHTML="";this._legendObj.parentNode.removeChild(this._legendObj);this._legendObj=null}if(this.canvases){this.canvases={}}this._contentobj.innerHTML="";for(var e=0;e<this._series.length;e++){if(this._series[e].tooltip)this._series[e].tooltip.destructor()}this._series=[]},clearCanvas:function(){if(this.canvases&&typeof this.canvases=="object")for(var e in this.canvases){this.canvases[e].clearCanvas()}},render:function(){var e,t,n,r,i;if(!this.isVisible(this._settings.id))return;if(!this.callEvent("onBeforeRender",[this.data]))return;if(this.canvases&&typeof this.canvases=="object"){for(t in this.canvases){this.canvases[t].clearCanvas()}}else this.canvases={};if(this._settings.legend){if(!this.canvases["legend"])this.canvases["legend"]=this._createCanvas("legend");this._drawLegend(this.data.getRange(),this._content_width,this._content_height)}e=this._getChartBounds(this._content_width,this._content_height);r=new webix.HtmlMap(this._id);i=this._settings;if(this._series){n=this._getChartData();for(t=0;t<this._series.length;t++){this._settings=this._series[t];if(!this.canvases[t])this.canvases[t]=this._createCanvas(t,"z-index:"+(2+t));this["$render_"+this._settings.type](this.canvases[t].getCanvas(),n,e.start,e.end,t,r)}}r.render(this._contentobj);this._contentobj.lastChild.style.zIndex=100;this._applyBounds(this._contentobj.lastChild,e);this.callEvent("onAfterRender",[]);this._settings=i},_applyBounds:function(e,t){var n={};n.left=t.start.x;n.top=t.start.y;n.width=t.end.x-t.start.x;n.height=t.end.y-t.start.y;for(var r in n){e.style[r]=n[r]+"px"}},_getChartData:function(){var e,t,n,r,i,s,o,u,a,f;r=this.data.getRange();e=this._settings.type.toLowerCase().indexOf("barh")!=-1?"yAxis":"xAxis";t=this._settings[e];if(t&&t.units&&typeof t.units=="object"){n=t.units;u=[];if(typeof n.start!="undefined"&&typeof n.end!="undefined"&&typeof n.next!="undefined"){o=n.start;while(o<=n.end){u.push(o);o=n.next.call(this,o)}}else if(Object.prototype.toString.call(n)==="[object Array]"){u=n}s=[];if(u.length){a=t.value;f={};for(i=0;i<r.length;i++){f[a(r[i])]=i}for(i=0;i<u.length;i++){if(typeof f[u[i]]!="undefined"){r[f[u[i]]].$unit=u[i];s.push(r[f[u[i]]])}else{s.push({$unit:u[i]})}}}return s}return r},series_setter:function(e){if(typeof e!="object"){webix.assert(e,"Chart :: Series must be an array or object")}else{this._parseSettings(!e.length?e:e[0]);this._series=[this._settings];for(var t=1;t<e.length;t++)this.addSeries(e[t])}return e},value_setter:webix.template,xValue_setter:webix.template,yValue_setter:function(e){this.define("value",e)},alpha_setter:webix.template,label_setter:webix.template,lineColor_setter:webix.template,borderColor_setter:webix.template,pieInnerText_setter:webix.template,gradient_setter:function(e){if(typeof e!="function"&&e&&e===true)e="light";return e},colormap:{RAINBOW:function(e){var t=Math.floor(this.getIndexById(e.id)/this.count()*1536);if(t==1536)t-=1;return this._rainbow[Math.floor(t/256)](t%256)}},color_setter:function(e){return this.colormap[e]||webix.template(e)},fill_setter:function(e){return!e||e=="0"?false:webix.template(e)},_definePreset:function(e){this.define("preset",e.preset);delete e.preset},preset_setter:function(e){var t,n,r;this.defaults=webix.extend({},this.defaults);r=this.presets[e];if(typeof r=="object"){for(t in r){if(typeof r[t]=="object"){if(!this.defaults[t]||typeof this.defaults[t]!="object"){this.defaults[t]=webix.extend({},r[t])}else{this.defaults[t]=webix.extend({},this.defaults[t]);for(n in r[t]){this.defaults[t][n]=r[t][n]}}}else{this.defaults[t]=r[t]}}return e}return false},legend_setter:function(e){if(!e){if(this.legendObj){this.legendObj.innerHTML="";this.legendObj=null}return false}if(typeof e!="object")e={template:e};this._mergeSettings(e,{width:150,height:18,layout:"y",align:"left",valign:"bottom",template:"",toggle:this._settings.type.toLowerCase().indexOf("stacked")!=-1?"":"hide",marker:{type:"square",width:15,height:15,radius:3},margin:4,padding:3});e.template=webix.template(e.template);return e},item_setter:function(e){if(typeof e!="object")e={color:e,borderColor:e};this._mergeSettings(e,webix.extend({},this.defaults.item));var t=["alpha","borderColor","color","radius"];this._converToTemplate(t,e);return e},line_setter:function(e){if(typeof e!="object")e={color:e};webix.extend(this.defaults.line,e,true);e=webix.extend({},this.defaults.line);e.color=webix.template(e.color);return e},padding_setter:function(e){if(typeof e!="object")e={left:e,right:e,top:e,bottom:e};this._mergeSettings(e,{left:50,right:20,top:35,bottom:40});return e},xAxis_setter:function(e){if(!e)return false;if(typeof e!="object")e={template:e};this._mergeSettings(e,{title:"",color:"#000000",lineColor:"#cfcfcf",template:"{obj}",lines:true});var t=["lineColor","template","lines"];this._converToTemplate(t,e);this._configXAxis=webix.extend({},e);return e},yAxis_setter:function(e){this._mergeSettings(e,{title:"",color:"#000000",lineColor:"#cfcfcf",template:"{obj}",lines:true,bg:"#ffffff"});var t=["lineColor","template","lines","bg"];this._converToTemplate(t,e);this._configYAxis=webix.extend({},e);return e},_converToTemplate:function(e,t){for(var n=0;n<e.length;n++){t[e[n]]=webix.template(t[e[n]])}},_createCanvas:function(e,t,n){return new webix.Canvas({container:n||this._contentobj,name:e,style:t||"",width:this._content_width,height:this._content_height})},_drawScales:function(e,t,n,r,i,s){var o=0;if(this._settings.yAxis){if(!this.canvases["y"])this.canvases["y"]=this._createCanvas("axis_y");o=this._drawYAxis(this.canvases["y"].getCanvas(),e,t,n,r,i)}if(this._settings.xAxis){if(!this.canvases["x"])this.canvases["x"]=this._createCanvas("axis_x");this._drawXAxis(this.canvases["x"].getCanvas(),e,t,n,s,o)}return o},_drawXAxis:function(e,t,n,r,i,s){var o=n.x-.5;var u=parseInt(s?s:r.y,10)+.5;var a=r.x;var f;var l=true;for(var c=0;c<t.length;c++){if(this._settings.offset===true)f=o+i/2+c*i;else{f=c==t.length-1?r.x:o+c*i;l=!!c}f=Math.ceil(f)-.5;var h=this._settings.origin!="auto"&&this._settings.type=="bar"&&parseFloat(this._settings.value(t[c]))<this._settings.origin;this._drawXAxisLabel(f,u,t[c],l,h);if((this._settings.offset||c)&&this._settings.xAxis.lines.call(this,t[c]))this._drawXAxisLine(e,f,r.y,n.y,t[c])}this.canvases["x"].renderTextAt(true,false,o,r.y+this._settings.padding.bottom-3,this._settings.xAxis.title,"webix_axis_title_x",r.x-n.x);this._drawLine(e,o,u,a,u,this._settings.xAxis.color,1);if(!this._settings.xAxis.lines.call(this,{})||!this._settings.offset)return;this._drawLine(e,a+.5,r.y,a+.5,n.y+.5,this._settings.xAxis.color,.2)},_drawYAxis:function(e,t,n,r,i,s){var o;var u={};if(!this._settings.yAxis)return;var a=n.x-.5;var f=r.y;var l=n.y;var c=r.y;if(this._settings.yAxis.step)o=parseFloat(this._settings.yAxis.step);if(typeof this._configYAxis.step=="undefined"||typeof this._configYAxis.start=="undefined"||typeof this._configYAxis.end=="undefined"){u=this._calculateScale(i,s);i=u.start;s=u.end;o=u.step;this._settings.yAxis.end=s;this._settings.yAxis.start=i}else if(this.config.scale=="logarithmic")this._logScaleCalc=true;this._setYAxisTitle(n,r);if(o===0)return;if(s==i){return f}var h=(f-l)*o/(s-i);var p=0;for(var d=i;d<=s;d+=o){var v=this._logScaleCalc?Math.pow(10,d):d;if(u.fixNum)v=parseFloat(v).toFixed(u.fixNum);var m=Math.floor(f-p*h)+.5;if(!(d==i&&this._settings.origin=="auto")&&this._settings.yAxis.lines.call(this,d))this._drawLine(e,a,m,r.x,m,this._settings.yAxis.lineColor.call(this,d),1);if(d==this._settings.origin)c=m;if(o<1&&!this._logScaleCalc){var g=Math.min(Math.floor(this._log10(o)),i<=0?0:Math.floor(this._log10(i)));var y=Math.pow(10,-g);v=Math.round(v*y)/y;d=v}this.canvases["y"].renderText(0,m-5,this._settings.yAxis.template(v.toString()),"webix_axis_item_y",n.x-5);p++}this._drawLine(e,a,f+1,a,l,this._settings.yAxis.color,1);return c},_setYAxisTitle:function(e,t){var n="webix_axis_title_y"+(webix._isIE&&webix._isIE!=9?" webix_ie_filter":"");var r=this.canvases["y"].renderTextAt("middle",false,0,parseInt((t.y-e.y)/2+e.y,10),this._settings.yAxis.title,n);if(r)r.style.left=(webix.env.transform?(r.offsetHeight-r.offsetWidth)/2:0)+"px"},_calculateLogScale:function(e,t){var n=Math.floor(this._log10(e));var r=Math.ceil(this._log10(t));return{start:n,step:1,end:r}},_calculateScale:function(e,t){this._logScaleCalc=false;if(this._settings.scale=="logarithmic"){var n=Math.floor(this._log10(e));var r=Math.ceil(this._log10(t));if(e>0&&t>0&&r-n>1){this._logScaleCalc=true;return this._calculateLogScale(e,t)}}if(this._settings.origin!="auto"&&this._settings.origin<e)e=this._settings.origin;var i,s,o;i=(t-e)/8||1;var u=Math.floor(this._log10(i));var a=Math.pow(10,u);var f=i/a;f=f>5?10:5;i=parseInt(f,10)*a;if(i>Math.abs(e))s=e<0?-i:0;else{var l=Math.abs(e);var c=Math.floor(this._log10(l));var h=l/Math.pow(10,c);s=Math.ceil(h*10)/10*Math.pow(10,c)-i;if(l>1&&i>.1){s=Math.ceil(s)}while(e<0?s<=e:s>=e)s-=i;if(e<0)s=-s-2*i}o=s;while(o<t){o+=i;o=parseFloat((o*1).toFixed(Math.abs(u)))}return{start:s,end:o,step:i,fixNum:Math.abs(u)}},_getLimits:function(e,t){var n=this.data._obj_array();var r,i;var s=arguments.length&&e=="h"?this._configXAxis:this._configYAxis;t=t||"value";if(s&&typeof s.end!="undefined"&&typeof s.start!="undefined"&&s.step){r=parseFloat(s.end);i=parseFloat(s.start)}else{r=webix.GroupMethods.max(this._series[0][t],n);i=s&&typeof s.start!="undefined"?parseFloat(s.start):webix.GroupMethods.min(this._series[0][t],n);if(this._series.length>1)for(var o=1;o<this._series.length;o++){var u=webix.GroupMethods.max(this._series[o][t],n);var a=webix.GroupMethods.min(this._series[o][t],n);if(u>r)r=u;if(a<i)i=a}}return{max:r,min:i}},_log10:function(e){var t="log";return Math[t](e)/Math.LN10},_drawXAxisLabel:function(e,t,n,r,i){if(!this._settings.xAxis)return;var s=this.canvases["x"].renderTextAt(i,r,e,t-(i?2:0),this._settings.xAxis.template(n));if(s)s.className+=" webix_axis_item_x"},_drawXAxisLine:function(e,t,n,r,i){if(!this._settings.xAxis||!this._settings.xAxis.lines)return;this._drawLine(e,t,n,t,r,this._settings.xAxis.lineColor.call(this,i),1)},_drawLine:function(e,t,n,r,i,s,o){e.strokeStyle=s;e.lineWidth=o;e.beginPath();e.moveTo(t,n);e.lineTo(r,i);e.stroke();e.lineWidth=1},_getRelativeValue:function(e,t){var n,r;var i=1;if(t!=e){n=t-e}else n=e;return[n,i]},_rainbow:[function(e){return"#FF"+webix.color.toHex(e/2,2)+"00"},function(e){return"#FF"+webix.color.toHex(e/2+128,2)+"00"},function(e){return"#"+webix.color.toHex(255-e,2)+"FF00"},function(e){return"#00FF"+webix.color.toHex(e,2)},function(e){return"#00"+webix.color.toHex(255-e,2)+"FF"},function(e){return"#"+webix.color.toHex(e,2)+"00FF"}],addSeries:function(e){var t=webix.extend({},this._settings);this._settings=webix.extend({},t);this._parseSettings(e,{});this._series.push(this._settings);this._settings=t},_switchSerie:function(e,t,n){var r;if(!n.getAttribute("userdata"))return;this._active_serie=n.getAttribute("userdata");if(!this._series[this._active_serie])return;for(var i=0;i<this._series.length;i++){r=this._series[i].tooltip;if(r)r.disable()}if(!n.getAttribute("disabled")){r=this._series[this._active_serie].tooltip;if(r)r.enable()}},hideSeries:function(e){this.canvases[e].hideCanvas();if(this._settings.legend.values&&this._settings.legend.values[e])this._settings.legend.values[e].$hidden=true;this._drawLegend()},showSeries:function(e){this.canvases[e].showCanvas();if(this._settings.legend.values&&this._settings.legend.values[e])delete this._settings.legend.values[e].$hidden;this._drawLegend()},_drawLegend:function(e,t){var n,r,i,s,o,u,a,f=0,l=0,c,h,p,d;e=e||[];t=t||this._content_width;c=this.canvases["legend"].getCanvas();r=this._settings.legend;a=this._settings.legend.layout!="x"?"width:"+r.width+"px":"";if(this._legendObj){this._legendObj.innerHTML="";this._legendObj.parentNode.removeChild(this._legendObj)}this.canvases["legend"].clearCanvas(true);i=webix.html.create("DIV",{"class":"webix_chart_legend",style:"left:"+f+"px; top:"+l+"px;"+a},"");if(r.padding){i.style.padding=r.padding+"px"}this._legendObj=i;this._contentobj.appendChild(i);o=[];if(!r.values)for(n=0;n<e.length;n++){o.push(this._drawLegendText(i,r.template(e[n])))}else for(n=0;n<r.values.length;n++){o.push(this._drawLegendText(i,r.values[n].text,typeof r.values[n].id!="undefined"?typeof r.values[n].id:n,r.values[n].$hidden))}if(i.offsetWidth===0)i.style.width="auto";u=i.offsetWidth;s=i.offsetHeight;if(u<t){if(r.layout=="x"&&r.align=="center"){f=(t-u)/2}if(r.align=="right"){f=t-u}if(r.margin&&r.align!="center"){f+=(r.align=="left"?1:-1)*r.margin}}if(s<this._content_height){if(r.valign=="middle"&&r.align!="center"&&r.layout!="x")l=(this._content_height-s)/2;else if(r.valign=="bottom")l=this._content_height-s;if(r.margin&&r.valign!="middle"){l+=(r.valign=="top"?1:-1)*r.margin}}i.style.left=f+"px";i.style.top=l+"px";c.save();for(n=0;n<o.length;n++){d=o[n];if(r.values&&r.values[n].$hidden){p=true;h=r.values[n].disableColor?r.values[n].disableColor:"#d9d9d9"}else{p=false;h=r.values?r.values[n].color:this._settings.color.call(this,e[n])}this._drawLegendMarker(c,d.offsetLeft+f,d.offsetTop+l,h,d.offsetHeight,p,n)}c.restore();o=null},_drawLegendText:function(e,t,n,r){var i="";if(this._settings.legend.layout=="x")i="float:left;";var s=webix.html.create("DIV",{style:i+"padding-left:"+(10+this._settings.legend.marker.width)+"px","class":"webix_chart_legend_item"+(r?" hidden":"")},t);if(arguments.length>2)s.setAttribute("series_id",n);e.appendChild(s);return s},_drawLegendMarker:function(e,t,n,r,i,s,o){var u=[];var a=this._settings.legend.marker;var f=this._settings.legend.values;var l=f&&f[o].markerType?f[o].markerType:a.type;if(r){e.strokeStyle=e.fillStyle=r}if(l=="round"||!a.radius){e.beginPath();e.lineWidth=a.height;e.lineCap=a.type;t+=e.lineWidth/2+5;n+=i/2;e.moveTo(t,n);var c=t+a.width-a.height+1;e.lineTo(c,n);e.stroke();e.fill()}else if(l=="item"){if(this._settings.line&&this._settings.type!="scatter"&&!this._settings.disableLines){e.beginPath();e.lineWidth=this._series[o].line.width;e.strokeStyle=s?r:this._series[o].line.color.call(this,{});var h=t+5;var p=n+i/2;e.moveTo(h,p);var c=h+a.width;e.lineTo(c,p);e.stroke()}var d=this._series[o].item;var v=parseInt(d.radius.call(this,{}),10)||0;if(v){e.beginPath();if(s){e.lineWidth=d.borderWidth;e.strokeStyle=r;e.fillStyle=r}else{e.lineWidth=d.borderWidth;e.fillStyle=d.color.call(this,{});e.strokeStyle=d.borderColor.call(this,{});e.globalAlpha=d.alpha.call(this,{})}e.beginPath();t+=a.width/2+5;n+=i/2;this._strokeChartItem(e,t,n,v+1,d.type);e.fill();e.stroke()}e.globalAlpha=1}else{e.beginPath();e.lineWidth=1;t+=5;n+=i/2-a.height/2;u=[[t+a.radius,n+a.radius,a.radius,Math.PI,3*Math.PI/2,false],[t+a.width-a.radius,n],[t+a.width-a.radius,n+a.radius,a.radius,-Math.PI/2,0,false],[t+a.width,n+a.height-a.radius],[t+a.width-a.radius,n+a.height-a.radius,a.radius,0,Math.PI/2,false],[t+a.radius,n+a.height],[t+a.radius,n+a.height-a.radius,a.radius,Math.PI/2,Math.PI,false],[t,n+a.radius]];this._path(e,u);e.stroke();e.fill()}},_getChartBounds:function(e,t){var n,r,i,s;n=this._settings.padding.left;r=this._settings.padding.top;i=e-this._settings.padding.right;s=t-this._settings.padding.bottom;if(this._settings.legend){var o=this._settings.legend;var u=this._settings.legend.width;var a=this._settings.legend.height;if(o.layout=="x"){if(o.valign=="center"){if(o.align=="right")i-=u;else if(o.align=="left")n+=u}else if(o.valign=="bottom"){s-=a}else{r+=a}}else{if(o.align=="right")i-=u;else if(o.align=="left")n+=u}}return{start:{x:n,y:r},end:{x:i,y:s}}},_getStackedLimits:function(e){var t,n,r,i,s;if(this._settings.yAxis&&typeof this._settings.yAxis.end!="undefined"&&typeof this._settings.yAxis.start!="undefined"&&this._settings.yAxis.step){r=parseFloat(this._settings.yAxis.end);i=parseFloat(this._settings.yAxis.start)}else{for(t=0;t<e.length;t++){e[t].$sum=0;e[t].$min=Infinity;for(n=0;n<this._series.length;n++){s=parseFloat(this._series[n].value(e[t])||0);if(isNaN(s))continue;if(this._series[n].type.toLowerCase().indexOf("stacked")!=-1)e[t].$sum+=s;if(s<e[t].$min)e[t].$min=s}}r=-Infinity;i=Infinity;for(t=0;t<e.length;t++){if(e[t].$sum>r)r=e[t].$sum;if(e[t].$min<i)i=e[t].$min}if(i>0)i=0}return{max:r,min:i}},_setBarGradient:function(e,t,n,r,i,s,o,u){var a,f,l,c,h,p;if(s=="light"){if(u=="x")a=e.createLinearGradient(t,n,r,n);else a=e.createLinearGradient(t,n,t,i);p=[[0,"#FFFFFF"],[.9,o],[1,o]];f=2}else if(s=="falling"||s=="rising"){if(u=="x")a=e.createLinearGradient(t,n,r,n);else a=e.createLinearGradient(t,n,t,i);l=webix.color.toRgb(o);c=webix.color.rgbToHsv(l[0],l[1],l[2]);c[1]*=1/2;h="rgb("+webix.color.hsvToRgb(c[0],c[1],c[2])+")";if(s=="falling"){p=[[0,h],[.7,o],[1,o]]}else if(s=="rising"){p=[[0,o],[.3,o],[1,h]]}f=0}else{e.globalAlpha=.37;f=0;if(u=="x")a=e.createLinearGradient(t,i,t,n);else a=e.createLinearGradient(t,n,r,n);p=[[0,"#9d9d9d"],[.3,"#e8e8e8"],[.45,"#ffffff"],[.55,"#ffffff"],[.7,"#e8e8e8"],[1,"#9d9d9d"]]}this._gradient(a,p);return{gradient:a,offset:f}},_getPositionByAngle:function(e,t,n,r){e*=-1;t=t+Math.cos(e)*r;n=n-Math.sin(e)*r;return{x:t,y:n}},_gradient:function(e,t){for(var n=0;n<t.length;n++){e.addColorStop(t[n][0],t[n][1])}},_path:function(e,t){var n,r;for(n=0;n<t.length;n++){r=n?"lineTo":"moveTo";if(t[n].length>2)r="arc";e[r].apply(e,t[n])}},_addMapRect:function(e,t,n,r,i){e.addRect(t,[n[0].x-r.x,n[0].y-r.y,n[1].x-r.x,n[1].y-r.y],i)}},webix.Group,webix.AutoTooltip,webix.DataLoader,webix.MouseEvents,webix.EventSystem,webix.ui.view);webix.extend(webix.ui.chart,{$render_pie:function(e,t,n,r,i,s){this._renderPie(e,t,n,r,1,s,i)},_renderPie:function(e,t,n,r,i,s,o){if(!t.length)return;var u=this._getPieParameters(n,r);var a=this._settings.radius?this._settings.radius:u.radius;if(a<0)return;var f=this._getValues(t);var l=this._getTotalValue(f);var c=this._getRatios(f,l);var h=this._settings.x?this._settings.x:u.x;var p=this._settings.y?this._settings.y:u.y;if(i==1&&this._settings.shadow)this._addShadow(e,h,p,a);p=p/i;var d=-Math.PI/2;var v=[];e.scale(1,i);if(this._settings.gradient){var m=i!=1?h+a/3:h;var g=i!=1?p+a/3:p;this._showRadialGradient(e,h,p,a,m,g)}for(var y=0;y<t.length;y++){if(!f[y])continue;e.strokeStyle=this._settings.lineColor.call(this,t[y]);e.beginPath();e.moveTo(h,p);v.push(d);var b=-Math.PI/2+c[y]-1e-4;e.arc(h,p,a,d,b,false);e.lineTo(h,p);var w=this._settings.color.call(this,t[y]);e.fillStyle=w;e.fill();if(this._settings.pieInnerText)this._drawSectorLabel(h,p,5*a/6,d,b,i,this._settings.pieInnerText(t[y],l),true);if(this._settings.label)this._drawSectorLabel(h,p,a+this._settings.labelOffset,d,b,i,this._settings.label(t[y]));if(i!=1){this._createLowerSector(e,h,p,d,b,a,true);e.fillStyle="#000000";e.globalAlpha=.2;this._createLowerSector(e,h,p,d,b,a,false);e.globalAlpha=1;e.fillStyle=w}s.addSector(t[y].id,d,b,h-n.x,p-n.y/i,a,i,o);d=b}e.globalAlpha=.8;var E;for(y=0;y<v.length;y++){E=this._getPositionByAngle(v[y],h,p,a);this._drawLine(e,h,p,E.x,E.y,this._settings.lineColor.call(this,t[y]),2)}if(i==1){e.lineWidth=2;e.strokeStyle="#ffffff";e.beginPath();e.arc(h,p,a+1,0,2*Math.PI,false);e.stroke()}e.globalAlpha=1;e.scale(1,1/i)},_getValues:function(e){var t=[];for(var n=0;n<e.length;n++)t.push(parseFloat(this._settings.value(e[n])||0));return t},_getTotalValue:function(e){var t=0;for(var n=0;n<e.length;n++)t+=e[n];return t},_getRatios:function(e,t){var n;var r=[];var i=0;t=t||this._getTotalValue(e);for(var s=0;s<e.length;s++){n=e[s];r[s]=Math.PI*2*(t?(n+i)/t:1/e.length);i+=n}return r},_getPieParameters:function(e,t){var n=t.x-e.x;var r=t.y-e.y;var i=e.x+n/2;var s=e.y+r/2;var o=Math.min(n/2,r/2);return{x:i,y:s,radius:o}},_createLowerSector:function(e,t,n,r,i,s,o){e.lineWidth=1;if(!(r<=0&&i>=0||r>=0&&i<=Math.PI||Math.abs(r-Math.PI)>.003&&r<=Math.PI&&i>=Math.PI))return;if(r<=0&&i>=0){r=0;o=false;this._drawSectorLine(e,t,n,s,r,i)}if(r<=Math.PI&&i>=Math.PI){i=Math.PI;o=false;this._drawSectorLine(e,t,n,s,r,i)}var u=(this._settings.pieHeight||Math.floor(s/4))/this._settings.cant;e.beginPath();e.arc(t,n,s,r,i,false);e.lineTo(t+s*Math.cos(i),n+s*Math.sin(i)+u);e.arc(t,n+u,s,i,r,true);e.lineTo(t+s*Math.cos(r),n+s*Math.sin(r));e.fill();if(o)e.stroke()},_drawSectorLine:function(e,t,n,r,i,s){e.beginPath();e.arc(t,n,r,i,s,false);e.stroke()},_addShadow:function(e,t,n,r){e.globalAlpha=.5;var i=["#c4c4c4","#c6c6c6","#cacaca","#dcdcdc","#dddddd","#e0e0e0","#eeeeee","#f5f5f5","#f8f8f8"];for(var s=i.length-1;s>-1;s--){e.beginPath();e.fillStyle=i[s];e.arc(t+1,n+1,r+s,0,Math.PI*2,true);e.fill()}e.globalAlpha=1},_getGrayGradient:function(e){e.addColorStop(0,"#ffffff");e.addColorStop(.7,"#7a7a7a");e.addColorStop(1,"#000000");return e},_showRadialGradient:function(e,t,n,r,i,s){e.beginPath();var o;if(typeof this._settings.gradient!="function"){o=e.createRadialGradient(i,s,r/4,t,n,r);o=this._getGrayGradient(o)}else o=this._settings.gradient(o);e.fillStyle=o;e.arc(t,n,r,0,Math.PI*2,true);e.fill();e.globalAlpha=.7},_drawSectorLabel:function(e,t,n,r,i,s,o,u){var a=this.canvases[0].renderText(0,0,o,0,1);if(!a)return;var f=a.scrollWidth;a.style.width=f+"px";if(f>e)f=e;var l=i-r<.2?4:8;if(u)l=f/1.8;var c=r+(i-r)/2;n=n-(l-8)/2;var h=-l;var p=-8;var d="right";if(c>=Math.PI/2&&c<Math.PI||c<=3*Math.PI/2&&c>=Math.PI){h=-f-h+1;d="left"}var v=0;if(!u&&s<1&&c>0&&c<Math.PI)v=(this._settings.height||Math.floor(n/4))/s;var m=(t+Math.floor((n+v)*Math.sin(c)))*s+p;var g=e+Math.floor((n+l/2)*Math.cos(c))+h;var y=i<Math.PI/2+.01;var b=r<Math.PI/2;if(b&&y){g=Math.max(g,e+3)}else if(!b&&!y)g=Math.min(g,e-f);else if(!u&&(c>=Math.PI/2&&c<Math.PI||c<=3*Math.PI/2&&c>=Math.PI)){g+=f/3}a.style.top=m+"px";a.style.left=g+"px";a.style.width=f+"px";a.style.textAlign=d;a.style.whiteSpace="nowrap"},$render_pie3D:function(e,t,n,r,i,s){this._renderPie(e,t,n,r,this._settings.cant,s)},$render_donut:function(e,t,n,r,i,s){if(!t.length)return;this._renderPie(e,t,n,r,1,s);var o=this._settings;var u=this._getPieParameters(n,r);var a=o.radius?o.radius:u.radius;var f=o.innerRadius&&o.innerRadius<a?o.innerRadius:a/3;var l=o.x?o.x:u.x;var c=o.y?o.y:u.y;e.fillStyle="#ffffff";e.beginPath();e.arc(l,c,f,0,Math.PI*2,true);e.fill()}});webix.extend(webix.ui.chart,{$render_bar:function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b=r.y-n.y;y=!!this._settings.yAxis;g=!!this._settings.xAxis;f=this._getLimits();l=f.max;c=f.min;u=(r.x-n.x)/t.length;if(!i&&!(this._settings.origin!="auto"&&!y)){this._drawScales(t,n,r,c,l,u)}if(y){l=parseFloat(this._settings.yAxis.end);c=parseFloat(this._settings.yAxis.start)}d=this._getRelativeValue(c,l);h=d[0];p=d[1];m=h?b/h:h;if(!y&&!(this._settings.origin!="auto"&&g)){v=10;m=h?(b-v)/h:v}if(!i&&this._settings.origin!="auto"&&!y&&this._settings.origin>c){this._drawXAxis(e,t,n,r,u,r.y-m*(this._settings.origin-c))}o=parseInt(this._settings.barWidth,10);var w=0;var E=0;for(a=0;a<this._series.length;a++){if(a==i){E=w}if(this._series[a].type=="bar")w++}if(this._series&&o*w+4>u)o=parseInt(u/w-4,10);var S=(u-o*w)/2;var x=typeof this._settings.radius!="undefined"?parseInt(this._settings.radius,10):Math.round(o/5);var T=false;var N=this._settings.gradient;if(N&&typeof N!="function"){T=N;N=false}else if(N){N=e.createLinearGradient(0,r.y,0,n.y);this._settings.gradient(N)}if(!g){this._drawLine(e,n.x,r.y+.5,r.x,r.y+.5,"#000000",1)}for(a=0;a<t.length;a++){var C=parseFloat(this._settings.value(t[a])||0);if(this._logScaleCalc)C=this._log10(C);if(isNaN(C))continue;if(C>l)C=l;C-=c;C*=p;var k=n.x+S+a*u+(o+1)*E;var L=r.y;if(C<0||this._settings.yAxis&&C===0&&!(this._settings.origin!="auto"&&this._settings.origin>c)){this.canvases[i].renderTextAt(true,true,k+Math.floor(o/2),L,this._settings.label(t[a]));continue}if(!y&&!(this._settings.origin!="auto"&&g))C+=v/m;var A=N||this._settings.color.call(this,t[a]);e.globalAlpha=this._settings.alpha.call(this,t[a]);var O=this._drawBar(e,n,k,L,o,c,x,m,C,A,N,T);if(T){this._drawBarGradient(e,k,L,o,c,x,m,C,A,T)}if(this._settings.border)this._drawBarBorder(e,k,L,o,c,x,m,C,A);e.globalAlpha=1;if(O[0]!=k)this.canvases[i].renderTextAt(false,true,k+Math.floor(o/2),O[1],this._settings.label(t[a]));else this.canvases[i].renderTextAt(true,true,k+Math.floor(o/2),O[3],this._settings.label(t[a]));s.addRect(t[a].id,[k-n.x,O[3]-n.y,O[2]-n.x,O[1]-n.y],i)}},_correctBarParams:function(e,t,n,r,i,s,o){var u=this._settings.xAxis;var a=n;if(!!u&&this._settings.origin!="auto"&&this._settings.origin>o){n-=(this._settings.origin-o)*i;a=n;r=r-(this._settings.origin-o);if(r<0){r*=-1;e.translate(t+s,n);e.rotate(Math.PI);t=0;n=0}n-=.5}return{value:r,x0:t,y0:n,start:a}},_drawBar:function(e,t,n,r,i,s,o,u,a,f,l,c){e.save();e.fillStyle=f;var h=this._correctBarParams(e,n,r,a,u,i,s);var p=this._setBarPoints(e,h.x0,h.y0,i,o,u,h.value,this._settings.border?1:0);if(l&&!c)e.lineTo(h.x0+(this._settings.border?1:0),t.y);e.fill();e.restore();var d=h.x0;var v=h.x0!=n?n+p[0]:p[0];var m=h.x0!=n?h.start-p[1]-h.y0:h.y0;var g=h.x0!=n?h.start-h.y0:p[1];return[d,m,v,g]},_setBorderStyles:function(e,t){var n,r;r=webix.color.toRgb(t);n=webix.color.rgbToHsv(r[0],r[1],r[2]);n[2]/=1.4;t="rgb("+webix.color.hsvToRgb(n[0],n[1],n[2])+")";e.strokeStyle=t;if(e.globalAlpha==1)e.globalAlpha=.9},_drawBarBorder:function(e,t,n,r,i,s,o,u,a){var f;e.save();f=this._correctBarParams(e,t,n,u,o,r,i);this._setBorderStyles(e,a);this._setBarPoints(e,f.x0,f.y0,r,s,o,f.value,e.lineWidth/2,1);e.stroke();e.restore()},_drawBarGradient:function(e,t,n,r,i,s,o,u,a,f){e.save();var l=this._correctBarParams(e,t,n,u,o,r,i);var c=this._setBarGradient(e,l.x0,l.y0,l.x0+r,l.y0-o*l.value+2,f,a,"y");var h=this._settings.border?1:0;e.fillStyle=c.gradient;this._setBarPoints(e,l.x0+c.offset,l.y0,r-c.offset*2,s,o,l.value,c.offset+h);e.fill();e.restore()},_setBarPoints:function(e,t,n,r,i,s,o,u,a){e.beginPath();var f=0;if(i>s*o){var l=(i-s*o)/i;if(l<=1&&l>=-1)f=-Math.acos(l)+Math.PI/2}e.moveTo(t+u,n);var c=n-Math.floor(s*o)+i+(i?0:u);if(i<s*o)e.lineTo(t+u,c);var h=t+i;if(i&&i>0)e.arc(h,c,i-u,-Math.PI+f,-Math.PI/2,false);var p=t+r-i-u;var d=c-i+(i?u:0);e.lineTo(p,d);if(i&&i>0)e.arc(p,c,i-u,-Math.PI/2,0-f,false);var v=t+r-u;e.lineTo(v,n);if(!a){e.lineTo(t+u,n)}return[v,d]}});webix.extend(webix.ui.chart,{$render_line:function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g;f=this._calculateLineParams(e,t,n,r,i);o=this._settings;if(t.length){l=o.offset?n.x+f.cellWidth*.5:n.x;a=[];for(u=0;u<t.length;u++){g=this._getPointY(t[u],n,r,f);if(g){h=!u?l:f.cellWidth*u-.5+l;d=typeof g=="object"?g.y0:g;if(u&&this._settings.fixOverflow){m=this._getPointY(t[u-1],n,r,f);if(m.out&&m.out==g.out){continue}c=f.cellWidth*(u-1)-.5+l;p=typeof m=="object"?m.y0:m;if(m.out){v=m.out=="min"?r.y:n.y;a.push({x:this._calcOverflowX(c,h,p,d,v),y:v})}if(g.out){v=g.out=="min"?r.y:n.y;a.push({x:this._calcOverflowX(c,h,p,d,v),y:v})}}if(!g.out)a.push({x:h,y:g,index:u})}}this._mapStart=n;for(u=1;u<=a.length;u++){c=a[u-1].x;p=a[u-1].y;if(u<a.length){h=a[u].x;d=a[u].y;this._drawLine(e,c,p,h,d,o.line.color.call(this,t[u-1]),o.line.width);if(o.line&&o.line.shadow){e.globalAlpha=.3;this._drawLine(e,c+2,p+o.line.width+8,h+2,d+o.line.width+8,"#eeeeee",o.line.width+3);e.globalAlpha=1}}if(typeof a[u-1].index!="undefined")this._drawItem(e,c,p,t[a[u-1].index],o.label(t[a[u-1].index]),i,s,n)}}},_calcOverflowX:function(e,t,n,r,i){return e+(i-n)*(t-e)/(r-n)},_drawItem:function(e,t,n,r,i,s,o){var u=this._settings.item;var a=parseInt(u.radius.call(this,r),10)||0;var f=this._mapStart;if(a){e.save();if(u.shadow){e.lineWidth=1;e.strokeStyle="#bdbdbd";e.fillStyle="#bdbdbd";var l=[.1,.2,.3];for(var c=l.length-1;c>=0;c--){e.globalAlpha=l[c];e.strokeStyle="#d0d0d0";e.beginPath();this._strokeChartItem(e,t,n+2*a/3,a+c+1,u.type);e.stroke()}e.beginPath();e.globalAlpha=.3;e.fillStyle="#bdbdbd";this._strokeChartItem(e,t,n+2*a/3,a+1,u.type);e.fill()}e.restore();e.lineWidth=u.borderWidth;e.fillStyle=u.color.call(this,r);e.strokeStyle=u.borderColor.call(this,r);e.globalAlpha=u.alpha.call(this,r);e.beginPath();this._strokeChartItem(e,t,n,a+1,u.type);e.fill();e.stroke();e.globalAlpha=1}if(i){this.canvases[s].renderTextAt(false,true,t,n-a-this._settings.labelOffset,this._settings.label.call(this,r))}if(o){var h=this._settings.eventRadius||a+1;o.addRect(r.id,[t-h-f.x,n-h-f.y,t+h-f.x,n+h-f.y],s)}},_strokeChartItem:function(e,t,n,r,i){var s=[];if(i&&(i=="square"||i=="s")){r*=Math.sqrt(2)/2;s=[[t-r-e.lineWidth/2,n-r],[t+r,n-r],[t+r,n+r],[t-r,n+r],[t-r,n-r]]}else if(i&&(i=="diamond"||i=="d")){var o=e.lineWidth>1?e.lineWidth*Math.sqrt(2)/4:0;s=[[t,n-r],[t+r,n],[t,n+r],[t-r,n],[t+o,n-r-o]]}else if(i&&(i=="triangle"||i=="t")){s=[[t,n-r],[t+Math.sqrt(3)*r/2,n+r/2],[t-Math.sqrt(3)*r/2,n+r/2],[t,n-r]]}else s=[[t,n,r,0,Math.PI*2,true]];this._path(e,s)},_getPointY:function(e,t,n,r){var i=r.minValue;var s=r.maxValue;var o=r.unit;var u=r.valueFactor;var a=this._settings.value(e);if(this._logScaleCalc){a=this._log10(a)}var f=(parseFloat(a||0)-i)*u;if(!this._settings.yAxis)f+=r.startValue/o;var l=n.y-o*f;if(this._settings.fixOverflow&&(this._settings.type=="line"||this._settings.type=="area")){if(a>s)l={y:t.y,y0:l,out:"max"};else if(f<0||a<i)l={y:n.y,y0:l,out:"min"}}else{if(a>s)l=t.y;if(f<0||a<i)l=n.y}return l},_calculateLineParams:function(e,t,n,r,i){var s={};var o;s.totalHeight=r.y-n.y;s.cellWidth=(r.x-n.x)/(!this._settings.offset?t.length-1:t.length);var u=!!this._settings.yAxis;var a=this._settings.type.indexOf("stacked")!=-1?this._getStackedLimits(t):this._getLimits();s.maxValue=a.max;s.minValue=a.min;if(!i)this._drawScales(t,n,r,s.minValue,s.maxValue,s.cellWidth);if(u){s.maxValue=parseFloat(this._settings.yAxis.end);s.minValue=parseFloat(this._settings.yAxis.start)}var f=this._getRelativeValue(s.minValue,s.maxValue);o=f[0];s.valueFactor=f[1];s.unit=o?s.totalHeight/o:10;s.startValue=0;if(!u){s.startValue=10;if(s.unit!=s.totalHeight)s.unit=o?(s.totalHeight-s.startValue)/o:10}return s}});webix.extend(webix.ui.chart,{$render_barH:function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C;a=(r.y-n.y)/t.length;h=this._getLimits("h");p=h.max;d=h.min;E=r.x-n.x;C=!!this._settings.yAxis;if(!i)this._drawHScales(e,t,n,r,d,p,a);if(C){p=parseFloat(this._settings.xAxis.end);d=parseFloat(this._settings.xAxis.start)}b=this._getRelativeValue(d,p);g=b[0];m=b[1];x=g?E/g:10;if(!C){w=10;x=g?(E-w)/g:10}u=parseInt(this._settings.barWidth,10);if(u*this._series.length+4>a)u=a/this._series.length-4;o=Math.floor((a-u*this._series.length)/2);y=typeof this._settings.radius!="undefined"?parseInt(this._settings.radius,10):Math.round(u/5);v=false;l=this._settings.gradient;if(l&&typeof l!="function"){v=l;l=false}else if(l){l=e.createLinearGradient(n.x,n.y,r.x,n.y);this._settings.gradient(l)}if(!C){this._drawLine(e,n.x-.5,n.y,n.x-.5,r.y,"#000000",1)}for(c=0;c<t.length;c++){S=parseFloat(this._settings.value(t[c]||0));if(this._logScaleCalc)S=this._log10(S);if(S>p)S=p;S-=d;S*=m;T=n.x;N=n.y+o+c*a+(u+1)*i;if(S<0&&this._settings.origin=="auto"||this._settings.xAxis&&S===0&&!(this._settings.origin!="auto"&&this._settings.origin>d)){this.canvases[i].renderTextAt("middle","right",T+10,N+u/2+o,this._settings.label(t[c]));continue}if(S<0&&this._settings.origin!="auto"&&this._settings.origin>d){S=0}if(!C)S+=w/x;f=l||this._settings.color.call(this,t[c]);if(this._settings.border){this._drawBarHBorder(e,T,N,u,d,y,x,S,f)}e.globalAlpha=this._settings.alpha.call(this,t[c]);var k=this._drawBarH(e,r,T,N,u,d,y,x,S,f,l,v);if(v){this._drawBarHGradient(e,T,N,u,d,y,x,S,f,v)}e.globalAlpha=1;if(k[3]==N){this.canvases[i].renderTextAt("middle","left",k[0]-5,k[3]+Math.floor(u/2),this._settings.label(t[c]));s.addRect(t[c].id,[k[0]-n.x,k[3]-n.y,k[2]-n.x,k[3]+u-n.y],i)}else{this.canvases[i].renderTextAt("middle",false,k[2]+5,k[1]+Math.floor(u/2),this._settings.label(t[c]));s.addRect(t[c].id,[k[0]-n.x,N-n.y,k[2]-n.x,k[3]-n.y],i)}}},_setBarHPoints:function(e,t,n,r,i,s,o,u,a){var f=0;if(i>s*o){var l=(i-s*o)/i;f=-Math.asin(l)+Math.PI/2}e.moveTo(t,n+u);var c=t+s*o-i-(i?0:u);if(i<s*o)e.lineTo(c,n+u);var h=n+i;if(i&&i>0)e.arc(c,h,i-u,-Math.PI/2+f,0,false);var p=n+r-i-(i?0:u);var d=c+i-(i?u:0);e.lineTo(d,p);if(i&&i>0)e.arc(c,p,i-u,0,Math.PI/2-f,false);var v=n+r-u;e.lineTo(t,v);if(!a){e.lineTo(t,n+u)}return[d,v]},_drawHScales:function(e,t,n,r,i,s,o){var u=0;if(this._settings.xAxis){if(!this.canvases["x"])this.canvases["x"]=this._createCanvas("axis_x");u=this._drawHXAxis(this.canvases["x"].getCanvas(),t,n,r,i,s)}if(this._settings.yAxis){if(!this.canvases["y"])this.canvases["y"]=this._createCanvas("axis_y");this._drawHYAxis(this.canvases["y"].getCanvas(),t,n,r,o,u)}},_drawHYAxis:function(e,t,n,r,i,s){if(!this._settings.yAxis)return;var o;var u=parseInt(s?s:n.x,10)-.5;var a=r.y+.5;var f=n.y;this._drawLine(e,u,a,u,f,this._settings.yAxis.color,1);for(var l=0;l<t.length;l++){var c=this._settings.origin!="auto"&&this._settings.type=="barH"&&parseFloat(this._settings.value(t[l]))<this._settings.origin;o=f+i/2+l*i;this.canvases["y"].renderTextAt("middle",c?false:"left",c?u+5:u-5,o,this._settings.yAxis.template(t[l]),"webix_axis_item_y",c?0:u-10);if(this._settings.yAxis.lines.call(this,t[l]))this._drawLine(e,n.x,o,r.x,o,this._settings.yAxis.lineColor.call(this,t[l]),1)}this._drawLine(e,n.x+.5,f+.5,r.x,f+.5,this._settings.yAxis.lineColor.call(this,{}),1);this._setYAxisTitle(n,r)},_drawHXAxis:function(e,t,n,r,i,s){var o;var u={};var a=this._settings.xAxis;if(!a)return;var f=r.y+.5;var l=n.x-.5;var c=r.x-.5;var h=n.x;this._drawLine(e,l,f,c,f,a.color,1);if(a.step)o=parseFloat(a.step);if(typeof this._configXAxis.step=="undefined"||typeof this._configXAxis.start=="undefined"||typeof this._configXAxis.end=="undefined"){u=this._calculateScale(i,s);i=u.start;s=u.end;o=u.step;this._settings.xAxis.end=s;this._settings.xAxis.start=i;this._settings.xAxis.step=o}if(o===0)return;var p=(c-l)*o/(s-i);var d=0;for(var v=i;v<=s;v+=o){var m=this._logScaleCalc?Math.pow(10,v):v;if(u.fixNum)m=parseFloat(m).toFixed(u.fixNum);var g=Math.floor(l+d*p)+.5;if(!(v==i&&this._settings.origin=="auto")&&a.lines.call(this,v))this._drawLine(e,g,f,g,n.y,this._settings.xAxis.lineColor.call(this,v),1);if(v==this._settings.origin)h=g+1;if(o<1&&!this._logScaleCalc){var y=Math.min(Math.floor(this._log10(o)),i<=0?0:Math.floor(this._log10(i)));var b=Math.pow(10,-y);m=Math.round(m*b)/b;v=m}this.canvases["x"].renderTextAt(false,true,g,f+2,a.template(m.toString()),"webix_axis_item_x");d++}this.canvases["x"].renderTextAt(true,false,l,r.y+this._settings.padding.bottom-3,this._settings.xAxis.title,"webix_axis_title_x",r.x-n.x);if(!a.lines.call(this,{})){this._drawLine(e,l,n.y-.5,c,n.y-.5,this._settings.xAxis.color,.2)}return h},_correctBarHParams:function(e,t,n,r,i,s,o){var u=this._settings.yAxis;var a=t;if(!!u&&this._settings.origin!="auto"&&this._settings.origin>o){t+=(this._settings.origin-o)*i;a=t;r=r-(this._settings.origin-o);if(r<0){r*=-1;e.translate(t,n+s);e.rotate(Math.PI);t=.5;n=0}t+=.5}return{value:r,x0:t,y0:n,start:a}},_drawBarH:function(e,t,n,r,i,s,o,u,a,f,l,c){e.save();var h=this._correctBarHParams(e,n,r,a,u,i,s);e.fillStyle=f;e.beginPath();var p=this._setBarHPoints(e,h.x0,h.y0,i,o,u,h.value,this._settings.border?1:0);if(l&&!c)e.lineTo(t.x,h.y0+(this._settings.border?1:0));e.fill();e.restore();var d=h.y0;var v=h.y0!=r?r:p[1];var m=h.y0!=r?h.start-p[0]:h.start;var g=h.y0!=r?h.start:p[0];return[m,d,g,v]},_drawBarHBorder:function(e,t,n,r,i,s,o,u,a){e.save();var f=this._correctBarHParams(e,t,n,u,o,r,i);e.beginPath();this._setBorderStyles(e,a);e.globalAlpha=.9;this._setBarHPoints(e,f.x0,f.y0,r,s,o,f.value,e.lineWidth/2,1);e.stroke();e.restore()},_drawBarHGradient:function(e,t,n,r,i,s,o,u,a,f){e.save();var l=this._correctBarHParams(e,t,n,u,o,r,i);var c=this._setBarGradient(e,l.x0,l.y0+r,l.x0+o*l.value,l.y0,f,a,"x");e.fillStyle=c.gradient;e.beginPath();this._setBarHPoints(e,l.x0,l.y0+c.offset,r-c.offset*2,s,o,l.value,c.offset);e.fill();e.globalAlpha=1;e.restore()}});webix.extend(webix.ui.chart,{$render_stackedBar:function(e,t,n,r,i,s){var o,u;var a;var f;var l=r.y-n.y;var c=!!this._settings.yAxis;var h=!!this._settings.xAxis;var p=this._getStackedLimits(t);o=p.max;u=p.min;var d=Math.floor((r.x-n.x)/t.length);if(!i)this._drawScales(t,n,r,u,o,d);if(c){o=parseFloat(this._settings.yAxis.end);u=parseFloat(this._settings.yAxis.start)}var v=this._getRelativeValue(u,o);f=v[0];a=v[1];var m=f?l/f:10;var g=parseInt(this._settings.barWidth,10);if(g+4>d)g=d-4;var y=Math.floor((d-g)/2);var b=this._settings.gradient?this._settings.gradient:false;if(!h){this._drawLine(e,n.x,r.y+.5,r.x,r.y+.5,"#000000",1)}for(var w=0;w<t.length;w++){var E=parseFloat(this._settings.value(t[w]||0));if(this._logScaleCalc)E=this._log10(E);if(!E){if(!i||!t[w].$startY)t[w].$startY=r.y;continue}if(!i)E-=u;E*=a;var S=n.x+y+w*d;var x=r.y;if(!i)t[w].$startY=x;else x=t[w].$startY;if(x<n.y+1)continue;if(E<0||this._settings.yAxis&&E===0){this.canvases["y"].renderTextAt(true,true,S+Math.floor(g/2),x,this._settings.label(t[w]));continue}var T=this._settings.color.call(this,t[w]);e.globalAlpha=this._settings.alpha.call(this,t[w]);e.fillStyle=this._settings.color.call(this,t[w]);e.beginPath();var N=this._setStakedBarPoints(e,S-(this._settings.border?.5:0),x,g+(this._settings.border?.5:0),m,E,0,n.y);e.fill();if(b){e.save();var C=this._setBarGradient(e,S,x,S+g,N[1],b,T,"y");e.fillStyle=C.gradient;e.beginPath();N=this._setStakedBarPoints(e,S+C.offset,x,g-C.offset*2,m,E,this._settings.border?1:0,n.y);e.fill();e.restore()}if(this._settings.border){e.save();this._setBorderStyles(e,T);e.beginPath();this._setStakedBarPoints(e,S-.5,x,g+1,m,E,0,n.y,1);e.stroke();e.restore()}e.globalAlpha=1;this.canvases[i].renderTextAt(false,true,S+Math.floor(g/2),N[1]+(x-N[1])/2-7,this._settings.label(t[w]));s.addRect(t[w].id,[S-n.x,N[1]-n.y,N[0]-n.x,(t[w].$startY||x)-n.y],i);t[w].$startY=this._settings.border?N[1]+1:N[1]}},_setStakedBarPoints:function(e,t,n,r,i,s,o,u,a){e.moveTo(t,n);var f=n-i*s+o;if(f<u)f=u;e.lineTo(t,f);var l=t+r;var c=f;e.lineTo(l,c);var h=t+r;e.lineTo(h,n);if(!a){e.lineTo(t,n)}return[h,c-2*o]}});webix.extend(webix.ui.chart,{$render_stackedBarH:function(e,t,n,r,i,s){var o,u;var a;var f;var l=r.x-n.x;var c=!!this._settings.yAxis;var h=this._getStackedLimits(t);o=h.max;u=h.min;var p=Math.floor((r.y-n.y)/t.length);if(!i)this._drawHScales(e,t,n,r,u,o,p);if(c){o=parseFloat(this._settings.xAxis.end);u=parseFloat(this._settings.xAxis.start)}var d=this._getRelativeValue(u,o);f=d[0];a=d[1];var v=f?l/f:10;var m=0;if(!c){m=10;v=f?(l-m)/f:10}var g=parseInt(this._settings.barWidth,10);if(g+4>p)g=p-4;var y=(p-g)/2;var b=0;var w=false;var E=this._settings.gradient;if(E){w=true}if(!c){this._drawLine(e,n.x-.5,n.y,n.x-.5,r.y,"#000000",1)}var S=0;var x=0;for(T=0;T<this._series.length;T++){if(T==i){x=S}if(this._series[T].type=="stackedBarH")S++}for(var T=0;T<t.length;T++){if(!x)t[T].$startX=n.x;var N=parseFloat(this._settings.value(t[T]||0));if(N>o)N=o;N-=u;N*=a;var C=n.x;var k=n.y+y+T*p;if(!x)t[T].$startX=C;else C=t[T].$startX;if(N<0||this._settings.yAxis&&N===0){this.canvases["y"].renderTextAt("middle",true,C+10,k+g/2,this._settings.label(t[T]));continue}if(!c)N+=m/v;var L=this._settings.color.call(this,t[T]);e.globalAlpha=this._settings.alpha.call(this,t[T]);e.fillStyle=this._settings.color.call(this,t[T]);e.beginPath();var A=this._setBarHPoints(e,C,k,g,b,v,N,this._settings.border?1:0);if(E&&!w)e.lineTo(n.x+l,k+(this._settings.border?1:0));e.fill();if(w){var O=this._setBarGradient(e,C,k+g,C,k,w,L,"x");e.fillStyle=O.gradient;e.beginPath();A=this._setBarHPoints(e,C,k,g,b,v,N,0);e.fill()}if(this._settings.border){this._drawBarHBorder(e,C,k,g,u,b,v,N,L)}e.globalAlpha=1;this.canvases[i].renderTextAt("middle",true,t[T].$startX+(A[0]-t[T].$startX)/2-1,k+(A[1]-k)/2,this._settings.label(t[T]));s.addRect(t[T].id,[t[T].$startX-n.x,k-n.y,A[0]-n.x,A[1]-n.y],i);t[T].$startX=A[0]}}});webix.extend(webix.ui.chart,{$render_spline:function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y;l=this._calculateLineParams(e,t,n,r,i);o=this._settings;this._mapStart=n;a=[];if(t.length){p=o.offset?n.x+l.cellWidth*.5:n.x;for(u=0;u<t.length;u++){m=this._getPointY(t[u],n,r,l);if(m){h=!u?p:l.cellWidth*u-.5+p;a.push({x:h,y:m,index:u})}}c=this._getSplineParameters(a);for(u=0;u<a.length;u++){d=a[u].x;g=a[u].y;if(u<a.length-1){v=a[u+1].x;y=a[u+1].y;for(f=d;f<v;f++){var b=this._getSplineYPoint(f,d,u,c.a,c.b,c.c,c.d);if(b<n.y)b=n.y;if(b>r.y)b=r.y;var w=this._getSplineYPoint(f+1,d,u,c.a,c.b,c.c,c.d);if(w<n.y)w=n.y;if(w>r.y)w=r.y;this._drawLine(e,f,b,f+1,w,o.line.color(t[u]),o.line.width)}this._drawLine(e,v-1,this._getSplineYPoint(f,d,u,c.a,c.b,c.c,c.d),v,y,o.line.color(t[u]),o.line.width)}this._drawItem(e,d,g,t[a[u].index],o.label(t[a[u].index]),i,s)}}},_getSplineParameters:function(e){var t,n,r,i,s,o,u,a,f=[],l=[],c=e.length;for(s=0;s<c-1;s++){f[s]=e[s+1].x-e[s].x;l[s]=(e[s+1].y-e[s].y)/f[s]}u=[];a=[];u[0]=0;u[1]=2*(f[0]+f[1]);a[0]=0;a[1]=6*(l[1]-l[0]);for(s=2;s<c-1;s++){u[s]=2*(f[s-1]+f[s])-f[s-1]*f[s-1]/u[s-1];a[s]=6*(l[s]-l[s-1])-f[s-1]*a[s-1]/u[s-1]}o=[];o[c-1]=o[0]=0;for(s=c-2;s>=1;s--)o[s]=(a[s]-f[s]*o[s+1])/u[s];t=[];n=[];r=[];i=[];for(s=0;s<c-1;s++){t[s]=e[s].y;n[s]=-f[s]*o[s+1]/6-f[s]*o[s]/3+(e[s+1].y-e[s].y)/f[s];r[s]=o[s]/2;i[s]=(o[s+1]-o[s])/(6*f[s])}return{a:t,b:n,c:r,d:i}},_getSplineYPoint:function(e,t,n,r,i,s,o){return r[n]+(e-t)*(i[n]+(e-t)*(s[n]+(e-t)*o[n]))}});webix.extend(webix.ui.chart,{$render_area:function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;c=this._calculateLineParams(e,t,n,r,i);u=this._settings;f=u.eventRadius||Math.floor(c.cellWidth/2);if(t.length){h=[];v=!u.offset?n.x:n.x+c.cellWidth*.5;for(a=0;a<t.length;a++){l=t[a];d=this._getPointY(l,n,r,c);y=v+c.cellWidth*a;if(d){b=typeof d=="object"?d.y0:d;if(a&&this._settings.fixOverflow){p=this._getPointY(t[a-1],n,r,c);if(p.out&&p.out==d.out){continue}m=c.cellWidth*(a-1)-.5+v;g=typeof p=="object"?p.y0:p;if(p.out){w=p.out=="min"?r.y:n.y;h.push([this._calcOverflowX(m,y,g,b,w),w])}if(d.out){w=d.out=="min"?r.y:n.y;h.push([this._calcOverflowX(m,y,g,b,w),w]);if(a==t.length-1&&w==n.y)h.push([y,n.y])}}if(!d.out){h.push([y,b]);s.addRect(l.id,[y-f-n.x,b-f-n.y,y+f-n.x,b+f-n.y],i)}if(!u.yAxis){o=!u.offset&&a==t.length-1?"left":"center";this.canvases[i].renderTextAt(false,o,y,b-u.labelOffset,u.label(l))}}}if(h.length){h.push([y,r.y]);h.push([h[0][0],r.y])}e.globalAlpha=this._settings.alpha.call(this,t[0]);e.fillStyle=this._settings.color.call(this,t[0]);e.beginPath();this._path(e,h);e.fill();if(u.border){e.lineWidth=u.borderWidth||1;if(u.borderColor)e.strokeStyle=u.borderColor.call(this,t[0]);else this._setBorderStyles(e,e.fillStyle);e.beginPath();this._path(e,h);e.stroke()}e.lineWidth=1;e.globalAlpha=1}},$render_stackedArea:function(e,t,n,r,i,s){var o,u,a,f,l,c,h,p,d,v,m,g,y,b;v=this._calculateLineParams(e,t,n,r,i);f=this._settings;p=f.eventRadius||Math.floor(v.cellWidth/2);if(t.length){m=[];b=[];g=!f.offset?n.x:n.x+v.cellWidth*.5;var w=function(e,n){return i?t[e].$startY?n-r.y+t[e].$startY:0:n};var E=function(e,t,n){var r=(n.y-t.y)/(n.x-t.x);return r*e+t.y-r*t.x};for(l=0;l<t.length;l++){d=t[l];if(!l){y=w(l,r.y);m.push([g,y])}else{g+=v.cellWidth}y=w(l,this._getPointY(d,n,r,v));b.push(isNaN(y)&&!l?t[l].$startY||r.y:y);if(y){m.push([g,y]);s.addRect(d.id,[g-p-n.x,y-p-n.y,g+p-n.x,y+p-n.y],i);if(!f.yAxis){a=!f.offset&&h?"left":"center";this.canvases[i].renderTextAt(false,a,g,y-f.labelOffset,f.label(d))}}}m.push([g,w(l-1,r.y)]);if(i){for(l=t.length-2;l>0;l--){g-=v.cellWidth;y=t[l].$startY;if(y)m.push([g,y])}}m.push([m[0][0],m[0][1]]);e.globalAlpha=this._settings.alpha.call(this,t[0]);e.fillStyle=this._settings.color.call(this,t[0]);e.beginPath();this._path(e,m);e.fill();for(l=0;l<t.length;l++){y=b[l];if(!y){if(l==t.length-1){y=t[l].$startY}for(c=l+1;c<t.length;c++){if(b[c]){o={x:n.x,y:b[0]};u={x:n.x+v.cellWidth*c,y:b[c]};y=E(n.x+v.cellWidth*l,o,u);break}}}t[l].$startY=y}}}});webix.extend(webix.ui.chart,{$render_radar:function(e,t,n,r,i,s){this._renderRadarChart(e,t,n,r,i,s)},_renderRadarChart:function(e,t,n,r,i,s){if(!t.length)return;var o=this._getPieParameters(n,r);var u=this._settings.radius?this._settings.radius:o.radius;var a=this._settings.x?this._settings.x:o.x;var f=this._settings.y?this._settings.y:o.y;var l=[];for(var c=0;c<t.length;c++)l.push(1);var h=this._getRatios(l,t.length);this._mapStart=n;if(!i)this._drawRadarAxises(h,a,f,u,t);this._drawRadarData(e,h,a,f,u,t,i,s)},_drawRadarData:function(e,t,n,r,i,s,o,u){var a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C;l=this._settings;h=l.yAxis.start;p=l.yAxis.end;C=this._getRelativeValue(h,p);b=C[0];N=b?i/b:i/2;T=C[1];w=-Math.PI/2;a=f=w;m=[];v=0;for(c=0;c<s.length;c++){if(!x){E=l.value(s[c]);if(this._logScaleCalc)E=this._log10(E);S=(parseFloat(E||0)-h)*T}else S=x;g=Math.floor(N*S);E=l.value(c!=s.length-1?s[c+1]:s[0]);if(this._logScaleCalc)E=this._log10(E);x=(parseFloat(E||0)-h)*T;y=Math.floor(N*x);a=f;f=c!=s.length-1?w+t[c]-1e-4:w;d=v||this._getPositionByAngle(a,n,r,g);v=this._getPositionByAngle(f,n,r,y);m.push(d)}if(l.fill)this._fillRadarChart(e,m,s);if(!l.disableLines&&s.length>2)this._strokeRadarChart(e,m,s);if(!l.disableItems||s.length<3)this._drawRadarItemMarkers(e,m,s,o,u);m=null},_drawRadarItemMarkers:function(e,t,n,r,i){for(var s=0;s<t.length;s++){this._drawItem(e,t[s].x,t[s].y,n[s],this._settings.label.call(this,n),r,i)}},_fillRadarChart:function(e,t,n){var r,i;e.globalAlpha=this._settings.alpha.call(this,{});e.beginPath();for(var s=0;s<t.length;s++){e.fillStyle=this._settings.fill.call(this,n[s]);r=t[s];i=t[s+1]||t[0];if(!s){e.moveTo(r.x,r.y)}e.lineTo(i.x,i.y)}e.fill();e.globalAlpha=1},_strokeRadarChart:function(e,t,n){var r,i;for(var s=0;s<t.length;s++){r=t[s];i=t[s+1]||t[0];this._drawLine(e,r.x,r.y,i.x,i.y,this._settings.line.color.call(this,n[s]),this._settings.line.width)}},_drawRadarAxises:function(e,t,n,r,i){var s=this._settings.yAxis;var o=this._settings.xAxis;var u=s.start;var a=s.end;var f=s.step;var l={};var c=this._configYAxis;if(typeof c.step=="undefined"||typeof c.start=="undefined"||typeof c.end=="undefined"){var h=this._getLimits();l=this._calculateScale(h.min,h.max);u=l.start;a=l.end;f=l.step;s.end=a;s.start=u}var p=[];var d,v,m;var g=0;var y=r*f/(a-u);var b,w;if(f<1){b=Math.min(this._log10(f),u<=0?0:this._log10(u));w=Math.pow(10,-b)}var E=[];if(!this.canvases["scale"])this.canvases["scale"]=this._createCanvas("radar_scale");var S=this.canvases["scale"].getCanvas();for(d=a;d>=u;d-=f){var x=this._logScaleCalc?Math.pow(10,d):d;if(l.fixNum)x=parseFloat(d).toFixed(l.fixNum);p.push(Math.floor(g*y)+.5);if(w&&!this._logScaleCalc){x=Math.round(x*w)/w;d=x}var T=n-r+p[p.length-1];this.canvases["scale"].renderTextAt("middle","left",t,T,s.template(x.toString()),"webix_axis_item_y webix_radar");if(e.length<2){this._drawScaleSector(S,"arc",t,n,r-p[p.length-1],-Math.PI/2,3*Math.PI/2,d);return}var N=-Math.PI/2;var C=N;var k;for(v=0;v<e.length;v++){if(d==a)E.push(C);k=N+e[v]-1e-4;this._drawScaleSector(S,e.length>2?c.lineShape||"line":"arc",t,n,r-p[p.length-1],C,k,d,v,i[d]);C=k}g++}for(d=0;d<E.length;d++){m=this._getPositionByAngle(E[d],t,n,r);if(o.lines.call(this,i[d],d))this._drawLine(S,t,n,m.x,m.y,o?o.lineColor.call(this,i[d]):"#cfcfcf",1);this._drawRadarScaleLabel(S,t,n,r,E[d],o?o.template.call(this,i[d]):"&nbsp;")}},_drawScaleSector:function(e,t,n,r,i,s,o,u,a){var f,l;if(i<0)return false;f=this._getPositionByAngle(s,n,r,i);l=this._getPositionByAngle(o,n,r,i);var c=this._settings.yAxis;if(c.bg){e.beginPath();e.moveTo(n,r);if(t=="arc")e.arc(n,r,i,s,o,false);else{e.lineTo(f.x,f.y);e.lineTo(l.x,l.y)}e.fillStyle=c.bg(u,a);e.moveTo(n,r);e.fill();e.closePath()}if(c.lines.call(this,u)){e.lineWidth=1;e.beginPath();if(t=="arc")e.arc(n,r,i,s,o,false);else{e.moveTo(f.x,f.y);e.lineTo(l.x,l.y)}e.strokeStyle=c.lineColor.call(this,u);e.stroke()}},_drawRadarScaleLabel:function(e,t,n,r,i,s){var o=this.canvases["scale"].renderText(0,0,s,"webix_axis_radar_title",1);var u=o.scrollWidth;var a=o.offsetHeight;var f=.001;var l=this._getPositionByAngle(i,t,n,r+5);var c=0,h=0;if(i<0||i>Math.PI){h=-a}if(i>Math.PI/2){c=-u}if(Math.abs(i+Math.PI/2)<f||Math.abs(i-Math.PI/2)<f){c=-u/2}else if(Math.abs(i)<f||Math.abs(i-Math.PI)<f){h=-a/2}o.style.top=l.y+h+"px";o.style.left=l.x+c+"px";o.style.width=u+"px";o.style.whiteSpace="nowrap"}});webix.extend(webix.ui.chart,{$render_scatter:function(e,t,n,r,i,s){if(!this._settings.xValue)return webix.log("warning","Undefined propery: xValue");var o=this._getLimits();var u=this._getLimits("h","xValue");if(!i){if(!this.canvases["x"])this.canvases["x"]=this._createCanvas("axis_x");if(!this.canvases["y"])this.canvases["y"]=this._createCanvas("axis_y");this._drawYAxis(this.canvases["y"].getCanvas(),t,n,r,o.min,o.max);this._drawHXAxis(this.canvases["x"].getCanvas(),t,n,r,u.min,u.max)}o={min:this._settings.yAxis.start,max:this._settings.yAxis.end};u={min:this._settings.xAxis.start,max:this._settings.xAxis.end};var a=this._getScatterParams(e,t,n,r,u,o);this._mapStart=n;for(var f=0;f<t.length;f++){this._drawScatterItem(e,s,n,r,a,u,o,t[f],i)}},_getScatterParams:function(e,t,n,r,i,s){var o={};o.totalHeight=r.y-n.y;o.totalWidth=r.x-n.x;this._calcScatterUnit(o,i.min,i.max,o.totalWidth,"X");this._calcScatterUnit(o,s.min,s.max,o.totalHeight,"Y");return o},_drawScatterItem:function(e,t,n,r,i,s,o,u,a){var f=this._calculateScatterItemPosition(i,r,n,s,u,"X");var l=this._calculateScatterItemPosition(i,n,r,o,u,"Y");this._drawItem(e,f,l,u,this._settings.label.call(this,u),a,t)},_calculateScatterItemPosition:function(e,t,n,r,i,s){var o=this._settings[s=="X"?"xValue":"value"].call(this,i);var u=e["valueFactor"+s];var a=(parseFloat(o||0)-r.min)*u;var f=e["unit"+s];var l=n[s.toLowerCase()]-(s=="X"?-1:1)*Math.floor(f*a);if(a<0)l=n[s.toLowerCase()];if(o>r.max)l=t[s.toLowerCase()];if(o<r.min)l=n[s.toLowerCase()];return l},_calcScatterUnit:function(e,t,n,r,i){var s=this._getRelativeValue(t,n);i=i||"";e["relValue"+i]=s[0];e["valueFactor"+i]=s[1];e["unit"+i]=e["relValue"+i]?r/e["relValue"+i]:10}});webix.extend(webix.ui.chart,{presets:{simple:{item:{borderColor:"#ffffff",color:"#2b7100",shadow:false,borderWidth:2},line:{color:"#8ecf03",width:2}},plot:{color:"#1293f8",item:{borderColor:"#636363",borderWidth:1,color:"#ffffff",type:"r",shadow:false},line:{color:"#1293f8",width:2}},diamond:{color:"#b64040",item:{borderColor:"#b64040",color:"#b64040",type:"d",radius:3,shadow:true},line:{color:"#ff9000",width:2}},point:{color:"#fe5916",disableLines:true,fill:false,disableItems:false,item:{color:"#feb916",borderColor:"#fe5916",radius:2,borderWidth:1,type:"r"},alpha:1},line:{line:{color:"#3399ff",width:2},item:{color:"#ffffff",borderColor:"#3399ff",radius:2,borderWidth:2,type:"d"},fill:false,disableItems:false,disableLines:false,alpha:1},area:{fill:"#3399ff",line:{color:"#3399ff",width:1},disableItems:true,alpha:.2,disableLines:false},round:{item:{radius:3,borderColor:"#3f83ff",borderWidth:1,color:"#3f83ff",type:"r",shadow:false,alpha:.6}},square:{item:{radius:3,borderColor:"#447900",borderWidth:2,color:"#69ba00",type:"s",shadow:false,alpha:1}},column:{color:"RAINBOW",gradient:false,barWidth:45,radius:0,alpha:1,border:true},stick:{barWidth:5,gradient:false,color:"#67b5c9",radius:2,alpha:1,border:false},alpha:{color:"#b9a8f9",barWidth:70,gradient:"falling",radius:0,alpha:.5,border:true}}});webix.protoUI({name:"calendar",defaults:{date:new Date,select:false,navigation:true,monthSelect:true,weekHeader:true,weekNumber:false,skipEmptyWeeks:false,calendarHeader:"%F %Y",calendarWeekHeader:"W#",calendarTime:"%H:%i",events:webix.Date.isHoliday,minuteStep:5,timepickerHeight:30,headerHeight:70,dayTemplate:function(e){return e.getDate()},width:259,height:250},dayTemplate_setter:webix.template,calendarHeader_setter:webix.Date.dateToStr,calendarWeekHeader_setter:webix.Date.dateToStr,calendarTime_setter:webix.Date.dateToStr,date_setter:function(e){return this._string_to_date(e)},maxDate_setter:function(e){return this._string_to_date(e)},minDate_setter:function(e){return this._string_to_date(e)},$init:function(){this._viewobj.className+=" webix_calendar";this._special_dates={};this._selected_date_part=this._selected_date=null;this._zoom_level=0},$setSize:function(e,t){if(webix.ui.view.prototype.$setSize.call(this,e,t)){this.render()}},$getSize:function(e,t){if(this._settings.cellHeight){var n=this._getDateBoundaries(this._settings.date);this._settings.height=this._settings.cellHeight*n.rows+webix.skin.$active.calendar.height}return webix.ui.view.prototype.$getSize.call(this,e,t)},_getDateBoundaries:function(e,t){if(!this._set_date_bounds||t){var n=e.getMonth();var r=e.getFullYear();var i=new Date(r,n+1,1);var s=webix.Date.weekStart(new Date(r,n,1));var o=Math.round((i.valueOf()-s.valueOf())/(60*1e3*60*24));var u=this._settings.skipEmptyWeeks?Math.ceil(o/7):6;this._set_date_bounds={_month:n,_start:s,_next:i,_rows:u}}return this._set_date_bounds},$skin:function(){if(webix.skin.$active.calendar){if(webix.skin.$active.calendar.width)this.defaults.width=webix.skin.$active.calendar.width;if(webix.skin.$active.calendar.height)this.defaults.height=webix.skin.$active.calendar.height;if(webix.skin.$active.calendar.headerHeight)this.defaults.headerHeight=webix.skin.$active.calendar.headerHeight;if(webix.skin.$active.calendar.timepickerHeight)this.defaults.timepickerHeight=webix.skin.$active.calendar.timepickerHeight}},_getColumnConfigSizes:function(e){var t=this._getDateBoundaries(e);var n=this._settings;var r=[];var i=[];var s=this._content_width-42;var o=this._content_height-this.config.headerHeight-10-(this._settings.timepicker?this.config.timepickerHeight:0);var u=n.weekNumber?8:7;for(var a=0;a<u;a++){i[a]=Math.ceil(s/(u-a));s-=i[a]}var f=t._rows;for(var l=0;l<f;l++){r[l]=Math.ceil(o/(f-l));o-=r[l]}return[i,r]},refresh:function(){this.render()},render:function(){this._zoom_level=0;this._zoom_size=false;var e=this._settings;if(!this.isVisible(e.id))return;this._current_time=webix.Date.datePart(new Date);if(webix.debug_render)webix.log("Render: "+this.name+"@"+e.id);this.callEvent("onBeforeRender",[]);var t=this._settings.date;var n=this._getDateBoundaries(t,true);var r=this._getColumnConfigSizes(t);var i=r[0];var s=r[1];var o="<div class='webix_cal_month'><span class='webix_cal_month_name'>"+e.calendarHeader(t)+"</span>";if(e.navigation)o+="<div class='webix_cal_prev_button'></div><div class='webix_cal_next_button'></div>";o+="</div>";if(e.weekHeader)o+="<div class='webix_cal_header'>"+this._week_template(i)+"</div>";o+="<div class='webix_cal_body'>"+this._body_template(i,s,n)+"</div>";if(this._settings.timepicker)o+="<div class='webix_cal_time'>"+this._timepicker_template(t)+"</div>";this._contentobj.innerHTML=o;this.callEvent("onAfterRender",[])},_timepicker_template:function(e){return"<div><span class='webix_icon fa-clock-o'></span> "+this._settings.calendarTime(e)+"</div>"},_week_template:function(e){var t=this._settings;var n="";var r=0;if(t.weekNumber){r=1;n+="<div class='webix_cal_week_header' style='width: "+e[0]+"px;' >"+t.calendarWeekHeader()+"</div>"}var i=webix.Date.startOnMonday?1:0;for(var s=0;s<7;s++){var o=(i+s)%7;var u=webix.i18n.calendar.dayShort[o];n+="<div day='"+o+"' style='width: "+e[s+r]+"px;' >"+u+"</div>"}return n},blockDates_setter:function(e){return webix.toFunctor(e,this.$scope)},_day_css:function(e,t){var n="webix_cal_day";if(webix.Date.equal(e,this._current_time))n+=" webix_cal_today";if(webix.Date.equal(e,this._selected_date_part))n+=" webix_cal_select";if(e.getMonth()!=t._month)n+=" webix_cal_outside";if(this._settings.blockDates&&this._settings.blockDates.call(this,e)||e<this._settings.minDate||e>this._settings.maxDate)n+=" webix_cal_day_disabled";if(this._settings.events)n+=" "+this._settings.events(e);return n},_body_template:function(e,t,n){var r=this._settings;var i="";var s=webix.Date.datePart(webix.Date.copy(n._start));var o=r.weekNumber?1:0;var u=webix.Date.getISOWeek(webix.Date.add(s,2,"day",true));var a=this._settings.minDate||new Date(1,1,1);var f=this._settings.maxDate||new Date(9999,1,1);for(var l=0;l<t.length;l++){i+="<div class='webix_cal_row' style='height:"+t[l]+"px'>";if(o)i+="<div class='webix_cal_week_num' style='width:"+e[0]+"px'>"+u+"</div>";for(var c=o;c<e.length;c++){var h=this._day_css(s,n);var p=this._settings.dayTemplate.call(this,s);i+="<div day='"+c+"' class='"+h+"' style='width:"+e[c]+"px'><span class='webix_cal_day_inner'>"+p+"</span></div>";s=webix.Date.add(s,1,"day")}i+="</div>";u++}return i},_changeDate:function(e,t,n){var r=this._settings.date;if(!t){t=this._zoom_logic[this._zoom_level]._changeStep}if(!this._zoom_level){r=webix.Date.copy(r);r.setDate(1)}var i=webix.Date.add(r,e*t,"month",true);this._changeDateInternal(r,i)},_changeDateInternal:function(e,t){if(this.callEvent("onBeforeMonthChange",[e,t])){if(this._zoom_level){this._update_zoom_level(t)}else{this.showCalendar(t)}this.callEvent("onAfterMonthChange",[t,e])}},_zoom_logic:{"-2":{_setContent:function(e,t){e.setMinutes(t)}},"-1":{_setContent:function(e,t){e.setHours(t)}},0:{_changeStep:1},1:{_getTitle:function(e){return e.getFullYear()},_getContent:function(e){return webix.i18n.calendar.monthShort[e]},_setContent:function(e,t){if(t!=e.getMonth())e.setDate(1);e.setMonth(t)},_changeStep:12},2:{_getTitle:function(e){var t=e.getFullYear();this._zoom_start_date=t=t-t%10-1;return t+" - "+(t+10)},_getContent:function(e){return this._zoom_start_date+e},_setContent:function(e,t){e.setFullYear(this._zoom_start_date+t)},_changeStep:12*10}},_update_zoom_level:function(e){var t,n,r,i,s;var o="";var u=this._settings.weekHeader?2:1;var a=this._zoom_logic[this._zoom_level];var f=this._contentobj.childNodes;if(e)this._settings.date=e;if(!this._zoom_size){this._reserve_box_height=this._contentobj.offsetHeight-this.config.headerHeight-this.config.timepickerHeight;this._reserve_box_width=f[u].offsetWidth;this._zoom_size=1}if(this._zoom_in){n=this._reserve_box_height/6;s=(this._reserve_box_width-1)/6;o+="<div class='webix_time_header'>"+this._timeHeaderTemplate(s)+"</div>";o+="<div  class='webix_cal_body' style='height:"+this._reserve_box_height+"px'>";o+="<div class='webix_hours'>";i=this._settings.date.getHours();for(r=0;r<24;r++){t=i==r?" webix_selected":"";o+="<div class='webix_cal_block"+t+"' data-value='"+r+"' style='"+this._getCalSizesString(s,n)+(r%4===0?"clear:both;":"")+"'>"+webix.Date.toFixed(r)+"</div>"}o+="</div>";o+="<div class='webix_minutes'>";i=this._settings.date.getMinutes();for(r=0;r<60;r+=this._settings.minuteStep){t=i==r?" webix_selected":"";o+="<div class='webix_cal_block webix_cal_block_min"+t+"' data-value='"+r+"' style='"+this._getCalSizesString(s,n)+"'>"+webix.Date.toFixed(r)+"</div>"}o+="</div>";o+="</div>";o+="<div  class='webix_time_footer'>"+this._timeButtonsTemplate()+"</div>";this._contentobj.innerHTML=o}else{f[0].firstChild.innerHTML=a._getTitle(this._settings.date);n=this._reserve_box_height/3;s=this._reserve_box_width/4;i=this._zoom_level==1?this._settings.date.getMonth():this._settings.date.getFullYear();for(r=0;r<12;r++){t=i==(this._zoom_level==1?r:a._getContent(r))?" webix_selected":"";o+="<div class='webix_cal_block"+t+"' data-value='"+r+"' style='"+this._getCalSizesString(s,n)+"'>"+a._getContent(r)+"</div>"}if(u-1){f[u-1].style.display="none"}f[u].innerHTML=o;if(!f[u+1]){this._contentobj.innerHTML+="<div  class='webix_time_footer'>"+this._timeButtonsTemplate()+"</div>"}else f[u+1].innerHTML=this._timeButtonsTemplate();f[u].style.height=this._reserve_box_height+"px"}},_getCalSizesString:function(e,t){return"width:"+e+"px; height:"+t+"px; line-height:"+t+"px;"},_timeButtonsTemplate:function(){return"<input type='button' style='width:100%' class='webix_cal_done' value='"+webix.i18n.calendar.done+"'>"},_timeHeaderTemplate:function(e){var t=e*4;var n=e*2;return"<div class='webix_cal_hours' style='width:"+t+"px'>"+webix.i18n.calendar.hours+"</div><div class='webix_cal_minutes' style='width:"+n+"px'>"+webix.i18n.calendar.minutes+"</div>"},_changeZoomLevel:function(e,t){if(this.callEvent("onBeforeZoom",[e])){this._zoom_level=e;if(e)this._update_zoom_level(t);else this.showCalendar(t);this.callEvent("onAfterZoom",[e])}},_mode_selected:function(e){var t=this._settings.date;var n=webix.Date.copy(t);this._zoom_logic[this._zoom_level]._setContent(n,e);var r=this._zoom_level-1;this._changeZoomLevel(r,n)},_selectDate:function(e){if(this.callEvent("onBeforeDateSelect",[e])){this.selectDate(e,true);this.callEvent("onDateSelect",[e]);this.callEvent("onAfterDateSelect",[e])}},on_click:{webix_cal_prev_button:function(e,t,n){this._changeDate(-1)},webix_cal_next_button:function(e,t,n){this._changeDate(1)},webix_cal_day:function(e,t,n){if(n.className.indexOf("webix_cal_day_disabled")!==-1)return false;var r=webix.html.index(n)-(this._settings.weekNumber?1:0);var i=webix.html.index(n.parentNode);var s=webix.Date.add(this._getDateBoundaries()._start,r+i*7,"day",true);if(this._settings.timepicker){s.setHours(this._settings.date.getHours());s.setMinutes(this._settings.date.getMinutes())}this._selectDate(s)},webix_cal_time:function(e){if(this._zoom_logic[this._zoom_level-1]){this._zoom_in=true;var t=this._zoom_level-1;this._changeZoomLevel(t)}},webix_cal_done:function(e){this._selectDate(this._settings.date)},webix_cal_month_name:function(e){this._zoom_in=false;if(this._zoom_level==2||!this._settings.monthSelect)return;var t=Math.max(this._zoom_level,0)+1;this._changeZoomLevel(t)},webix_cal_block:function(e,t,n){if(this._zoom_in){var r=n.className.indexOf("webix_cal_block_min")!=-1?this._zoom_level-1:this._zoom_level;var i=this._settings.date;var s=webix.Date.copy(i);this._zoom_logic[r]._setContent(s,n.getAttribute("data-value")*1);this._update_zoom_level(s)}else{this._mode_selected(n.getAttribute("data-value")*1)}}},_string_to_date:function(e,t){if(!e)return new Date;if(typeof e=="string"){if(t)e=webix.Date.strToDate(t)(e);else e=webix.i18n.parseFormatDate(e)}return e},showCalendar:function(e){e=this._string_to_date(e);this._settings.date=e;this.render();this.resize()},getSelectedDate:function(){return this._selected_date?webix.Date.copy(this._selected_date):this._selected_date},getVisibleDate:function(){return webix.Date.copy(this._settings.date)},setValue:function(e,t){this.selectDate(e,true)},getValue:function(e){var t=this.getSelectedDate();if(e)t=webix.Date.dateToStr(e)(t);return t},selectDate:function(e,t){if(e){e=this._string_to_date(e);this._selected_date=e;this._selected_date_part=webix.Date.datePart(webix.Date.copy(e))}else{this._selected_date=null;this._selected_date_part=null}if(t)this.showCalendar(e);else this.render();this.callEvent("onChange",[e])},locate:function(){return null}},webix.MouseEvents,webix.ui.view,webix.EventSystem);webix.protoUI({name:"property",$init:function(){this._contentobj.className+=" webix_property";this._destroy_with_me=[]},defaults:{nameWidth:100,editable:true},on_render:{checkbox:function(e,t){return"<input type='checkbox' class='webix_property_check' "+(e?"checked":"")+">"},color:function(e,t){return'<div class="webix_property_col_val"><div class=\'webix_property_col_ind\' style="background-color:'+(e||"#FFFFFF")+';"></div><span>'+e+"</span></div>"}},on_edit:{label:false},_id:"webix_f_id",on_click:{webix_property_check:function(e){var t=this.locate(e);this.getItem(t).value=!this.getItem(t).value;this.callEvent("onCheck",[t,this.getItem(t).value]);return false}},on_dblclick:{},registerType:function(e,t){if(t.template)this.on_render[e]=t.template;if(t.editor)this.on_edit[e]=t.editor;if(t.click)for(var n in t.click)this.on_click[n]=t.click[n]},elements_setter:function(e){this._idToLine={};for(var t=0;t<e.length;t++){var n=e[t];n.id=n.id||webix.uid();n.label=n.label||"";n.value=n.value||"";this._idToLine[n.id]=t;this.template=this._map_options(e[t])}return e},showItem:function(e){webix.RenderStack.showItem.call(this,e)},locate:function(e){return webix.html.locate(arguments[0],this._id)},getItemNode:function(e){return this._dataobj.childNodes[this._idToLine[e]]},getItem:function(e){return this._settings.elements[this._idToLine[e]]},_get_editor_type:function(e){var t=this.getItem(e).type;if(t=="checkbox")return"inline-checkbox";var n=this.on_edit[t];return n===false?false:n||t},_get_edit_config:function(e){return this.getItem(e)},_find_cell_next:function(e,t,n){var r=this._idToLine[e.id];var i=this._settings.elements;if(n){for(var s=r+1;s<i.length;s++){if(t.call(this,i[s].id))return i[s].id}}else{for(var s=r-1;s>=0;s--){if(t.call(this,i[s].id))return i[s].id}}return null},updateItem:function(){this.refresh()},_cellPosition:function(e){var t=this.getItemNode(e);return{left:t.offsetLeft+this._settings.nameWidth,top:t.offsetTop,height:t.firstChild.offsetHeight,width:this._data_width,parent:this._contentobj}},setValues:function(e){this._clear();for(var t in e){var n=this.getItem(t);if(n)n.value=e[t]}this._props_dataset=e;this.refresh()},_onLoad:function(){return webix.Values._onLoad.apply(this,arguments)},_clear:function(){var e=this._settings.elements;for(var t=0;t<e.length;t++)e[t].value=""},getValues:function(){var e=webix.clone(this._props_dataset||{});for(var t=0;t<this._settings.elements.length;t++){var n=this._settings.elements[t];if(n.type!="label")e[n.id]=n.value}return e},refresh:function(){this.render()},$setSize:function(e,t){if(webix.ui.view.prototype.$setSize.call(this,e,t)){this._data_width=this._content_width-this._settings.nameWidth;this.render()}},$getSize:function(e,t){if(this._settings.autoheight){var n=this._settings.elements.length;this._settings.height=Math.max(this.type.height*n,this._settings.minHeight||0)}return webix.ui.view.prototype.$getSize.call(this,e,t)},_toHTML:function(){var e=[];var t=this._settings.elements;if(t)for(var n=0;n<t.length;n++){var r=t[n];if(r.css&&typeof r.css=="object")r.css=webix.html.createCss(r.css);var i='<div webix_f_id="'+r.id+'" class="webix_property_line '+(r.css||"")+'">';if(r.type=="label")e[n]=i+"<div class='webix_property_label_line'>"+r.label+"</div></div>";else{var s=this.on_render[r.type],o;var u="<div class='webix_property_label' style='width:"+this._settings.nameWidth+"px'>"+r.label+"</div><div class='webix_property_value' style='width:"+this._data_width+"px'>";if(r.collection||r.options){o=r.template(r,r.value)}else if(r.format)o=r.format(r.value);else o=r.value;if(s)o=s.call(this,r.value,r);e[n]=i+u+o+"</div></div>"}}return e.join("")},type:{height:24,templateStart:webix.template(""),templateEnd:webix.template("</div>")},$skin:function(){this.type.height=webix.skin.$active.propertyItemHeight||24}},webix.EditAbility,webix.MapCollection,webix.MouseEvents,webix.Scrollable,webix.SingleRender,webix.AtomDataLoader,webix.EventSystem,webix.ui.view);webix.protoUI({name:"colorboard",defaults:{template:'<div style="width:100%;height:100%;background-color:{obj.val}"></div>',palette:null,height:220,width:220,cols:12,rows:10,minLightness:.15,maxLightness:1},$init:function(e){webix.event(this._viewobj,"click",webix.bind(function(e){var t=webix.html.locate(e,"webix_val");this.setValue(t);this.callEvent("onSelect",[this._settings.value,e])},this))},_findIndex:function(e){var t=this._settings.palette;e=e.toUpperCase();for(var n=0,r=t.length;n<r;n++)for(var i=0,s=t[n].length;i<s;i++){if(t[n][i].toUpperCase()==e){return{row:n,col:i}}}return null},$setSize:function(e,t){if(webix.ui.view.prototype.$setSize.call(this,e,t)){this.render()}},getValue:function(){return this._settings.value},_getBox:function(){return this._viewobj.firstChild},setValue:function(e){if(!e)return;if(e.charAt(0)!="#")e="#"+e;this._settings.value=e;this._drawSelection(e);return e},_selectBox:null,_getSelectBox:function(){if(this._selectBox&&this._selectBox.parentNode){return this._selectBox}else{var e=this._selectBox=document.createElement("div");e.className="webix_color_selector";this._viewobj.lastChild.appendChild(e);return e}},_drawSelection:function(e,t){if(this.isVisible()){var n=0,r=0;if(!t){var i=this._findIndex(e);if(i){t=this._viewobj.lastChild.childNodes[i.row].childNodes[i.col]}}if(t&&t.parentNode&&t.parentNode.parentNode){var s=t.parentNode;n=t.offsetLeft-s.offsetLeft;r=-(this.$height-(t.offsetTop-s.parentNode.offsetTop))}else{if(this._selectBox)this._selectBox.style.left="-100px";return}var o=this._getSelectBox();var u=["left:"+n+"px","top:"+r+"px","width:"+t.style.width,"height:"+t.style.height].join(";");if(typeof o.style.cssText!=="undefined"){o.style.cssText=u}else{o.setAttribute("style",u)}}},_initPalette:function(e){function t(e){return webix.color.toHex(e,2)}function n(e,n,r){return"#"+t(Math.floor(e))+t(Math.floor(n))+t(Math.floor(r))}function r(e,t,n){var r,s,o;if(!t){r=s=o=n}else{var u=n<.5?n*(1+t):n+t-n*t;var a=2*n-u;r=i(a,u,e+1/3);s=i(a,u,e);o=i(a,u,e-1/3)}return{r:r*255,g:s*255,b:o*255}}function i(e,t,n){if(n<0)n+=1;if(n>1)n-=1;if(n<1/6)return e+(t-e)*6*n;else if(n<=1/2)return t;else if(n<2/3)return e+(t-e)*(2/3-n)*6;else return e}function s(e){var t=[],r=255,i=r/e;for(var s=0;s<e;s++){r=Math.round(r>0?r:0);t.push(n(r,r,r));r-=i}t[t.length-1]="#000000";return t}var o=[];var u=e.rows-1;var a=1/e.cols;var f=(e.maxLightness-e.minLightness)/u;var l=null;o.push(s(e.cols));for(var c=0,h=e.minLightness;c<u;c++){l=[];for(var p=0,d=0;p<e.cols;p++){var v=r(d,1,h);l.push(n(v.r,v.g,v.b));d+=a}o.push(l);h+=f}this._settings.palette=o},render:function(){function p(e,t,i){var s='<div class="webix_color_row">';for(var o=0;o<e.length;o++){r.width=t[o];r.height=i;r.val=e[o];s+=n(r)}s+="</div>";return s}if(!this.isVisible(this._settings.id))return;if(!this._settings.palette)this._initPalette(this._settings);var e=this._settings.palette;this.callEvent("onBeforeRender",[]);var t=this._settings,n=webix.template('<div style="width:{obj.width}px;height:{obj.height}px;" webix_val="{obj.val}">'+(t.template||"")+"</div>"),r={width:0,height:0,val:0},i=this.$width,s=this.$height,o=[];var u='<div class="webix_color_palette">';var a=typeof e[0]=="object"?e[0]:e;for(var f=0;f<a.length;f++){o[f]=Math.floor(i/(a.length-f));i-=o[f]}if(typeof e[0]=="object"){for(var l=0;l<e.length;l++){var c=Math.floor(s/(e.length-l));s-=c;var h=e[l];u+=p(h,o,c)}}else{u+=p(e,o,s)}u+="</div>";this._viewobj.innerHTML=u;this._selectBox=null;this.callEvent("onAfterRender",[])},refresh:function(){this.render()}},webix.ui.view,webix.EventSystem);webix.protoUI({name:"resizer",defaults:{width:7,height:7},$init:function(e){webix.assert(this.getParentView(),"Resizer can't be initialized outside a layout");var t=this.getParentView()._margin;webix.event(this._viewobj,webix.env.mouse.down,this._rsDown,this);webix.event(document.body,webix.env.mouse.up,this._rsUp,this);var n=this._getResizeDir();this._rs_started=false;this._resizer_dir=n;this._resizer_dim=n=="x"?"width":"height";if(n=="x")e.height=0;else e.width=0;if(t>0){this._viewobj.className+=" webix_resizer_v"+n;this._viewobj.style.marginRight="-"+t+"px";if(n=="x")e.width=t;else e.height=t;this.$nospace=true}else this._viewobj.className+=" webix_resizer_"+n;this._viewobj.innerHTML="<div class='webix_resizer_content'></div>";if(n=="y"&&t>0)this._viewobj.style.marginBottom="-"+(e.height||this.defaults.height)+"px"},_rsDown:function(e){var t=this._getResizerCells();if(t){e=e||event;this._rs_started=true;this._rs_process=webix.html.pos(e);this._rsLimit=[];this._rsStart(e,t[0])}},_rsUp:function(){this._rs_started=false;this._rs_process=false},_rsStart:function(e,t){var n,r,i,s,o;e=e||event;n=this._resizer_dir;this.getParentView()._viewobj.style.position="relative";i=webix.html.offset(this._viewobj);s=webix.html.offset(this.getParentView()._viewobj);o=i[n]-s[n];r=webix.html.offset(t.$view)[n]-webix.html.offset(this.getParentView().$view)[n];this._rs_progress=[n,t,o,r];this._resizeStick=new webix.ui.resizearea({container:this.getParentView()._viewobj,dir:n,eventPos:this._rs_process[n],start:o-1,height:this.$height,width:this.$width,border:1,margin:this.getParentView()["_padding"+n.toUpperCase()]});this._resizeStick.attachEvent("onResizeEnd",webix.bind(this._rsEnd,this));this._resizeStick.attachEvent("onResize",webix.bind(this._rsResizeHandler,this));webix.html.addCss(document.body,"webix_noselect")},_getResizeDir:function(){return this.getParentView()._vertical_orientation?"y":"x"},_rsResizeHandler:function(){var e,t,n,r,i,s,o,u,a,f;if(this._rs_progress){e=this._getResizerCells();i=this._rs_progress[0];r=this._resizeStick._last_result-this._rs_progress[2];a=this._rsGetDiffCellSizes(e,i,r);f=e[0]["$"+this._resizer_dim]+e[1]["$"+this._resizer_dim];o=i=="y"?["minHeight","maxHeight"]:["minWidth","maxWidth"];for(s=0;s<2;s++){t=e[s]._settings;n=s?-r:r;var l=t[o[0]];var c=t[o[1]];if(n>0&&c&&c<=a[s]||n<0&&(l||3)>=a[s]){this._rsLimit[s]=n>0?c:l||3;u=this._rsGetLimitCellSizes(e,i);this._resizeStick._dragobj.style[i=="y"?"top":"left"]=this._rs_progress[3]+u[0]+"px";return}else if(a[s]<3){this._resizeStick._dragobj.style[i=="y"?"top":"left"]=this._rs_progress[3]+s*f+1+"px"}else{this._rsLimit[s]=null}}}},_getResizerCells:function(){var e,t;e=this.getParentView()._cells;for(t=0;t<e.length;t++){if(e[t]==this){if(!e[t-1]||e[t-1]._settings.$noresize)return null;if(!e[t+1]||e[t+1]._settings.$noresize)return null;return[e[t-1],e[t+1]]}}},_rsEnd:function(e){if(typeof e=="undefined")return;var t,n,r,i,s;var o=this.getParentView()._vertical_orientation;this._resizerStick=null;if(this._rs_progress){n=this._rs_progress[0];r=e-this._rs_progress[2];t=this._getResizerCells();if(t[0]&&t[1]){s=this._rsGetCellSizes(t,n,r);for(var i=0;i<2;i++){var u=t[i].$getSize(0,0);if(o?u[2]==u[3]:Math.abs(u[1]-u[0])<3){t[i]._settings[this._resizer_dim]=s[i];if(t[i]._bubble_size)t[i]._bubble_size(this._resizer_dim,s[i],o)}else{var a=t[i].$view[o?"offsetHeight":"offsetWidth"];t[i]._settings.gravity=s[i]/a*t[i]._settings.gravity}}t[0].resize();for(var i=0;i<2;i++)if(t[i].callEvent)t[i].callEvent("onViewResize",[]);webix.callEvent("onLayoutResize",[t])}this._rs_progress=false}this._rs_progress=false;this._rs_started=false;this._rsLimit=null;webix.html.removeCss(document.body,"webix_noselect")},_rsGetLimitCellSizes:function(e){var t,n,r;r=e[0]["$"+this._resizer_dim]+e[1]["$"+this._resizer_dim];if(this._rsLimit[0]){t=this._rsLimit[0];n=r-t}else if(this._rsLimit[1]){n=this._rsLimit[1];t=r-n}return[t,n]},_rsGetDiffCellSizes:function(e,t,n){var r=[];for(var i=0;i<2;i++)r[i]=e[i]["$"+this._resizer_dim]+(i?-1:1)*n;return r},_rsGetCellSizes:function(e,t,n){var r,i,s;if(this._rsLimit[0]||this._rsLimit[1]){i=this._rsGetLimitCellSizes(e,t)}else{i=this._rsGetDiffCellSizes(e,t,n);for(r=0;r<2;r++){if(i[r]<0){s=i[0]+i[1];i[r]=1;i[1-r]=s-1}}}return i}},webix.MouseEvents,webix.ui.view);webix.protoUI({name:"multiview",defaults:{animate:{}},setValue:function(e){webix.$$(e).show()},getValue:function(){return this.getActiveId()},$init:function(){this._active_cell=0;this._vertical_orientation=1;this._viewobj.style.position="relative";this._viewobj.className+=" webix_multiview";this._back_queue=[]},_ask_render:function(e,t){var n=webix.$$(e);if(!n._render_hash){n._render_queue=[];n._render_hash={}}if(!n._render_hash[t]){n._render_hash[t]=true;n._render_queue.push(t)}},_render_activation:function(e){var t=webix.$$(e);if(this._back_queue[this._back_queue.length-2]!=e){if(this._back_queue.length==10)this._back_queue.splice(0,1);this._back_queue.push(e)}else this._back_queue.splice(this._back_queue.length-1,1);if(t._render_hash){for(var n=0;n<t._render_queue.length;n++)webix.$$(t._render_queue[n]).render();t._render_queue=[];t._render_hash={}}},_hide:function(){},_parse_cells:function(e){e=e||this._collection;for(var t=0;t<e.length;t++)e[t]._inner=this._settings.borderless?{top:1,left:1,right:1,bottom:1}:this._settings._inner||{};webix.ui.baselayout.prototype._parse_cells.call(this,e);for(var t=1;t<this._cells.length;t++)webix.html.remove(this._cells[t]._viewobj);for(var t=0;t<e.length;t++){var n=this._cells[t];if(n._cells&&!n._render_borders)continue;var r=n._settings._inner;if(r.top)n._viewobj.style.borderTopWidth="0px";if(r.left)n._viewobj.style.borderLeftWidth="0px";if(r.right)n._viewobj.style.borderRightWidth="0px";if(r.bottom)n._viewobj.style.borderBottomWidth="0px"}this._render_activation(this.getActiveId())},cells_setter:function(e){webix.assert(e&&e.length,"Multiview must have at least one view in 'cells'");this._collection=e},_getDirection:function(e,t){var n=(this._settings.animate||{}).direction;var r=n=="top"||n=="bottom";return e<t?r?"bottom":"right":r?"top":"left"},_show:function(e,t){if(this._in_animation)return webix.delay(this._show,this,[e],100);var n=-1;for(var r=0;r<this._cells.length;r++)if(this._cells[r]==e){n=r;break}if(n<0||n==this._active_cell)return;var i=this._cells[this._active_cell]?this._cells[this._active_cell].config.id:null;var s=this._cells[n]?this._cells[n].config.id:null;var o=this._cells[this._active_cell].$getSize(0,0);if((t||typeof t=="undefined")&&webix.animate.isSupported()&&this._settings.animate){var u=webix.extend({},this._settings.animate);u.direction=this._getDirection(n,this._active_cell);u=webix.Settings._mergeSettings(t||{},u);var a=webix.animate.formLine(this._cells[n]._viewobj,this._cells[this._active_cell]._viewobj,u);this._cells[n].$getSize(0,0);this._cells[n].$setSize(this._content_width,this._content_height);var f=u.callback;u.callback=function(){webix.animate.breakLine(a);this._in_animation=false;if(f)f.call(this);f=u.master=u.callback=null;this.resize()};u.master=this;this._active_cell=n;this._render_activation(this.getActiveId());webix.animate(a,u);this._in_animation=true}else{webix.html.remove(this._cells[this._active_cell]._viewobj);this._active_cell=n;this._viewobj.appendChild(this._cells[r]._viewobj);this._cells[this._active_cell].resize();this._render_activation(this.getActiveId())}this.callEvent("onViewChange",[i,s])},$getSize:function(e,t){webix.debug_size_box_start(this,true);var n=this._cells[this._active_cell].$getSize(0,0);if(this._settings.fitBiggest){for(var r=0;r<this._cells.length;r++)if(r!=this._active_cell){var i=this._cells[r].$getSize(0,0);for(var s=0;s<4;s++)n[s]=Math.max(n[s],i[s])}}var o=webix.ui.baseview.prototype.$getSize.call(this,0,0);if(o[1]>=1e5)o[1]=0;if(o[3]>=1e5)o[3]=0;o[0]=(o[0]||n[0])+e;o[1]=(o[1]||n[1])+e;o[2]=(o[2]||n[2])+t;o[3]=(o[3]||n[3])+t;webix.debug_size_box_end(this,o);return o},$setSize:function(e,t){this._layout_sizes=[e,t];webix.ui.baseview.prototype.$setSize.call(this,e,t);this._cells[this._active_cell].$setSize(e,t)},isVisible:function(e,t){if(t&&t!=this.getActiveId()){if(e)this._ask_render(t,e);return false}return webix.ui.view.prototype.isVisible.call(this,e,this._settings.id)},getActiveId:function(){return this._cells.length?this._cells[this._active_cell]._settings.id:null},back:function(e){e=e||1;if(this.callEvent("onBeforeBack",[this.getActiveId(),e])){if(this._back_queue.length>e){var t=this._back_queue[this._back_queue.length-e-1];webix.$$(t).show();return t}return null}return null}},webix.ui.baselayout);webix.protoUI({name:"form",defaults:{type:"form",autoheight:true},_default_height:-1,_form_classname:"webix_form",_form_vertical:true,$getSize:function(e,t){var n=webix.ui.layout.prototype.$getSize.call(this,e,t);if(this._settings.scroll||!this._settings.autoheight){n[2]=this._settings.height||this._settings.minHeight||0;n[3]+=1e5}return n}},webix.ui.toolbar);webix.protoUI({name:"menu",_listClassName:"webix_menu",$init:function(){this.data.attachEvent("onStoreUpdated",webix.bind(function(){this._hide_sub_menu()},this));this.attachEvent("onMouseMove",this._mouse_move_menu);this.attachEvent("onMouseOut",function(){if(this._menu_was_activated()&&this._settings.openAction=="click")return;if(!this._child_menu_active)this._hide_sub_menu()});this.attachEvent("onItemClick",function(e,t,n){var r=this.getItem(e);if(r){if(r.$template)return;var i=this.getTopMenu();if(!this.data.getMark(e,"webix_disabled")){i.callEvent("onMenuItemClick",[e,t,n]);if(this!=i)i._call_onclick(e,t,n);if(!r.submenu){i._hide_sub_menu(true);if(i._hide_on_item_click)i.hide()}else{if((this===i||webix.env.touch)&&i._settings.openAction=="click"){this._mouse_move_activation(e,n)}i._block_hide_sub_menu(new Date)}}}});this.data.attachEvent("onCleaAll",function(){this._hidden_items=[]});this.data._hidden_items=[]},getTopMenu:function(){var e=this;while(e._parent_menu)e=webix.$$(e._parent_menu);return e},_auto_height_calc:function(e){if(this._settings.autoheight)e=this.count();var t=0;for(var n=0;n<e;n++){var r=this.data.pull[this.data.order[n]];if(r.$template=="Separator")t+=4;else t+=this.type.height}return t},on_mouse_move:{},type:{css:"menu",width:"auto",templateStart:function(e,t,n){if(e.$template){return'<div webix_l_id="#id#" class="webix_context_sep">'}var r=e.target?" target='"+e.target+"' ":"";var i="<a"+(e.href?" href='"+e.href+"' ":"")+r+" class='webix_menu_link' >";return webix.ui.list.prototype.type.templateStart(e,t,n)+i+(e.submenu&&t.subsign?"<div class='webix_submenu_icon'></div>":"")},templateEnd:function(e,t,n){return"</a>"+webix.ui.list.prototype.type.templateEnd(e,t,n)},templateSeparator:webix.template("<div class='sep_line'></div>")},getSubMenu:function(e){if(!this.data.pull[e]){for(var t in this.data.pull){var n=this.getItem(t);if(n.submenu){var r=this._get_submenu(n).getSubMenu(e);if(r)return r}}}else return this},getMenuItem:function(e){return this.getSubMenu(e).getItem(e)},_get_submenu:function(e){var t=webix.$$(e.submenu);if(!t){e.submenu=this._create_sub_menu(e);t=webix.$$(e.submenu)}return t},_mouse_move_menu:function(e,t,n){if(!this._menu_was_activated())return;this._mouse_move_activation(e,n)},_menu_was_activated:function(){var e=this.getTopMenu();if(e._settings.openAction=="click"){if(webix.env.touch)return false;var t=e._open_sub_menu;if(t&&webix.$$(t).isVisible())return true;return false}return true},_mouse_move_activation:function(e,t){var n=this.getItem(e);if(!n)return;this._child_menu_active=null;if(this._open_sub_menu&&n.submenu!=this._open_sub_menu)this._hide_sub_menu(true);if(n.submenu&&!this.config.hidden){var r=this._get_submenu(n);if(this.data.getMark(e,"webix_disabled"))return;r.show(t,{pos:this._settings.subMenuPos});r._parent_menu=this._settings.id;this._open_sub_menu=n.submenu}},disableItem:function(e){this.getSubMenu(e).addCss(e,"webix_disabled")},enableItem:function(e){this.getSubMenu(e).removeCss(e,"webix_disabled")},_set_item_hidden:function(e,t){var n=this.data;if(n._hidden_items[e]!=t){n._hidden_items[e]=t;n.filter(function(e){return!n._hidden_items[e.id]});this.resize()}},hideItem:function(e){var t=this.getSubMenu(e);if(t)t._set_item_hidden(e,true)},showItem:function(e){var t=this.getSubMenu(e);if(t){t._set_item_hidden(e,false);return webix.ui.list.prototype.showItem.call(t,e)}},_block_hide_sub_menu:function(e){this._show_time_click=e;if(this._open_sub_menu){var t=webix.$$(this._open_sub_menu);if(t._block_hide_sub_menu)t._block_hide_sub_menu(e)}},_hide_sub_menu:function(e){if(this._open_sub_menu){var t=webix.$$(this._open_sub_menu);if(t._hide_sub_menu)t._hide_sub_menu(e);if(e||!t._show_on_mouse_out){t._show_time=new Date(2012,1,1);t.hide();this._open_sub_menu=null}}},_create_sub_menu:function(e){var t={view:"submenu",data:e.submenu};var n=this.getMenuItem(e.id);if(n&&n.config){webix.extend(t,n.config)}var r=this.getTopMenu()._settings.submenuConfig;if(r)webix.extend(t,r);var i=webix.ui(t);return i._settings.id},$skin:function(){webix.ui.list.prototype.$skin.call(this);this.type.height=webix.skin.$active.menuHeight},defaults:{scroll:"",layout:"x",mouseEventDelay:100,subMenuPos:"bottom"}},webix.ui.list);webix.protoUI({name:"submenu",$init:function(){this._body_cell=this._dummy_cell_interface;this._body_cell._view=this;this.attachEvent("onMouseOut",function(){if(this.getTopMenu()._settings.openAction=="click")return;if(!this._child_menu_active&&!this._show_on_mouse_out)this.hide()});this.attachEvent("onMouseMoving",function(){if(this._parent_menu)webix.$$(this._parent_menu)._child_menu_active=true})},$skin:function(){webix.ui.menu.prototype.$skin.call(this);webix.ui.popup.prototype.$skin.call(this);this.type.height=webix.skin.$active.menuHeight},_dummy_cell_interface:{$getSize:function(e,t){var n=this._view._settings.height;var r=this._view._settings.width;var i=webix.ui.menu.prototype.$getSize.call(this._view,e,t);this._view._settings.height=n;this._view._settings.width=r;return i},$setSize:function(e,t){if(this._view._settings.scroll)this._view._bodyobj.style.height=t+"px"},destructor:function(){this._view=null}},body_setter:function(){},defaults:{width:150,subMenuPos:"right",layout:"y",autoheight:true},type:{height:webix.skin.menuHeight,subsign:true}},webix.ui.menu,webix.ui.popup);webix.ContextHelper={defaults:{padding:"4",hidden:true},body_setter:function(e){e=webix.ui.window.prototype.body_setter.call(this,e);this._body_cell._viewobj.style.borderWidth="0px";return e},attachTo:function(e){webix.assert(e,"Invalid target for Context::attach");if(e.on_context)e.attachEvent("onAfterContextMenu",webix.bind(this._show_at_ui,this));else webix.event(e,"contextmenu",this._show_at_node,this)},getContext:function(){return this._area},_show_at_node:function(e){this._area=webix.toNode(e||event);return this._show_at(e)},_show_at_ui:function(e,t,n){this._area={obj:webix.$$(t),id:e};return this._show_at(t)},_show_at:function(e){if(!this.callEvent("onBeforeShow",[e]))return;this.show(e,null,true);webix.callEvent("onClick",[e]);return webix.html.preventEvent(e)},_show_on_mouse_out:true,master_setter:function(e){this.attachTo(e);return null}};webix.protoUI({name:"context"},webix.ContextHelper,webix.ui.popup);webix.protoUI({name:"contextmenu",_hide_on_item_click:true,$init:function(e){if(e.submenuConfig)webix.extend(e,e.submenuConfig)}},webix.ContextHelper,webix.ui.submenu);webix.protoUI({name:"tabbar",$skin:function(){var e=webix.skin.$active;var t=this.defaults;t.topOffset=e.tabTopOffset||0;t.tabOffset=typeof e.tabOffset!="undefined"?e.tabOffset:10;t.bottomOffset=e.tabBottomOffset||0;t.height=e.tabbarHeight;t.tabMargin=e.tabMargin;t.inputPadding=e.inputPadding;t.tabMinWidth=e.tabMinWidth||100;t.tabMoreWidth=e.tabMoreWidth||40},_getTabbarSizes:function(){var e=this.config,t=e.options.length,n=this._input_width-e.tabOffset*2-(!e.type?e.tabMargin*(t-1):0)-t+1;if(n/t<e.tabMinWidth){return{max:parseInt(n/e.tabMinWidth,10)||1}}return{width:n/t}},_init_popup:function(){var e=this._settings;if(!e.tabbarPopup){var t={view:"popup",width:e.popupWidth||200,body:{view:"list",borderless:true,select:true,css:"webix_tab_list",autoheight:true,yCount:e.yCount,type:{template:e.popupTemplate}}};var n=webix.ui(t);n.getBody().attachEvent("onBeforeSelect",webix.bind(function(e){if(e&&this.callEvent("onBeforeTabClick",[e])){this.setValue(e);webix.$$(this._settings.tabbarPopup).hide();this.callEvent("onAfterTabClick",[e]);return true}},this));e.tabbarPopup=n._settings.id;this._destroy_with_me.push(n)}this._init_popup=function(){}},getPopup:function(){this._init_popup();return webix.$$(this._settings.tabbarPopup)},moreTemplate_setter:webix.template,popupTemplate_setter:webix.template,defaults:{popupWidth:200,popupTemplate:"#value#",yCount:7,moreTemplate:'<span class="webix_icon fa-ellipsis-h"></span>',template:function(e,t){var n,r,i,s,o,u,a,f,l,c=e.options;if(!c.length){r="<div class='webix_tab_filler' style='width:"+t._input_width+"px; border-right:0px;'></div>"}else{t._check_options(c);if(!e.value&&c.length)e.value=c[0].id;c=webix.copy(c);r="";if(e.tabOffset)r+="<div class='webix_tab_filler' style='width:"+e.tabOffset+"px;'>&nbsp;</div>";n=t._input_width-e.tabOffset*2-(!e.type?e.tabMargin*(c.length-1):0)-c.length+1;f=e.topOffset+e.bottomOffset;var h=t._getTabbarSizes();if(h.max&&h.max<c.length){var p=t.getPopup();p.hide();var d=p.getBody()||null;if(d){if(h.max){var v=false;for(i=0;i<c.length&&!v;i++)if(c[i].id==e.value){v=true;if(i+1>h.max){var m=c.splice(i+1-h.max,h.max);c=m.concat(c)}}d.clearAll();d.parse(c.slice(h.max))}else{d.clearAll()}}}else if(t._settings.tabbarPopup)webix.$$(t._settings.tabbarPopup).hide();a=e.tabOffset;var g=false;for(i=0;i<c.length&&!g;i++){if(h&&h.max){if(h.max==i+1){g=true}n=t._input_width-e.tabOffset*2-(!e.type&&h.max>1?e.tabMargin*(h.max-1):0)-h.max+1;l=(n-e.tabMoreWidth)/h.max}else l=h.width;l=c[i].width||e.optionWidth||l;a+=l+(i&&!e.type?e.tabMargin+1:0)+1;if(e.tabMargin>0&&i&&!e.type)r+="<div class='webix_tab_filler' style='width:"+e.tabMargin+"px;'></div>";r+=t._getTabHTML(c[i],l);if(g){var y=t._content_height-(!e.type?f:0);r+='<div class="webix_tab_more_icon" style="width:'+e.tabMoreWidth+"px;line-height:"+y+'px">'+e.moreTemplate(e,t)+"</div>";a+=e.tabMoreWidth}}s=t._content_width-a-e.tabOffset*2;if(s>0&&!e.type)r+="<div class='webix_tab_filler' style='width:"+s+"px;'>&nbsp;</div>"}o="";u=f&&!e.type?"height:"+(t._content_height-f)+"px'":"";if(e.topOffset&&!e.type)o+="<div class='webix_before_all_tabs' style='width:100%;height:"+e.topOffset+"px'></div>";o+="<div style='"+u+"' class='webix_all_tabs "+(e.type?"webixtype_"+e.type:"")+"'>"+r+"</div>";if(e.bottomOffset&&!e.type)o+="<div class='webix_after_all_tabs' style='width:100%;height:"+e.bottomOffset+"px'></div>";return o}},_getTabHTML:function(e,t){var n,r="",i=this.config;if(e.id==i.value)r=" webix_selected";if(e.css)r+=" "+e.css;t=e.width||t;n='<div class="webix_item_tab'+r+'" button_id="'+e.id+'" style="width:'+t+'px;">';if(this._tabTemplate){var s=this._content_height-i.inputPadding*2-2;var o=this._content_height-2;var u=webix.extend({cheight:s,aheight:o},e);n+=this._tabTemplate(u)}else n+=e.value;n+="</div>";return n},_types:{image:"<div class='webix_img_btn_top' style='height:#cheight#px;background-image:url(#image#);'><div class='webix_img_btn_text'>#value#</div></div>",icon:"<div class='webix_img_btn' style='line-height:#cheight#px;'><span class='webix_icon_btn fa-#icon#' style='max-width:#cheight#px;max-height:#cheight#px;'></span>#value#</div>",iconTop:"<div class='webix_img_btn_top' style='height:#cheight#px;width:100%;top:0px;text-align:center;'><span class='webix_icon fa-#icon#'></span><div class='webix_img_btn_text'>#value#</div></div>"},type_setter:function(e){this._settings.tabOffset=0;if(this._types[e])this._tabTemplate=webix.template(this._types[e]);return e}},webix.ui.segmented);webix.protoUI({name:"tabview",defaults:{type:"clean"},setValue:function(e){this._cells[0].setValue(e)},getValue:function(){return this._cells[0].getValue()},getTabbar:function(){return this._cells[0]},getMultiview:function(){return this._cells[1]},$init:function(e){var t=e.cells;var n=[];webix.assert(t&&t.length,"tabview must have cells collection");for(var r=t.length-1;r>=0;r--){var i=t[r].body||t[r];if(!i.id)i.id="view"+webix.uid();n[r]={value:t[r].header,id:i.id};t[r]=i}var s={view:"tabbar",multiview:true};var o={view:"multiview",cells:t,animate:!!e.animate};if(e.value)s.vaue=e.value;if(e.tabbar)webix.extend(s,e.tabbar,true);if(e.multiview)webix.extend(o,e.multiview,true);s.options=s.options||n;e.rows=[s,o];delete e.cells;delete e.tabs}},webix.ui.layout);webix.protoUI({name:"htmlform",_default_values:null,$init:function(e){this.elements=null;if(e.content&&(e.container==e.content||!e.container&&e.content==document.body))this._copy_inner_content=true},content_setter:function(e){e=webix.toNode(e);if(this._copy_inner_content){while(e.childNodes.length>1)this._viewobj.childNodes[0].appendChild(e.childNodes[0])}else{this._viewobj.childNodes[0].appendChild(e)}return true},render:function(){if(!this._default_values){webix.ui.template.prototype.render.apply(this,arguments);this._default_values=this.getValues()}},_parse_inputs:function(){if(!this.elements)this.elements=this._viewobj.querySelectorAll("[name]");return this.elements},getValues:function(){var e=this._values?webix.clone(this._values):{};var t=this._parse_inputs();for(var n=0;n<t.length;n++){if(this._tagname(t[n])==="input"&&this._attribute(t[n],"type")==="radio"&&t[n].checked===false)continue;e[t[n].name]=this._get_html_value(t[n])}return e},setValues:function(e){this.render();this._values=webix.clone(e);if(webix.debug_render)webix.log("Render: "+this.name+"@"+this._settings.id);var t=this._parse_inputs();for(var n=0;n<t.length;n++){if(!webix.isUndefined(e[t[n].name]))this._set_html_value(t[n],e[t[n].name])}this.callEvent("onChange",[])},focus:function(e){var t;if(!webix.isUndefined(e))t=this._viewobj.querySelector('[name="'+e+'"]');else t=this._parse_inputs()[0];if(!webix.isUndefined(t))t.focus()},clear:function(){if(this._default_values){this.render();var e=this._parse_inputs();for(var t=0;t<e.length;t++){this._set_html_value(e[t],this._default_values[e[t].name]||"")}}},_tagname:function(e){if(!e.tagName)return null;return e.tagName.toLowerCase()},_attribute:function(e,t){if(!e.getAttribute)return null;var n=e.getAttribute(t);return n.toLowerCase?n.toLowerCase():null},_get_html_value:function(e){var t=this._tagname(e);if(this._get_value[t])return this._get_value[t].call(this,e);return this._get_value.other.call(this,e)},_get_value:{input:function(e){var t=this._attribute(e,"type");if(t==="checkbox")return e.checked;return e.value},textarea:function(e){return e.value},select:function(e){var t=e.selectedIndex;return e.options[t].value},other:function(e){return e.innerHTML}},_set_html_value:function(e,t){var n=this._tagname(e);if(this._set_value[n])return this._set_value[n].call(this,e,t);return this._set_value.other.call(this,e,t)},_set_value:{input:function(e,t){var n=this._attribute(e,"type");if(n==="checkbox")e.checked=t?true:false;else if(n==="radio")e.checked=e.value===t?true:false;else e.value=t},textarea:function(e,t){e.value=t},select:function(e,t){e.value=t},other:function(e,t){e.innerHTML=t}},_mark_invalid:function(e,t){this._clear_invalid(e,t);var n=this._viewobj.querySelector('[name="'+e+'"]');if(n)webix.html.addCss(n,"invalid")},_clear_invalid:function(e,t){var n=this._viewobj.querySelector('[name="'+e+'"]');if(n)webix.html.removeCss(n,"invalid")}},webix.ui.template,webix.Values,webix.ValidateData);webix.dp=function(e){if(typeof e=="object"&&e._settings)e=e._settings.id;if(webix.dp._pull[e])return webix.dp._pull[e];if(typeof e=="string"||typeof e=="number")e={master:webix.$$(e)};var t=new webix.DataProcessor(e);var n=t._settings.master._settings.id;webix.dp._pull[n]=t;webix.$$(n).attachEvent("onDestruct",function(){webix.dp._pull[this._settings.id]=null;delete webix.dp._pull[this._settings.id]});return t};webix.dp._pull={};webix.dp.$$=function(e){return webix.dp._pull[e]};webix.DataProcessor=webix.proto({defaults:{autoupdate:true,updateFromResponse:false,mode:"post",operationName:"webix_operation",trackMove:false},$init:function(){this.reset();this._ignore=false;this.name="DataProcessor";this.$ready.push(this._after_init_call)},reset:function(){this._updates=[]},url_setter:function(e){var t="";if(typeof e=="string"){var n=e.split("->");if(n.length>1){e=n[1];t=n[0]}}else if(e&&e.mode){t=e.mode;e=e.url}if(t)return webix.proxy(t,e);return e},master_setter:function(e){var t=e;if(e.name!="DataStore")t=e.data;this._settings.store=t;return e},_after_init_call:function(){webix.assert(this._settings.store,"store or master need to be defined for the dataprocessor");this._settings.store.attachEvent("onStoreUpdated",webix.bind(this._onStoreUpdated,this));this._settings.store.attachEvent("onDataMove",webix.bind(this._onDataMove,this))},ignore:function(e,t){var n=this._ignore;this._ignore=true;e.call(t||this);this._ignore=n},off:function(){this._ignore=true},on:function(){this._ignore=false},_copy_data:function(e){var t={};for(var n in e)if(n.indexOf("$")!==0)t[n]=e[n];return t},save:function(e,t,n){t=t||"update";this._save_inner(e,n||this._settings.store.getItem(e),t)},_save_inner:function(e,t,n){if(typeof e=="object")e=e.toString();if(!e||this._ignore===true||!n||n=="paint")return true;var r={id:e,data:this._copy_data(t),operation:n};if(!webix.isUndefined(t.$parent))r.data.parent=t.$parent;if(r.operation!="delete"&&!this.validate(r.data))return false;var i=this._settings.master;if(i&&i.data&&i.data.getMark&&i.data.getMark(e,"webix_invalid"))r._invalid=true;if(this._check_unique(r))this._updates.push(r);if(this._settings.autoupdate)this.send();return true},_onDataMove:function(e,t,n){if(this._settings.trackMove){var r=webix.copy(this._settings.store.getItem(e));var i=this._settings.store.order;r.webix_move_index=t;r.webix_move_id=i[t+1]||"";r.webix_move_parent=n;this._save_inner(e,r,"update")}},_onStoreUpdated:function(e,t,n){switch(n){case"save":n="update";break;case"update":n="update";break;case"add":n="insert";break;case"delete":n="delete";break;default:return true}return this._save_inner(e,t,n)},_check_unique:function(e){for(var t=0;t<this._updates.length;t++){var n=this._updates[t];if(n.id==e.id){if(e.operation=="delete"){if(n.operation=="insert")this._updates.splice(t,1);else n.operation="delete"}n.data=e.data;n._invalid=e._invalid;return false}}return true},send:function(){this._sendData()},_sendData:function(){if(!this._settings.url)return;var e=this._updates;var t=[];var n=this._settings.url;for(var r=0;r<e.length;r++){var i=e[r];if(i._in_progress)continue;if(i._invalid)continue;var s=i.id;var o=i.operation;var u=typeof n=="object"&&!n.$proxy?n[o]:n;var a=u&&(u.$proxy||typeof u==="function");if(!u)continue;if(this._settings.store._scheme_save)this._settings.store._scheme_save(i.data);if(!this.callEvent("onBefore"+o,[s,i]))continue;i._in_progress=true;if(!this.callEvent("onBeforeDataSend",[i]))return;i.data=this._updatesData(i.data);var f=this._send_callback({id:i.id,status:i.operation});if(u.$proxy){if(u.save)u.save(this.config.master,i,this,f);else t.push(i)}else{if(o=="insert")delete i.data.id;if(a){u(i.id,i.operation,i.data).then(function(e){f.success("",e,-1)},function(e){f.error("",null,e)})}else{i.data[this._settings.operationName]=o;this._send(u,i.data,this._settings.mode,o,f)}}this.callEvent("onAfterDataSend",[i])}if(n.$proxy&&n.saveAll&&t.length)n.saveAll(this.config.master,t,this,this._send_callback({}))},_updatesData:function(e){var t={};for(var n in e){if(n.indexOf("$")!==0)t[n]=e[n]}return t},_send:function(e,t,n,r,i){webix.assert(e,"url was not set for DataProcessor");if(typeof e=="function")return e(t,r,i);webix.ajax()[n](e,t,i)},_send_callback:function(e){var t=this;return{success:function(n,r,i){return t._processResult(e,n,r,i)},error:function(n,r,i){return t._processError(e,n,r,i)}}},attachProgress:function(e,t,n){this.attachEvent("onBeforeDataSend",e);this.attachEvent("onAfterSync",t);this.attachEvent("onAfterSaveError",n);this.attachEvent("onLoadError",n)},_processError:function(e,t,n,r){if(e)this._innerProcessResult(true,e.id,false,e.status,false,{text:t,data:n,loader:r});else{this.callEvent("onLoadError",arguments);webix.callEvent("onLoadError",[t,n,r,this])}},_innerProcessResult:function(e,t,n,r,i,s){var o=this.getItemState(t);o._in_progress=false;if(e){if(this.callEvent("onBeforeSaveError",[t,r,i,s])){o._invalid=true;this.callEvent("onAfterSaveError",[t,r,i,s]);return}}else this.setItemState(t,false);if(i&&r!="delete"&&this._settings.updateFromResponse){var u=this._settings.store.getItem(t);webix.extend(u,i,true);this._settings.store.refresh(t)}if(n&&t!=n)this._settings.store.changeId(t,n);this.callEvent("onAfterSave",[i,t,s]);this.callEvent("onAfter"+r,[i,t,s])},processResult:function(e,t,n){var r=t&&(t.status=="error"||t.status=="invalid");var i=t?t.newid||t.id:false;this._innerProcessResult(r,e.id,i,e.status,t,n)},_processResult:function(e,t,n,r){this.callEvent("onBeforeSync",[e,t,n,r]);if(r===-1){this.processResult(e,n,{})}else{var i=this._settings.url;if(i.$proxy&&i.result)i.result(e,this._settings.master,this,t,n,r);else{var s;if(t){s=n.json();if(t&&typeof s=="undefined")s={status:"error"}}this.processResult(e,s,{text:t,data:n,loader:r})}}this.callEvent("onAfterSync",[e,t,n,r])},escape:function(e){if(this._settings.escape)return this._settings.escape(e);else return encodeURIComponent(e)},getItemState:function(e){var t=this._get_stack_index(e);return this._updates[t]||null},setItemState:function(e,t){if(t)this.save(e,t);else{var n=this._get_stack_index(e);if(n>-1)this._updates.splice(n,1)}},_get_stack_index:function(e){var t=-1;var n=null;for(var r=0;r<this._updates.length;r++)if(this._updates[r].id==e){t=r;break}return t}},webix.Settings,webix.EventSystem,webix.ValidateData);webix.jsonp=function(e,t,n,r){var i="webix_jsonp_"+webix.uid();var s=document.createElement("script");s.id=i;s.type="text/javascript";var o=document.getElementsByTagName("head")[0];if(typeof t=="function"){r=n;n=t;t={}}if(!t)t={};t.jsonp="webix.jsonp."+i;webix.jsonp[i]=function(){n.apply(r||window,arguments);s.parentNode.removeChild(s);n=o=r=s=null;delete webix.jsonp[i]};var u=[];for(var a in t)u.push(a+"="+encodeURIComponent(t[a]));e+=(e.indexOf("?")==-1?"?":"&")+u.join("&");s.src=e;o.appendChild(s)};webix.markup={namespace:"x",attribute:"data-",dataTag:"li",_dash:/-([a-z])/g,_after_dash:function(e){return e[1].toUpperCase()},_parse_int:{width:true,height:true,gravity:true,margin:true,padding:true,paddingX:true,paddingY:true,minWidth:true,maxWidth:true,minHeight:true,maxHeight:true,headerRowHeight:true},_view_has_method:function(e,t){return webix.ui.hasMethod(e,t)},init:function(e,t,n){e=e||document.body;var r=[];var i=this._get_core_els(e);var s=i.html;for(var o=i.length-1;o>=0;o--)r[o]=i[o];for(var o=0;o<r.length;o++){var u,a;u=this._sub_markup(r[o],s);u.$scope=n;this._initComponent(u,r[o],s,t)}},parse:function(e,t){if(typeof e=="string")e=webix.DataDriver[t||"xml"].toObject(e,e);var n=this._get_core_els(e,t);return this._sub_markup(n[0],n.html)},_initComponent:function(e,t,n,r){if(!r){e.container=t.parentNode;webix.html.remove(t)}else e.container=r;if(this._view_has_method(e.view,"setPosition"))delete e.container;webix.ui(e)},_get_core_els:function(e){this._full_prefix=this.namespace?this.namespace+":":"";this._full_prefix_top=this._full_prefix+"ui";var t=e.getElementsByTagName(this._full_prefix_top);if(!t.length&&e.documentElement&&e.documentElement.tagName==this._full_prefix_top)t=[e.documentElement];if(!t.length&&this.namespace){t=e.getElementsByTagName("ui");if(!t.length&&e.documentElement&&e.documentElement.tagName=="ui")t=[e.documentElement]}if(!t.length){t=this._get_html_tops(e);t.html=true}return t},_get_html_tops:function(e){if(e.getAttribute&&e.getAttribute(this.attribute+"view"))return[e];var t=e.querySelectorAll("["+this.attribute+"view]");var n=[];var r=[];for(var i=0;i<t.length;i++)if(!t[i].parentNode.getAttribute(this.attribute+"view"))n.push(t[i]);return n},_sub_markup:function(e,t,n){var r=false;if(!n){var i=this._get_name(e,t);if(i=="ui"){var s=e.childNodes;for(var o=0;o<s.length;o++)if(s[o].nodeType==1){return this._sub_markup(s[o],t)}}n={view:i};if(t&&e.tagName.toLowerCase()=="table"){n.data=e;n.datatype="htmltable";r=true}}var u=n.view=="cols"||n.view=="rows"||this._view_has_method(n.view,"addView");var a=[];var f=0;var l=!(t||e.style);var c=e.firstChild;while(c){if(c.nodeType==1){var i=this._get_name(c,t);if(i=="data"){f=1;var h=c;c=c.nextSibling;n.data=this._handle_data(h,t);continue}else if(i=="config"){this._get_config_html(c,n,t);var p=c;c=c.nextSibling;webix.html.remove(p);continue}else if(i=="column"){f=1;var d=this._tag_to_json(c,t);d.header=d.header||d.value;d.width=d.width*1||"";n.columns=n.columns||[];n.columns.push(d)}else if(i||u&&t){var v=this._sub_markup(c,t,{view:i});if(v.view=="head")n.head=v.rows?v.rows[0]:v.template;else if(v.view=="body"){if(this._view_has_method(n.view,"addView")){a.push({body:v.rows?v.rows[0]:v.value,header:v.header||""})}else{n.body=v.rows?v.rows.length==1?v.rows[0]:{rows:v.rows}:v.value}}else a.push(v)}else if(l){f=1;n[c.tagName]=webix.DataDriver.xml.tagToObject(c)}}c=c.nextSibling}this._attrs_to_json(e,n,t);if(a.length){if(n.stack)n[n.stack]=a;else if(this._view_has_method(n.view,"setValues"))n["elements"]=a;else if(n.view=="rows"){n.view="layout";n.rows=a}else if(n.view=="cols"){n.view="layout";n.cols=a}else if(this._view_has_method(n.view,"setValue")){n["cells"]=a}else if(this._view_has_method(n.view,"getBody")){n.body=a.length==1?a[0]:{rows:a}}else n["rows"]=a}else if(!r&&!f){if(t&&!n.template&&(!n.view||n.view=="template")){n.view="template";n.content=e}else{var m=this._content(e,t);if(m){var g="template";if(this._view_has_method(n.view,"setValue"))g="value";n[g]=n[g]||m}}}return n},_empty:function(e){var t=e.replace(/\s+/gm,"");return t.length>0?false:true},_markup_names:{body:1,head:1,data:1,rows:1,cols:1,cells:1,elements:1,ui:1,column:1,config:1},_get_config_html:function(e,t,n){var r=this._attrs_to_json(e,{});if(r.name){t[r.name]=r;delete r.name}else if(r.stack)t[r.stack]=[];else t=r;var i=e.childNodes;for(var s=0;s<i.length;s++){var o=null;if(i[s].nodeType==1&&i[s].tagName.toLowerCase()=="config"&&i[s].attributes.length)o=this._get_config_html(i[s],r,n);else o=i[s].innerHTML;if(r.stack&&o)t[r.stack].push(o)}return t},_get_name:function(e,t){if(t)return e.getAttribute(this.attribute+"view")||(e.tagName.toLowerCase()=="config"?"config":null);var n=e.tagName.toLowerCase();if(this.namespace){if(n.indexOf(this._full_prefix)===0||e.scopeName==this.namespace)return n.replace(this._full_prefix,"")}else{if(webix.ui[n]||this._markup_names[n])return n}return 0},_handle_data:function(e,t){var n=[];var r=e.getElementsByTagName(webix.markup.dataTag);for(var i=0;i<r.length;i++){var s=r[i];if(s.parentNode.parentNode.tagName!=webix.markup.dataTag){var o=this._tag_to_json(s,t);if(s.className)o.$css=s.className;n.push(o)}}webix.html.remove(e);return n},_content:function(e,t){if(e.style)return e.innerHTML;if(e.firstChild)return e.firstChild.wholeText||e.firstChild.data||"";return""},_tag_to_json:function(e,t){if(!t)return webix.DataDriver.xml.tagToObject(e);var n=this._attrs_to_json(e,{},t);if(!n.value&&e.childNodes.length)n.value=this._content(e,t);return n},_attrs_to_json:function(e,t,n){var r=e.attributes;for(var i=0;i<r.length;i++){var s=r[i].name;if(n){if(s.indexOf(this.attribute)!==0)continue;s=s.replace(this.attribute,"").replace(this._dash,this._after_dash)}var o=r[i].value;if(o.indexOf("json://")!=-1)o=JSON.parse(o.replace("json://",""));if(this._parse_int[s])o=parseInt(o,10);t[s]=o}return t}};(function(){function t(t,n){var i=t.callback;r(false);t.box.parentNode.removeChild(t.box);e=t.box=null;if(i)i(n)}function n(n){if(e){n=n||event;var r=n.which||event.keyCode;if(webix.message.keyboard){if(r==13||r==32)t(e,true);if(r==27)t(e,false);if(n.preventDefault)n.preventDefault();return!(n.cancelBubble=true)}}}function r(e){if(!r.cover||!r.cover.parentNode){r.cover=document.createElement("DIV");r.cover.onkeydown=n;r.cover.className="webix_modal_cover";document.body.appendChild(r.cover)}r.cover.style.display=e?"inline-block":"none"}function i(e,t,n){return"<div class='webix_popup_button"+(n?" "+n:"")+"' result='"+t+"' ><div>"+e+"</div></div>"}function s(e){if(!p.area){p.area=document.createElement("DIV");p.area.className="webix_message_area";p.area.style[p.position]="5px";document.body.appendChild(p.area)}p.hide(e.id);var t=document.createElement("DIV");t.innerHTML="<div>"+e.text+"</div>";t.className="webix_info webix_"+e.type;t.onclick=function(){p.hide(e.id);e=null};if(webix.$testmode)t.className+=" webix_no_transition";if(p.position=="bottom"&&p.area.firstChild)p.area.insertBefore(t,p.area.firstChild);else p.area.appendChild(t);if(e.expire>0)p.timers[e.id]=window.setTimeout(function(){p.hide(e.id)},e.expire);t.style.height=t.offsetHeight-2+"px";p.pull[e.id]=t;t=null;return e.id}function o(n,r,s){var o=document.createElement("DIV");o.className=" webix_modal_box webix_"+n.type;o.setAttribute("webixbox",1);var u="";if(n.width)o.style.width=n.width;if(n.height)o.style.height=n.height;if(n.title)u+='<div class="webix_popup_title">'+n.title+"</div>";u+='<div class="webix_popup_text"><span>'+(n.content?"":n.text)+'</span></div><div  class="webix_popup_controls">';if(r||n.ok)u+=i(n.ok||"OK",true,"confirm");if(s||n.cancel)u+=i(n.cancel||"Cancel",false);if(n.buttons){for(var a=0;a<n.buttons.length;a++)u+=i(n.buttons[a],a)}u+="</div>";o.innerHTML=u;if(n.content){var f=n.content;if(typeof f=="string")f=document.getElementById(f);if(f.style.display=="none")f.style.display="";o.childNodes[n.title?1:0].appendChild(f)}o.onclick=function(e){e=e||event;var r=e.target||e.srcElement;if(!r.className)r=r.parentNode;if(r.className.indexOf("webix_popup_button")!=-1){var i=r.getAttribute("result");i=i=="true"||(i=="false"?false:i);t(n,i)}e.cancelBubble=true};n.box=o;if(r||s||n.buttons)e=n;return o}function u(e,t,i){var s=e.tagName?e:o(e,t,i);if(!e.hidden)r(true);document.body.appendChild(s);var u=e.left||Math.abs(Math.floor(((window.innerWidth||document.documentElement.offsetWidth)-s.offsetWidth)/2));var a=e.top||Math.abs(Math.floor(((window.innerHeight||document.documentElement.offsetHeight)-s.offsetHeight)/2));if(e.position=="top")s.style.top="-3px";else s.style.top=a+"px";s.style.left=u+"px";s.onkeydown=n;s.focus();if(e.hidden)webix.modalbox.hide(s);return s}function a(e){return u(e,true,false)}function f(e){return u(e,true,true)}function l(e){return u(e)}function c(e,t,n){if(typeof e!="object"){if(typeof t=="function"){n=t;t=""}e={text:e,type:t,callback:n}}return e}function h(e,t,n,r){if(typeof e!="object")e={text:e,type:t,expire:n,id:r};e.id=e.id||p.uid();e.expire=e.expire||p.expire;return e}var e=null;if(document.attachEvent)document.attachEvent("onkeydown",n);else document.addEventListener("keydown",n,true);webix.alert=function(){var e=c.apply(this,arguments);e.type=e.type||"confirm";return a(e)};webix.confirm=function(){var e=c.apply(this,arguments);e.type=e.type||"alert";return f(e)};webix.modalbox=function(){var e=c.apply(this,arguments);e.type=e.type||"alert";return l(e)};webix.modalbox.hide=function(t){if(t){while(t&&t.getAttribute&&!t.getAttribute("webixbox"))t=t.parentNode;if(t){t.parentNode.removeChild(t)}}r(false);e=null};var p=webix.message=function(e,t,n,r){e=h.apply(this,arguments);e.type=e.type||"info";var i=e.type.split("-")[0];switch(i){case"alert":return a(e);case"confirm":return f(e);case"modalbox":return l(e);default:return s(e)}};p.seed=(new Date).valueOf();p.uid=function(){return p.seed++};p.expire=4e3;p.keyboard=true;p.position="top";p.pull={};p.timers={};p.hideAll=function(){for(var e in p.pull)p.hide(e)};p.hide=function(e){var t=p.pull[e];if(t&&t.parentNode){window.setTimeout(function(){t.parentNode.removeChild(t);t=null},2e3);t.style.height=0;t.className+=" hidden";if(p.timers[e])window.clearTimeout(p.timers[e]);delete p.pull[e]}}})();webix.debug_ready(function(){function t(t){var n={};var r=[];t=webix.$$(t);for(var i in t.config){if(e[i])continue;if(typeof t.config[i]=="object")continue;if(typeof t.config[i]=="undefined")continue;if(typeof t.config[i]=="function")continue;if(i=="view"||i=="id")r.push({label:i,id:i});else r.push({label:i,type:"text",id:i});if(t.defaults[i]==t.config[i])r[r.length-1].css={color:"#888"};n[i]=t.config[i]}r.sort(function(e,t){if(!e.css&&t.css)return-1;if(e.css&&!t.css)return 1;return e.id>t.id?1:e.id==t.id?0:-1});return{elements:r,data:n,head:" ["+t.name+"] <strong>"+t._settings.id+"</strong>"}}function n(){if(!webix.$$("webix_debug_inspector_win"))webix.ui({id:"webix_debug_inspector_win",view:"window",top:2,left:0,width:350,height:350,head:false,autofit:false,body:{cols:[{width:10},{type:"clean",rows:[{view:"toolbar",elements:[{view:"label",value:"",id:"webix_debug_inspector_head"},{view:"button",width:100,value:"Hide",type:"custom",click:function(){webix.debug_inspect()}}]},{id:"webix_debug_inspector",nameWidth:150,view:"property",scroll:"y",elements:[],on:{onaftereditstop:function(e,t){if(e.old==e.value)return;var n=e.value;if(n==="true"||n==="false"){n=n==="true"}else{var r=parseInt(n,10);if(r==n)n=r}var i=webix.$$(this.config.view);i.define(t.id,n);if(i.refreshColumns)i.refreshColumns();else if(i.refresh)i.refresh();i.resize()}}}]}]}})}function r(e,r){n();var i=webix.$$("webix_debug_inspector_win");if(e){var s=t(e);var o=document.body.offsetWidth;var u=document.body.offsetHeight;var a=r?webix.html.pos(r):{x:0,y:0};i.define("height",Math.max(350,u-4));i.resize();var f=webix.$$("webix_debug_inspector");f.define("elements",s.elements);f.define("view",e);i.show({x:a.x>o/2?0:o-370,y:0});webix.$$("webix_debug_inspector").setValues(s.data);webix.$$("webix_debug_inspector_head").setValue(s.head)}else i.hide()}function i(e){if(e>=1e5)return"Any";return e}function s(e,t,n){window.console.log((e==n?">>":"  ")+t+e.name+" / "+e.config.id);t+="  ";if(e._cells)for(var r=0;r<e._cells.length;r++){s(e._cells[r],t,n)}if(e._head_cell)s(e._head_cell,t,n);if(e._body_cell)s(e._body_cell,t,n)}var e={_inner:true,awidth:true,cheight:true,bheight:true,aheight:true};webix.debug_inspect=r;webix.ui({view:"contextmenu",on:{onBeforeShow:function(e){if(!e.ctrlKey)return false;var t=webix.html.locate(e,"view_id");if(!t)return false;this.config.lastTarget=t;webix.blockEvent();webix.delay(function(){webix.unblockEvent()})},onShow:function(){var e=webix.$$(this.config.lastTarget);var t="<span style='color:#888'>"+e._settings.id+"<sup style='float:right'>["+e.name+"]</sup></span>";document.getElementById("webix_debug_cmx").innerHTML=t}},data:["<div id='webix_debug_cmx'></div>",{id:"inspect",value:"Inspect"},{id:"docs",value:"Documentation"},{value:"Log to Console",submenu:[{id:"size",value:"Sizes"},{id:"tree",value:"Tree"},{id:"dump",value:"Dump"}]}],click:function(e,t){var n=webix.$$(this.config.lastTarget);if(e=="dump"){window.console.info("\n"+n.name+" / "+n.config.id);window.console.log("\nView: ",n,", Config: ",n.config,", Data: ",n.data);window.console.log(n.$view)}if(e=="tree"){var o=n;while(n.getParentView())n=n.getParentView();window.console.log("");s(n,"",o)}if(e=="size"){window.console.info("");window.console.info("\n"+n.name+" / "+n.config.id);window.console.info("\n[min]   ",n.config.width," x ",n.config.height);var u=n.$getSize(0,0);window.console.info("[max]    ",i(u[1])," x ",i(u[3])+(n.config.autoheight?", auto height":""));window.console.info("[gravity]   ",n.config.gravity);window.console.info("\n[content]    ",n._content_width," x ",n._content_height);window.console.info("[last set]   ",n._last_size[0]," x ",n._last_size[1]);if(n._settings._inner)window.console.info("\n[borders]   ","left:",!n._settings._inner.left,"	top:",!n._settings._inner.top,"	right:",!n._settings._inner.right,"	bottom:",!n._settings._inner.bottom);else window.console.info("\n[borders]   none")}if(e=="docs")window.open("http://docs.webix.com/api__refs__ui."+n.name+".html","__blank");if(e=="inspect"){r(this.config.lastTarget,t)}},master:document.body})});webix.protoUI({name:"carousel",defaults:{scrollSpeed:"300ms",type:"clean",navigation:{}},$init:function(){this._viewobj.className+=" webix_carousel";this._layout=null;this._dataobj=null;this._active_cell=0;this.$ready.push(this._after_init_call)},cols_setter:function(e){this._vertical_orientation=0;this._initLayout.call(this,{cols:e})},rows_setter:function(e){this._vertical_orientation=1;this._initLayout.call(this,{rows:e})},_initLayout:function(e){if(this._layout&&this._layout.destructor)this._layout.destructor();this._layout=webix.ui._view(e);this._layout._parent_cell=this;this._viewobj.appendChild(this._layout._viewobj);this._cells=this._layout._cells;this._layout._show=webix.bind(webix.ui.carousel.prototype._show,this);this._layout.adjustScroll=webix.bind(webix.ui.carousel.prototype.adjustScroll,this);webix.attachEvent("onReconstruct",webix.bind(function(e){if(e==this._layout)this._setScroll()},this));this._contentobj=this._viewobj.firstChild},getChildViews:function(){return[this._layout]},getLayout:function(){return this._layout},_after_init_call:function(){this._contentobj.setAttribute("touch_scroll",this._vertical_orientation?"y":"x")},adjustScroll:function(e){var t=this._vertical_orientation?this._content_height:this._content_width;var n;if(this._vertical_orientation){n=Math.round(e.f/t);e.f=n*t}else{n=Math.round(e.e/t);e.e=n*t}this._active_cell=-n;if(this._settings.navigation)this._renderNavItems();return true},_show:function(e){var t,n,r,i,s,o;r=-1;n=this._layout;for(t=0;t<n._cells.length;t++){if(n._cells[t]==e){r=t;break}}if(r<0||r==this._active_cell)return;this._active_cell=r;i=n._vertical_orientation?this._content_height:this._content_width;s=-(n._vertical_orientation?0:r*i);o=-(n._vertical_orientation?r*i:0);this.scrollTo(s,o);this.callEvent("onShow",[n._cells[this._active_cell]._settings.id]);if(this._settings.navigation)this._renderPanel()},scrollTo:function(e,t){if(webix.Touch&&webix.animate.isSupported())webix.Touch._set_matrix(this._contentobj,e,t,this._settings.scrollSpeed||"100ms");else{this._contentobj.style.marginLeft=e+"px";this._contentobj.style.marginTop=t+"px"}},navigation_setter:function(e){this._mergeSettings(e,{type:"corner",buttons:true,items:true});return e},showNext:function(){if(this._active_cell<this._layout._cells.length-1)this.setActiveIndex(this._active_cell+1)},showPrev:function(){if(this._active_cell>0)this.setActiveIndex(this._active_cell-1)},setActiveIndex:function(e){webix.assert(e<this._layout._cells.length,"Not existing index in collection");var t=this._layout._cells[e]._settings.id;webix.$$(t).show()},getActiveIndex:function(){return this._active_cell},$getSize:function(e,t){var n=this._layout.$getSize(0,0);var r=webix.ui.view.prototype.$getSize.call(this,e,t);if(this._layout._vertical_orientation){r[0]=Math.max(r[0],n[0]);r[1]=Math.min(r[1],n[1])}else{r[2]=Math.max(r[2],n[2]);r[3]=Math.min(r[3],n[3])}return r},$setSize:function(e,t){if(webix.ui.view.prototype.$setSize.call(this,e,t)){var n=this._layout;var r=n._cells.length;var i=this._content_height*(n._vertical_orientation?r:1);var s=this._content_width*(n._vertical_orientation?1:r);this._contentobj.style.height=i+"px";this._contentobj.style.width=s+"px";n.$setSize(s,i);this._setScroll()}},_setScroll:function(){var e=this._layout;var t=this._active_cell||0;var n=e._vertical_orientation?this._content_height:this._content_width;var r=-(e._vertical_orientation?0:t*n);var i=-(e._vertical_orientation?t*n:0);this.scrollTo(r,i);if(this._settings.navigation)this._renderPanel()},getActiveId:function(){return this._layout._cells[this._active_cell]._settings.id},setActive:function(e){webix.$$(e).show()}},webix.EventSystem,webix.NavigationButtons,webix.ui.view);webix.type(webix.ui.list,{name:"uploader",template:"#name#  {common.removeIcon()}{common.percent()}<div style='float:right'>#sizetext#</div>",percent:function(e){if(e.status=="transfer")return"<div style='width:60px; text-align:center; float:right'>"+e.percent+"%</div>";return"<div class='webix_upload_"+e.status+"'><span class='"+(e.status=="error"?"error_icon":"fa-ok webix_icon")+"'></span></div>"},removeIcon:function(e){return"<div class='webix_remove_upload'><span class='cancel_icon'></span></div>"},on_click:{webix_remove_upload:function(e,t){webix.$$(this.config.uploader).files.remove(t)}}});webix.UploadDriver={flash:{},html5:{$render:function(e){if(this._upload_area){this._contentobj.appendChild(this._upload_area);return}this.files.attachEvent("onBeforeDelete",this._stop_file);var t={type:"file","class":"webix_hidden_upload",tabindex:-1};if(this._settings.multiple)t.multiple="true";var n=webix.html.create("input",t);this._upload_area=this._contentobj.appendChild(n);webix.event(this._viewobj,"drop",webix.bind(function(e){this._drop(e);webix.html.preventEvent(e)},this));webix.event(n,"change",webix.bind(function(){this._add_files(n.files)},this));webix.event(this._viewobj,"click",webix.bind(function(){var e=new Date;if(e-(this._upload_timer_click||0)>250){this.fileDialog()}},this));webix.event(this._viewobj,"dragenter",webix.html.preventEvent);webix.event(this._viewobj,"dragexit",webix.html.preventEvent);webix.event(this._viewobj,"dragover",webix.html.preventEvent)},_drop:function(e){var t=e.dataTransfer.files;if(this.callEvent("onBeforeFileDrop",[t,e]))this._add_files(t);this.callEvent("onAfterFileDrop",[t,e])},fileDialog:function(e){this._upload_timer_click=new Date;this._last_file_context=e;var t=this._viewobj.getElementsByTagName("INPUT");t[t.length-1].click()},send:function(e){if(typeof e=="function"){this._last_assigned_upload_callback=e;e=0}if(!e){var t=this.files.data.order;var n=true;if(t.length)for(var r=0;r<t.length;r++)n=!this.send(t[r])&&n;if(n)this._upload_complete();return}var i=this.files.getItem(e);if(i.status!=="client")return false;webix.assert(this._settings.upload,"You need to define upload url for uploader component");i.status="transfer";var s=new FormData;s.append("upload",i.file);var o=i.xhr=new XMLHttpRequest;o.upload.addEventListener("progress",webix.bind(function(t){this._update_progress(e,t.loaded/t.total*100)},this),false);o.onload=webix.bind(function(t){this._file_complete(e)},this);o.open("POST",this._settings.upload,true);o.send(s);this._update_progress(e,0);return true},_file_complete:function(e){var t=this.files.getItem(e);if(t){var n=webix.DataDriver.json.toObject(t.xhr.responseText);if(t.xhr.status!=200||!n||n.status=="error"){t.status="error";delete t.percent;this.files.updateItem(e);this.callEvent("onFileUploadError",[t,n])}else{this._complete(e,n)}delete t.xhr}},stopUpload:function(e){webix.bind(this._stop_file,this.files)(e)},_stop_file:function(e){var t=this.getItem(e);if(typeof t.xhr!=="undefined")t.xhr.abort();delete t.xhr;t.status="client"}}};webix.protoUI({name:"uploader",defaults:{autosend:true,multiple:true},$cssName:"button",_allowsClear:true,$init:function(e){var t=webix.UploadDriver.html5;this.files=new webix.DataCollection;if(webix.isUndefined(XMLHttpRequest)||webix.isUndefined((new XMLHttpRequest).upload))t=webix.UploadDriver.flash;webix.assert(t,"incorrect driver");webix.extend(this,t)},$setSize:function(e,t){if(webix.ui.view.prototype.$setSize.call(this,e,t)){this.render()}},apiOnly_setter:function(e){webix.delay(this.render,this);return this.$apiOnly=e},_add_files:function(e){for(var t=0;t<e.length;t++)this.addFile(e[t])},link_setter:function(e){if(e)webix.delay(function(){var e=webix.$$(this._settings.link);if(e.sync&&e.filter)e.sync(this.files);else if(e.setValues)this.files.data.attachEvent("onStoreUpdated",function(){e.setValues(this)});e._settings.uploader=this._settings.id},this);return e},addFile:function(e,t,n){var r=null;if(typeof e=="object"){r=e;e=r.name;t=r.size}var i=this._format_size(t);n=n||e.split(".").pop();var s={file:r,name:e,id:webix.uid(),size:t,sizetext:i,type:n,context:this._last_file_context,status:"client"};if(this.callEvent("onBeforeFileAdd",[s])){if(!this._settings.multiple)this.files.clearAll();var o=this.files.add(s);this.callEvent("onAfterFileAdd",[s]);if(o&&this._settings.autosend)this.send(o)}},_format_size:function(e){var t=0;while(e>1024){t++;e=e/1024}return Math.round(e*100)/100+" "+webix.i18n.fileSize[t]},_complete:function(e,t){if(t.status==="server"){var n=this.files.getItem(e);n.status="server";n.progress=100;webix.extend(n,t,true);this.callEvent("onFileUpload",[n,t]);this.callEvent("onChange",[]);this.files.updateItem(e)}if(this.isUploaded())this._upload_complete(t)},_upload_complete:function(e){this.callEvent("onUploadComplete",[e]);if(this._last_assigned_upload_callback){this._last_assigned_upload_callback.call(this,e);this._last_assigned_upload_callback=0}},isUploaded:function(){var e=this.files.data.order;for(var t=0;t<e.length;t++)if(this.files.getItem(e[t]).status!="server")return false;return true},_update_progress:function(e,t){var n=this.files.getItem(e);n.percent=Math.round(t);this.files.updateItem(e)},setValue:function(e){if(typeof e=="string")e={value:e,status:"server"};this.files.clearAll();if(e)this.files.parse(e);this.callEvent("onChange",[])},getValue:function(){var e=[];this.files.data.each(function(t){if(t.status=="server")e.push(t.value||t.name)});return e.join(",")}},webix.ui.button);webix.html.addMeta=function(e,t){document.getElementsByTagName("head").item(0).appendChild(webix.html.create("meta",{name:e,content:t}))};(function(){var e=function(){var e=!!(window.orientation%180);if(webix.ui.orientation===e)return;webix.ui.orientation=e;webix.callEvent("onRotate",[e])};if(webix.env.touch){webix.ui.orientation=!!((webix.isUndefined(window.orientation)?90:window.orientation)%180);webix.event(window,"onorientationchange"in window?"orientationchange":"resize",e)}if(webix.env.isFF&&window.matchMedia){window.matchMedia("(orientation: portrait)").addListener(function(){webix.ui.orientation=false});window.matchMedia("(orientation: landscape)").addListener(function(){webix.ui.orientation=true})}webix.ui.fullScreen=function(){if(!webix.env.touch)return;webix.html.addMeta("apple-mobile-web-app-capable","yes");webix.html.addMeta("viewport","initial-scale=1, maximum-scale=1, user-scalable=no");var t=document.body.offsetHeight||document.body.scrollHeight;var n=navigator.userAgent.indexOf("iPhone")!=-1;var r=navigator.userAgent.indexOf("iPad")!=-1;var i=navigator.userAgent.indexOf("OS 7")!=-1;var s=n&&(t==356||t==208||t==306||t==158||t==444);var o=window.screen.height==568;var u=function(){var e=0;var t=0;if(n&&!i){if(!webix.ui.orientation){e=320;t=o?s?504:548:s?416:460}else{e=o?568:480;t=s?268:300}}else if(webix.env.isAndroid){if(!webix.env.isFF){document.body.style.width=document.body.style.height="1px";document.body.style.overflow="hidden";var r=window.outerWidth/window.innerWidth;e=window.outerWidth/r;t=window.outerHeight/r}}else{e=window.innerWidth;t=window.innerHeight}if(t){document.body.style.height=t+"px";document.body.style.width=e+"px"}webix.ui._freeze=false;webix.ui.resize()};var a=function(){webix.ui._freeze=true;if(webix.env.isSafari)u();else webix.delay(u,null,[],500)};webix.attachEvent("onRotate",a);e();webix.delay(a)}})();if(window.jQuery){(function(e){function n(e){if(e&&e.getAttribute)return e.getAttribute("view_id")}function r(r){return function(i){if(typeof i==="string"){if(t[i]){return t[i].apply(this,[])}else{e.error("Method "+i+" does not exist on jQuery.".name)}}else{var s=[];this.each(function(){var e;var t;var t=n(this)||n(this.firstChild);if(t)e=webix.$$(t);if(!e){var o=i?i.data:0;if(o)i.data=null;var u=webix.copy(i||{autoheight:true,autowidth:true});u.view=r;if(o)i.data=u.data=o;if(this.tagName.toLowerCase()==="table"){var a=webix.html.create("div",{id:this.getAttribute("id")||"","class":this.getAttribute("class")||""},"");this.parentNode.insertBefore(a,this);u.container=a;e=webix.ui(u);e.parse(this,"htmltable")}else{u.container=this;e=webix.ui(u)}}s.push(e)});if(s.length===1)return s[0];return s}}}var t=[];for(var i in webix.ui){var s="webix_"+i;e.fn[s]=r(i)}})(jQuery)}webix.history={track:function(e,t){this._init_state(e,t);var n=webix.$$(e);var r=function(){if(webix.history._ignored)return;if(n.getValue)webix.history.push(e,n.getValue())};if(n.getActiveId)n.attachEvent("onViewChange",r);else n.attachEvent("onChange",r)},_set_state:function(e,t){webix.history._ignored=1;e=webix.$$(e);if(e.callEvent("onBeforeHistoryNav",[t]))if(e.setValue)e.setValue(t);webix.history._ignored=0},push:function(e,t,n){e=webix.$$(e);var r="";if(t)r="#!/"+t;if(webix.isUndefined(n)){if(e.getValue)n=e.getValue();else n=t}window.history.pushState({webix:true,id:e._settings.id,value:n},"",r)},_init_state:function(e,t){webix.event(window,"popstate",function(e){if(e.state&&e.state.webix){webix.history._set_state(e.state.id,e.state.value)}});var n=window.location.hash;webix.noanimate=true;if(n&&n.indexOf("#!/")===0)webix.history._set_state(e,n.replace("#!/",""));else if(t){webix.history.push(e,t);webix.history._set_state(e,t)}webix.noanimate=false;this._init_state=function(){}}};webix.protoUI({name:"fieldset",defaults:{borderless:true},$init:function(e){webix.assert(e.body,"fieldset must have not-empty body");this._viewobj.className+=" webix_fieldset";this._viewobj.innerHTML="<fieldset><legend></legend><div></div></fieldset>"},label_setter:function(e){this._viewobj.firstChild.childNodes[0].innerHTML=e;return e},getChildViews:function(){return[this._body_view]},body_setter:function(e){this._body_view=webix.ui(e,this._viewobj.firstChild.childNodes[1]);this._body_view._parent_cell=this;return e},getBody:function(){return this._body_view},$getSize:function(e,t){webix.debug_size_box_start(this,true);e+=18;t+=45;var n=this._last_body_size=this._body_view.$getSize(e,t);webix.debug_size_box_end(this,n);return n},$setSize:function(e,t){if(webix.ui.view.prototype.$setSize.call(this,e,t)){t=Math.min(this._last_body_size[3],t);e=Math.min(this._last_body_size[1],e);this._body_view.$setSize(e-18,t-45)}}},webix.ui.view);webix.protoUI({name:"slider",defaults:{min:0,max:100,value:50,step:1,title:false,template:function(e,t){var n=t._handle_id="x"+(e.id||webix.uid());var r="<div class='webix_slider_title'></div><div class='webix_slider_box'><div class='webix_slider_left'>&nbsp;</div><div class='webix_slider_right'></div><div class='webix_slider_handle' id='"+n+"'>&nbsp;</div></div>";return t.$renderInput(e,r,n)}},type_setter:function(e){this._viewobj.className+=" webix_slider_"+e},title_setter:function(e){if(typeof e=="string")return webix.template(e);return e},_get_slider_handle:function(){return document.getElementById(this._handle_id)},_set_inner_size:function(){var e=this._get_slider_handle();var t=this._settings;if(e){var n=this._get_input_width(t);var r=t.value%t.step?Math.round(t.value/t.step)*t.step:t.value;r=Math.max(Math.min(r,t.max),t.min);var i=t.max-t.min;var s=Math.ceil((n-20)*(r-t.min)/i);var o=n-20-s;e.style.left=10+s-8+"px";e.parentNode.style.width=n+"px";o=Math.min(Math.max(o,2),n-22);s=Math.min(Math.max(s,2),n-22);var u=e.previousSibling;u.style.width=o+"px";var a=u.previousSibling;a.style.width=s+"px";if(this._settings.title){e.parentNode.previousSibling.innerHTML=this._settings.title(this._settings,this)}}},refresh:function(){this._set_inner_size()},$setValue:function(){this.refresh()},$getValue:function(){return this._settings.value},$init:function(){if(webix.env.touch){this.attachEvent("onTouchStart",webix.bind(this._on_mouse_down_start,this))}else webix.event(this._viewobj,"mousedown",webix.bind(this._on_mouse_down_start,this))},_on_mouse_down_start:function(e){var t=e.target||e.srcElement;if(t.className=="webix_slider_handle")return this._start_handle_dnd.apply(this,arguments);else if(t.className.indexOf("webix_slider")!=-1){this.setValue(this._get_value_from_event.apply(this,arguments));this._start_handle_dnd(e)}},_start_handle_dnd:function(e){if(webix.env.touch){this._handle_drag_events=[this.attachEvent("onTouchMove",webix.bind(this._handle_move_process,this)),this.attachEvent("onTouchEnd",webix.bind(this._handle_move_stop,this))]}else this._handle_drag_events=[webix.event(document.body,"mousemove",webix.bind(this._handle_move_process,this)),webix.event(document.body,"mouseup",webix.bind(this._handle_move_stop,this))];webix.html.addCss(document.body,"webix_noselect")},_handle_move_stop:function(e){if(this._handle_drag_events){if(webix.env.touch){webix.detachEvent(this._handle_drag_events[0]);webix.detachEvent(this._handle_drag_events[1])}else{webix.eventRemove(this._handle_drag_events[0]);webix.eventRemove(this._handle_drag_events[1])}this._handle_drag_events=[]}webix.html.removeCss(document.body,"webix_noselect");this.setValue(this._get_value_from_event.apply(this,arguments))},_handle_move_process:function(e){this._settings.value=this._get_value_from_event.apply(this,arguments);this.refresh();this.callEvent("onSliderDrag",[])},_get_value_from_event:function(e,t){var n=0;if(webix.env.touch){n=t?t.x:e.x}else n=webix.html.pos(e).x;return this._get_value_from_pos(n)},_get_value_from_pos:function(e){var t=this._settings;var n=t.max-t.min;var r=webix.html.offset(this._get_slider_handle().parentNode).x;var i=Math.ceil((e-r)*n/this._get_input_width(t));i=Math.round((i+t.min)/t.step)*t.step;return Math.max(Math.min(i,t.max),t.min)},_init_onchange:function(){}},webix.ui.text);webix.proxy.offline={$proxy:true,storage:webix.storage.local,cache:false,data:"",_is_offline:function(){if(!this.cache&&!webix.env.offline){webix.call("onOfflineMode",[]);webix.env.offline=true}},_is_online:function(){if(!this.cache&&webix.env.offline){webix.env.offline=false;webix.call("onOnlineMode",[])}},load:function(e,t){var n={error:function(){var n=this.getCache()||this.data;var r={responseText:n};var i=webix.ajax.prototype._data(r);this._is_offline();webix.ajax.$callback(e,t,n,i,r)},success:function(n,r,i){this._is_online();webix.ajax.$callback(e,t,n,r,i);this.setCache(n)}};if(this.cache&&this.getCache())n.error.call(this);else{if(this.source.$proxy)this.source.load(this,n);else webix.ajax(this.source,n,this)}},getCache:function(){return this.storage.get(this._data_name())},clearCache:function(){this.storage.remove(this._data_name())},setCache:function(e){if(typeof e!="string")e=JSON.stringify(e);this.storage.put(this._data_name(),e)},_data_name:function(){if(this.source.$proxy)return this.source.source+"_$proxy$_data";else return this.source+"_$proxy$_data"},saveAll:function(e,t,n,r){this.setCache(JSON.stringify(e.serialize()));webix.ajax.$callback(e,r,"",t)},result:function(e,t,n,r,i){for(var s=0;s<i.length;s++)n.processResult({id:i[s].id,status:i[s].operation},{},{})}};webix.proxy.cache={init:function(){webix.extend(this,webix.proxy.offline)},cache:true};webix.proxy.local={init:function(){webix.extend(this,webix.proxy.offline)},cache:true,data:[]};if(window.angular)(function(){function e(e){var t=e.attr("id");if(!t){t=webix.uid();e.attr("id",t)}return t}function t(e){if(typeof e.attr("webix-ui")!="undefined")return e.attr("id");return t(e.parent())}angular.module("webix",[]).directive("webixUi",["$parse",function(t){return{restrict:"A",scope:false,link:function(n,r,i,s){var o=i["webixUi"];var u=i["webixReady"];var a=null;var f=e(r);r.ready(function(){if(a)return;if(u)u=t(u);r.bind("$destroy",function(){if(a)a.destructor()});if(o){var e=function(e){if(a)a.destructor();if(n[o]){var t=webix.copy(n[o]);t.$scope=n;a=webix.ui(t,r[0]);if(u)u(n,{root:a})}};n.$watch(o,e);e()}else{if(!i["view"])r.attr("view","rows");var s=webix.markup;var f=s.attribute;s.attribute="";if(typeof i["webixRefresh"]!="undefined")a=s.init(r[0],r[0],n);else a=s.init(r[0],null,n);s.attribute=f;if(u)u(n,{root:a})}n.$watch(function(){return r[0].offsetWidth+"."+r[0].offsetHeight},function(){if(a)a.adjust()})})}}}]).directive("webixShow",["$parse",function(t){return{restrict:"A",scope:false,link:function(n,r,i,s){var o=t(i["webixShow"]);var u=e(r);if(!o(n))r.attr("hidden","true");n.$watch(i["webixShow"],function(){var e=webix.$$(u);if(e){if(o(n)){webix.$$(u).show();r[0].removeAttribute("hidden")}else webix.$$(u).hide()}})}}}]).directive("webixEvent",["$parse",function(t){var n=function(e,n,r){var i=r.split("=");var s=t(i[1]);var o=i[0].trim();n.attachEvent(o,function(){return s(e,{id:arguments[0],details:arguments})})};return{restrict:"A",scope:false,link:function(t,r,i,s){var o=i["webixEvent"].split(";");var u=e(r);setTimeout(function(){var e=r[0].firstChild;if(e&&e.nodeType==1)u=e.getAttribute("view_id")||u;var i=webix.$$(u);for(var s=0;s<o.length;s++){n(t,i,o[s])}})}}}]).directive("webixElements",["$parse",function(t){return{restrict:"A",scope:false,link:function(t,n,r,i){var s=r["webixElements"];var o=e(n);if(t.$watchCollection)t.$watchCollection(s,function(e){setTimeout(function(){var t=webix.$$(o);if(t){t.define("elements",e);t.refresh()}},1)})}}}]).directive("webixData",["$parse",function(t){return{restrict:"A",scope:false,link:function(t,n,r,i){var s=r["webixData"];var o=e(n);if(t.$watchCollection)t.$watchCollection(s,function(e){if(e){setTimeout(function(){var t=n[0].firstChild;if(t&&t.nodeType==1)o=t.getAttribute("view_id")||o;var r=webix.$$(o);if(r){if(r.options_setter){r.define("options",e);r.refresh()}else{if(r.clearAll)r.clearAll();r.parse(e)}}},1)}})}}}])})();if(window.Backbone)(function(){function t(e){e._backbone_loading=true;e.callEvent("onBeforeLoad",[]);e.blockEvent()}function n(e){e.unblockEvent();e._backbone_loading=false;e.refresh()}var e={use_id:false};webix.attachEvent("onUnSyncUnknown",function(e,t){var n=e._sync_events;var r=e._sync_backbone_events;for(var i=0;i<n.length;i++)e.detachEvent(n[i]);for(var i=0;i<r.length;i++)t.off.apply(t,r[i])});webix.attachEvent("onSyncUnknown",function(r,i,s){function o(t){if(e.use_id)return t;var n={};for(var r in t)if(r!="id")n[r]=t[r];return n}function u(t){return e.use_id?t.id:t.cid}function a(e,t){var n=[];t.each(function(e){var t=u(e);var r=f(e);r.id=t;n.push(r)});e.clearAll();e._parse(n)}function f(t){if(e.get){var n={};for(var r=0;r<e.get.length;r++){var i=e.get[r];n[i]=t.get(i)}return n}return t.toJSON()}if(s)e=s;if(e.get&&typeof e.get=="string")e.get=e.get.split(",");var l=[["change",function(e,t){var n=u(e);var i=r.pull[n]=f(e);i.id=n;if(r._scheme_update)r._scheme_update(i);r.refresh(i.id)}],["remove",function(e,t){var n=u(e);if(r.pull[n])r.remove(n)}],["add",function(e,t){var n=u(e);if(!r.pull[n]){var i=f(e);i.id=n;if(r._scheme_init)r._scheme_init(i);r.add(i)}}],["reset",function(e,t){a(r,i)}],["request",function(e){if(e instanceof Backbone.Collection)t(r)}],["sync",function(e){if(e instanceof Backbone.Collection)n(r)}],["error",function(e){if(e instanceof Backbone.Collection)n(r)}]];for(var c=0;c<l.length;c++)i.bind.apply(i,l[c]);var h=[r.attachEvent("onAfterAdd",function(e){if(!i.get(e)){var t=o(r.getItem(e));var n=new i.model(t);var s=u(n);if(s!=e)this.changeId(e,s);i.add(n);i.trigger("webix:add",n)}return true}),r.attachEvent("onDataUpdate",function(e){var t=i.get(e);var n=o(r.getItem(e));t.set(n);i.trigger("webix:change",t);return true}),r.attachEvent("onAfterDelete",function(e){var t=i.get(e);if(t){i.trigger("webix:remove",t);i.remove(e)}return true})];r._sync_source=i;r._sync_events=h;r._sync_backbone_events=l;if(i.length||r.count()){a(r,i)}});window.WebixView=Backbone.View.extend({tagName:"div",initialize:function(e){this.options=e||{}},render:function(){if(this.beforeRender)this.beforeRender.apply(this,arguments);var e=this.config||this.options.config;var t=this.el?$(this.el)[0]:document.body;if(t&&!t.config)t.innerHTML="";this.root=webix.ui(webix.copy(e),t);if(this.afterRender)this.afterRender.apply(this,arguments);return this},destroy:function(){if(this.root)this.root.destructor()},getRoot:function(){return this.root},getChild:function(e){webix.assert(this.root.$$,"You need to set isolate property for top view");return this.root.$$(e)}})})();webix.ActiveContent={$init:function(e){if(e.activeContent){this.$ready.push(this._init_active_content_list);this._active_holders={};this._active_holders_item={};this._active_holders_values={};this._active_references={};for(var t in e.activeContent){this[t]=this._bind_active_content(t);if(e.activeContent[t].earlyInit){var n=webix._parent_cell;webix._parent_cell=null;this[t].call(this,{},this,e.activeContent);webix._parent_cell=n}}}},_init_active_content_list:function(){if(this.filter){for(var e in this._settings.activeContent){this.type[e]=this[e];this[e]=this._locate_active_content_by_id(e)}this.type.masterUI=this}},_locate_active_content_by_id:function(e){return function(t){var n=this._active_references[e];var r=n._settings.id;var i=this.getItemNode(t).getElementsByTagName("DIV");for(var s=0;s<i.length;s++){if(i[s].getAttribute("view_id")==r){n._viewobj=n._dataobj=i[s];break}}return n}},_get_active_node:function(e,t,n){return function(r){if(r){var i=r.target||r.srcElement;while(i){if(i.getAttribute&&i.getAttribute("view_id")){e._dataobj=e._viewobj=e.$view=i;if(n.locate){var s=n.locate(i.parentNode);var o=n._active_holders_values[t][s];e._settings.value=o;e._settings.$masterId=s}return i}i=i.parentNode}}return e._viewobj}},_set_new_active_value:function(e,t){return function(n){var r=t.data;if(t.filter){var i=t.locate(this._viewobj.parentNode);r=t.getItem(i);this.refresh();t._active_holders_item[e][i]=this._viewobj.outerHTML||(new XMLSerializer).serializeToString(this._viewobj);t._active_holders_values[e][i]=n}r[e]=n}},_bind_active_content:function(e){return function(t,n,r){var i=n._active_holders?n:n.masterUI;if(!i._active_holders[e]){var s=document.createElement("DIV");r=r||i._settings.activeContent;var o=webix.ui(r[e],s);s.firstChild.setAttribute("onclick","webix.callEvent('onClick',[event]); event.cancelBubble = true;");o.getNode=i._get_active_node(o,e,i);o.attachEvent("onChange",i._set_new_active_value(e,i));i._active_references[e]=o;i._active_holders[e]=s.innerHTML;i._active_holders_item[e]={};i._active_holders_values[e]={}}if(i.filter&&t[e]!=i._active_holders_values[e]&&!webix.isUndefined(t[e])){var o=i._active_references[e];o.blockEvent();o.setValue(t[e]);o.unblockEvent();i._active_holders_values[e][t.id]=t[e];i._active_holders_item[e][t.id]=o._viewobj.outerHTML||(new XMLSerializer).serializeToString(o._viewobj)}return i._active_holders_item[e][t.id]||i._active_holders[e]}}};webix.protoUI({name:"video",$init:function(e){if(!e.id)e.id=webix.uid();this.$ready.push(this._init_video)},_init_video:function(){var e=this._settings;this._contentobj=webix.html.create("video",{"class":"webix_view_video",style:"width:100%;height:100%;",autobuffer:"autobuffer"},"");if(e.poster)this._contentobj.poster=e.poster;if(e.src){if(typeof e.src!="object")e.src=[e.src];for(var t=0;t<e.src.length;t++)this._contentobj.innerHTML+=' <source src="'+e.src[t]+'">'}if(e.controls)this._contentobj.controls=true;if(e.autoplay)this._contentobj.autoplay=true;this._viewobj.appendChild(this._contentobj)},getVideo:function(){return this._contentobj},defaults:{src:"",controls:true}},webix.ui.view);
